/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("webcore/data-backend/OnlineDataBackend",["./_DataBackend","../url-helpers","mendix/lang","mendix/lib/MxObject","mendix/lib/Error","mendix/logger","dojo/_base/array","dojo/_base/lang"],function(_1,_2,_3,_4,_5,_6,_7,_8){function _9(_a,_b){_1.call(this,_a);this._objectCache=_b;};_9.prototype=new _1();_9.prototype.getByGuid=function(_c,_d,_e,_f){window.mx.server.request({request:{action:"retrieve_by_ids",params:{ids:_c,schema:_d}},options:{callback:function(_10,_11){if(_e){_e(_11.mxobjects||[]);}},error:_f}});};_9.prototype.getByPath=function(_12,_13,_14,_15,_16){window.mx.server.request({request:{action:"retrieve_by_path",params:{id:_12,path:_13,entity:_14}},options:{callback:function(_17,_18){if(_15){_15(_18.mxobjects||[]);}},error:_16}});};_9.prototype.getByXPath=function(_19,_1a,_1b,_1c,_1d,_1e){_1a=_1a||{};window.mx.server.request({request:{action:"retrieve_by_xpath",params:{xpath:_19,schema:_1a,count:_1b,aggregates:_1c}},options:{callback:function(_1f,_20){if(_1d){_1d(_20.mxobjects,_20.count,_20.aggregates);}},error:_1e}});};_9.prototype.release=function(_21){mx.server.release(_21);};_9.prototype.action=function(_22,_23,_24,_25,_26,_27,_28){window.mx.server.request({request:{action:"executeaction",params:_22,context:_23},options:{store:_24,async:_25,onValidation:_26,callback:function(_29,_2a,_2b){if(_27){_27(_2a.actionResult,_2b);}},error:_28}});};_9.prototype.create=function(_2c,_2d,_2e,_2f){window.mx.server.request({request:{action:_2d?"create":"instantiate",params:{objecttype:_2c,preventCache:(new Date()).getTime()}},options:{callback:function(_30,_31){if(_2e){_2e(_31.mxobject);}},error:_2f}});};_9.prototype.save=function(_32,_33,_34,_35){window.mx.server.request({request:{action:"change",params:_32},options:{onValidation:_33,sync:true,unique:true,callback:_34,error:_35}});};_9.prototype.commit=function(_36,_37,_38,_39,_3a,_3b){window.mx.server.request({request:{action:"commit",params:{guid:_36},context:_37},options:{onValidation:_39,store:_38,callback:_3a,error:_3b}});};_9.prototype.rollback=function(_3c,_3d,_3e){window.mx.server.request({request:{action:"rollback",params:{guid:_3c}},options:{unique:true,standalone:true,callback:function(_3f,_40){if(_3d){_3d(_40.mxobject||null);}},error:_3e}});};_9.prototype.remove=function(_41,_42,_43){window.mx.server.request({request:{action:"delete",params:{guids:_41}},options:{callback:function(){if(_42){_42();}},error:_43}});};_9.prototype.saveDocument=function(_44,_45,_46,_47,_48,_49){var _4a=new FormData();if(_45!=null){_4a.append("mxdocument",_47,_45);}else{_4a.append("mxdocument",_47);}var xhr=new XMLHttpRequest();xhr.open("POST",_4b(),true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){if(_48){_48();}return;}var _4c=_4d(xhr.response);if(_49){_49(_4c||undefined);}}};xhr.responseType="document";xhr.send(_4a);function _4b(){var _4e=_8.mixin({},_46,{guid:_44,csrfToken:window.mx.session.getCSRFToken()});return window.mx.remoteUrl+"file?"+Object.keys(_4e).map(function(_4f){return _4f+"="+_4e[_4f];}).join("&");};function _4d(doc){var err;if(doc){err=_3.getFileError(doc,"mendix/lib/Upload._getError");}else{err=new Error("mendix/lib/Upload._getError: connection error");}return err;};};_9.prototype.getDocumentUrl=_2.getDynamicResourceUrl;return _9;});