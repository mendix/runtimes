/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("webcore/data-backend/OnlineDataBackend",["./_DataBackend","../url-helpers","mendix/lang","mendix/lib/MxObject","mendix/lib/Error","mendix/logger","dojo/_base/array","dojo/_base/lang"],function(_1,_2,_3,_4,_5,_6,_7,_8){function _9(_a,_b){_1.call(this,_a);this._objectCache=_b;};_9.prototype=new _1();_9.prototype.getByGuid=function(_c,_d,_e,_f){window.mx.server.request({request:{action:"retrieve_by_ids",params:{ids:_c,schema:_d}},options:{callback:function(_10,_11){if(_e){_e(_11.mxobjects||[]);}},error:_f}});};_9.prototype.getByPath=function(_12,_13,_14,_15){window.mx.server.request({request:{action:"retrieve_by_path",params:{id:_12,path:_13},context:null},options:{callback:function(_16,_17){if(_14){_14(_17.mxobjects||[]);}},error:_15}});};_9.prototype.getByXPath=function(_18,_19,_1a,_1b,_1c,_1d){window.mx.server.request({request:{action:"retrieve_by_xpath",params:{xpath:_18,schema:_19,count:_1a,aggregates:_1b}},options:{callback:function(_1e,_1f){if(_1c){_1c(_1f.mxobjects,_1f.count,_1f.aggregates);}},error:_1d}});};_9.prototype.release=function(_20){mx.server.release(_20);};_9.prototype.action=function(_21,_22,_23,_24,_25,_26,_27){window.mx.server.request({request:{action:"executeaction",params:_21,context:_22},options:{store:_23,async:_24,onValidation:_25,callback:function(_28,_29,_2a){if(_26){_26(_29.actionResult,_2a);}},error:_27}});};_9.prototype.create=function(_2b,_2c,_2d,_2e){window.mx.server.request({request:{action:_2c?"create":"instantiate",params:{objecttype:_2b,preventCache:(new Date()).getTime()}},options:{callback:function(_2f,_30){if(_2d){_2d(_30.mxobject);}},error:_2e}});};_9.prototype.save=function(_31,_32,_33,_34){window.mx.server.request({request:{action:"change",params:_31},options:{onValidation:_32,sync:true,unique:true,callback:_33,error:_34}});};_9.prototype.commit=function(_35,_36,_37,_38,_39,_3a){window.mx.server.request({request:{action:"commit",params:{guid:_35},context:_36},options:{onValidation:_38,store:_37,callback:_39,error:_3a}});};_9.prototype.rollback=function(_3b,_3c,_3d){window.mx.server.request({request:{action:"rollback",params:{guid:_3b}},options:{unique:true,standalone:true,callback:function(_3e,_3f){if(_3c){_3c(_3f.mxobject||null);}},error:_3d}});};_9.prototype.remove=function(_40,_41,_42){window.mx.server.request({request:{action:"delete",params:{guids:_40}},options:{callback:function(){if(_41){_41();}},error:_42}});};_9.prototype.saveDocument=function(_43,_44,_45,_46,_47){var _48=new FormData();_48.append("mxdocument",_45);var xhr=new XMLHttpRequest();xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){if(_46){_46();}return;}var _49=_4a(xhr.response);if(_47){_47(_49||undefined);}}};xhr.open("post",_4b(),true);xhr.responseType="document";xhr.send(_48);function _4b(){var _4c=_8.mixin({},_44,{guid:_43,csrfToken:window.mx.session.getCSRFToken()});return window.mx.remoteUrl+"file?"+Object.keys(_4c).map(function(_4d){return _4d+"="+_4c[_4d];}).join("&");};function _4a(doc){var err;if(doc){err=_3.getFileError(doc,"mendix/lib/Upload._getError");}else{err=new Error("mendix/lib/Upload._getError: connection error");}return err;};};_9.prototype.getDocumentUrl=_2.getDynamicResourceUrl;return _9;});