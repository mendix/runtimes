/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("webcore/data-backend/OnlineDataBackend",["./_DataBackend","../url-helpers","../Task","mendix/lang","mendix/lib/MxObject","mendix/lib/Error","mendix/logger","dojo/_base/array","dojo/_base/lang"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){function _a(_b,_c){_1.call(this,_b);this._objectCache=_c;};_a.prototype=new _1();_a.prototype.getByGuid=function(_d,_e,_f,_10){window.mx.server.request({request:{action:"retrieve_by_ids",params:{ids:_d,schema:_e}},options:{callback:function(_11,_12){if(_f){_f(_12.mxobjects||[]);}},error:_10}});};_a.prototype.getByPath=function(_13,_14,_15,_16,_17){window.mx.server.request({request:{action:"retrieve_by_path",params:{id:_13,path:_14,entity:_15}},options:{callback:function(_18,_19){if(_16){_16(_19.mxobjects||[]);}},error:_17}});};_a.prototype.getByXPath=function(_1a,_1b,_1c,_1d,_1e,_1f){_1b=_1b||{};window.mx.server.request({request:{action:"retrieve_by_xpath",params:{xpath:_1a,schema:_1b,count:_1c,aggregates:_1d}},options:{callback:function(_20,_21){if(_1e){_1e(_21.mxobjects,_21.count,_21.aggregates);}},error:_1f}});};_a.prototype.release=function(_22){mx.server.release(_22);};_a.prototype.action=function(_23,_24,_25,_26,_27,_28,_29){window.mx.server.request({request:{action:"executeaction",params:_23,context:_24},options:{store:_25,async:_26,onValidation:_27,callback:function(_2a,_2b,_2c){if(_28){_28(_2b.actionResult,_2c);}},error:_29}});};_a.prototype.upload=function(_2d){return _3.of({});};_a.prototype.download=function(){return _3.of({});};_a.prototype.create=function(_2e,_2f,_30,_31){window.mx.server.request({request:{action:_2f?"create":"instantiate",params:{objecttype:_2e,preventCache:(new Date()).getTime()}},options:{callback:function(_32,_33){if(_30){_30(_33.mxobject);}},error:_31}});};_a.prototype.save=function(_34,_35,_36,_37){window.mx.server.request({request:{action:"change",params:_34},options:{onValidation:_35,sync:true,unique:true,callback:_36,error:_37}});};_a.prototype.commit=function(_38,_39,_3a,_3b,_3c,_3d){window.mx.server.request({request:{action:"commit",params:{guid:_38},context:_39},options:{onValidation:_3b,store:_3a,callback:_3c,error:_3d}});};_a.prototype.rollback=function(_3e,_3f,_40){window.mx.server.request({request:{action:"rollback",params:{guid:_3e}},options:{unique:true,standalone:true,callback:function(_41,_42){if(_3f){_3f(_42.mxobject||null);}},error:_40}});};_a.prototype.remove=function(_43,_44,_45){window.mx.server.request({request:{action:"delete",params:{guids:_43}},options:{callback:function(){if(_44){_44();}},error:_45}});};_a.prototype.saveDocument=function(_46,_47,_48,_49,_4a,_4b){var _4c=new FormData();if(_47!=null){_4c.append("mxdocument",_49,_47);}else{_4c.append("mxdocument",_49);}var xhr=new XMLHttpRequest();xhr.open("POST",_4d(),true);xhr.onreadystatechange=function(){if(xhr.readyState==4){if(xhr.status==200){if(_4a){_4a();}return;}var _4e=_4f(xhr.response);if(_4b){_4b(_4e||undefined);}}};xhr.responseType="document";xhr.send(_4c);function _4d(){var _50=_9.mixin({},_48,{guid:_46,csrfToken:window.mx.session.getCSRFToken()});return window.mx.remoteUrl+"file?"+Object.keys(_50).map(function(_51){return _51+"="+_50[_51];}).join("&");};function _4f(doc){var err;if(doc){err=_4.getFileError(doc,"mendix/lib/Upload._getError");}else{err=new Error("mendix/lib/Upload._getError: connection error");}return err;};};_a.prototype.getDocumentUrl=_2.getDynamicResourceUrl;return _a;});