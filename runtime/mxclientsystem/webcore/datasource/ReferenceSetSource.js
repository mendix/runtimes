/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("webcore/datasource/ReferenceSetSource",["./_XPathSourceBase","mendix/lang","mendix/logger","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5){var _6=_5(_1,{name:"webcore.datasource.ReferenceSetSource",_xpath:"",_reference:"",_sourceObject:null,constructor:function(_7){this.inherited(arguments);var _8=_7.path.split("/"),_9=_8.pop(),_a=_8.pop();this._xpath="//"+_9;this._reference=_a;this._selectconstraints="[1=0]";},reload:function(_b){this._runQuery(_b);},refresh:function(_c){this._runQuery(_c);},update:function(_d){this._runQuery(_d);},entityUpdate:function(_e){this._runQuery(_e);},generateExport:function(_f){_f.params=_4.mixin({},_f.params,{xpath:this.getCurrentXPath(),sort:this.getSortSettings(),gridid:this._schemaId});window.mx.data.generateExport(_f);},getCurrentXPath:function(){return this._xpathString()+this._selectconstraints;},setObject:function(obj){this._sourceObject=obj;},_runQuery:function(_10){var _11=_2.nullExec;if(this._sourceObject){var _12=this._sourceObject.getReferences(this._reference);if(_12.length>0){var _13=[];for(var i=0,_14;_14=_12[i];++i){_13.push("id=\""+_14+"\"");}this._selectconstraints="["+_13.join(" or ")+"]";window.mx.data.get({xpath:this.getCurrentXPath(),filter:this.getFilterOptions(),count:true,callback:function(_15,_16){this._setObjects(_15);this._setSetSize(_16.count);_11(_10);},error:function(e){window.mx.onError(e);_11(_10);}},this);}else{this._selectconstraints="[1=0]";this._setObjects([]);this._setSetSize(0);_11(_10);}}else{_11(_10);}},_xpathString:function(){return this._xpath+this.getStaticConstraint()+this.getConstraints();}});return _6;});