/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("webcore/sql/SelectBuilder",["./constants"],function(_1){var _2={"equals":_3("="),"lessThan":_3("<"),"lessThanOrEquals":_3("<="),"greaterThan":_3(">"),"greaterThanOrEquals":_3(">="),"contains":_4};function _5(_6,_7){if(!(this instanceof _5)){return new _5();}this._select=_7&&_7.select||_6&&_6._select||null;this._from=_7&&_7.from||_6&&_6._from||{};this._constraints=_7&&_7.constraints||_6&&_6._constraints||[];this._orderBy=_7&&_7.orderBy||_6&&_6._orderBy||[];this._limit=_7&&_7.limit||_6&&_6._limit||null;this._offset=_7&&_7.offset||_6&&_6._offset||null;};_5.prototype.from=function(_8,_9){return new _5(this,{from:{name:_8,alias:_9}});};_5.prototype.where=function(_a,_b){return this._where(_a,false,_b);};_5.prototype.whereNot=function(_c,_d){return this._where(_c,true,_d);};_5.prototype.whereNull=function(_e,_f){return this._whereNull(_e,false,_f);};_5.prototype.whereNotNull=function(_10,_11){return this._whereNull(_10,true,_11);};_5.prototype.order=function(_12,_13){return new _5(this,{orderBy:this._orderBy.concat([[_12,_13]])});};_5.prototype.limit=function(n){return new _5(this,{limit:n});};_5.prototype.offset=function(n){return new _5(this,{offset:n});};_5.prototype.select=function(_14,_15){if(Array.isArray(_14)){_14=_14.join(", ");}var sql="SELECT "+_14;if(_15){sql+=" AS "+_15;}sql+=this._buildSql();return sql;};_5.prototype._where=function(_16,_17,_18){return new _5(this,{constraints:this._constraints.concat([new _19(_16,_18,_17)])});};_5.prototype._whereNull=function(_1a,_1b){return new _5(this,{constraints:this._constraints.concat([new _1c(_1a,_1b)])});};_5.prototype._buildSql=function(){var sql="";sql+=" FROM "+this._from.name;if(this._from.alias){sql+=" AS "+this._from.alias;}if(this._constraints.length>0){sql+=" WHERE "+this._constraints.map(function(_1d){return _1d.toString();}).join(" AND ");}if(this._orderBy.length>0){sql+=" ORDER BY "+this._orderBy.map(function(_1e){return _1e[0]+" "+_1e[1];}).join(", ");}if(this._limit){sql+=" LIMIT "+this._limit;}if(this._offset){sql+=" OFFSET "+this._offset;}return sql;};function _1c(_1f,_20){this._column=_1f;this._negate=!!_20;};_1c.prototype.toString=function(){return this._column+" IS "+(this._negate?"NOT ":"")+"NULL";};function _19(_21,_22,_23){this._column=_21;this._operator=_22;this._negate=!!_23;};_19.prototype.toString=function(){var _24=_2[this._operator];return (this._negate?"NOT ":"")+_24(this._column);};return _5;function _3(_25){return function(_26){return _26+" "+_25+" ?";};};function _4(_27){var _28="";_28+=_27;_28+=" LIKE '%' || ? || '%'";_28+=" ESCAPE '"+_1.LIKE_ESCAPE_CHAR+"'";return _28;};});