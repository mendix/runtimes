/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("webcore/sql/Store",["bluebird/bluebird","big/big","./transaction-creators","./runners","../Store","../TaskReader","../task-helpers"],function(_1,_2,_3,_4,_5,_6,_7){function _8(){return window.openDatabase("MendixDatabase","1","Mendix Database",10*1024*1024);};function _9(_a,_b,_c,_d){_5.call(this,_a,_b);_d=_d||_8;this._tableNames=Object.keys(_c);this._db=_d();this._initialize()(this._db);};_9.prototype=Object.create(_5.prototype);_9.prototype._getDatabase=function(){return this._databasePromise;};_9.prototype._initialize=function(){return function(db){var _e=_3.createCreateTransaction(this._tableNames);this._databasePromise=_7.promiseFromTask(_4.runWriteTransaction(db,_e)).then(function(){return db;});return this._databasePromise;}.bind(this);};_9.prototype._deleteDatabase=function(){return function(db){var _f=_3.createDropAllTablesTransaction(this._tableNames);this._databasePromise=_7.promiseFromTask(_4.runWriteTransaction(db,_f)).then(function(){return db;});return this._databasePromise;}.bind(this);};_9.prototype._fetch=function(_10){return function(db){var _11=_3.createFetchByGuidTransaction(_10);return _7.promiseFromTask(_4.runReadTransaction(db,_11));};};_9.prototype._fetchSlice=function(_12,_13,_14){return function(db){var _15=_3.createFetchSliceTransaction(_12,_13,_14.offset,_14.limit,_14.sort);return _7.promiseFromTask(_4.runReadTransaction(db,_15));};};_9.prototype._fillBulk=function(_16,_17){return _6.ask().chain(function(db){var _18=_3.createFillBulkTransaction(_16,_17);return new _6(function(_19){return _4.runWriteTransaction(db,_18);});});};_9.prototype._insertOrReplace=function(_1a,obj){return function(db){var _1b=_3.createInsertOrReplaceTransaction(_1a,obj);return _7.promiseFromTask(_4.runWriteTransaction(db,_1b));};};_9.prototype._upload=function(_1c){return function(db){var _1d=_3.createUploadTransaction(_1c);return _7.promiseFromTask(_4.runReadTransaction(db,_1d));};};_9.prototype._cleanupDirtyObjects=function(){return function(db){var _1e=_3.createDirtyCleanupTransaction();return _7.promiseFromTask(_4.runWriteTransaction(db,_1e));};};return _9;});