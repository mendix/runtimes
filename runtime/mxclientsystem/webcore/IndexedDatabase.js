/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("webcore/IndexedDatabase",["indexeddbshim/indexeddbshim","./SynchronousPromise"],function(_1,_2){function _3(db){this.transaction=function(_4,_5,_6){if(typeof _5=="function"){_6=_5;_5="readonly";}return new _2(function(_7,_8){var _9=db.transaction(_4,_5);var _a;_9.onerror=_8;_9.onabort=_8;_9.oncomplete=function(_b){_7(_a);};_a=_6(new _10(_9));});};this.createObjectStore=function(_c,_d,fn){var _e=db.createObjectStore(_c,_d);if(fn){fn(new _f(_e));}return this;};};function _10(_11){this.store=function(_12){var _13=_11.objectStore(_12);return new _f(_13);};};function _f(_14){this.key=function(key){this._key=key;return this;};this.get=function(_15,_16){var _17=this;return new _2(function(_18,_19){var _1a=_14.get(_17._key);_1a.onerror=_19;_1a.onsuccess=function(_1b){_18(_1b.target.result);};}).then(_15,_16);};this.cursor=function(_1c,_1d){return new _29(_14,_1c,_1d);};this.index=function(_1e,_1f,_20){return new _29(_14.index(_1e),_1f,_20);};this.count=function(){return new _2(function(_21,_22){var _23=_14.count();_23.onerror=_22;_23.onsuccess=function(_24){_21(_24.target.result);};});};this.add=function(_25,key){_14.add(_25,key);return this;};this.createIndex=function(_26,_27,_28){_14.createIndex(_26,_27,_28);return this;};};function _29(_2a,_2b,_2c){var _2d=null;var _2e=0;var _2f=-1;var _30=null;this.offset=function(n){_2e=n;return this;};this.limit=function(n){_2f=n;return this;};this.each=function(fn){_31(function(_32){if(_32!=null){fn(_32);}});return this;};this.toArray=function(fn){var _33=[];_31(function(_34){if(_34==null){fn(_33);}else{_33.push(_34);}});return this;};this["catch"]=this.caught=function(fn){_30=fn;};function _31(fn){var _35=0;_2d=_2a.openCursor(_2b,_2c);if(_30){_2d.onerror=_30;}if(_2e>0){_2d.onsuccess=_36;}else{_2d.onsuccess=_37;}function _36(_38){var _39=_38.target.result;_39.advance(_2e);_2d.onsuccess=_37;};function _37(_3a){var _3b=_3a.target.result;if(_3b&&(_2f==-1||_35<_2f)){fn(_3b.value);_3b["continue"]();}else{fn(null);}++_35;};};};return _3;});