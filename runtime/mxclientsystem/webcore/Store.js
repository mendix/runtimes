/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("webcore/Store",["mendix/lib/MxObject","bluebird/bluebird"],function(_1,_2){function _3(_4){this._fetchDescriptions=_4;};_3.prototype.getSlice=function(_5,_6,_7){return _8(this._getDatabase().then(this._fetchSlice(_5,_6,_7)));};_3.prototype.getByGuid=function(_9){return _8(this._getDatabase().then(this._fetch(_9)));};_3.prototype.insertOrReplace=function(_a,_b){return _8(this._getDatabase().then(this._insertOrReplace(_a,_b)));};_3.prototype.download=function(){var _c=this;function _d(){return _c._fetchDescriptions.map(function(fd){return _1d(fd.xpath).then(function(_e){return _c._getDatabase().then(_c._fillBulk(fd.store,_e.map(_1a))).then(function(){return _e.map(function(_f){return new _1({json:_f,meta:window.mx.meta.getEntity(_f.objectType)});});});});});};return _8(this._getDatabase().then(this._deleteDatabase()).then(this._initialize()).then(function(){return _2.all(_d());}).then(_10));};_3.prototype.upload=function(_11){return _8(this._getDatabase().then(this._upload(_11)));};_3.prototype.cleanupDirtyObjects=function(){return _8(this._getDatabase().then(this._cleanupDirtyObjects()));};_3.prototype._getDatabase=function(){return _2.reject(new Error("not implemented"));};_3.prototype._initialize=function(){return _2.reject(new Error("not implemented"));};_3.prototype._deleteDatabase=function(){return _2.reject(new Error("not implemented"));};_3.prototype._fetch=function(_12){return function(db){return _2.reject(new Error("not implemented"));};};_3.prototype._fetchSlice=function(_13,_14,_15){return function(db){return _2.reject(new Error("not implemented"));};};_3.prototype._insertOrReplace=function(_16,obj){return function(db){return _2.reject(new Error("not implemented"));};};_3.prototype._fillBulk=function(_17,_18){return function(db){return _2.reject(new Error("not implemented"));};};_3.prototype._upload=function(_19){return function(db){return _2.reject(new Error("not implemented"));};};_3.prototype._cleanupDirtyObjects=function(){return _2.reject(new Error("not implemented"));};return _3;function _1a(_1b){var _1c={guid:_1b.guid};for(var key in _1b.attributes){_1c[key]=_1b.attributes[key].value;}return _1c;};function _1d(_1e){return new _2(function(_1f,_20){window.mx.server.request({request:{action:"retrieve_by_xpath",params:{xpath:_1e,schema:{}}},options:{callback:function(_21,_22){_1f(_22.mxobjects||[]);},error:_20}});});};function _8(_23){return new _2(function(_24,_25){return _23.then(_24,_25);});};function _10(a){return [].concat.apply([],a);};});