/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("webcore/offline",["mendix/lib/MxObject","./IndexedDatabase","./IndexedDbOffline","./SynchronousPromise","bluebird/bluebird"],function(_1,_2,_3,_4,_5){return {getSlice:function(_6,_7){return new _5(function(_8,_9){return _21().then(_3.fetchSlice(_6,_7)).spread(function(_a,_b){var _c=_a.map(function(_d){return _e(_6,_d);});_8([_c,_b]);});});},getSliceReference:function(_f,_10,_11,_12){return new _5(function(_13,_14){return _21().then(_3.fetchSliceReference(_f,_10,_11,_12)).spread(function(_15,_16){var _17=_15.map(function(obj){return _e(_f,obj);});_13([_17,_16]);});});},getByGuid:function(_18){return new _5(function(_19,_1a){return _21().then(_3.fetch(_18)).spread(function(obj,_1b){_19(_e(_1b,obj));});});},updateLocalDatabase:function(){return _3.deleteDatabase().then(_1c);}};function _1c(){return _1d().then(function(_1e){return _4.all(_1e.fetch.map(function(_1f){return _2e(_1f.xpath).spread(function(_20){return _21().then(_3.fillBulk(_1f.store,_20));});}));});};var _22=null;function _1d(){if(!_22){_22=new _5(function(_23,_24){window.mx.server.get({url:"components.json",handleAs:"json",load:function(_25){_23(_25.synchronize);},error:_24});});}return _22;};function _21(){return _1d().then(_3.getDatabase);};function _26(_27){var _28=_27.jsonData;var _29={guid:_28.guid};var _2a=_3.serialize(_28.attributes);for(var key in _2a){_29[key]=_2a[key].value;}return _29;};function _e(_2b,obj){var _2c={guid:obj.guid,objectType:_2b,attributes:{}};var _2d=_3.deserialize(obj);for(var key in _2d){if(key!="guid"){_2c.attributes[key]={value:_2d[key]};}}return new _1({json:_2c,meta:window.mx.meta.getEntity(_2b)});};function _2e(_2f){return new _5(function(_30,_31){mx.data.get({xpath:_2f,callback:function(_32,_33){_30([_32.map(_26),_33]);},error:_31});});};});