
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mendix/lib/ReferenceSetSource",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mendix.lib.ReferenceSetSource");_1.declare("mendix.lib.ReferenceSetSource",[mendix.lib.XPathSourceBase],{name:"mendix.lib.ReferenceSetSource",_xpath:"",_reference:"",_sourceObject:null,constructor:function(_4){this.inherited(arguments);this._xpath="//"+_4.entity;this._reference=_4.reference;this._selectconstraints="[1=0]";},reload:function(_5){this._runQuery(_5);},refresh:function(_6){this._runQuery(_6);},update:function(_7){this._runQuery(_7);},entityUpdate:function(_8){this._runQuery(_8);},generateExport:function(_9){_9.params=_1.mixin({},_9.params,{xpath:this.getCurrentXPath(),sort:this.getSortSettings(),gridid:this._schemaId});mx.data.generateExport(_9);},getCurrentXPath:function(){return this._xpathString()+this._selectconstraints;},setObject:function(_a){this._sourceObject=_a;},_runQuery:function(_b){var _c=mendix.lang.nullExec;if(this._sourceObject){var _d=this._sourceObject.getReferences(this._reference);if(_d.length>0){var _e=[];for(var i=0,_f;_f=_d[i];++i){_e.push("id=\""+_f+"\"");}this._selectconstraints="["+_e.join(" or ")+"]";mx.data.get({xpath:this.getCurrentXPath(),filter:this.getFilterOptions(),count:true,callback:function(_10,_11){this._setObjects(_10);this._setSetSize(_11.count);_c(_b);},error:function(e){mx.onError(e);_c(_b);}},this);}else{this._selectconstraints="[1=0]";this._setObjects([]);this._setSetSize(0);_c(_b);}}else{_c(_b);}},_xpathString:function(){return this._xpath+this.getStaticConstraint()+this.getConstraints();}});});