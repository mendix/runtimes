
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mendix/lib/ReferenceSetSource",["mendix/lib/XPathSourceBase","mendix/lang","mendix/logger","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5){var _6=_5(_1,{name:"mendix.lib.ReferenceSetSource",_xpath:"",_reference:"",_sourceObject:null,constructor:function(_7){this.inherited(arguments);this._xpath="//"+_7.entity;this._reference=_7.reference;this._selectconstraints="[1=0]";},reload:function(_8){this._runQuery(_8);},refresh:function(_9){this._runQuery(_9);},update:function(_a){this._runQuery(_a);},entityUpdate:function(_b){this._runQuery(_b);},generateExport:function(_c){_c.params=_4.mixin({},_c.params,{xpath:this.getCurrentXPath(),sort:this.getSortSettings(),gridid:this._schemaId});window.mx.data.generateExport(_c);},getCurrentXPath:function(){return this._xpathString()+this._selectconstraints;},setObject:function(_d){this._sourceObject=_d;},_runQuery:function(_e){var _f=_2.nullExec;if(this._sourceObject){var _10=this._sourceObject.getReferences(this._reference);if(_10.length>0){var _11=[];for(var i=0,_12;_12=_10[i];++i){_11.push("id=\""+_12+"\"");}this._selectconstraints="["+_11.join(" or ")+"]";window.mx.data.get({xpath:this.getCurrentXPath(),filter:this.getFilterOptions(),count:true,callback:function(_13,_14){this._setObjects(_13);this._setSetSize(_14.count);_f(_e);},error:function(e){window.mx.onError(e);_f(_e);}},this);}else{this._selectconstraints="[1=0]";this._setObjects([]);this._setSetSize(0);_f(_e);}}else{_f(_e);}},_xpathString:function(){return this._xpath+this.getStaticConstraint()+this.getConstraints();}});return _6;});