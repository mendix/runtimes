
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mendix/lib/SimpleXPathSource",["mendix/lib/XPathSourceBase","mendix/lang","mendix/logger","dojo/_base/declare"],function(_1,_2,_3,_4){var _5=_4(_1,{name:"mendix.lib.SimpleXPathSource",_xpath:"",_count:0,constructor:function(_6){var _7=_6.path;this._xpath="//"+_6.entity+this.getStaticConstraint();if(_7.length){this._xpath+="["+_7.reverse().join("/")+"=\"[%CurrentObject%]\"]";}},reload:function(_8){this._runQuery(_8);},refresh:function(_9){this._runQuery(_9);},update:function(_a){this._runQuery(_a);},getCurrentXPath:function(){return this._xpathString();},entityUpdate:function(_b){this._runQuery(_b);},_runQuery:function(_c){var _d=this._xpathString();if(_d){window.mx.data.get({xpath:this.getCurrentXPath(),filter:this.getFilterOptions(),count:true,callback:function(_e,_f){this._setObjects(_e);this._setSetSize(_f.count);_2.nullExec(_c);},error:function(e){window.mx.onError(e);_2.nullExec(_c);}},this);}else{this._setObjects([]);this._setSetSize(0);_2.nullExec(_c);}},_xpathString:function(){var _10=this._xpath+this.getConstraints();if(/\[%CurrentObject%\]/.test(_10)){var _11=this.context.getTrackId();if(_11){return _10.replace(/\[%CurrentObject%\]/g,this.context.getTrackId());}else{return "";}}else{return _10;}}});return _5;});