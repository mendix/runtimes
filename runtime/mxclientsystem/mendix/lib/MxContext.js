/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mendix/lib/MxContext",["mendix/lib/MxObject","mendix/logger","dojo/_base/lang","dojo/_base/array","dojo/_base/json","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6){var _7=0;var _8=_6(null,{constructor:function(_9){this.id=this.ident=++_7;this.trackId="";this.trackClass="";this.trackObject=null;this.localParams={};this.constraintby=[];this._contextStore={};if(_9){if(_9.mxcontext){this.dupFrom(_9.mxcontext);}if(_9.classname&&_9.mendixguid){this.setContext(_9.classname,_9.mendixguid);}else{if(_9.entity&&_9.guid){this.setContext(_9.entity,_9.guid);}}}},hasTrackEntity:function(){return this.trackClass!=="";},hasTrackId:function(){return !!this.trackId;},hasTrackObject:function(){return !!this.trackObject;},getTrackEntity:function(){return this.trackClass;},getTrackId:function(){return this.trackId;},getTrackObject:function(){return this.trackObject;},setTrackEntity:function(_a){if(_a==null){this.trackClass="";}else{if(typeof _a=="string"){this.trackClass=_a;}else{throw new Error("mendix/lib/MxContext.setTrackEntity: entity should be a string");}}},setTrackId:function(_b){this.trackId=_b;this.trackObject=null;},setTrackObject:function(_c){if(_c){this.setContext(_c.getEntity(),_c.getGuid());}this.trackObject=_c;},setObject:function(_d,_e,_f){if(_d){this.setContext(_d.getEntity(),_d.getGuid());}else{this.trackId=_f||"";if(_e){this.trackClass=_e;}}this.trackObject=_d;},getObject:function(){return this.trackObject;},setConstraints:function(_10){if(_10==null||_10===""||_10.length===0){return;}if(typeof _10=="string"){this.constraintby=_10.split(",");}else{this.constraintby=_10;}},getConstraints:function(){var t=[];for(var i=0;i<this.constraintby.length;i++){t.push(this.constraintby[i]);}return t;},hasBacktrack:function(){return this.constraintby.length!==0;},getContexts:function(){var c=[];for(var i in this._contextStore){if(typeof i!="undefined"&&this._contextStore[i]!==""){c.push(i);}}return c;},setContext:function(_11,_12){if((arguments.length==1)&&(arguments[0] instanceof _1)){var _13=arguments[0];_11=_13.getEntity(),_12=_13.getGuid();}if(typeof _11!="string"){throw new Error("mendix/lib/MxContext.setContext: parameter entity is not of type String");}if(_12==null){_12="";}this.setTrackId(_12);this.setTrackEntity(_11);this._contextStore[_11]=_12;},unsetContext:function(_14){if(typeof _14!="string"){throw new Error("mendix/lib/MxContext.unsetContext: parameter entity is not of type String");}delete this._contextStore[_14];},getContext:function(_15){if(typeof _15!="string"){throw new Error("mendix/lib/MxContext.getContext: parameter entity is not of type String");}if(_15 in this._contextStore){return this._contextStore[_15];}var _16=window.mx.meta.getEntity(_15),_17=null;_4.some(_16.getSubEntities(),function(_18){if(_18 in this._contextStore){_17=this._contextStore[_18];return true;}},this);return _17;},hasContext:function(_19){if(typeof _19!="string"){throw new Error("mendix/lib/MxContext.hasContext: parameter entity is not of type String");}return this.getContext(_19)!=null;},reset:function(){this._contextStore={};this.trackId=null;this.trackClass="";this.trackObject=null;},dupFrom:function(_1a){this.reset();this.mixin(_1a);},mixin:function(_1b){if(_1b){var _1c=_1b.getContexts();for(var i=0,c;c=_1c[i];i++){this.setContext(c,_1b.getContext(c));}this.setParams(_1b.getParams());this.setConstraints(_1b.getConstraints());this.setContext(_1b.getTrackEntity(),_1b.getTrackId());this.setTrackObject(_1b.getTrackObject());}else{var _1d=this.getTrackEntity();if(_1d){this.unsetContext(_1d);}this.setTrackId("");this.setTrackEntity("");this.setTrackObject(null);}},hasParam:function(key){return key in this.localParams;},getParam:function(key){if(!this.hasParam(key)){return null;}return this.localParams[key];},getParams:function(){return this.localParams;},setParam:function(key,_1e){if(key==null){throw new Error("mendix/lib/MxContext["+this.ident+"].setParam key is null");}this.localParams[key]=_1e;},setParams:function(obj){if(typeof obj!="object"){throw new Error("mendix/lib/MxContext["+this.ident+"].setParams requires an Object.");}for(var i in obj){this.localParams[i]=obj[i];}},unsetParam:function(key){delete this.localParams[key];},resetParams:function(){this.localParams={};},isEmpty:function(){for(var j in this._contextStore){return true;}},getGuidS:function(){var _1f=this.getContexts();var _20=this.getTrackId();var _21=_20?[_20]:[];for(var i=0,l=_1f.length;i<l;i++){var c=_1f[i];if(c!="System.owner"&&c!="System.changedBy"){var _22=this.getContext(c);if(_22!=_20){_21.push(_22);}}}return _21;},freeze:function(){this.setTrackEntity=this.setTrackId=this.setTrackObject=this.setConstraints=this.setBacktrack=this.setContext=this.unsetContext=this.unsetBacktrack=this.reset=this.dupFrom=this.setParam=this.setParams=this.unsetParam=this.resetParams=function(){_2.error("mendix/lib/MxContext["+this.ident+"].freeze: context is readonly");return false;};},toString:function(){return this.ident;},toJSON:function(){var _23=_3.mixin({},this);delete _23.trackObject;delete _23.toJSON;return JSON.stringify(_23);}});_8.fromJSON=function(_24){var _25=new _8();_3.mixin(_25,JSON.parse(_24));return _25;};return _8;});