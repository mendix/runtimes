
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mendix/lib/MxContext",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mendix.lib.MxContext");_1.declare("mendix.lib.MxContext",null,{constructor:function(_4){return function(_5){this.id=this.ident=++_4;this._app_flow_id="";this.trackId="";this.trackClass="";this.trackObject=null;this.localParams={};this.constraintby=[];this._contextStore={};this.saveStore={localParams:{},contexts:{}};if(_5){if(_5.mxcontext){this.dupFrom(_5.mxcontext);}if(_5.classname&&_5.mendixguid){this.setContext(_5.classname,_5.mendixguid);}else{if(_5.entity&&_5.guid){this.setContext(_5.entity,_5.guid);}}}};}(0),hasTrackEntity:function(){return this.trackClass!="";},hasTrackId:function(){return !!this.trackId;},hasTrackObject:function(){return !!this.trackObject;},getTrackEntity:function(){return this.trackClass;},getTrackId:function(){return this.trackId;},getTrackObject:function(){return this.trackObject;},setTrackEntity:function(_6){this.trackClass=_6;},setTrackId:function(_7){this.trackId=_7;this.trackObject=null;},setTrackObject:function(_8){if(_8){this.setContext(_8.getEntity(),_8.getGuid());}this.trackObject=_8;},setObject:function(_9,_a,_b){if(_9){this.setContext(_9.getEntity(),_9.getGuid());}else{this.trackId=_b||"";if(_a){this.trackClass=_a;}}this.trackObject=_9;},getObject:function(){return this.trackObject;},setConstraints:function(_c){if(!(_c==null||_c==""||_c.length==0)){if(typeof _c=="string"){this.constraintby=_c.split(",");}else{this.constraintby=_c;}}},getConstraints:function(){var t=[];for(var i=0;i<this.constraintby.length;i++){t.push(this.constraintby[i]);}return t;},hasBacktrack:function(){return this.constraintby.length!=0;},getContexts:function(){var c=[];for(var i in this._contextStore){if(typeof i!="undefined"&&this._contextStore[i]!=""){c.push(i);}}return c;},setContext:function(_d,_e){if((arguments.length==1)&&(arguments[0] instanceof mendix.lib.MxObject)){var _f=arguments[0];_d=_f.getEntity(),_e=_f.getGuid();}if(typeof _d!="string"){throw new Error("mendix.lib.MxContext.setContext: parameter className is not of type String");}else{if(String(_e).match(/^[0-9]+$/)==null){}}if(_e==null){_e="";}if(this._contextStore[_d]!=null){}else{}this.setTrackId(_e);this.setTrackEntity(_d);this._contextStore[_d]=_e;},unsetContext:function(_10){if(typeof _10!="string"){throw new Error("mendix.lib.MxContext.unsetContext: parameter className is not of type String");}if(this._contextStore[_10]!=null){}else{}delete this._contextStore[_10];},getContext:function(_11){if(typeof _11!="string"){throw new Error("mendix.lib.MxContext.getContext: parameter className is not of type String");}if(!this.hasContext(_11)){return false;}else{return this._contextStore[_11];}},hasContext:function(_12){if(typeof _12!="string"){throw new Error("mendix.lib.MxContext.hasContext: parameter className is not of type String");}return this._contextStore[_12]!==undefined;},reset:function(){this._contextStore={};this.trackId=null;this.trackClass="";this.trackObject=null;},dupFrom:function(_13){this.reset();this.mixin(_13);},mixin:function(_14){if(_14){var _15=_14.getContexts();for(var i=0,c;c=_15[i];i++){this.setContext(c,_14.getContext(c));}this.setParams(_14.getParams());this.setConstraints(_14.getConstraints());this.setContext(_14.getTrackEntity(),_14.getTrackId());this.setTrackObject(_14.getTrackObject());}else{var _16=this.getTrackEntity();if(_16){this.unsetContext(_16);}this.setTrackId("");this.setTrackEntity("");this.setTrackObject(null);}},save:function(){var _17=this.saveStore={contexts:{},localParams:{}};for(var i in this._contextStore){_17.contexts[i]=this._contextStore[i];}for(var i in this.localParams){_17.localParams[i]=this.localParams[i];}},restore:function(){var _18=this.saveStore;this._contextStore={};this.localParams={};for(var i in _18.contexts){this._contextStore[i]=_18.contexts[i];}for(var i in _18.localParams){this.localParams[i]=_18.localParams[i];}},hasParam:function(key){return (key in this.localParams);},getParam:function(key){if(!this.hasParam(key)){return null;}return this.localParams[key];},getParams:function(){return this.localParams;},setParam:function(key,_19){if(key==null){throw new Error("mendix.lib.MxContext["+this.ident+"].setParam key is null");}this.localParams[key]=_19;},setParams:function(obj){if(typeof obj!="object"){throw new Error("mendix.lib.MxContext["+this.ident+"].setParams requires an Object.");}for(var i in obj){this.localParams[i]=obj[i];}},unsetParam:function(key){delete this.localParams[key];},resetParams:function(){this.localParams={};},isEmpty:function(){for(var j in this._contextStore){return true;}},getGuidS:function(){var _1a=this.getContexts();var _1b=this.getTrackId();var _1c=_1b?[_1b]:[];for(var i=0,l=_1a.length;i<l;i++){var c=_1a[i];if(c!="System.owner"&&c!="System.changedBy"){var _1d=this.getContext(c);if(_1d!=_1b){_1c.push(_1d);}}}return _1c;},dump:function(){var _1e="";var _1f=this.getContexts();for(var i=0;i<_1f.length;i++){var _20=_1f[i];_1e+=" "+_20+": "+this.getContext(_20)+";";}return _1e;},serialize:function(){return _1.toJson(this._contextStore);},toQuery:function(){var _21=this._contextStore,_22=this.trackId,_23=[];for(var i in _21){var _24=_21[i];if(_24){_23[_24==_22?"unshift":"push"](i+"="+_24);}}return _23.join("&");},freeze:function(){this.setActiveClass=this.setTrackEntity=this.setTrackId=this.setTrackObject=this.setContextFromMxObject=this.setConstraints=this.setBacktrack=this.setContext=this.unsetContext=this.unsetBacktrack=this.reset=this.dupFrom=this.restore=this.setParam=this.setParams=this.unsetParam=this.resetParams=function(){logger.error("mendix.lib.MxContext["+this.ident+"].freeze: context is readonly");return false;};},setAppFlowId:function(_25){this._app_flow_id=_25;},getAppFlowId:function(){return this._app_flow_id;},toString:function(){return this.ident;}});});