
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mendix/lib/MxContext",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mendix.lib.MxContext");_1.declare("mendix.lib.MxContext",null,{constructor:function(_4){return function(_5){this.id=this.ident=++_4;this._app_flow_id="";this.trackId="";this.trackClass="";this.trackObject=null;this.localParams={};this.constraintby=[];this._contextStore={};this.saveStore={localParams:{},contexts:{}};if(_5){if(_5.mxcontext){this.dupFrom(_5.mxcontext);}if(_5.classname&&_5.mendixguid){this.setContext(_5.classname,_5.mendixguid);}else{if(_5.entity&&_5.guid){this.setContext(_5.entity,_5.guid);}}}};}(0),hasTrackEntity:function(){return this.trackClass!="";},hasTrackId:function(){return !!this.trackId;},hasTrackObject:function(){return !!this.trackObject;},getTrackEntity:function(){return this.trackClass;},getTrackId:function(){return this.trackId;},getTrackObject:function(){return this.trackObject;},setTrackEntity:function(_6){this.trackClass=_6;},setTrackId:function(_7){this.trackId=_7;this.trackObject=null;},setTrackObject:function(_8){if(_8){this.setContext(_8.getEntity(),_8.getGuid());}this.trackObject=_8;},setObject:function(_9,_a,_b){if(_9){this.setContext(_9.getEntity(),_9.getGuid());}else{this.trackId=_b||"";if(_a){this.trackClass=_a;}}this.trackObject=_9;},getObject:function(){return this.trackObject;},setConstraints:function(_c){if(!(_c==null||_c==""||_c.length==0)){if(typeof _c=="string"){this.constraintby=_c.split(",");}else{this.constraintby=_c;}}},getConstraints:function(){var t=[];for(var i=0;i<this.constraintby.length;i++){t.push(this.constraintby[i]);}return t;},hasBacktrack:function(){return this.constraintby.length!=0;},getContexts:function(){var c=[];for(var i in this._contextStore){if(typeof i!="undefined"&&this._contextStore[i]!=""){c.push(i);}}return c;},setContext:function(_d,_e){if((arguments.length==1)&&(arguments[0] instanceof mendix.lib.MxObject)){var _f=arguments[0];_d=_f.getEntity(),_e=_f.getGuid();}if(typeof _d!="string"){throw new Error("mendix.lib.MxContext.setContext: parameter className is not of type String");}else{if(String(_e).match(/^[0-9]+$/)==null){}}if(_e==null){_e="";}if(this._contextStore[_d]!=null){}else{}this.setTrackId(_e);this.setTrackEntity(_d);this._contextStore[_d]=_e;},unsetContext:function(_10){if(typeof _10!="string"){throw new Error("mendix.lib.MxContext.unsetContext: parameter className is not of type String");}if(this._contextStore[_10]!=null){}else{}delete this._contextStore[_10];},getContext:function(_11){if(typeof _11!="string"){throw new Error("mendix.lib.MxContext.getContext: parameter className is not of type String");}if(_11 in this._contextStore){return this._contextStore[_11];}var _12=mx.meta.getEntity(_11),_13=null;_1.some(_12.getSubEntities(),function(_14){if(_14 in this._contextStore){_13=this._contextStore[_14];return true;}},this);return _13;},hasContext:function(_15){if(typeof _15!="string"){throw new Error("mendix.lib.MxContext.hasContext: parameter className is not of type String");}return this.getContext(_15)!=null;},reset:function(){this._contextStore={};this.trackId=null;this.trackClass="";this.trackObject=null;},dupFrom:function(_16){this.reset();this.mixin(_16);},mixin:function(_17){if(_17){var _18=_17.getContexts();for(var i=0,c;c=_18[i];i++){this.setContext(c,_17.getContext(c));}this.setParams(_17.getParams());this.setConstraints(_17.getConstraints());this.setContext(_17.getTrackEntity(),_17.getTrackId());this.setTrackObject(_17.getTrackObject());}else{var _19=this.getTrackEntity();if(_19){this.unsetContext(_19);}this.setTrackId("");this.setTrackEntity("");this.setTrackObject(null);}},save:function(){var _1a=this.saveStore={contexts:{},localParams:{}};for(var i in this._contextStore){_1a.contexts[i]=this._contextStore[i];}for(var i in this.localParams){_1a.localParams[i]=this.localParams[i];}},restore:function(){var _1b=this.saveStore;this._contextStore={};this.localParams={};for(var i in _1b.contexts){this._contextStore[i]=_1b.contexts[i];}for(var i in _1b.localParams){this.localParams[i]=_1b.localParams[i];}},hasParam:function(key){return (key in this.localParams);},getParam:function(key){if(!this.hasParam(key)){return null;}return this.localParams[key];},getParams:function(){return this.localParams;},setParam:function(key,_1c){if(key==null){throw new Error("mendix.lib.MxContext["+this.ident+"].setParam key is null");}this.localParams[key]=_1c;},setParams:function(obj){if(typeof obj!="object"){throw new Error("mendix.lib.MxContext["+this.ident+"].setParams requires an Object.");}for(var i in obj){this.localParams[i]=obj[i];}},unsetParam:function(key){delete this.localParams[key];},resetParams:function(){this.localParams={};},isEmpty:function(){for(var j in this._contextStore){return true;}},getGuidS:function(){var _1d=this.getContexts();var _1e=this.getTrackId();var _1f=_1e?[_1e]:[];for(var i=0,l=_1d.length;i<l;i++){var c=_1d[i];if(c!="System.owner"&&c!="System.changedBy"){var _20=this.getContext(c);if(_20!=_1e){_1f.push(_20);}}}return _1f;},dump:function(){var _21="";var _22=this.getContexts();for(var i=0;i<_22.length;i++){var _23=_22[i];_21+=" "+_23+": "+this.getContext(_23)+";";}return _21;},serialize:function(){return _1.toJson(this._contextStore);},toQuery:function(){var _24=this._contextStore,_25=this.trackId,_26=[];for(var i in _24){var _27=_24[i];if(_27){_26[_27==_25?"unshift":"push"](i+"="+_27);}}return _26.join("&");},freeze:function(){this.setActiveClass=this.setTrackEntity=this.setTrackId=this.setTrackObject=this.setContextFromMxObject=this.setConstraints=this.setBacktrack=this.setContext=this.unsetContext=this.unsetBacktrack=this.reset=this.dupFrom=this.restore=this.setParam=this.setParams=this.unsetParam=this.resetParams=function(){logger.error("mendix.lib.MxContext["+this.ident+"].freeze: context is readonly");return false;};},setAppFlowId:function(_28){this._app_flow_id=_28;},getAppFlowId:function(){return this._app_flow_id;},toString:function(){return this.ident;}});});