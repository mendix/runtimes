
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mendix/sys/Remote",["mendix/lang","mendix/ov","mendix/logger","dojo/_base/lang"],function(_1,ov,_2,_3){function _4(){var _5="mendix.sys.Remote",_6=false,_7={system:new _4.SystemCall(),component:new _4.ComponentCall(),application:new _4.ApplicationCall()};var _8=function(_9,_a){var _b=_3.clone(_9.instructions),_c=[];for(var i=0,_d;_d=_b[i];i++){if(/(open_form|close)/.test(_d.type)){_c.push(_d);_b.splice(i,1);}}if(_a){}else{_b=_c.concat(_b);}return _b;};this.toString=function(){return _5;};this.startup=function(_e){_6=true;_e();};this.shutdown=function(){_6=false;};this.isLoaded=function(){return _6;};this.hasInstructions=function(_f){return !!(_f&&_f.instructions!=null&&_f.instructions.length);};this.execute=function(_10,_11,_12,_13){if(this.hasInstructions(_10)){var _14=[],_15=_8(_10,_12);if(_15.length>10){}for(var i=0,_16;_16=_15[i];i++){var _17=_16.target;if(_7[_17]){_14.push(_7[_17].buildInstruction(_16,_11||{}));}else{}}_1.sequence(_14,_13);}else{_13&&_13();}};this.hasValidation=function(_18){return ov.hasValidations(_18);};this.getValidations=function(_19){return ov.getValidations(_19);};};_4.SystemCall=function(){var _1a="mendix.sys.Remote.SystemCall",_1b={text_message:"actTextMessage",refresh_object_list:"actRefreshObjectList",refresh_object:"actRefreshObject",refresh_class:"actRefreshClass",open_form:"actOpenForm",download_file:"actDownloadFile",show_login:"actShowLogin",logout:"logout"};var _1c=function(_1d){var _1e=mx.context.create();if(!_1d){return _1e;}var _1f="",_20=_1d.items||[];for(var i=0,_21;_21=_20[i];i++){var _22=_21.guid,_23=_21.classname;if(_23&&_22){_1e.setContext(_23,_22);if(_22==_1d.activeguid){_1f=_23;}}}if(_1f){_1e.setTrackEntity(_1f);}return _1e;};this.actTextMessage=function(_24,_25,_26){var _27=_24.args,_28=_27.MessageContent,_29=_27.MessageType,_2a=String(_27.MessageBlock)=="true";if(_28!=null&&_29!=null){(mx.ui[_29.toLowerCase()]||mx.ui.info)(_28,_2a);}else{throw new Error(_1a+".actTextMessage: message content is null");}_26&&_26();};this.actRefreshObjectList=function(_2b,_2c,_2d){var _2e=_2b.args.mxobjects,_2f=[];if(_2e&&_2e.length){var _30={},_31=_2e.length;while(_31--){var obj=_2e[_31];if(typeof obj=="object"&&obj.objectType){var _32=mx.data.setOrRetrieveMxObject(obj);_30[_32.getEntity()]=true;_2f.push((function(_33){return function(cb){mx.data.objectPing(_33,cb);};})(_32));}else{_2.error(_1a+"actRefreshObjectList: invalid json object");}}_2f.push(function(cb){for(var _34 in _30){mx.data.sendClassUpdate(_34);}cb();});_1.collect(_2f,_2d);}else{_2d&&_2d();}};this.actRefreshClass=function(_35,_36,_37){var _38=_35.args.ObjectClass;if(_38!=null){mx.data.sendClassUpdate(_38);}else{}_37&&_37();};this.actOpenForm=function(_39,_3a,_3b){var _3c=_1c(_39.context),_3d=_39.args,_3e=String(_3d.FormTarget).toLowerCase();if(_3d.FormGuid){_3c.setContext(_3d.FormEntity,_3d.FormGuid);}mx.ui.openForm(_3d.FormPath,{title:_3d.FormTitle,location:(_3e=="window")?"popup":_3e,width:_3d.FormWidth,height:_3d.FormHeight,resizable:_3d.FormResizable,context:_3c,dir:_3a.dir});_3b&&_3b();};this.actDownloadFile=function(_3f,_40,_41){var _42=_3f.args.FileDocument,_43=_3f.args.Target;if(!_42){_41&&_41();return;}mx.ui.downloadFile({mxobject:mx.data.setOrRetrieveMxObject(_42),target:_43});_41&&_41();};this.actShowLogin=function(_44,_45,_46){mx.ui.showLogin();_46&&_46();};this.logout=function(_47,_48,_49){mx.logout();_49();};this.buildInstruction=function(_4a,_4b){var _4c=_1b[_4a.type];if(_4c){return _3.hitch(this,_1b[_4a.type],_4a,_4b);}else{return function(_4d){_4d&&_4d();};}};};_4.ComponentCall=function(){var _4e="mendix.sys.Remote.ComponentCall";this.buildInstruction=function(_4f,_50){var _51=_50.caller;if(_51&&_51.hasInterface&&_51.hasInterface(_4f.type)){return function(_52){try{_51.invokeCall(_4f.type,_4f.args);}catch(e){_2.error(_4e+".buildInstruction: error occurred while executing instruction: "+e.message);}_52&&_52();};}else{return function(_53){_53&&_53();};}};};_4.ApplicationCall=function(){var _54="mendix.sys.Remote.ApplicationCall";this.buildInstruction=function(_55,_56){return function(_57){_57&&_57();};};};return _4;});