/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mendix/sys/Remote",["mendix/lang","mendix/ov","mendix/logger","dojo/_base/lang"],function(_1,ov,_2,_3){function _4(){var _5="mendix.sys.Remote",_6={system:new _4.SystemCall(),component:new _4.ComponentCall(),application:new _4.ApplicationCall()};var _7=function(_8,_9){var _a=_3.clone(_8.instructions),_b=[];for(var i=0,_c;_c=_a[i];){if(/(open_form|close)/.test(_c.type)){_b.push(_c);_a.splice(i,1);}else{i++;}}if(_9){}else{_a=_b.concat(_a);}return _a;};this.toString=function(){return _5;};this.hasInstructions=function(_d){return !!(_d&&_d.instructions!=null&&_d.instructions.length);};this.execute=function(_e,_f,_10,_11){if(this.hasInstructions(_e)){var _12=[],_13=_7(_e,_10);if(_13.length>10){}for(var i=0,_14;_14=_13[i];i++){var _15=_14.target;if(_6[_15]){_12.push(_6[_15].buildInstruction(_14,_f||{}));}else{}}_1.sequence(_12,_11);}else{_11&&_11();}};this.hasValidation=function(_16){return ov.hasValidations(_16);};this.getValidations=function(_17){return ov.getValidations(_17);};};_4.SystemCall=function(){var _18="mendix.sys.Remote.SystemCall",_19={text_message:"actTextMessage",refresh_object_list:"actRefreshObjectList",refresh_class:"actRefreshClass",open_form:"actOpenForm",download_file:"actDownloadFile",show_login:"actShowLogin",logout:"logout"};var _1a=function(_1b){var _1c=new mendix.lib.MxContext();if(!_1b){return _1c;}var _1d="",_1e=_1b.items||[];for(var i=0,_1f;_1f=_1e[i];i++){var _20=_1f.guid,_21=_1f.classname;if(_21&&_20){_1c.setContext(_21,_20);if(_20==_1b.activeguid){_1d=_21;}}}if(_1d){_1c.setTrackEntity(_1d);}return _1c;};this.actTextMessage=function(_22,_23,_24){var _25=_22.args,_26=_25.MessageContent,_27=_25.MessageType,_28=String(_25.MessageBlock)=="true";if(_26!=null&&_27!=null){(mx.ui[_27.toLowerCase()]||mx.ui.info)(_26,_28);}else{throw new Error(_18+".actTextMessage: message content is null");}_24&&_24();};this.actRefreshObjectList=function(_29,_2a,_2b){var _2c=_29.args.mxobjects,_2d=[];if(_2c&&_2c.length){var _2e={},_2f=_2c.length;while(_2f--){var obj=_2c[_2f];if(typeof obj=="object"&&obj.objectType){var _30=mx.data.setOrRetrieveMxObject(obj);_2e[_30.getEntity()]=true;_2d.push((function(_31){return function(cb){mx.data.objectPing(_31,cb);};})(_30));}else{_2.error(_18+"actRefreshObjectList: invalid json object");}}_2d.push(function(cb){for(var _32 in _2e){mx.data.sendClassUpdate(_32);}cb();});_1.collect(_2d,_2b);}else{_2b&&_2b();}};this.actRefreshClass=function(_33,_34,_35){var _36=_33.args.ObjectClass;if(_36!=null){mx.data.sendClassUpdate(_36);}else{}_35&&_35();};this.actOpenForm=function(_37,_38,_39){var _3a=_1a(_37.context),_3b=_37.args,_3c=_3b.FormTarget;if(_3b.FormGuid){_3a.setContext(_3b.FormEntity,_3b.FormGuid);}else{_3a.setTrackId(null);_3a.setTrackEntity(null);}if(_3c=="popup"||_3c=="modal"){mx.ui.openFormInPopup(_3b.FormPath,{title:_3b.FormTitle,width:_3b.FormWidth,height:_3b.FormHeight,resizable:_3b.FormResizable,modal:_3c=="modal"},_3a,null,_39);}else{mx.ui.openFormInContent(_3b.FormPath,_3b.FormTitle,_3a);_39&&_39();}};this.actDownloadFile=function(_3d,_3e,_3f){var _40=_3d.args.FileDocument,_41=_3d.args.Target;if(!_40){_3f&&_3f();return;}mx.ui.downloadFile({mxobject:mx.data.setOrRetrieveMxObject(_40),target:_41});_3f&&_3f();};this.actShowLogin=function(_42,_43,_44){mx.ui.showLogin();_44&&_44();};this.logout=function(_45,_46,_47){mx.logout();_47();};this.buildInstruction=function(_48,_49){var _4a=_19[_48.type];if(_4a){return _3.hitch(this,_19[_48.type],_48,_49);}else{return function(_4b){_4b&&_4b();};}};};_4.ComponentCall=function(){var _4c="mendix.sys.Remote.ComponentCall";this.buildInstruction=function(_4d,_4e){var _4f=_4e.caller;if(_4f&&_4f.hasInterface&&_4f.hasInterface(_4d.type)){return function(_50){try{_4f.invokeCall(_4d.type,_4d.args);}catch(e){_2.error(_4c+".buildInstruction: error occurred while executing instruction: "+e.message);}_50&&_50();};}else{return function(_51){_51&&_51();};}};};_4.ApplicationCall=function(){var _52="mendix.sys.Remote.ApplicationCall";this.buildInstruction=function(_53,_54){return function(_55){_55&&_55();};};};return _4;});