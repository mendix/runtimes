
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mendix/Client",["mendix/sys/Meta","mendix/sys/Server","mendix/sys/XAS","mendix/sys/Context","mendix/sys/Data","mendix/sys/Session","mendix/sys/Remote","mendix/lang","mendix/logger","dojo/_base/lang"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){function _b(_c){_c=_c||{};var _d=function(){var _e=window.location.href,_f=_e.indexOf("#");if(_f!=-1){_e=_e.slice(0,_f);}return _e.slice(0,_e.lastIndexOf("/")+1);};this.offline=!!_c.offline;this.appUrl=_c.appUrl||_d();this.baseUrl=_c.baseUrl||(this.appUrl+"xas/");this.modulePath=_c.modulePath||"../../widgets/";var _10=this,_11="mendix.Client",_12=false,_13=[],_14={"meta":_1,"server":_2,"xas":_3,"context":_4,"data":_5,"session":_6,"remote":_7};var _15=function(){for(var i in _14){_10[i]=new _14[i](_c[i]);}};var _16=function(){var _17=[],_18="startup";for(var i in _14){var sub=_10[i];if(sub[_18]){_17.push((function(sub,id){return function(_19){sub[_18](_19);};})(sub,i));}}_8.sequence(_17,function(_1a){while(_13.length!=0){_13.pop()();}_12=true;});};var _1b=function(){var i=0,_1c=[];for(_1c[i++] in _14){}for(var j=0,sys;sys=_1c[j];j++){_10[sys].shutdown();}};this.toString=function(){return _11;};this.startup=function(){_15();};this.isLoaded=function(){return _12;};this.registerSubSystem=function(_1d,sys,_1e){var _1f=_a.getObject(sys);if(!_1f){_9.error(_11+".registerSubSystem: "+_1d+" not found");}else{if(_14[_1d]){_9.error(_11+".registerSubSystem: "+_1d+" already registered");}else{_c[_1d]=_1e;_14[_1d]=_1f;}}};this.addOnLoad=function(fnc){_12?fnc():_13.push(fnc);};this.login=function(_20){this.session.authorized({yes:function(){_10.ui.hideLogin();_12&&_1b();_16();},no:function(_21){_10.ui.setupLoginPage();_10.ui.showLogin(_a.mixin(_21,_20));}});};this.logout=function(_22){if(_12){_12=false;_1b();}this.login(_22);};this.onError=function(err){};};return _b;});