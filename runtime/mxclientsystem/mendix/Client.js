
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mendix/Client",["mendix/sys/Meta","mendix/sys/Server","mendix/sys/XAS","mendix/sys/Context","mendix/sys/Data","mendix/sys/Session","mendix/sys/Remote","mendix/lang","mendix/logger","dojo/_base/lang"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){function _b(_c){_c=_c||{};var _d=function(){var _e=location.href,_f=_e.indexOf("#"),_10;if(_f!=-1){_e=_e.slice(0,_f);}_10=_e.lastIndexOf("/");if(_10==-1){_e+="/";}else{_e=_e.slice(0,_10+1);}return _e;};this.offline=!!_c.offline;this.appUrl=_c.appUrl||_d();this.baseUrl=_c.baseUrl||(this.appUrl+"xas/");this.modulePath=_c.modulePath||"../../widgets/";var _11=this,_12="mendix.Client",_13=false,_14=[],_15={"meta":_1,"server":_2,"xas":_3,"context":_4,"data":_5,"session":_6,"remote":_7};var _16=function(){for(var i in _15){_11[i]=new _15[i](_c[i]);}};var _17=function(){var _18=[],_19="startup";for(var i in _15){var sub=_11[i];if(sub[_19]){_18.push((function(sub,id){return function(_1a){sub[_19](_1a);};})(sub,i));}}_8.sequence(_18,function(_1b){while(_14.length!=0){_14.pop()();}_13=true;});};var _1c=function(){var i=0,_1d=[];for(_1d[i++] in _15){}for(var j=0,sys;sys=_1d[j];j++){_11[sys].shutdown();}};this.toString=function(){return _12;};this.startup=function(){_16();};this.isLoaded=function(){return _13;};this.registerSubSystem=function(_1e,sys,_1f){var _20=_a.getObject(sys);if(!_20){_9.error(_12+".registerSubSystem: "+_1e+" not found");}else{if(_15[_1e]){_9.error(_12+".registerSubSystem: "+_1e+" already registered");}else{_c[_1e]=_1f;_15[_1e]=_20;}}};this.addOnLoad=function(fnc){_13?fnc():_14.push(fnc);};this.login=function(_21){this.session.authorized({yes:function(){_11.ui.hideLogin();_13&&_1c();_17();},no:function(_22){_11.ui.setupLoginPage();_11.ui.showLogin(_a.mixin(_22,_21));}});};this.logout=function(_23){if(_13){_13=false;_1c();}this.login(_23);};this.onError=function(err){};};return _b;});