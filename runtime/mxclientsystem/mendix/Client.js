
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mendix/Client",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mendix.Client");mendix.Client=function(_4){_4=_4||{};var _5=function(){var _6=location.href,_7=_6.indexOf("#"),_8;if(_7!=-1){_6=_6.slice(0,_7);}_8=_6.lastIndexOf("/");if(_8==-1){_6+="/";}else{_6=_6.slice(0,_8+1);}return _6;};this.offline=!!_4.offline;this.appUrl=_4.appUrl||_5();this.baseUrl=_4.baseUrl||(this.appUrl+"xas/");this.modulePath=_4.modulePath||"../../widgets/";var _9=this,_a="mendix.Client",_b=false,_c=[],_d={"meta":mendix.sys.Meta,"server":mendix.sys.Server,"xas":mendix.sys.XAS,"context":mendix.sys.Context,"data":mendix.sys.Data,"session":mendix.sys.Session,"remote":mendix.sys.Remote};var _e=function(){for(var i in _d){_9[i]=new _d[i](_4[i]);}};var _f=function(){var _10=[],_11="startup";for(var i in _d){var sub=_9[i];if(sub[_11]){_10.push((function(sub,id){return function(_12){sub[_11](_12);};})(sub,i));}}mendix.lang.sequence(_10,function(_13){while(_c.length!=0){_c.pop()();}_b=true;});};var _14=function(){var i=0,_15=[];for(_15[i++] in _d){}for(var i=0,sys;sys=_15[i];i++){_9[sys].shutdown();}};var _16=function(_17){mx.server.request({request:{action:"active_modules",params:{}},options:{sync:true,callback:function(_18,_19){var _1a=null,_1b=null,_1c=_19&&_19.active_modules;if(_1c){var _1d=_1c.clientmodules;_1b=_1d?_1.map(_1d,function(mod){return (/\./.test(mod))?mod:(mod+"."+mod);}):null;_1a=_1c.customwidgets;}_17.callback({modules:typeof mxui!="undefined"?_1b:[],widgets:_1a});},error:function(){if(_17.error){_17.error(e);}else{_17.callback({modules:null,widgets:null});}}}});};this.toString=function(){return _a;};this.startup=function(){_e();};this.isLoaded=function(){return _b;};this.registerSubSystem=function(_1e,sys,_1f){var _20=_1.getObject(sys);if(!_20){logger.error(_a+".registerSubSystem: "+_1e+" not found");}else{if(_d[_1e]){logger.error(_a+".registerSubSystem: "+_1e+" already registered");}else{_4[_1e]=_1f;_d[_1e]=_20;}}};this.addOnLoad=function(fnc){_b?fnc():_c.push(fnc);};this.login=function(_21){this.session.authorized({yes:function(){_9.ui.hideLogin();_b&&_14();_f();},no:function(_22){_9.ui.setupLoginPage();_9.ui.showLogin(_1.mixin(_22,_21));}});};this.logout=function(_23){if(_b){_b=false;_14();}this.login(_23);};this.onError=function(err){};};});