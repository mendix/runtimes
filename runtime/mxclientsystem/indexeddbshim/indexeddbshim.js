//>>built
define("indexeddbshim/indexeddbshim",["dojo","dijit","dojox"],function(_1,_2,_3){var _4={util:{cleanInterface:false}};(function(){"use strict";var _5={test:true};if(Object.defineProperty){try{Object.defineProperty(_5,"test",{enumerable:false});if(_5.test){_4.util.cleanInterface=true;}}catch(e){}}})();(function(_6){"use strict";function _7(fn,_8,_9){_9.target=_8;(typeof _8[fn]==="function")&&_8[fn].apply(_8,[_9]);};var _a=function(){this.length=0;this._items=[];if(_6.util.cleanInterface){Object.defineProperty(this,"_items",{enumerable:false});}};_a.prototype={contains:function(_b){return -1!==this._items.indexOf(_b);},item:function(_c){return this._items[_c];},indexOf:function(_d){return this._items.indexOf(_d);},push:function(_e){this._items.push(_e);this.length+=1;for(var i=0;i<this._items.length;i++){this[i]=this._items[i];}},splice:function(){this._items.splice.apply(this._items,arguments);this.length=this._items.length;for(var i in this){if(i===String(parseInt(i,10))){delete this[i];}}for(i=0;i<this._items.length;i++){this[i]=this._items[i];}}};if(_6.util.cleanInterface){for(var i in {"indexOf":false,"push":false,"splice":false}){Object.defineProperty(_a.prototype,i,{enumerable:false});}}_6.util.callback=_7;_6.util.StringList=_a;_6.util.quote=function(_f){return "\""+_f+"\"";};}(_4));(function(_10){"use strict";function _11(){if(navigator.userAgent.match(/MSIE/)||navigator.userAgent.match(/Trident/)){_12();}};function _12(){var cmp=IDBFactory.prototype.cmp;var _13=IDBDatabase.prototype.createObjectStore;var _14=IDBObjectStore.prototype.createIndex;var add=IDBObjectStore.prototype.add;var put=IDBObjectStore.prototype.put;var _15=IDBIndex.prototype.get;var _16=IDBIndex.prototype.getKey;var _17=IDBIndex.prototype.openCursor;var _18=IDBIndex.prototype.openKeyCursor;var _19=IDBObjectStore.prototype.get;var _1a=IDBObjectStore.prototype["delete"];var _1b=IDBObjectStore.prototype.openCursor;var _1c=IDBObjectStore.prototype.openKeyCursor;var _1d=IDBKeyRange.bound;var _1e=IDBKeyRange.upperBound;var _1f=IDBKeyRange.lowerBound;var _20=IDBKeyRange.only;var _21=Object.getOwnPropertyDescriptor(IDBRequest.prototype,"result");var _22=Object.getOwnPropertyDescriptor(IDBCursor.prototype,"primaryKey");var _23=Object.getOwnPropertyDescriptor(IDBCursor.prototype,"key");var _24=Object.getOwnPropertyDescriptor(IDBCursorWithValue.prototype,"value");IDBFactory.prototype.cmp=function(_25,_26){var _27=Array.prototype.slice.call(arguments);if(_25 instanceof Array){_27[0]=_5a(_25);}if(_26 instanceof Array){_27[1]=_5a(_26);}return cmp.apply(this,_27);};IDBDatabase.prototype.createObjectStore=function(_28,_29){if(_29&&_29.keyPath instanceof Array){_29.keyPath=_51(_29.keyPath);}return _13.apply(this,arguments);};IDBObjectStore.prototype.createIndex=function(_2a,_2b,_2c){var _2d=Array.prototype.slice.call(arguments);if(_2b instanceof Array){_2d[1]=_51(_2b);}return _14.apply(this,_2d);};IDBObjectStore.prototype.add=function(_2e,key){return this.__insertData(add,arguments);};IDBObjectStore.prototype.put=function(_2f,key){return this.__insertData(put,arguments);};IDBObjectStore.prototype.__insertData=function(_30,_31){_31=Array.prototype.slice.call(_31);var _32=_31[0];var key=_31[1];if(key instanceof Array){_31[1]=_5a(key);}if(typeof _32==="object"){if(_4f(this.keyPath)){_55(_32,this.keyPath);}for(var i=0;i<this.indexNames.length;i++){var _33=this.index(this.indexNames[i]);if(_4f(_33.keyPath)){try{_55(_32,_33.keyPath);}catch(e){}}}}return _30.apply(this,_31);};IDBIndex.prototype.get=function(key){var _34=Array.prototype.slice.call(arguments);if(key instanceof Array){_34[0]=_5a(key);}return _15.apply(this,_34);};IDBIndex.prototype.getKey=function(key){var _35=Array.prototype.slice.call(arguments);if(key instanceof Array){_35[0]=_5a(key);}return _16.apply(this,_35);};IDBIndex.prototype.openCursor=function(key){var _36=Array.prototype.slice.call(arguments);if(key instanceof Array){_36[0]=_5a(key);}return _17.apply(this,_36);};IDBIndex.prototype.openKeyCursor=function(key){var _37=Array.prototype.slice.call(arguments);if(key instanceof Array){_37[0]=_5a(key);}return _18.apply(this,_37);};IDBObjectStore.prototype.get=function(key){var _38=Array.prototype.slice.call(arguments);if(key instanceof Array){_38[0]=_5a(key);}return _19.apply(this,_38);};IDBObjectStore.prototype["delete"]=function(key){var _39=Array.prototype.slice.call(arguments);if(key instanceof Array){_39[0]=_5a(key);}return _1a.apply(this,_39);};IDBObjectStore.prototype.openCursor=function(key){var _3a=Array.prototype.slice.call(arguments);if(key instanceof Array){_3a[0]=_5a(key);}return _1b.apply(this,_3a);};IDBObjectStore.prototype.openKeyCursor=function(key){var _3b=Array.prototype.slice.call(arguments);if(key instanceof Array){_3b[0]=_5a(key);}return _1c.apply(this,_3b);};IDBKeyRange.bound=function(_3c,_3d,_3e,_3f){var _40=Array.prototype.slice.call(arguments);if(_3c instanceof Array){_40[0]=_5a(_3c);}if(_3d instanceof Array){_40[1]=_5a(_3d);}return _1d.apply(IDBKeyRange,_40);};IDBKeyRange.upperBound=function(key,_41){var _42=Array.prototype.slice.call(arguments);if(key instanceof Array){_42[0]=_5a(key);}return _1e.apply(IDBKeyRange,_42);};IDBKeyRange.lowerBound=function(key,_43){var _44=Array.prototype.slice.call(arguments);if(key instanceof Array){_44[0]=_5a(key);}return _1f.apply(IDBKeyRange,_44);};IDBKeyRange.only=function(key){var _45=Array.prototype.slice.call(arguments);if(key instanceof Array){_45[0]=_5a(key);}return _20.apply(IDBKeyRange,_45);};Object.defineProperty(IDBRequest.prototype,"result",{enumerable:_21.enumerable,configurable:_21.configurable,get:function(){var _46=_21.get.call(this);return _4a(_46);}});Object.defineProperty(IDBCursor.prototype,"primaryKey",{enumerable:_22.enumerable,configurable:_22.configurable,get:function(){var _47=_22.get.call(this);return _4a(_47);}});Object.defineProperty(IDBCursor.prototype,"key",{enumerable:_23.enumerable,configurable:_23.configurable,get:function(){var _48=_23.get.call(this);return _4a(_48);}});Object.defineProperty(IDBCursorWithValue.prototype,"value",{enumerable:_24.enumerable,configurable:_24.configurable,get:function(){var _49=_24.get.call(this);return _4a(_49);}});try{if(!IDBTransaction.VERSION_CHANGE){IDBTransaction.VERSION_CHANGE="versionchange";}}catch(e){}};var _4b="__$$compoundKey";var _4c=/\$\$/g;var _4d="$$$$";var _4e="$_$";function _4f(_50){return _50&&(_50.indexOf(_4b+".")===0);};function _51(_52){for(var i=0;i<_52.length;i++){_52[i]=_52[i].replace(/\./g,_4d);}return _4b+"."+_52.join(_4e);};function _53(_54){_54=_54.substr(_4b.length+1);_54=_54.split(_4e);for(var i=0;i<_54.length;i++){_54[i]=_54[i].replace(_4c,".");}return _54;};function _55(_56,_57){var _58=_53(_57);var key=_10.Key.getValue(_56,_58);var _59=_5a(key);_57=_57.substr(_4b.length+1);_56[_4b]=_56[_4b]||{};_56[_4b][_57]=_59;};function _4a(_5b){if(typeof _5b==="string"&&_4f(_5b)){return _5c(_5b);}else{if(_5b&&typeof _5b[_4b]==="object"){delete _5b[_4b];}}return _5b;};function _5a(key){_10.Key.validate(key);key=_10.Key.encode(key);key=_4b+"."+key;_5d(key);return key;};function _5c(key){_5d(key);key=key.substr(_4b.length+1);key=_10.Key.decode(key);return key;};function _5d(key){if(key.length>889){throw _10.util.createDOMException("DataError","The encoded key is "+key.length+" characters long, but IE only allows 889 characters. Consider replacing numeric keys with strings to reduce the encoded length.");}};_10.polyfill=_11;})(_4);(function(_5e){"use strict";var Sca=(function(){return {decycle:function(_5f,_60){var _61=[],_62=[],_63=[],_64=_60;function _65(){if(_63.length===0){_64(_66);}};function _67(_68,_69){var _6a=new FileReader();_6a.onloadend=function(_6b){var _6c=_6b.target.result;var _6d="Blob";if(_68 instanceof File){}_6e(_6c,_69,_6d);};_6a.readAsDataURL(_68);};function _6e(_6f,_70,_71){var _72=_63.indexOf(_70);_70=_70.replace("$","derezObj");eval(_70+".$enc=\""+_6f+"\"");eval(_70+".$type=\""+_71+"\"");_63.splice(_72,1);_65();};function _73(_74,_75){var i,_76,nu;if(typeof _74==="object"&&_74!==null&&!(_74 instanceof Boolean)&&!(_74 instanceof Date)&&!(_74 instanceof Number)&&!(_74 instanceof RegExp)&&!(_74 instanceof Blob)&&!(_74 instanceof String)){for(i=0;i<_61.length;i+=1){if(_61[i]===_74){return {$ref:_62[i]};}}_61.push(_74);_62.push(_75);if(Object.prototype.toString.apply(_74)==="[object Array]"){nu=[];for(i=0;i<_74.length;i+=1){nu[i]=_73(_74[i],_75+"["+i+"]");}}else{nu={};for(_76 in _74){if(Object.prototype.hasOwnProperty.call(_74,_76)){nu[_76]=_73(_74[_76],_75+"["+JSON.stringify(_76)+"]");}}}return nu;}else{if(_74 instanceof Blob){_63.push(_75);_67(_74,_75);}else{if(_74 instanceof Boolean){_74={"$type":"Boolean","$enc":_74.toString()};}else{if(_74 instanceof Date){_74={"$type":"Date","$enc":_74.getTime()};}else{if(_74 instanceof Number){_74={"$type":"Number","$enc":_74.toString()};}else{if(_74 instanceof RegExp){_74={"$type":"RegExp","$enc":_74.toString()};}else{if(typeof _74==="number"){_74={"$type":"number","$enc":_74+""};}else{if(_74===undefined){_74={"$type":"undefined"};}}}}}}}}return _74;};var _66=_73(_5f,"$");_65();},retrocycle:function retrocycle($){var px=/^\$(?:\[(?:\d+|\"(?:[^\\\"\u0000-\u001f]|\\([\\\"\/bfnrt]|u[0-9a-zA-Z]{4}))*\")\])*$/;function _77(_78){var _79=";base64,",_7a,_7b,raw;if(_78.indexOf(_79)===-1){_7b=_78.split(",");_7a=_7b[0].split(":")[1];raw=_7b[1];return new Blob([raw],{type:_7a});}_7b=_78.split(_79);_7a=_7b[0].split(":")[1];raw=window.atob(_7b[1]);var _7c=raw.length;var _7d=new Uint8Array(_7c);for(var i=0;i<_7c;++i){_7d[i]=raw.charCodeAt(i);}return new Blob([_7d.buffer],{type:_7a});};function rez(_7e){var i,_7f,_80,_81;if(_7e&&typeof _7e==="object"){if(Object.prototype.toString.apply(_7e)==="[object Array]"){for(i=0;i<_7e.length;i+=1){_7f=_7e[i];if(_7f&&typeof _7f==="object"){_81=_7f.$ref;if(typeof _81==="string"&&px.test(_81)){_7e[i]=eval(_81);}else{_7e[i]=rez(_7f);}}}}else{if(_7e.$type!==undefined){switch(_7e.$type){case "Blob":case "File":_7e=_77(_7e.$enc);break;case "Boolean":_7e=Boolean(_7e.$enc==="true");break;case "Date":_7e=new Date(_7e.$enc);break;case "Number":_7e=Number(_7e.$enc);break;case "RegExp":_7e=eval(_7e.$enc);break;case "number":_7e=parseFloat(_7e.$enc);break;case "undefined":_7e=undefined;break;}}else{for(_80 in _7e){if(typeof _7e[_80]==="object"){_7f=_7e[_80];if(_7f){_81=_7f.$ref;if(typeof _81==="string"&&px.test(_81)){_7e[_80]=eval(_81);}else{_7e[_80]=rez(_7f);}}}}}}}return _7e;};return rez($);},"encode":function(val,_82){function _83(val){_82(JSON.stringify(val));};this.decycle(val,_83);},"decode":function(val){return this.retrocycle(JSON.parse(val));}};}());_5e.Sca=Sca;}(_4));(function(_84){"use strict";var _85=["undefined","number","date","string","array"];var _86=["negativeInfinity","bigNegative","smallNegative","smallPositive","bigPositive","positiveInfinity"];var _87={undefined:{encode:function(key){return _85.indexOf("undefined")+"-";},decode:function(key){return undefined;}},date:{encode:function(key){return _85.indexOf("date")+"-"+key.toJSON();},decode:function(key){return new Date(key.substring(2));}},number:{encode:function(key){var _88=Math.abs(key).toString(32);var _89=_88.indexOf(".");_88=(_89!==-1)?_88.replace(".",""):_88;var _8a=_88.search(/[^0]/);_88=_88.slice(_8a);var _8b,_8c=_8d(2),_8e=_8d(11);if(isFinite(key)){if(key<0){if(key>-1){_8b=_86.indexOf("smallNegative");_8c=_8f(_8a);_8e=_90(_91(_88));}else{_8b=_86.indexOf("bigNegative");_8c=_90(_8f((_89!==-1)?_89:_88.length));_8e=_90(_91(_88));}}else{if(key<1){_8b=_86.indexOf("smallPositive");_8c=_90(_8f(_8a));_8e=_91(_88);}else{_8b=_86.indexOf("bigPositive");_8c=_8f((_89!==-1)?_89:_88.length);_8e=_91(_88);}}}else{_8b=_86.indexOf(key>0?"positiveInfinity":"negativeInfinity");}return _85.indexOf("number")+"-"+_8b+_8c+_8e;},decode:function(key){var _92=+key.substr(2,1);var _93=key.substr(3,2);var _94=key.substr(5,11);switch(_86[_92]){case "negativeInfinity":return -Infinity;case "positiveInfinity":return Infinity;case "bigPositive":return _95(_94,_93);case "smallPositive":_93=_96(_90(_93));return _95(_94,_93);case "smallNegative":_93=_96(_93);_94=_90(_94);return -_95(_94,_93);case "bigNegative":_93=_90(_93);_94=_90(_94);return -_95(_94,_93);default:throw new Error("Invalid number.");}}},string:{encode:function(key,_97){if(_97){key=key.replace(/(.)/g,"-$1")+" ";}return _85.indexOf("string")+"-"+key;},decode:function(key,_98){key=key.substring(2);if(_98){key=key.substr(0,key.length-1).replace(/-(.)/g,"$1");}return key;}},array:{encode:function(key){var _99=[];for(var i=0;i<key.length;i++){var _9a=key[i];var _9b=_84.Key.encode(_9a,true);_99[i]=_9b;}_99.push(_85.indexOf("undefined")+"-");return _85.indexOf("array")+"-"+JSON.stringify(_99);},decode:function(key){var _9c=JSON.parse(key.substring(2));_9c.pop();for(var i=0;i<_9c.length;i++){var _9d=_9c[i];var _9e=_84.Key.decode(_9d,true);_9c[i]=_9e;}return _9c;}}};function _8f(n){n=n.toString(32);return (n.length===1)?"0"+n:n;};function _91(s){return (s+_8d(11)).slice(0,11);};function _90(_9f){var _a0="";for(var i=0;i<_9f.length;i++){_a0+=(31-parseInt(_9f[i],32)).toString(32);}return _a0;};function _95(_a1,_a2){var _a3,_a4,_a5;_a2=parseInt(_a2,32);if(_a2<0){return _a6(parseInt(_a1,32)*Math.pow(32,_a2-10));}else{if(_a2<11){_a3=_a1.slice(0,_a2);_a3=parseInt(_a3,32);_a4=_a1.slice(_a2);_a4=parseInt(_a4,32)*Math.pow(32,_a2-11);return _a6(_a3+_a4);}else{_a5=_a1+_8d(_a2-11);return parseInt(_a5,32);}}};function _a6(num,_a7){_a7=_a7||16;return parseFloat(num.toPrecision(_a7));};function _8d(n){var _a8="";while(n--){_a8=_a8+"0";}return _a8;};function _96(s){return "-"+s;};function _a9(key){if(key instanceof Date){return "date";}if(key instanceof Array){return "array";}return typeof key;};function _aa(key){var _ab=_a9(key);if(_ab==="array"){for(var i=0;i<key.length;i++){_aa(key[i]);}}else{if(!_87[_ab]||(_ab!=="string"&&isNaN(key))){throw _84.util.createDOMException("DataError","Not a valid key");}}};function _ac(_ad,_ae){try{if(_ae instanceof Array){var _af=[];for(var i=0;i<_ae.length;i++){_af.push(_ad[_ae[i]]);}return _af;}else{return _ad[_ae];}}catch(e){return undefined;}};function _b0(_b1,_b2,_b3){var _b4=_b2.split(".");for(var i=0;i<_b4.length-1;i++){var _b5=_b4[i];_b1=_b1[_b5]=_b1[_b5]||{};}_b1[_b4[_b4.length-1]]=_b3;};function _b6(_b7,_b8){var _b9=_85[_b8.substring(0,1)];if(_b9==="array"){return _b8.indexOf(_b7)>1;}else{return _b8===_b7;}};function _ba(key,_bb){var _bc=_bb.lower===undefined;var _bd=_bb.upper===undefined;var _be=_84.Key.encode(key,true);if(_bb.lower!==undefined){if(_bb.lowerOpen&&_be>_bb.__lower){_bc=true;}if(!_bb.lowerOpen&&_be>=_bb.__lower){_bc=true;}}if(_bb.upper!==undefined){if(_bb.upperOpen&&_be<_bb.__upper){_bd=true;}if(!_bb.upperOpen&&_be<=_bb.__upper){_bd=true;}}return _bc&&_bd;};function _bf(_c0,_c1){var _c2=[];if(_c0 instanceof Array){for(var i=0;i<_c0.length;i++){var key=_c0[i];if(key instanceof Array){if(_c1.lower===_c1.upper){continue;}if(key.length===1){key=key[0];}else{var _c3=_bf(key,_c1);if(_c3.length>0){_c2.push(key);}continue;}}if(_ba(key,_c1)){_c2.push(key);}}}else{if(_ba(_c0,_c1)){_c2.push(_c0);}}return _c2;};_84.Key={encode:function(key,_c4){if(key===undefined){return null;}return _87[_a9(key)].encode(key,_c4);},decode:function(key,_c5){if(typeof key!=="string"){return undefined;}return _87[_85[key.substring(0,1)]].decode(key,_c5);},validate:_aa,getValue:_ac,setValue:_b0,isMultiEntryMatch:_b6,findMultiEntryMatches:_bf};}(_4));(function(_c6){"use strict";function _c7(_c8,_c9){var _ca=new Event(_c8);_ca.debug=_c9;Object.defineProperty(_ca,"target",{writable:true});return _ca;};function _cb(_cc,_cd){this.type=_cc;this.debug=_cd;this.bubbles=false;this.cancelable=false;this.eventPhase=0;this.timeStamp=new Date().valueOf();};var _ce=false;try{var _cf=_c7("test type","test debug");var _d0={test:"test target"};_cf.target=_d0;if(_cf instanceof Event&&_cf.type==="test type"&&_cf.debug==="test debug"&&_cf.target===_d0){_ce=true;}}catch(e){}if(_ce){_c6.Event=Event;_c6.IDBVersionChangeEvent=Event;_c6.util.createEvent=_c7;}else{_c6.Event=_cb;_c6.IDBVersionChangeEvent=_cb;_c6.util.createEvent=function(_d1,_d2){return new _cb(_d1,_d2);};}}(_4));(function(_d3){"use strict";function _d4(_d5,_d6){var e=new DOMException.prototype.constructor(0,_d6);e.name=_d5||"DOMException";e.message=_d6;return e;};function _d7(_d8,_d9){_d8=_d8||"DOMError";var e=new DOMError(_d8,_d9);e.name===_d8||(e.name=_d8);e.message===_d9||(e.message=_d9);return e;};function _da(_db,_dc){var e=new Error(_dc);e.name=_db||"DOMException";e.message=_dc;return e;};_d3.util.logError=function(_dd,_de,_df){if(_d3.DEBUG){if(_df&&_df.message){_df=_df.message;}var _e0=typeof (console.error)==="function"?"error":"log";console[_e0](_dd+": "+_de+". "+(_df||""));console.trace&&undefined;}};_d3.util.findError=function(_e1){var err;if(_e1){if(_e1.length===1){return _e1[0];}for(var i=0;i<_e1.length;i++){var arg=_e1[i];if(arg instanceof Error||arg instanceof DOMException){return arg;}else{if(arg&&typeof arg.message==="string"){err=arg;}}}}return err;};var _e2,_e3=false,_e4=false;try{_e2=_d4("test name","test message");if(_e2 instanceof DOMException&&_e2.name==="test name"&&_e2.message==="test message"){_e3=true;}}catch(e){}try{_e2=_d7("test name","test message");if(_e2 instanceof DOMError&&_e2.name==="test name"&&_e2.message==="test message"){_e4=true;}}catch(e){}if(_e3){_d3.DOMException=DOMException;_d3.util.createDOMException=function(_e5,_e6,_e7){_d3.util.logError(_e5,_e6,_e7);return _d4(_e5,_e6);};}else{_d3.DOMException=Error;_d3.util.createDOMException=function(_e8,_e9,_ea){_d3.util.logError(_e8,_e9,_ea);return _da(_e8,_e9);};}if(_e4){_d3.DOMError=DOMError;_d3.util.createDOMError=function(_eb,_ec,_ed){_d3.util.logError(_eb,_ec,_ed);return _d7(_eb,_ec);};}else{_d3.DOMError=Error;_d3.util.createDOMError=function(_ee,_ef,_f0){_d3.util.logError(_ee,_ef,_f0);return _da(_ee,_ef);};}}(_4));(function(_f1){"use strict";function _f2(){this.onsuccess=this.onerror=this.result=this.error=this.source=this.transaction=null;this.readyState="pending";};function _f3(){this.onblocked=this.onupgradeneeded=null;};_f3.prototype=new _f2();_f3.prototype.constructor=_f3;_f1.IDBRequest=_f2;_f1.IDBOpenDBRequest=_f3;}(_4));(function(_f4,_f5){"use strict";function _f6(_f7,_f8,_f9,_fa){if(_f7!==_f5){_f4.Key.validate(_f7);}if(_f8!==_f5){_f4.Key.validate(_f8);}this.lower=_f7;this.upper=_f8;this.lowerOpen=!!_f9;this.upperOpen=!!_fa;};_f6.only=function(_fb){return new _f6(_fb,_fb,false,false);};_f6.lowerBound=function(_fc,_fd){return new _f6(_fc,_f5,_fd,_f5);};_f6.upperBound=function(_fe,_ff){return new _f6(_f5,_fe,_f5,_ff);};_f6.bound=function(_100,_101,_102,_103){return new _f6(_100,_101,_102,_103);};_f4.IDBKeyRange=_f6;}(_4));(function(_104,_105){"use strict";function _106(_107,_108,_109,_10a,_10b,_10c){if(_107===null){_107=_105;}if(_107!==_105&&!(_107 instanceof _104.IDBKeyRange)){_107=new _104.IDBKeyRange(_107,_107,false,false);}_109.transaction.__assertActive();if(_108!==_105&&["next","prev","nextunique","prevunique"].indexOf(_108)===-1){throw new TypeError(_108+"is not a valid cursor direction");}this.source=_10a;this.direction=_108||"next";this.key=_105;this.primaryKey=_105;this.__store=_109;this.__range=_107;this.__req=new _104.IDBRequest();this.__keyColumnName=_10b;this.__valueColumnName=_10c;this.__valueDecoder=_10c==="value"?_104.Sca:_104.Key;this.__offset=-1;this.__lastKeyContinued=_105;this.__multiEntryIndex=_10a instanceof _104.IDBIndex?_10a.multiEntry:false;this.__unique=this.direction.indexOf("unique")!==-1;if(_107!==_105){_107.__lower=_107.lower!==_105&&_104.Key.encode(_107.lower,this.__multiEntryIndex);_107.__upper=_107.upper!==_105&&_104.Key.encode(_107.upper,this.__multiEntryIndex);}this["continue"]();};_106.prototype.__find=function(){var args=Array.prototype.slice.call(arguments);if(this.__multiEntryIndex){this.__findMultiEntry.apply(this,args);}else{this.__findBasic.apply(this,args);}};_106.prototype.__findBasic=function(key,tx,_10d,_10e,_10f){_10f=_10f||1;var me=this;var _110=_104.util.quote(me.__keyColumnName);var sql=["SELECT * FROM",_104.util.quote(me.__store.name)];var _111=[];sql.push("WHERE",_110,"NOT NULL");if(me.__range&&(me.__range.lower!==_105||me.__range.upper!==_105)){sql.push("AND");if(me.__range.lower!==_105){sql.push(_110,(me.__range.lowerOpen?">":">="),"?");_111.push(me.__range.__lower);}(me.__range.lower!==_105&&me.__range.upper!==_105)&&sql.push("AND");if(me.__range.upper!==_105){sql.push(_110,(me.__range.upperOpen?"<":"<="),"?");_111.push(me.__range.__upper);}}if(typeof key!=="undefined"){me.__lastKeyContinued=key;me.__offset=0;}if(me.__lastKeyContinued!==_105){sql.push("AND",_110,">= ?");_104.Key.validate(me.__lastKeyContinued);_111.push(_104.Key.encode(me.__lastKeyContinued));}var _112=me.direction==="prev"||me.direction==="prevunique"?"DESC":"ASC";sql.push("ORDER BY",_110,_112);sql.push("LIMIT",_10f,"OFFSET",me.__offset);sql=sql.join(" ");_104.DEBUG&&undefined;me.__prefetchedData=null;me.__prefetchedIndex=0;tx.executeSql(sql,_111,function(tx,data){if(data.rows.length>1){me.__prefetchedData=data.rows;me.__prefetchedIndex=0;_104.DEBUG&&undefined;me.__decode(data.rows.item(0),_10d);}else{if(data.rows.length===1){me.__decode(data.rows.item(0),_10d);}else{_104.DEBUG&&undefined;_10d(_105,_105,_105);}}},function(tx,err){_104.DEBUG&&undefined;_10e(err);});};_106.prototype.__findMultiEntry=function(key,tx,_113,_114){var me=this;if(me.__prefetchedData&&me.__prefetchedData.length===me.__prefetchedIndex){_104.DEBUG&&undefined;_113(_105,_105,_105);return;}var _115=_104.util.quote(me.__keyColumnName);var sql=["SELECT * FROM",_104.util.quote(me.__store.name)];var _116=[];sql.push("WHERE",_115,"NOT NULL");if(me.__range&&(me.__range.lower!==_105&&me.__range.upper!==_105)){if(me.__range.upper.indexOf(me.__range.lower)===0){sql.push("AND",_115,"LIKE ?");_116.push("%"+me.__range.__lower.slice(0,-1)+"%");}}if(typeof key!=="undefined"){me.__lastKeyContinued=key;me.__offset=0;}if(me.__lastKeyContinued!==_105){sql.push("AND",_115,">= ?");_104.Key.validate(me.__lastKeyContinued);_116.push(_104.Key.encode(me.__lastKeyContinued));}var _117=me.direction==="prev"||me.direction==="prevunique"?"DESC":"ASC";sql.push("ORDER BY key",_117);sql=sql.join(" ");_104.DEBUG&&undefined;me.__prefetchedData=null;me.__prefetchedIndex=0;tx.executeSql(sql,_116,function(tx,data){me.__multiEntryOffset=data.rows.length;if(data.rows.length>0){var rows=[];for(var i=0;i<data.rows.length;i++){var _118=data.rows.item(i);var _119=_104.Key.decode(_118[me.__keyColumnName],true);var _11a=_104.Key.findMultiEntryMatches(_119,me.__range);for(var j=0;j<_11a.length;j++){var _11b=_11a[j];var _11c={matchingKey:_104.Key.encode(_11b,true),key:_118.key};_11c[me.__keyColumnName]=_118[me.__keyColumnName];_11c[me.__valueColumnName]=_118[me.__valueColumnName];rows.push(_11c);}}var _11d=me.direction.indexOf("prev")===0;rows.sort(function(a,b){if(a.matchingKey.replace("[","z")<b.matchingKey.replace("[","z")){return _11d?1:-1;}if(a.matchingKey.replace("[","z")>b.matchingKey.replace("[","z")){return _11d?-1:1;}if(a.key<b.key){return me.direction==="prev"?1:-1;}if(a.key>b.key){return me.direction==="prev"?-1:1;}return 0;});me.__prefetchedData={data:rows,length:rows.length,item:function(_11e){return this.data[_11e];}};me.__prefetchedIndex=0;if(rows.length>1){_104.DEBUG&&undefined;me.__decode(rows[0],_113);}else{if(rows.length===1){_104.DEBUG&&undefined;me.__decode(rows[0],_113);}else{_104.DEBUG&&undefined;_113(_105,_105,_105);}}}else{_104.DEBUG&&undefined;_113(_105,_105,_105);}},function(tx,err){_104.DEBUG&&undefined;_114(err);});};_106.prototype.__onsuccess=function(_11f){var me=this;return function(key,_120,_121){me.key=key===_105?null:key;me.value=_120===_105?null:_120;me.primaryKey=_121===_105?null:_121;var _122=key===_105?null:me;_11f(_122,me.__req);};};_106.prototype.__decode=function(_123,_124){if(this.__multiEntryIndex&&this.__unique){if(!this.__matchedKeys){this.__matchedKeys={};}if(this.__matchedKeys[_123.matchingKey]){_124(_105,_105,_105);return;}this.__matchedKeys[_123.matchingKey]=true;}var key=_104.Key.decode(this.__multiEntryIndex?_123.matchingKey:_123[this.__keyColumnName],this.__multiEntryIndex);var val=this.__valueDecoder.decode(_123[this.__valueColumnName]);var _125=_104.Key.decode(_123.key);_124(key,val,_125);};_106.prototype["continue"]=function(key){var _126=_104.cursorPreloadPackSize||100;var me=this;this.__store.transaction.__pushToQueue(me.__req,function cursorContinue(tx,args,_127,_128){me.__offset++;if(me.__prefetchedData){me.__prefetchedIndex++;if(me.__prefetchedIndex<me.__prefetchedData.length){me.__decode(me.__prefetchedData.item(me.__prefetchedIndex),me.__onsuccess(_127));return;}}me.__find(key,tx,me.__onsuccess(_127),_128,_126);});};_106.prototype.advance=function(_129){if(_129<=0){throw _104.util.createDOMException("Type Error","Count is invalid - 0 or negative",_129);}var me=this;this.__store.transaction.__pushToQueue(me.__req,function cursorAdvance(tx,args,_12a,_12b){me.__offset+=_129;me.__find(_105,tx,me.__onsuccess(_12a),_12b);});};_106.prototype.update=function(_12c){var me=this;me.__store.transaction.__assertWritable();return me.__store.transaction.__addToTransactionQueue(function cursorUpdate(tx,args,_12d,_12e){_104.Sca.encode(_12c,function(_12f){me.__find(_105,tx,function(key,_130,_131){var _132=me.__store;var _133=[_12f];var sql=["UPDATE",_104.util.quote(_132.name),"SET value = ?"];_104.Key.validate(_131);for(var i=0;i<_132.indexNames.length;i++){var _134=_132.__indexes[_132.indexNames[i]];var _135=_104.Key.getValue(_12c,_134.keyPath);sql.push(",",_104.util.quote(_134.name),"= ?");_133.push(_104.Key.encode(_135,_134.multiEntry));}sql.push("WHERE key = ?");_133.push(_104.Key.encode(_131));_104.DEBUG&&undefined;tx.executeSql(sql.join(" "),_133,function(tx,data){me.__prefetchedData=null;me.__prefetchedIndex=0;if(data.rowsAffected===1){_12d(key);}else{_12e("No rows with key found"+key);}},function(tx,data){_12e(data);});},_12e);});});};_106.prototype["delete"]=function(){var me=this;me.__store.transaction.__assertWritable();return this.__store.transaction.__addToTransactionQueue(function cursorDelete(tx,args,_136,_137){me.__find(_105,tx,function(key,_138,_139){var sql="DELETE FROM  "+_104.util.quote(me.__store.name)+" WHERE key = ?";_104.DEBUG&&undefined;_104.Key.validate(_139);tx.executeSql(sql,[_104.Key.encode(_139)],function(tx,data){me.__prefetchedData=null;me.__prefetchedIndex=0;if(data.rowsAffected===1){me.__offset--;_136(_105);}else{_137("No rows with key found"+key);}},function(tx,data){_137(data);});},_137);});};_104.IDBCursor=_106;}(_4));(function(_13a,_13b){"use strict";function _13c(_13d,_13e){this.objectStore=_13d;this.name=_13e.columnName;this.keyPath=_13e.keyPath;this.multiEntry=_13e.optionalParams&&_13e.optionalParams.multiEntry;this.unique=_13e.optionalParams&&_13e.optionalParams.unique;this.__deleted=!!_13e.__deleted;};_13c.__clone=function(_13f,_140){return new _13c(_140,{columnName:_13f.name,keyPath:_13f.keyPath,optionalParams:{multiEntry:_13f.multiEntry,unique:_13f.unique}});};_13c.__createIndex=function(_141,_142){var _143=!!_141.__indexes[_142.name]&&_141.__indexes[_142.name].__deleted;_141.__indexes[_142.name]=_142;_141.indexNames.push(_142.name);var _144=_141.transaction;_144.__addToTransactionQueue(function createIndex(tx,args,_145,_146){function _147(tx,err){_146(_13a.util.createDOMException(0,"Could not create index \""+_142.name+"\"",err));};function _148(tx){_13c.__updateIndexList(_141,tx,function(){tx.executeSql("SELECT * FROM "+_13a.util.quote(_141.name),[],function(tx,data){_13a.DEBUG&&undefined;_149(0);function _149(i){if(i<data.rows.length){try{var _14a=_13a.Sca.decode(data.rows.item(i).value);var _14b=_13a.Key.getValue(_14a,_142.keyPath);_14b=_13a.Key.encode(_14b,_142.multiEntry);tx.executeSql("UPDATE "+_13a.util.quote(_141.name)+" set "+_13a.util.quote(_142.name)+" = ? where key = ?",[_14b,data.rows.item(i).key],function(tx,data){_149(i+1);},_147);}catch(e){_149(i+1);}}else{_145(_141);}};},_147);},_147);};if(_143){_148(tx);}else{var sql=["ALTER TABLE",_13a.util.quote(_141.name),"ADD",_13a.util.quote(_142.name),"BLOB"].join(" ");_13a.DEBUG&&undefined;tx.executeSql(sql,[],_148,_147);}});};_13c.__deleteIndex=function(_14c,_14d){_14c.__indexes[_14d.name].__deleted=true;_14c.indexNames.splice(_14c.indexNames.indexOf(_14d.name),1);var _14e=_14c.transaction;_14e.__addToTransactionQueue(function createIndex(tx,args,_14f,_150){function _151(tx,err){_150(_13a.util.createDOMException(0,"Could not delete index \""+_14d.name+"\"",err));};_13c.__updateIndexList(_14c,tx,_14f,_151);});};_13c.__updateIndexList=function(_152,tx,_153,_154){var _155={};for(var i=0;i<_152.indexNames.length;i++){var idx=_152.__indexes[_152.indexNames[i]];_155[idx.name]={columnName:idx.name,keyPath:idx.keyPath,optionalParams:{unique:idx.unique,multiEntry:idx.multiEntry},deleted:!!idx.deleted};}_13a.DEBUG&&undefined;tx.executeSql("UPDATE __sys__ set indexList = ? where name = ?",[JSON.stringify(_155),_152.name],function(){_153(_152);},_154);};_13c.prototype.__fetchIndexData=function(key,_156){var me=this;var _157,_158;if(arguments.length===1){_156=key;_157=false;}else{_13a.Key.validate(key);_158=_13a.Key.encode(key,me.multiEntry);_157=true;}return me.objectStore.transaction.__addToTransactionQueue(function fetchIndexData(tx,args,_159,_15a){var sql=["SELECT * FROM",_13a.util.quote(me.objectStore.name),"WHERE",_13a.util.quote(me.name),"NOT NULL"];var _15b=[];if(_157){if(me.multiEntry){sql.push("AND",_13a.util.quote(me.name),"LIKE ?");_15b.push("%"+_158+"%");}else{sql.push("AND",_13a.util.quote(me.name),"= ?");_15b.push(_158);}}_13a.DEBUG&&undefined;tx.executeSql(sql.join(" "),_15b,function(tx,data){var _15c=0,_15d=null;if(me.multiEntry){for(var i=0;i<data.rows.length;i++){var row=data.rows.item(i);var _15e=_13a.Key.decode(row[me.name]);if(_157&&_13a.Key.isMultiEntryMatch(_158,row[me.name])){_15c++;_15d=_15d||row;}else{if(!_157&&_15e!==_13b){_15c=_15c+(_15e instanceof Array?_15e.length:1);_15d=_15d||row;}}}}else{_15c=data.rows.length;_15d=_15c&&data.rows.item(0);}if(_156==="count"){_159(_15c);}else{if(_15c===0){_159(_13b);}else{if(_156==="key"){_159(_13a.Key.decode(_15d.key));}else{_159(_13a.Sca.decode(_15d.value));}}}},_15a);});};_13c.prototype.openCursor=function(_15f,_160){return new _13a.IDBCursor(_15f,_160,this.objectStore,this,this.name,"value").__req;};_13c.prototype.openKeyCursor=function(_161,_162){return new _13a.IDBCursor(_161,_162,this.objectStore,this,this.name,"key").__req;};_13c.prototype.get=function(key){if(arguments.length===0){throw new TypeError("No key was specified");}return this.__fetchIndexData(key,"value");};_13c.prototype.getKey=function(key){if(arguments.length===0){throw new TypeError("No key was specified");}return this.__fetchIndexData(key,"key");};_13c.prototype.count=function(key){if(arguments.length===0){return this.__fetchIndexData("count");}else{return this.__fetchIndexData(key,"count");}};_13a.IDBIndex=_13c;}(_4));(function(_163){"use strict";function _164(_165,_166){this.name=_165.name;this.keyPath=JSON.parse(_165.keyPath);this.transaction=_166;this.autoIncrement=typeof _165.autoInc==="string"?_165.autoInc==="true":!!_165.autoInc;this.__indexes={};this.indexNames=new _163.util.StringList();var _167=JSON.parse(_165.indexList);for(var _168 in _167){if(_167.hasOwnProperty(_168)){var _169=new _163.IDBIndex(this,_167[_168]);this.__indexes[_169.name]=_169;if(!_169.__deleted){this.indexNames.push(_169.name);}}}};_164.__clone=function(_16a,_16b){var _16c=new _164({name:_16a.name,keyPath:JSON.stringify(_16a.keyPath),autoInc:JSON.stringify(_16a.autoIncrement),indexList:"{}"},_16b);_16c.__indexes=_16a.__indexes;_16c.indexNames=_16a.indexNames;return _16c;};_164.__createObjectStore=function(db,_16d){db.__objectStores[_16d.name]=_16d;db.objectStoreNames.push(_16d.name);var _16e=db.__versionTransaction;_163.IDBTransaction.__assertVersionChange(_16e);_16e.__addToTransactionQueue(function createObjectStore(tx,args,_16f,_170){function _171(tx,err){throw _163.util.createDOMException(0,"Could not create object store \""+_16d.name+"\"",err);};var sql=["CREATE TABLE",_163.util.quote(_16d.name),"(key BLOB",_16d.autoIncrement?"UNIQUE, inc INTEGER PRIMARY KEY AUTOINCREMENT":"PRIMARY KEY",", value BLOB)"].join(" ");_163.DEBUG&&undefined;tx.executeSql(sql,[],function(tx,data){tx.executeSql("INSERT INTO __sys__ VALUES (?,?,?,?)",[_16d.name,JSON.stringify(_16d.keyPath),_16d.autoIncrement,"{}"],function(){_16f(_16d);},_171);},_171);});};_164.__deleteObjectStore=function(db,_172){db.__objectStores[_172.name]=undefined;db.objectStoreNames.splice(db.objectStoreNames.indexOf(_172.name),1);var _173=db.__versionTransaction;_163.IDBTransaction.__assertVersionChange(_173);_173.__addToTransactionQueue(function deleteObjectStore(tx,args,_174,_175){function _176(tx,err){_175(_163.util.createDOMException(0,"Could not delete ObjectStore",err));};tx.executeSql("SELECT * FROM __sys__ where name = ?",[_172.name],function(tx,data){if(data.rows.length>0){tx.executeSql("DROP TABLE "+_163.util.quote(_172.name),[],function(){tx.executeSql("DELETE FROM __sys__ WHERE name = ?",[_172.name],function(){_174();},_176);},_176);}});});};_164.prototype.__validateKey=function(_177,key){if(this.keyPath){if(typeof key!=="undefined"){throw _163.util.createDOMException("DataError","The object store uses in-line keys and the key parameter was provided",this);}else{if(_177&&typeof _177==="object"){key=_163.Key.getValue(_177,this.keyPath);if(key===undefined){if(this.autoIncrement){return;}else{throw _163.util.createDOMException("DataError","Could not eval key from keyPath");}}}else{throw _163.util.createDOMException("DataError","KeyPath was specified, but value was not an object");}}}else{if(typeof key==="undefined"){if(this.autoIncrement){return;}else{throw _163.util.createDOMException("DataError","The object store uses out-of-line keys and has no key generator and the key parameter was not provided. ",this);}}}_163.Key.validate(key);};_164.prototype.__deriveKey=function(tx,_178,key,_179,_17a){var me=this;function _17b(_17c){tx.executeSql("SELECT * FROM sqlite_sequence where name like ?",[me.name],function(tx,data){if(data.rows.length!==1){_17c(1);}else{_17c(data.rows.item(0).seq+1);}},function(tx,_17d){_17a(_163.util.createDOMException("DataError","Could not get the auto increment value for key",_17d));});};if(me.keyPath){var _17e=_163.Key.getValue(_178,me.keyPath);if(_17e===undefined&&me.autoIncrement){_17b(function(_17f){try{_163.Key.setValue(_178,me.keyPath,_17f);_179(_17f);}catch(e){_17a(_163.util.createDOMException("DataError","Could not assign a generated value to the keyPath",e));}});}else{_179(_17e);}}else{if(typeof key==="undefined"&&me.autoIncrement){_17b(_179);}else{_179(key);}}};_164.prototype.__insertData=function(tx,_180,_181,_182,_183,_184){try{var _185={};if(typeof _182!=="undefined"){_163.Key.validate(_182);_185.key=_163.Key.encode(_182);}for(var i=0;i<this.indexNames.length;i++){var _186=this.__indexes[this.indexNames[i]];_185[_186.name]=_163.Key.encode(_163.Key.getValue(_181,_186.keyPath),_186.multiEntry);}var _187=["INSERT INTO ",_163.util.quote(this.name),"("];var _188=[" VALUES ("];var _189=[];for(var key in _185){_187.push(_163.util.quote(key)+",");_188.push("?,");_189.push(_185[key]);}_187.push("value )");_188.push("?)");_189.push(_180);var sql=_187.join(" ")+_188.join(" ");_163.DEBUG&&undefined;tx.executeSql(sql,_189,function(tx,data){_163.Sca.encode(_182,function(_18a){_18a=_163.Sca.decode(_18a);_183(_18a);});},function(tx,err){_184(_163.util.createDOMError("ConstraintError",err.message,err));});}catch(e){_184(e);}};_164.prototype.add=function(_18b,key){var me=this;if(arguments.length===0){throw new TypeError("No value was specified");}this.__validateKey(_18b,key);me.transaction.__assertWritable();var _18c=me.transaction.__createRequest();me.transaction.__pushToQueue(_18c,function objectStoreAdd(tx,args,_18d,_18e){me.__deriveKey(tx,_18b,key,function(_18f){_163.Sca.encode(_18b,function(_190){me.__insertData(tx,_190,_18b,_18f,_18d,_18e);});},_18e);});return _18c;};_164.prototype.put=function(_191,key){var me=this;if(arguments.length===0){throw new TypeError("No value was specified");}this.__validateKey(_191,key);me.transaction.__assertWritable();var _192=me.transaction.__createRequest();me.transaction.__pushToQueue(_192,function objectStorePut(tx,args,_193,_194){me.__deriveKey(tx,_191,key,function(_195){_163.Sca.encode(_191,function(_196){_163.Key.validate(_195);var sql="DELETE FROM "+_163.util.quote(me.name)+" where key = ?";tx.executeSql(sql,[_163.Key.encode(_195)],function(tx,data){_163.DEBUG&&undefined;me.__insertData(tx,_196,_191,_195,_193,_194);},function(tx,err){_194(err);});});},_194);});return _192;};_164.prototype.get=function(key){var me=this;if(arguments.length===0){throw new TypeError("No key was specified");}_163.Key.validate(key);var _197=_163.Key.encode(key);return me.transaction.__addToTransactionQueue(function objectStoreGet(tx,args,_198,_199){_163.DEBUG&&undefined;tx.executeSql("SELECT * FROM "+_163.util.quote(me.name)+" where key = ?",[_197],function(tx,data){_163.DEBUG&&undefined;var _19a;try{if(0===data.rows.length){return _198();}_19a=_163.Sca.decode(data.rows.item(0).value);}catch(e){_163.DEBUG&&undefined;}_198(_19a);},function(tx,err){_199(err);});});};_164.prototype["delete"]=function(key){var me=this;if(arguments.length===0){throw new TypeError("No key was specified");}me.transaction.__assertWritable();_163.Key.validate(key);var _19b=_163.Key.encode(key);return me.transaction.__addToTransactionQueue(function objectStoreDelete(tx,args,_19c,_19d){_163.DEBUG&&undefined;tx.executeSql("DELETE FROM "+_163.util.quote(me.name)+" where key = ?",[_19b],function(tx,data){_163.DEBUG&&undefined;_19c();},function(tx,err){_19d(err);});});};_164.prototype.clear=function(){var me=this;me.transaction.__assertWritable();return me.transaction.__addToTransactionQueue(function objectStoreClear(tx,args,_19e,_19f){tx.executeSql("DELETE FROM "+_163.util.quote(me.name),[],function(tx,data){_163.DEBUG&&undefined;_19e();},function(tx,err){_19f(err);});});};_164.prototype.count=function(key){var me=this;var _1a0=false;if(arguments.length>0){_1a0=true;_163.Key.validate(key);}return me.transaction.__addToTransactionQueue(function objectStoreCount(tx,args,_1a1,_1a2){var sql="SELECT * FROM "+_163.util.quote(me.name)+(_1a0?" WHERE key = ?":"");var _1a3=[];_1a0&&_1a3.push(_163.Key.encode(key));tx.executeSql(sql,_1a3,function(tx,data){_1a1(data.rows.length);},function(tx,err){_1a2(err);});});};_164.prototype.openCursor=function(_1a4,_1a5){return new _163.IDBCursor(_1a4,_1a5,this,this,"key","value").__req;};_164.prototype.index=function(_1a6){if(arguments.length===0){throw new TypeError("No index name was specified");}var _1a7=this.__indexes[_1a6];if(!_1a7){throw _163.util.createDOMException("NotFoundError","Index \""+_1a6+"\" does not exist on "+this.name);}return _163.IDBIndex.__clone(_1a7,this);};_164.prototype.createIndex=function(_1a8,_1a9,_1aa){if(arguments.length===0){throw new TypeError("No index name was specified");}if(arguments.length===1){throw new TypeError("No key path was specified");}if(_1a9 instanceof Array&&_1aa&&_1aa.multiEntry){throw _163.util.createDOMException("InvalidAccessError","The keyPath argument was an array and the multiEntry option is true.");}if(this.__indexes[_1a8]&&!this.__indexes[_1a8].__deleted){throw _163.util.createDOMException("ConstraintError","Index \""+_1a8+"\" already exists on "+this.name);}this.transaction.__assertVersionChange();_1aa=_1aa||{};var _1ab={columnName:_1a8,keyPath:_1a9,optionalParams:{unique:!!_1aa.unique,multiEntry:!!_1aa.multiEntry}};var _1ac=new _163.IDBIndex(this,_1ab);_163.IDBIndex.__createIndex(this,_1ac);return _1ac;};_164.prototype.deleteIndex=function(_1ad){if(arguments.length===0){throw new TypeError("No index name was specified");}var _1ae=this.__indexes[_1ad];if(!_1ae){throw _163.util.createDOMException("NotFoundError","Index \""+_1ad+"\" does not exist on "+this.name);}this.transaction.__assertVersionChange();_163.IDBIndex.__deleteIndex(this,_1ae);};_163.IDBObjectStore=_164;}(_4));(function(_1af){"use strict";var _1b0=0;function _1b1(db,_1b2,mode){this.__id=++_1b0;this.__active=true;this.__running=false;this.__requests=[];this.__storeNames=_1b2;this.mode=mode;this.db=db;this.error=null;this.onabort=this.onerror=this.oncomplete=null;var me=this;setTimeout(function(){me.__executeRequests();},0);};_1b1.prototype.__executeRequests=function(){if(this.__running){_1af.DEBUG&&undefined;return;}this.__running=true;var me=this;me.db.__db.transaction(function executeRequests(tx){me.__tx=tx;var q=null,i=0;function _1b3(_1b4,req){if(req){q.req=req;}q.req.readyState="done";q.req.result=_1b4;delete q.req.error;var e=_1af.util.createEvent("success");_1af.util.callback("onsuccess",q.req,e);i++;_1b5();};function _1b6(tx,err){err=_1af.util.findError(arguments);try{q.req.readyState="done";q.req.error=err||"DOMError";q.req.result=undefined;var e=_1af.util.createEvent("error",err);_1af.util.callback("onerror",q.req,e);}finally{_1b8(err);}};function _1b5(){if(i>=me.__requests.length){me.__requests=[];if(me.__active){me.__active=false;_1b7();}}else{try{q=me.__requests[i];q.op(tx,q.args,_1b3,_1b6);}catch(e){_1b6(e);}}};_1b5();},_1b8);function _1b8(err){if(!me.__active){throw err;}try{_1af.util.logError("Error","An error occurred in a transaction",err);me.error=err;var evt=_1af.util.createEvent("error");_1af.util.callback("onerror",me,evt);}finally{me.abort();}};function _1b7(){_1af.DEBUG&&undefined;var evt=_1af.util.createEvent("complete");_1af.util.callback("oncomplete",me,evt);_1af.util.callback("__oncomplete",me,evt);};};_1b1.prototype.__createRequest=function(){var _1b9=new _1af.IDBRequest();_1b9.source=this.db;_1b9.transaction=this;return _1b9;};_1b1.prototype.__addToTransactionQueue=function(_1ba,args){var _1bb=this.__createRequest();this.__pushToQueue(_1bb,_1ba,args);return _1bb;};_1b1.prototype.__pushToQueue=function(_1bc,_1bd,args){this.__assertActive();this.__requests.push({"op":_1bd,"args":args,"req":_1bc});};_1b1.prototype.__assertActive=function(){if(!this.__active){throw _1af.util.createDOMException("TransactionInactiveError","A request was placed against a transaction which is currently not active, or which is finished");}};_1b1.prototype.__assertWritable=function(){if(this.mode===_1b1.READ_ONLY){throw _1af.util.createDOMException("ReadOnlyError","The transaction is read only");}};_1b1.prototype.__assertVersionChange=function(){_1b1.__assertVersionChange(this);};_1b1.__assertVersionChange=function(tx){if(!tx||tx.mode!==_1b1.VERSION_CHANGE){throw _1af.util.createDOMException("InvalidStateError","Not a version transaction");}};_1b1.prototype.objectStore=function(_1be){if(arguments.length===0){throw new TypeError("No object store name was specified");}if(!this.__active){throw _1af.util.createDOMException("InvalidStateError","A request was placed against a transaction which is currently not active, or which is finished");}if(this.__storeNames.indexOf(_1be)===-1&&this.mode!==_1b1.VERSION_CHANGE){throw _1af.util.createDOMException("NotFoundError",_1be+" is not participating in this transaction");}var _1bf=this.db.__objectStores[_1be];if(!_1bf){throw _1af.util.createDOMException("NotFoundError",_1be+" does not exist in "+this.db.name);}return _1af.IDBObjectStore.__clone(_1bf,this);};_1b1.prototype.abort=function(){var me=this;_1af.DEBUG&&undefined;me.__active=false;var evt=_1af.util.createEvent("abort");setTimeout(function(){_1af.util.callback("onabort",me,evt);},0);};_1b1.READ_ONLY="readonly";_1b1.READ_WRITE="readwrite";_1b1.VERSION_CHANGE="versionchange";_1af.IDBTransaction=_1b1;}(_4));(function(_1c0){"use strict";function _1c1(db,name,_1c2,_1c3){this.__db=db;this.__closed=false;this.version=_1c2;this.name=name;this.onabort=this.onerror=this.onversionchange=null;this.__objectStores={};this.objectStoreNames=new _1c0.util.StringList();for(var i=0;i<_1c3.rows.length;i++){var _1c4=new _1c0.IDBObjectStore(_1c3.rows.item(i));this.__objectStores[_1c4.name]=_1c4;this.objectStoreNames.push(_1c4.name);}};_1c1.prototype.createObjectStore=function(_1c5,_1c6){if(arguments.length===0){throw new TypeError("No object store name was specified");}if(this.__objectStores[_1c5]){throw _1c0.util.createDOMException("ConstraintError","Object store \""+_1c5+"\" already exists in "+this.name);}this.__versionTransaction.__assertVersionChange();_1c6=_1c6||{};var _1c7={name:_1c5,keyPath:JSON.stringify(_1c6.keyPath||null),autoInc:JSON.stringify(_1c6.autoIncrement),indexList:"{}"};var _1c8=new _1c0.IDBObjectStore(_1c7,this.__versionTransaction);_1c0.IDBObjectStore.__createObjectStore(this,_1c8);return _1c8;};_1c1.prototype.deleteObjectStore=function(_1c9){if(arguments.length===0){throw new TypeError("No object store name was specified");}var _1ca=this.__objectStores[_1c9];if(!_1ca){throw _1c0.util.createDOMException("NotFoundError","Object store \""+_1c9+"\" does not exist in "+this.name);}this.__versionTransaction.__assertVersionChange();_1c0.IDBObjectStore.__deleteObjectStore(this,_1ca);};_1c1.prototype.close=function(){this.__closed=true;};_1c1.prototype.transaction=function(_1cb,mode){if(this.__closed){throw _1c0.util.createDOMException("InvalidStateError","An attempt was made to start a new transaction on a database connection that is not open");}if(typeof mode==="number"){mode=mode===1?IDBTransaction.READ_WRITE:IDBTransaction.READ_ONLY;_1c0.DEBUG&&undefined;}else{mode=mode||IDBTransaction.READ_ONLY;}if(mode!==IDBTransaction.READ_ONLY&&mode!==IDBTransaction.READ_WRITE){throw new TypeError("Invalid transaction mode: "+mode);}_1cb=typeof _1cb==="string"?[_1cb]:_1cb;if(_1cb.length===0){throw _1c0.util.createDOMException("InvalidAccessError","No object store names were specified");}for(var i=0;i<_1cb.length;i++){if(!this.objectStoreNames.contains(_1cb[i])){throw _1c0.util.createDOMException("NotFoundError","The \""+_1cb[i]+"\" object store does not exist");}}var _1cc=new _1c0.IDBTransaction(this,_1cb,mode);return _1cc;};_1c0.IDBDatabase=_1c1;}(_4));(function(_1cd){"use strict";var _1ce=4*1024*1024;var _1cf;function _1d0(_1d1,_1d2){function _1d3(tx,err){err=_1cd.util.findError(arguments);_1cd.DEBUG&&undefined;_1d2(err);};if(_1cf){_1d1();}else{_1cf=window.openDatabase("__sysdb__",1,"System Database",_1ce);_1cf.transaction(function(tx){tx.executeSql("CREATE TABLE IF NOT EXISTS dbVersions (name VARCHAR(255), version INT);",[],_1d1,_1d3);},_1d3);}};function _1d4(){this.modules=_1cd;};_1d4.prototype.open=function(name,_1d5){var req=new _1cd.IDBOpenDBRequest();var _1d6=false;if(arguments.length===0){throw new TypeError("Database name is required");}else{if(arguments.length===2){_1d5=parseFloat(_1d5);if(isNaN(_1d5)||!isFinite(_1d5)||_1d5<=0){throw new TypeError("Invalid database version: "+_1d5);}}}name=name+"";function _1d7(tx,err){if(_1d6){return;}err=_1cd.util.findError(arguments);_1d6=true;var evt=_1cd.util.createEvent("error",arguments);req.readyState="done";req.error=err||"DOMError";_1cd.util.callback("onerror",req,evt);};function _1d8(_1d9){var db=window.openDatabase(name,1,name,_1ce);req.readyState="done";if(typeof _1d5==="undefined"){_1d5=_1d9||1;}if(_1d5<=0||_1d9>_1d5){var err=_1cd.util.createDOMError("VersionError","An attempt was made to open a database using a lower version than the existing version.",_1d5);_1d7(err);return;}db.transaction(function(tx){tx.executeSql("CREATE TABLE IF NOT EXISTS __sys__ (name VARCHAR(255), keyPath VARCHAR(255), autoInc BOOLEAN, indexList BLOB)",[],function(){tx.executeSql("SELECT * FROM __sys__",[],function(tx,data){var e=_1cd.util.createEvent("success");req.source=req.result=new _1cd.IDBDatabase(db,name,_1d5,data);if(_1d9<_1d5){_1cf.transaction(function(_1da){_1da.executeSql("UPDATE dbVersions set version = ? where name = ?",[_1d5,name],function(){var e=_1cd.util.createEvent("upgradeneeded");e.oldVersion=_1d9;e.newVersion=_1d5;req.transaction=req.result.__versionTransaction=new _1cd.IDBTransaction(req.source,[],_1cd.IDBTransaction.VERSION_CHANGE);req.transaction.__addToTransactionQueue(function onupgradeneeded(tx,args,_1db){_1cd.util.callback("onupgradeneeded",req,e);_1db();});req.transaction.__oncomplete=function(){req.transaction=null;var e=_1cd.util.createEvent("success");_1cd.util.callback("onsuccess",req,e);};},_1d7);},_1d7);}else{_1cd.util.callback("onsuccess",req,e);}},_1d7);},_1d7);},_1d7);};_1d0(function(){_1cf.transaction(function(tx){tx.executeSql("SELECT * FROM dbVersions where name = ?",[name],function(tx,data){if(data.rows.length===0){tx.executeSql("INSERT INTO dbVersions VALUES (?,?)",[name,_1d5||1],function(){_1d8(0);},_1d7);}else{_1d8(data.rows.item(0).version);}},_1d7);},_1d7);},_1d7);return req;};_1d4.prototype.deleteDatabase=function(name){var req=new _1cd.IDBOpenDBRequest();var _1dc=false;var _1dd=null;if(arguments.length===0){throw new TypeError("Database name is required");}name=name+"";function _1de(tx,err){if(_1dc){return;}err=_1cd.util.findError(arguments);req.readyState="done";req.error=err||"DOMError";var e=_1cd.util.createEvent("error");e.debug=arguments;_1cd.util.callback("onerror",req,e);_1dc=true;};function _1df(){_1cf.transaction(function(_1e0){_1e0.executeSql("DELETE FROM dbVersions where name = ? ",[name],function(){req.result=undefined;var e=_1cd.util.createEvent("success");e.newVersion=null;e.oldVersion=_1dd;_1cd.util.callback("onsuccess",req,e);},_1de);},_1de);};_1d0(function(){_1cf.transaction(function(_1e1){_1e1.executeSql("SELECT * FROM dbVersions where name = ?",[name],function(tx,data){if(data.rows.length===0){req.result=undefined;var e=_1cd.util.createEvent("success");e.newVersion=null;e.oldVersion=_1dd;_1cd.util.callback("onsuccess",req,e);return;}_1dd=data.rows.item(0).version;var db=window.openDatabase(name,1,name,_1ce);db.transaction(function(tx){tx.executeSql("SELECT * FROM __sys__",[],function(tx,data){var _1e2=data.rows;function _1e3(i){if(i>=_1e2.length){tx.executeSql("DROP TABLE IF EXISTS __sys__",[],function(){_1df();},_1de);}else{tx.executeSql("DROP TABLE "+_1cd.util.quote(_1e2.item(i).name),[],function(){_1e3(i+1);},function(){_1e3(i+1);});}};_1e3(0);},function(e){_1df();});});},_1de);},_1de);},_1de);return req;};_1d4.prototype.cmp=function(key1,key2){if(arguments.length<2){throw new TypeError("You must provide two keys to be compared");}_1cd.Key.validate(key1);_1cd.Key.validate(key2);var _1e4=_1cd.Key.encode(key1);var _1e5=_1cd.Key.encode(key2);var _1e6=_1e4>_1e5?1:_1e4===_1e5?0:-1;if(_1cd.DEBUG){var _1e7=_1cd.Key.decode(_1e4);var _1e8=_1cd.Key.decode(_1e5);if(typeof key1==="object"){key1=JSON.stringify(key1);_1e7=JSON.stringify(_1e7);}if(typeof key2==="object"){key2=JSON.stringify(key2);_1e8=JSON.stringify(_1e8);}if(_1e7!==key1){console.warn(key1+" was incorrectly encoded as "+_1e7);}if(_1e8!==key2){console.warn(key2+" was incorrectly encoded as "+_1e8);}}return _1e6;};_1cd.shimIndexedDB=new _1d4();_1cd.IDBFactory=_1d4;}(_4));(function(_1e9,_1ea){"use strict";function shim(name,_1eb){try{_1e9[name]=_1eb;}catch(e){}if(_1e9[name]!==_1eb&&Object.defineProperty){try{Object.defineProperty(_1e9,name,{value:_1eb});}catch(e){}if(_1e9[name]!==_1eb){_1e9.console&&console.warn&&console.warn("Unable to shim "+name);}}};shim("shimIndexedDB",_1ea.shimIndexedDB);if(_1e9.shimIndexedDB){_1e9.shimIndexedDB.__useShim=function(){if(typeof _1e9.openDatabase!=="undefined"){shim("indexedDB",_1ea.shimIndexedDB);shim("IDBFactory",_1ea.IDBFactory);shim("IDBDatabase",_1ea.IDBDatabase);shim("IDBObjectStore",_1ea.IDBObjectStore);shim("IDBIndex",_1ea.IDBIndex);shim("IDBTransaction",_1ea.IDBTransaction);shim("IDBCursor",_1ea.IDBCursor);shim("IDBKeyRange",_1ea.IDBKeyRange);shim("IDBRequest",_1ea.IDBRequest);shim("IDBOpenDBRequest",_1ea.IDBOpenDBRequest);shim("IDBVersionChangeEvent",_1ea.IDBVersionChangeEvent);}else{if(typeof _1e9.indexedDB==="object"){_1ea.polyfill();}}};_1e9.shimIndexedDB.__debug=function(val){_1ea.DEBUG=val;};}if(!("indexedDB" in _1e9)){_1e9.indexedDB=_1e9.indexedDB||_1e9.webkitIndexedDB||_1e9.mozIndexedDB||_1e9.oIndexedDB||_1e9.msIndexedDB;}var _1ec=false;if(navigator.userAgent.match(/Android 2/)||navigator.userAgent.match(/Android 3/)||navigator.userAgent.match(/Android 4\.[0-3]/)){if(!navigator.userAgent.match(/Chrome/)){_1ec=true;}}if((typeof _1e9.indexedDB==="undefined"||!_1e9.indexedDB||_1ec)&&typeof _1e9.openDatabase!=="undefined"){_1e9.shimIndexedDB.__useShim();}else{_1e9.IDBDatabase=_1e9.IDBDatabase||_1e9.webkitIDBDatabase;_1e9.IDBTransaction=_1e9.IDBTransaction||_1e9.webkitIDBTransaction;_1e9.IDBCursor=_1e9.IDBCursor||_1e9.webkitIDBCursor;_1e9.IDBKeyRange=_1e9.IDBKeyRange||_1e9.webkitIDBKeyRange;if(!_1e9.IDBTransaction){_1e9.IDBTransaction={};}try{_1e9.IDBTransaction.READ_ONLY=_1e9.IDBTransaction.READ_ONLY||"readonly";_1e9.IDBTransaction.READ_WRITE=_1e9.IDBTransaction.READ_WRITE||"readwrite";}catch(e){}}}(window,_4));});