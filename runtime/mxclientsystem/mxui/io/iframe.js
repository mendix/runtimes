
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/io/iframe",["dojo","dijit","dojox","dojo/require!dojo/io/iframe"],function(_1,_2,_3){_1.provide("mxui.io.iframe");_1.require("dojo.io.iframe");_1.mixin(mxui.io.iframe,{name:"mxui.io.iframe",send:function(_4){var _5=function(){if(_1.isIE){return true;}if(_1.isOpera){return _1.isOpera<10;}if(_1.isChrome){if(typeof window.externalHost!=="undefined"){return false;}return _1.isChrome<16;}return false;};if(_5()){var _6=_4.handle;_4.handle=function(_7){window.history.back();var _8=function(){_6(_7);};setTimeout(_8,50);};}_4.handleAs="json";var _9=_4.handle;delete _4.handle;var _a=_1.io.iframe.send.apply(_1.io.iframe,arguments);_a.addBoth(function(_b){if(!_1.isIE){var _c=_1.io.iframe._frame;_c.parentNode.removeChild(_c);_1.io.iframe._frame=null;window.dojoIoIframe=null;}if(_b instanceof Error){logger.error(this.name+".send: An error occurred while uploading a file: the server did not respond");_9&&_9(new mendix.lib.Error(_b.message));}else{if(_b.type&&_b.type==="exception"){var _d=new mendix.lib.DescribedServerError(_b.description);logger.error(this.name+".send: "+_d.message);_d._type="exception";_9&&_9(_d);}else{_9&&_9();}}});},download:function(_e){var _f=_e.target||"internal",url=_e.url+"&target="+_f;if(_f==="window"||_1.isChrome&&typeof window.externalHost!=="undefined"){window.open(url,"mendix_file");return;}if(!this._iframe){var _10=this._iframe=document.createElement(mx.ui.isQuirky?"<iframe onload=\"mxui.io.iframe.onload()\">":"iframe");_1.style(_10,{top:"-10px",height:"1px",position:"absolute",visibility:"hidden"});document.body.appendChild(_10);if(!mx.ui.isQuirky){_10.onload=_1.hitch(this,"onload");}}this._error=_e.error;this._iframe.contentWindow.location=url;},onload:function(){var _11=this._iframe,_12=this._error,doc=_11.contentDocument||_11.document,err=mendix.lang.getFileError(doc,this.name+".onload");if(err&&_12){_12(err);}delete this._error;}});});