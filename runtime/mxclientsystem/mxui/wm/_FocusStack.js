/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/wm/_FocusStack",["mxui/dom","mxui/wm/focus"],function(_1,_2){var _3={create:function(){var _4=[];_4.find=this.find;_4.each=this.each;_4.box=null;_4.last=null;_4.first=null;_4.f_first=null;_4.f_last=null;return _4;},buildStack:function(_5,_6){var _7=null;var _8=null;var _9=null;var _a=null;var _b=null;var _c=this.create();_c.box=_6=(_6||_2.byNode(_5));var _d=_5==_6.domNode;var ni=_d?"0":_1.getTabIndex(_5);var _e=_6.domNode;var _f=null;var _10=null;var _11=null;var _12=null;if(!_d&&!_2.focusable(_5)){_f=_5;while((_f=_f.parentNode)!=null){var vi=_2.focusable(_f);if(vi||_f==_e){_10=_11;break;}_11=_f;}}_1.walkNode(_e,function(_13,_14){if(_13==_e){return true;}var one=(_13==_5);if(!one){var vi=_2.focusable(_13);if(!vi){if(_10){if(_12){if(_1.nextNode(_12,_14)){_12=false;}else{return true;}}else{if(_13==_10){_12=_14;return true;}}}return vi===0;}}var _15=this.isBox(_13);var ci=_2.getFocusIndex(_13);if(!ci&&_15){if(_1.getTabIndex(_13)<0){return false;}ci=_13.getAttribute("focusIndex")||"0";}if(one||ci){var _16={node:_13,stack:_c,next:null,prev:null};if(ni==-1){if(_9){if(_a==null||(_a>ci)){_a=ci;_b=_16;}}else{if(one){_9=true;}}}if(ci){if(!_7){_7=_16;}_8=_16;var _17=_c[ci];if(!_17){_17=_c[ci]=[];}_17.push(_16);}else{_c._curr=_16;}return false;}},_2);if(ni==-1){var _18=_c._curr;if(_18){_18.prev=_18.next=_b;}}_c.each(function(_19,_1a){if(!this.first){this.first=_1a;}var _1b=_1a.prev=this.last;if(_1b){_1b.next=_1a;}this.last=_1a;if(_5==_19){this._curr=_1a;}},null,_c);_c.f_first=_7;_c.f_last=_8;return _c;},each:function(fnc,_1c,_1d){if(_1c=="prev"){var i=this.length;while(0<=--i){var _1e=this[i];var l=_1e&&_1e.length;if(l){for(var c=l-1;0<=c;c--){var _1f=fnc.call(_1d,_1e[c].node,_1e[c],i);if(_1f!=null){return _1f;}}}}}else{var i=-1;while(++i<this.length){var _1e=this[i];var l=_1e&&_1e.length;if(l){for(var c=0;c<l;c++){var _1f=fnc.call(_1d,_1e[c].node,_1e[c],i);if(_1f!=null){return _1f;}}}}}return null;},find:function(_20){if(this._curr&&this._curr.node==_20){return this._curr;}var ni=_1.getTabIndex(_20)||"0";if(ni!=-1){var i=ni;do{var _21=this[i];if(_21){for(var c=0,l=_21.length;c<l;c++){var n=_21[c];if(n.node==_20){return n;}}}}while(++i<this.length);}var _22=null;var _23=this.box.domNode;var _24=_20;while((_24=_24.parentNode)!=null&&_24!=_23){if(!_2.focusable(_24)){continue;}if(_2.getFocusIndex(_24)){_22=_24;}}return _22?this.find(_22):null;}};return _3;});