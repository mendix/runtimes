/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/wm/_FocusBox",["mxui/dom","mxui/wm/_FocusStack","mxui/wm/focus","dojo/keys","dojo/_base/connect","dojo/_base/event","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8){var _9={getFocusStack:function(){var _a=_2.create();_a.box=this;var _b=null;var _c=null;var _d=false;var _e=this.nodes;for(var i=0,l=_e.length;i<l;i++){var _f=_e[i].node;var tab=_3.getFocusIndex(_f);var vi=_3.focusable(_f);if(tab){if(vi){_b=_f;break;}else{_d=true;_f.tabIndex=-1;}}else{if(vi){if(_d){_b=_f;_b.tabIndex=1;break;}_c=_f;}}}if(!_b){_b=_c;_b&&(_b.tabIndex=1);}if(_b){_a.push(_b);_a.last=_a.first=_a._curr={prev:null,next:null,node:_b,stack:_a};}return _a;},_onmousedown:function(e){var _10=e.target;if(_10.nodeName.toLowerCase()=="option"){_10=_10.parentNode;}var _11=_10;var s=null;var _12=this.domNode;do{s=_1.data(_11,"box-node");if(s&&s.box==this){break;}}while((_11!=null)&&(_11!=_12)&&(_11=_11.parentNode)!=null);if(s){var _13=_1.getTabIndex(_10);this._focus(s.node,_13!=null);}},_focus:function(_14,_15){var _16=this.getFocusStack();var _17=_16._curr;if(_17){_17.node.tabIndex=-1;}_14.tabIndex=1;_14=_3._tryNode({node:_14,stack:_16},"next");if(!_15){_3.put(_14);}},next:function(_18,dir){var _19=_1.data(_18,"box-node");if(_19){var _1a=this._getNextNode(_19,dir);if(_1a){var _1b=_1a.node;_1b.tabIndex=0;_18.tabIndex=-1;return _1b;}}else{}return null;},_getNextNode:function(_1c,dir){if(!_1c){return null;}var _1d=_1c;while((_1d=_1d[dir])!=null){var _1e=_1d.node;if(_3.focusable(_1e)){return _1d;}}return null;}};var _1f=_8(null,{declaredClass:"mxui.wm.focus.Box",id:null,domNode:null,nested:false,FOCUS_NEXT:"FOCUS_NEXT",FOCUS_PREV:"FOCUS_PREV",constructor:function(_20){this.id=_3.getUniqueId(this);this.domNode=_20;this.nodes=[];this.keys={};this.handlers={};_20.setAttribute("focus-id",this.id);},add:function(_21){var s=_1.data(_21,"box-node",{box:this,next:null,prev:null,node:_21});var _22=this.nodes.length;if(_22!=0){var _23=this.nodes[_22-1];s.prev=_23;_23.next=s;_21.tabIndex=-1;}else{_21.tabIndex=0;}if(!this.converted){this.converted=true;_7.mixin(this,_9);this._boxhandler=_5.connect(this.domNode,"onmousedown",_7.hitch(this,"_onmousedown"));}this.nodes.push(s);},pressed:function(_24,_25){var _26=this.keys;var hs=this.handlers;for(var key in _24){var _27=_4[key]||key;var fnc=_24[key];if(fnc==this.FOCUS_NEXT){_26[_27]="next";}else{if(fnc==this.FOCUS_PREV){_26[_27]="prev";}else{if(typeof fnc=="string"){fnc=_25[fnc];}if(typeof fnc!="function"){logger.error(this.id+".pressed: Passed stuff is not a function: "+key);}else{if(hs[_27]){}hs[_27]=[_25,fnc];}}}}},destroy:function(){if(!this._destroyed){var _28=this.nodes;for(var i=0,l=_28.length;i<l;i++){var _29=_28[i].node;_1.data(_29,"box-node",null);}this.nodes=null;this.keys=null;this.handlers=null;this._boxhandler&&this._boxhandler.remove();this._destroyed=true;}},getHandler:function(e){var _2a=typeof (e.charOrCode)!="undefined"?e.charOrCode:e.keyCode;return this.handlers[(_2a==" ")?_4.SPACE:_2a];},getFocusDirection:function(e){var nav=this.domNode.getAttribute("focuskeys");if(nav){var up,lr;if(nav=="up-down"){if(e.keyCode==_4.UP_ARROW){up="prev";}else{if(e.keyCode==_4.DOWN_ARROW){up="next";}}}if(nav=="left-right"){if(e.keyCode==_4.LEFT_ARROW){lr="prev";}else{if(e.keyCode==_4.RIGHT_ARROW){lr="next";}}}return up||lr;}else{var _2b=typeof (e.charOrCode)!="undefined"?e.charOrCode:e.keyCode;_2b=(_2b==" ")?_4.SPACE:_2b;var key=this.keys[_2b];if(key){return key;}}return null;},onFocusPress:function(e,_2c){var dir=this.getFocusDirection(e);if(e.altKey||e.shiftKey||e.ctrlKey){return true;}if(dir){var _2d=_1.data(_2c,"box-node");if(_2d){var _2e=this.next(_2c,dir);if(_2e){_3.put(_2e);return false;}_6.stop(e);}else{}}else{var h=this.getHandler(e);if(h){try{return h[1].call(h[0],e,_2c);}catch(error){logger.error(this.id+".onFocusPress: Error when executing handler: "+error.message);return true;}}}return true;},next:function(_2f,dir){var _30=_3._getStack(_2f,this);var _31=_3._doNext(_30.find(_2f),dir);return _31;}});return _1f;});