
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/Client",["mxui/sys/Parser","mxui/sys/UI","mendix/sys/Data","mendix/sys/Meta","mendix/sys/Remote","mendix/sys/Server","mendix/sys/Session","mendix/lang","mendix/logger","dojo/cookie","dojo/aspect","dojo/_base/array","dojo/_base/lang"],function(_1,UI,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){function _d(_e){_e=_e||{};var _f=this,_10="mendix.Client",_11=false,_12=[];this.appUrl=_e.appUrl||_13();this.baseUrl=_e.baseUrl||(this.appUrl+"xas/");this.modulePath=_e.modulePath||"../../widgets/";this.server=new _5(_e.server);this.session=new _6();this.remote=new _4();this.meta=new _3();this.data=new _2();this.ui=new UI();this.parser=new _1();_14();function _13(){var _15=window.location.href,_16=_15.indexOf("#");if(_16!=-1){_15=_15.slice(0,_16);}return _15.slice(0,_15.lastIndexOf("/")+1);};function _17(_18){_f.meta.startup();_f.data.startup();_f.session.startup();_f.ui.startup(_18);};this.toString=function(){return _10;};this.isLoaded=function(){return _11;};this.addOnLoad=function(fnc){_11?fnc():_12.push(fnc);};this.reload=function(){};this.redirect=function(_19){};this.startup=function(){if(_11){throw new Error("Client has already been started up!");}this.session.authorized({no:function(_1a){var _1b=_1a&&_7.inArray(_1a.http_code,["402","404","500","503"])?_1a.http_code:0;var _1c=_22("reloginReason");_f.ui.showLogin(_1c||_1b);},yes:function(){_17(function(){_11=true;while(_12.length!=0){_12.pop()();}});}});};this.login=function(_1d,_1e,_1f,_20){this.session.login({username:_1d,password:_1e,success:function(){if(_11){_f.reload();}else{_1f&&_1f();_f.startup();}},error:_20});};this.logout=function(){this.session.logout(_c.hitch(this,"reload"));};function _14(){_a.before(_f.server,"onUnauthorized",function(_21){if(_21=="401"){_21="419";}_9("reloginReason",_21,{expires:10/(24*60*60)});_f.reload();});};this.onError=function(err){};function _22(_23){var _24=_9(_23);_9(_23,null,{expires:-1});return _24;};};return _d;});