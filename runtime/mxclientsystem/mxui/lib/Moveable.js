
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/lib/Moveable",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.lib.Moveable");_1.declare("mxui.lib.Moveable",null,{node:null,handle:null,margin:0,delay:0,_events:null,_start:null,_moving:false,constructor:function(_4,_5){_5=_5||{};this.node=_4;this.handle=_5.handle||_4;this.margin=_5.margin||0;this.delay=_5.delay||0;this._events=[_1.on(this.handle,"dragstart",_1.stopEvent),_1.on(this.handle,"selectstart",_1.stopEvent)];_1.setSelectable(this.handle,false);this.reset();},reset:function(){this.clean();this._events.push(_1.on(this.handle,_1.touch.press,_1.hitch(this,"onMouseDown")));},clean:function(){while(this._events.length>3){this._events.pop().remove();}},prepare:function(e){var _6=_1.position(this.node);this._start={t:_6.y,l:_6.x,x:e.pageX,y:e.pageY};},onMouseDown:function(e){if(!this.delay){this.onMoveStart(e);}this.clean();this.prepare(e);this._events.push(_1.on(document,_1.touch.move,_1.hitch(this,"onMouseMove")),_1.on(document,_1.touch.release,_1.hitch(this,"onMouseUp")));e.preventDefault();},onMouseMove:function(e){var _7=this.node.style,_8=this._start,_9={};if(!this._moving){if(Math.sqrt(Math.pow(e.pageX-_8.x,2)+Math.pow(e.pageY-_8.y,2))>this.delay){this.onMoveStart(e);this.prepare(e);}return;}_7.top=_9.t=_8.t+(e.pageY-_8.y)+"px";_7.left=_9.l=_8.l+(e.pageX-_8.x)+"px";this.onMoving(_9);e.preventDefault();},onMouseUp:function(e){if(this._moving){this.onMoveStop(e);}this.reset();},onMoveStart:function(e){this._moving=true;},onMoving:function(e){},onMoveStop:function(e){this._moving=false;mxui.dom.moveIntoView(this.node,this.margin);},destroy:function(){while(this._events.length){this._events.pop().remove();}}});});