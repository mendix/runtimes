/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/lib/Moveable",["mxui/dom","dojo/on","dojo/touch","dojo/dom","dojo/dom-geometry","dojo/_base/event","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8){var _9=_8(null,{declaredClass:"mxui.lib.Moveable",node:null,handle:null,margin:0,delay:0,_events:null,_start:null,_moving:false,constructor:function(_a,_b){_b=_b||{};this.node=_a;this.handle=_b.handle||_a;this.margin=_b.margin||0;this.delay=_b.delay||0;this._events=[_2(this.handle,"dragstart",_6.stop),_2(this.handle,"selectstart",_6.stop)];_4.setSelectable(this.handle,false);this._reset();},_reset:function(){this._clean();this._events.push(_2(this.handle,_3.press,_7.hitch(this,"_onMouseDown")));},_clean:function(){while(this._events.length>3){this._events.pop().remove();}},_prepare:function(e){var _c=_5.position(this.node);this._start={t:_c.y,l:_c.x,x:e.pageX,y:e.pageY};},_onMouseDown:function(e){if(!this.delay){this.onMoveStart(e);}this._clean();this._prepare(e);this._events.push(_2(document,_3.move,_7.hitch(this,"_onMouseMove")),_2(document,_3.release,_7.hitch(this,"_onMouseUp")));},_onMouseMove:function(e){var _d=this.node.style,_e=this._start,_f={};if(!this._moving){if(Math.sqrt(Math.pow(e.pageX-_e.x,2)+Math.pow(e.pageY-_e.y,2))>this.delay){this.onMoveStart(e);this._prepare(e);}return;}_d.top=_f.t=_e.t+(e.pageY-_e.y)+"px";_d.left=_f.l=_e.l+(e.pageX-_e.x)+"px";this.onMoving(_f);e.preventDefault();},_onMouseUp:function(e){if(this._moving){this.onMoveStop(e);}this._reset();},onMoveStart:function(){this._moving=true;},onMoving:function(e){},onMoveStop:function(){this._moving=false;_1.moveIntoView(this.node,this.margin);},destroy:function(){while(this._events.length){this._events.pop().remove();}}});return _9;});