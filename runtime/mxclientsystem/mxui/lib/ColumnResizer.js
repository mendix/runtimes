
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/lib/ColumnResizer",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.lib.ColumnResizer");_1.declare("mxui.lib.ColumnResizer",null,{columns:null,thNodes:null,colUnits:"",tableNode:null,gridNode:null,rowNode:null,minWidth:40,cssClass:"mx-datagrid-column-resizer",rtl:false,autoColums:null,active:0,startPos:0,startWidth:0,totalWidth:0,bodyCursor:"",handles:null,connects:null,resizing:false,constructor:function(_4){_4=_4||{};var _5=_4.thNodes,_6=_4.colNodes;this.columns=[];this.autoColumns=[];this.thNodes=_5;this.colUnits=_4.colUnits;this.tableNode=_4.tableNode;this.gridNode=_4.gridNode;this.rowNode=_5[0].parentNode;this.minWidth=_4.minWidth||40;this.rtl=_4.rtl;this.prepareTable(_5,_6);},prepareTable:function(_7,_8){var _9=0,_a=false;_1.forEach(_7,function(th,_b){if(_b>0){var _c=mxui.dom.create("div",{"class":this.cssClass});mxui.dom.data(_c,"index",_b);th.firstChild.appendChild(_c);}var _d=_8[_b][0].style.width,_e=_d=="auto";var _f=this.columns[_b]={node:th,cols:_8[_b],width:0,rounded:0,minWidth:0,startWidth:0,isAuto:_e};if(this.colUnits=="px"){if(_e){_a=true;this.autoColumns.push(_f);}else{_9+=parseInt(_d,10);}}else{_a=true;}},this);if(!_a){this.tableNode.style.width=this.gridNode.style.width=_9+"px";}_1.forEach(this.columns,function(_10){_10.width=this.getColWidth(_10);},this);this.setRatios();var _11=this;this.connects=[_1.on(this.rowNode,"."+this.cssClass+":click",_1.stopEvent),_1.on(this.rowNode,"."+this.cssClass+":mousedown",function(e){var _12=mxui.dom.data(this,"index");_11.startResize(_12-1,e);})];},startResize:function(_13,e){if(this.resizing){this.endResize();return;}this.resizing=true;this.active=_13;this.startPos=e.pageX;this.startWidth=0;this.totalWidth=this.rowNode.offsetWidth;this.bodyCursor=_1.style(document.body,"cursor");_1.style(document.body,"cursor","col-resize");_1.forEach(this.columns,function(_14,i){var _15=this.getColWidth(_14);_14.width=_14.startWidth=_15;_14.minWidth=Math.min(_15,this.minWidth);if(i<=_13){this.startWidth+=_15;}},this);this.handles=[_1.connect(document,"mousemove",_1.hitch(this,"moveResize")),_1.connect(document,"mouseup",_1.hitch(this,"endResize"))];e.preventDefault();},moveResize:function(e){var _16=0,_17=this.active,_18=this.columns,_19=this.startWidth+(this.rtl?-1:1)*(e.pageX-this.startPos);this.scaleColumns(_17,_19);for(var i=0,_1a;_1a=_18[i];i++){var _1b=Math.round(_1a.width);this.setColWidth(_1a,_1b);_16+=_1b;}var _1c=this.totalWidth-_16;this.setColWidth(_18[_17],_18[_17].rounded+_1c);e.preventDefault();},endResize:function(e){this.resizing=false;while(this.handles.length){_1.disconnect(this.handles.pop());}var _1d=this.columns;_1.forEach(_1d,function(_1e){if(this.colUnits=="%"){var _1f=_1e.rounded/this.totalWidth*100;this.setColWidth(_1e,_1f,"%");}else{this.setRatios();}},this);_1.style(document.body,"cursor",this.bodyCursor);},recalculate:function(){if(this.colUnits=="px"){var _20=0,_21=false;_1.forEach(this.columns,function(_22){if(_22.isAuto){_21=true;}else{_20+=_22.width;}});if(_21){var _23=_1.contentBox(this.tableNode.parentNode).w-_1.getBorderExtents(this.tableNode).w,_24=totalWidthLeft=_23-_20;_1.forEach(this.autoColumns,function(_25){var _26=Math.max(Math.min(Math.round(_25.ratio*totalWidthLeft),_24),this.minWidth);_24-=_26;_25.width=_26;this.setColWidth(_25,_26);},this);}}},getColWidth:function(_27){return _27.node.offsetWidth;},setColWidth:function(_28,_29,_2a){_2a=_2a||"px";if(_2a==="px"){_28.rounded=_29;}_28.cols[0].style.width=_28.cols[1].style.width=_29+_2a;},setRatios:function(){var _2b=0;_1.forEach(this.autoColumns,function(_2c){_2b+=this.getColWidth(_2c);},this);_1.forEach(this.autoColumns,function(_2d){_2d.ratio=_2d.width/_2b;},this);},scaleColumns:function(_2e,_2f){var _30=this.columns,_31=_30.slice(0,_2e+1),_32=_30.slice(_2e+1).reverse(),_33=this.totalWidth,_34=0;for(var i=0;i<=_2e;i++){_34+=_30[i].width;}if(_2f<_34){var _35=this.calcScale(_31,_2f);this.calcScale(_32,_33-_35);}else{if(_2f>_34){var _35=this.calcScale(_32,_33-_2f);this.calcScale(_31,_33-_35);}}},calcScale:function(_36,_37){var _38=0,_39=0,_3a=0,_3b=_36.pop();for(var i=0;i<_36.length;i++){_38+=_36[i].minWidth;_39+=_36[i].startWidth;}_3b.width=Math.max(_3b.minWidth,_37-_39);_37-=_3b.width;for(var i=0;i<_36.length;i++){var _3c=_36[i];_38-=_3c.minWidth;var _3d=Math.min(_3c.startWidth,_37-_3a-_38),_3e=Math.min(_3d,_3c.startWidth/_39*_37);_3c.width=Math.max(_3c.minWidth,_3e);_3a+=_3c.width;}return _3a+_3b.width;},destroy:function(){while(this.connects.length){_1.disconnect(this.connects.pop());}_1.forEach(this.thNodes,function(th){mxui.dom.data(th,"index",null);});}});});