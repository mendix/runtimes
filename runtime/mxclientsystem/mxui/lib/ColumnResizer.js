/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/lib/ColumnResizer",["mxui/dom","dojo/dom-geometry","dojo/dom-style","dojo/on","dojo/_base/event","dojo/_base/array","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8){var _9=_8(null,{declaredClass:"mxui.lib.ColumnResizer",columns:null,thNodes:null,colUnits:"",tableNode:null,gridNode:null,rowNode:null,minWidth:40,cssClass:"mx-datagrid-column-resizer",rtl:false,autoColums:null,active:0,startPos:0,startWidth:0,totalWidth:0,bodyCursor:"",handles:null,connects:null,resizing:false,constructor:function(_a){_a=_a||{};var _b=_a.thNodes,_c=_a.colNodes;this.columns=[];this.autoColumns=[];this.thNodes=_b;this.colUnits=_a.colUnits;this.tableNode=_a.tableNode;this.gridNode=_a.gridNode;this.rowNode=_b[0].parentNode;this.minWidth=_a.minWidth||40;this.rtl=_a.rtl;this.prepareTable(_b,_c);},prepareTable:function(_d,_e){var _f=0,_10=false;_6.forEach(_d,function(th,_11){if(_11>0){var _12=_1.create("div",{"class":this.cssClass});_1.data(_12,"index",_11);th.firstChild.appendChild(_12);}var _13=_e[_11][0].style.width,_14=_13=="auto";var _15=this.columns[_11]={node:th,cols:_e[_11],width:0,rounded:0,minWidth:0,startWidth:0,isAuto:_14};if(this.colUnits=="px"){if(_14){_10=true;this.autoColumns.push(_15);}else{_f+=parseInt(_13,10);}}else{_10=true;}},this);if(!_10){this.tableNode.style.width=this.gridNode.style.width=_f+"px";}_6.forEach(this.columns,function(_16){_16.width=this.getColWidth(_16);},this);this.setRatios();var _17=this;this.connects=[_4(this.rowNode,"."+this.cssClass+":click",_5.stop),_4(this.rowNode,"."+this.cssClass+":mousedown",function(e){var _18=_1.data(this,"index");_17.startResize(_18-1,e);})];},startResize:function(_19,e){if(this.resizing){this.endResize();return;}this.resizing=true;this.active=_19;this.startPos=e.pageX;this.startWidth=0;this.totalWidth=this.rowNode.offsetWidth;this.bodyCursor=_3.get(document.body,"cursor");_3.set(document.body,"cursor","col-resize");_6.forEach(this.columns,function(_1a,i){var _1b=this.getColWidth(_1a);_1a.width=_1a.startWidth=_1b;_1a.minWidth=Math.min(_1b,this.minWidth);if(i<=_19){this.startWidth+=_1b;}},this);this.handles=[_4(document,"mousemove",_7.hitch(this,"moveResize")),_4(document,"mouseup",_7.hitch(this,"endResize"))];e.preventDefault();},moveResize:function(e){var _1c=0,_1d=this.active,_1e=this.columns,_1f=this.startWidth+(this.rtl?-1:1)*(e.pageX-this.startPos);this.scaleColumns(_1d,_1f);for(var i=0,_20;_20=_1e[i];i++){var _21=Math.round(_20.width);this.setColWidth(_20,_21);_1c+=_21;}var _22=this.totalWidth-_1c;this.setColWidth(_1e[_1d],_1e[_1d].rounded+_22);e.preventDefault();},endResize:function(){this.resizing=false;while(this.handles.length){this.handles.pop().remove();}var _23=this.columns;_6.forEach(_23,function(_24){if(this.colUnits=="%"){var _25=_24.rounded/this.totalWidth*100;this.setColWidth(_24,_25,"%");}else{this.setRatios();}},this);_3.set(document.body,"cursor",this.bodyCursor);},recalculate:function(){if(this.colUnits=="px"){var _26=0,_27=false;_6.forEach(this.columns,function(_28){if(_28.isAuto){_27=true;}else{_26+=_28.width;}});if(_27){var _29=_2.getContentBox(this.tableNode.parentNode).w-_2.getBorderExtents(this.tableNode).w,_2a=_29-_26,_2b=_2a;_6.forEach(this.autoColumns,function(_2c){var _2d=Math.max(Math.min(Math.round(_2c.ratio*_2a),_2b),this.minWidth);_2b-=_2d;_2c.width=_2d;this.setColWidth(_2c,_2d);},this);}}},getColWidth:function(_2e){return _2e.node.offsetWidth;},setColWidth:function(_2f,_30,_31){_31=_31||"px";if(_31==="px"){_2f.rounded=_30;}_2f.cols[0].style.width=_2f.cols[1].style.width=_30+_31;},setRatios:function(){var _32=0;_6.forEach(this.autoColumns,function(_33){_32+=this.getColWidth(_33);},this);_6.forEach(this.autoColumns,function(_34){_34.ratio=_34.width/_32;},this);},scaleColumns:function(_35,_36){var _37=this.columns,_38=_37.slice(0,_35+1),_39=_37.slice(_35+1).reverse(),_3a=this.totalWidth,_3b=0,_3c;for(var i=0;i<=_35;i++){_3b+=_37[i].width;}if(_36<_3b){_3c=this.calcScale(_38,_36);this.calcScale(_39,_3a-_3c);}else{if(_36>_3b){_3c=this.calcScale(_39,_3a-_36);this.calcScale(_38,_3a-_3c);}}},calcScale:function(_3d,_3e){var _3f=0,_40=0,_41=0,_42=_3d.pop();_6.forEach(_3d,function(_43){_3f+=_43.minWidth;_40+=_43.startWidth;});_42.width=Math.max(_42.minWidth,_3e-_40);_3e-=_42.width;_6.forEach(_3d,function(_44){_3f-=_44.minWidth;var _45=Math.min(_44.startWidth,_3e-_41-_3f),_46=Math.min(_45,_44.startWidth/_40*_3e);_44.width=Math.max(_44.minWidth,_46);_41+=_44.width;});return _41+_42.width;},destroy:function(){while(this.connects.length){this.connects.pop().remove();}_6.forEach(this.thNodes,function(th){_1.data(th,"index",null);});}});return _9;});