
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/lib/_ContextSource",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.lib._ContextSource");mxui.lib._ContextSourceDirect={name:"mxui.lib._ContextSourceDirect",isValidContext:function(_4){var _5=_4.params,_6=_4.mxcontext,_7=_5.entity;return _6.hasContext(_7);},fetchObject:function(_8){var _9=_8.params,_a=typeof _8.callback=="function"?_8.callback:null,_b=_9.mxcontext,_c=_9.entity,id=_b&&_b.getTrackId(),_d=_b&&_b.getTrackEntity(),_e=_d&&mx.meta.getEntity(_d);var _f=function(){_9.hold(null);_a&&_a(null);};if(_e&&_e.isA(_c)&&id&&_a){if(_9.useSchema){mx.data.getBySchema({id:id,schema:_9.mxid,callback:function(obj,_10){if(_10){_9.hold(obj);}_b.setTrackObject(obj);_a&&_a(obj);},error:function(e){mx.onError(e);_b.setTrackObject(null);_f();}});}else{mx.data.get({guid:id,filter:{id:_9.mxid},callback:function(obj){if(obj){if(obj.isA(_c)){_9.hold(obj);_a(obj);}else{mx.onError(new mendix.lib.Error(this.name+".fetchObject : received object is not of type "+_c));_f();}}else{_f();}},error:function(e){mx.onError(e);_f();}});}}else{_a&&_a(null);}}};mxui.lib._ContextSourceXPath={my_attributes:["cxtxpath"],isValidContext:function(_11,_12){return true;},fetchObject:function(_13){var _14=_13.params;var _15=typeof (_13.callback)=="function"?_13.callback:null;var _16=_14.mxcontext;var _17=_14.entity;var _18=_14.cxtxpath;if(!_18){logger.error("Unable to fetchObject, because path is empty");_15&&_15(null);}var _19=_18.split(/\//);var _1a=_19?_19[0]:null;var id=_16&&_1a?_16.getContext(_1a):null;if(id&&_18&&_15){var _1b=_18.replace(_1a,"//"+_1a+"[id="+id+"]")+"/"+_17;mx.data.get({xpath:_1b,filter:{limit:1},callback:function(_1c){_15(_1c[0]);},error:function(e){mx.onError(e);_15(null);}});}else{_15&&_15(null);}}};mxui.lib._ContextSourceMicroflow={name:"mxui.lib._ContextSourceMicroflow",my_attributes:["cxtmicroflow"],isValidContext:function(_1d){return true;},fetchObject:function(_1e){var _1f=_1e.params,_20=typeof _1e.callback=="function"?_1e.callback:null,_21=_1f.mxcontext,_22=_1f.cxtmicroflow;if(_22&&_20){mx.data.get({microflow:_22,context:_21,callback:function(_23){if(_1.isArray(_23)&&_23.length>0){if(_23.length>1){mx.data.release(_23.slice(0));}_1f.hold(_23[0]);_20(_23[0]);}else{_20(null);}},error:function(e){mx.onError(e);_20(null);}});}else{_20&&_20(null);}}};});