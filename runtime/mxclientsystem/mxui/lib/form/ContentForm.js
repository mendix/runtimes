
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/lib/form/ContentForm",["mxui/lib/pageTemplating/pageProvider","mxui/lib/pageTemplating/pageComponentComposer","mxui/lib/graveyard","mxui/lib/form/_FormBase","mxui/widget","mxui/dom","mendix/lang","mendix/logger","mendix/lib/NavigationError","dojo/dom-class","dojo/_base/array","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){"use strict";var $=_6.create;function _e(_f,_10){return _b.map(_f.components,function(_11){return _11.findPlaceholder(_10);});};function _12(_13){_b.forEach(_13,function(_14){_a.add(_14,"mx-placeholder-hidden");});};function _15(_16,_17,_18,_19,_1a){var _1b=_b.map(_17,function(_1c,i){var _1d=_16[i];_1c.appendTo(_1d);return function(_1e){_5.loadWidgetsIn(_1d,_18,_19,function(){_a.remove(_1d,"mx-placeholder-hidden");_1e();});};});_7.collect(_1b,_1a);};var _1f=_d(_4,{_currentLayouts:null,_lastRequestedPath:null,_lastRequestId:0,_requestsInProgress:0,widgetTemplates:null,constructor:function(){this.widgetTemplates={};this._currentLayouts=[];this.place="content";this.id="ContentForm";this.domNode=$("div",{"class":"mx-page"},$("div",{"class":"mx-placeholder","data-mx-placeholder":"main"}));},_updatePropertiesFrom:function(_20,_21,_22){this.widgetTemplates=_c.mixin(this.widgetTemplates,_20.widgetTemplates);this.id=_20.id;this.path=_20.path;this.title=_21||_20.title;this.viewState=_22;this.domNode.className="mx-page "+_20["class"];this.domNode.style.cssText=_20.style||"";},_loadPage:function(_23,_24,_25){var _26=this,_27=this._lastRequestId;_1.get(_23,function(_28){if(_27==_26._lastRequestId){_29(_28);}else{_25(new _9("Request for path "+_28.path+" has been superseded by request for "+_26._lastRequestedPath));}},_25);function _29(_2a){_2.composeNewComponentsIn(_2a,_26._currentLayouts,function(_2b){_26._currentLayouts=_2b.layouts;_24(_2b);},_25);};},navigateTo:function(_2c,_2d,_2e,_2f,_30,_31,_32){var _33=this,_34=++this._lastRequestId;this._requestsInProgress++;this._lastRequestedPath=_2c;_33._loadPage(_2c,function(_35){var _36=_e(_35,_33.domNode);_2f=_c.mixin({},_2f,{mxform:_33});_12(_36);_3.exileWidgetsIn(_36);_33._updatePropertiesFrom(_35,_2d,_30);_33.onNavigation();_15(_36,_35.components,_2f,_2e,function(){var _37=_33._lastRequestId;_38();if(_34==_37){_33.resize();_31();}else{_39(new _9("Loading of page "+_2c+" has been superseded by "+_33._lastRequestedPath));}});},function(e){_38();_39(e);});function _39(e){if(_32){_32(e);}else{mx.onError(e);}};function _38(){if(--_33._requestsInProgress===0){_3.destroyWidgets();}};},resize:function(){_5.resizeChildrenIn(this.domNode);},onNavigation:function(){}});return _1f;});