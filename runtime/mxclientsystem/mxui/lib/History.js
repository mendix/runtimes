
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/lib/History",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.lib.History");mxui.lib.History=function(_4){_4=_4||{};var _5=this,_6="mxui.lib.History",_7=_4.limit||10,_8=-1,_9=[],_a=null,_b=true,_c=!(_1.isIE<10&&window.self!=window.top);this.onHashChange=function(_d){if(_1.config.isDebug){_d=_d.substr(_d.lastIndexOf(";")+1);}if(_8!=-1&&_d==_9[_8].hash){return;}if(!_b){_b=true;return;}var _e=mendix.lang.findIndex(_9,function(_f){return _f.hash==_d;});if(_e!=-1){_8=_e;var _10=_9[_8];mx.ui.openForm(_10.path,{context:_10.context,instance:_10});}else{_8=-1;_b=false;mx.remote.execute(mx.session.getConfig());}};this.startup=function(){_a=_1.subscribe("/dojo/hashchange",this.onHashChange);};this.exists=function(){return _8<_9.length;};this.back=function(){if(_c){window.history.back();}else{setTimeout(function(){var _11=_9[_8-1];_5.onHashChange(_11?_11.hash:"");},0);}};this.register=function(_12){if(_b){var _13;if(_8<_9.length-1){_13=_9.splice(_8+1,_9.length);}else{if(_9.length==_7){_13=[_9.shift()];}}_1.forEach(_13,function(_14){_14.destroy();});_8=_9.length;_9.push(_12);}if(_c){_1.hash(_1.config.isDebug?mx.ui.encodeUrlHash(_12.path,_12.context,_12.hash):_12.hash,!_b);}};this.getForm=function(_15){return mendix.lang.find(_9,function(_16){return _16.hash==_15;});};this.destroy=function(){_1.forEach(_9,function(_17){_17.destroy();});if(_a){_1.unsubscribe(_a);_a=null;}_8=-1;_9=[];};};});