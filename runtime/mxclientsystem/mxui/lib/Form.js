
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/lib/Form",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.lib.Form");_1.declare("mxui.lib.Form",null,{id:"",path:"",title:"",hash:"",place:"",context:null,domNode:null,_params:null,_returns:null,_listeners:null,constructor:function(_4,_5){this.id=_4.id;this.path=_4.path;this.title=_5.title||_4.title;this.place=_5.place;this.hash=+new Date()+"";this._params=_5;this._returns={};this._listeners={};this.domNode=mxui.dom.create("div",{"class":"mx-page"},_4.content||"");_1.addClass(this.domNode,_4["class"]);_1.attr(this.domNode,"style",_4.style);mxui.wm.focus.addBox(this.domNode);mxui.wm.focus.cyclic(this.domNode,true);},startup:function(_6){var _7=_1.mixin({mxform:this},this._params),_8=mxui.html.parser.parse(this.domNode,_7);mxui.widget.ready(_8,_6);},onBeforeShow:function(){this.resize();},onBeforeHide:function(){},onAfterShow:function(){mxui.wm.focus.first(this.domNode);},onAfterHide:function(){},getTitle:function(){return this.title;},setTitle:function(_9){this.title=_9;},getChildren:function(_a){if(_a){return _1.query("[widgetid]",this.domNode).map(_2.byNode);}else{return _2.findWidgets(this.domNode);}},callRecursive:function(_b,_c,_d){var _e=this.getChildren(),_f=Array.prototype.slice.call(arguments,1);for(var i=0,_10;_10=_e[i];i++){_10[_b]&&_10[_b].apply(_10,_f);}},suspend:function(){var _11=this.getChildren(true);for(var i=0,_12;_12=_11[i];i++){if(_12 instanceof mxui.widget._WidgetBase){_12.set("suspended",true);}else{if(_12.suspend){_12.suspend();}}}},resume:function(){var _13=this.getChildren(true);for(var i=0,_14;_14=_13[i];i++){if(_14 instanceof mxui.widget._WidgetBase){_14.set("suspended",false);}else{if(_14.resume){_14.resume();}}}},reload:function(){this.applyContext(this.context);},resize:function(){if(this.place==="content"){var _15=this,_16=this.domNode,_17=_2.findWidgets(_16),_18=_17[0];if(_17.length!==1){return;}if(_18.domNode.parentNode===_16){if(typeof _18.resize==="function"){_16.style.height="100%";_18.resize({w:_16.offsetWidth,h:_16.offsetHeight});_16.style.height="";}}}},enable:function(){this.callRecursive("set","disabled",true);},disable:function(){this.callRecursive("set","disabled",false);},close:function(){var _19=this;this.publish("close",function(){_19.dispose();});},dispose:function(){},validate:function(_1a,_1b){this.publish("validate",_1a,_1b);},save:function(_1c,_1d){this.publish("save",_1c,_1d);},commit:function(_1e,_1f){this.publish("commit",_1e,_1f);},rollback:function(_20,_21){this.publish("rollback",_20,_21);},publish:function(_22,_23,_24){var _25=this._listeners[_22];if(_25){var _26=[];for(var _27 in _25){_26.unshift(_1.partial(function(_28,_29){_28(_29,_24);},_25[_27]));}mendix.lang.sequence(_26,_23);}else{_23&&_23();}},listen:function(_2a,_2b){var sid=mendix.lang.getUniqueId(),_2c=this._listeners[_2a]||(this._listeners[_2a]={});_2c[sid]=_2b;return [_2a,sid];},unlisten:function(_2d){var sid=_2d[1],msg=_2d[0],_2e=this._listeners[msg];if(_2e){delete _2e[sid];for(var i in _2e){return;}delete this._listeners[msg];}},applyContext:function(_2f,_30){var old=this.context;if(old&&old.toQuery()==_2f.toQuery()){mx.context.destroy(_2f);_30&&_30();}else{old&&mx.context.destroy(old);this.context=_2f;_2f.freeze();var _31=[];var run=function(_32){var _33=_2.findWidgets(_32);for(var i=0,_34;_34=_33[i];i++){if(_34.applyContext){_31.push(function(_35){return function(_36){_35.applyContext(_2f,_36);};}(_34));}else{run(_34.domNode);}}};run(this.domNode);mendix.lang.collect(_31,_30,this);}},getReturnValue:function(key){return this._returns[key];},setReturnValue:function(key,_37){this._returns[key]=_37;},hasInterface:function(_38){return _38=="close";},invokeCall:function(_39){if(_39=="close"){this.dispose();}},destroy:function(){mxui.wm.focus.removeBox(this.domNode);var _3a=[this.header,this.domNode,this.footer];for(var i=0,l=_3a.length;i<l;i++){if(_3a[i]){mxui.dom.orphan(_3a[i]);}}var top=this.getChildren(),all=this.getChildren(true);for(var i=0,_3b;_3b=top[i];i++){_3b.domNode&&_3b.destroyRecursive();}for(var i=0,_3b;_3b=all[i];i++){if(_3b.domNode){logger.error(_3b.id+": widget not destroyed, check parent's uninitalize method");_3b.destroyRecursive();}}if(this.context){mx.context.destroy(this.context);}}});});