
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/lib/Form",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.lib.Form");_1.declare("mxui.lib.Form",null,{id:"",path:"",title:"",hash:"",place:"",cssClass:"",cssStyle:"",context:null,domNode:null,_params:null,_returns:null,_listeners:null,constructor:function(_4,_5){this.id=_4.id;this.path=_4.path;this.title=_5.title||_4.title;this.place=_5.place;this.hash=+new Date()+"";this.cssClass=_4["class"]||"";this.cssStyle=_4.style||"";this._params=_5;this._returns={};this._listeners={};this.domNode=mxui.dom.create("div",{"class":"mx-page"},_4.content||"");if(this.place!="popup"){_1.addClass(this.domNode,this.cssClass);_1.attr(this.domNode,"style",this.cssStyle);}mxui.wm.focus.addBox(this.domNode);mxui.wm.focus.cyclic(this.domNode,true);},startup:function(_6){var _7=_1.mixin({mxform:this},this._params),_8=mxui.html.parser.parse(this.domNode,_7);mxui.widget.ready(_8,_6);},onBeforeShow:function(){this.resize();},onBeforeHide:function(){},onAfterShow:function(){mxui.wm.focus.first(this.domNode);},onAfterHide:function(){},getTitle:function(){return this.title;},setTitle:function(_9){this.title=_9;},getChildren:function(_a){if(_a){return _1.query("[widgetid]",this.domNode).map(_2.byNode);}else{return _2.findWidgets(this.domNode);}},callRecursive:function(_b,_c,_d){var _e=this.getChildren(),_f=Array.prototype.slice.call(arguments,1);for(var i=0,_10;_10=_e[i];i++){_10[_b]&&_10[_b].apply(_10,_f);}},suspend:function(){var _11=this.getChildren(true);for(var i=0,_12;_12=_11[i];i++){if(_12 instanceof mxui.widget._WidgetBase){_12.set("suspended",true);}else{if(_12.suspend){_12.suspend();}}}},resume:function(){var _13=this.getChildren(true);for(var i=0,_14;_14=_13[i];i++){if(_14 instanceof mxui.widget._WidgetBase){_14.set("suspended",false);}else{if(_14.resume){_14.resume();}}}},reload:function(_15){this.applyContext(this.context,_15);},resize:function(){if(this.place==="content"){var _16=this,_17=this.domNode,_18=_2.findWidgets(_17),_19=_18[0];if(_18.length!==1){return;}if(_19.domNode.parentNode===_17){if(typeof _19.resize==="function"){_17.style.height="100%";_19.resize({w:_17.offsetWidth,h:_17.offsetHeight});_17.style.height="";}}}},enable:function(){this.callRecursive("set","disabled",true);},disable:function(){this.callRecursive("set","disabled",false);},close:function(){var _1a=this;this.publish("close",function(){_1a.dispose();});},dispose:function(){},validate:function(_1b,_1c){this.publish("validate",_1b,_1c);},save:function(_1d,_1e){this.publish("save",_1d,_1e);},commit:function(_1f,_20){this.publish("commit",_1f,_20);},rollback:function(_21,_22){this.publish("rollback",_21,_22);},publish:function(_23,_24,_25){var _26=this._listeners[_23];if(_26){var _27=[];for(var _28 in _26){_27.unshift(_1.partial(function(_29,_2a){_29(_2a,_25);},_26[_28]));}mendix.lang.sequence(_27,_24);}else{_24&&_24();}},listen:function(_2b,_2c){var sid=mendix.lang.getUniqueId(),_2d=this._listeners[_2b]||(this._listeners[_2b]={});_2d[sid]=_2c;return [_2b,sid];},unlisten:function(_2e){var sid=_2e[1],msg=_2e[0],_2f=this._listeners[msg];if(_2f){delete _2f[sid];for(var i in _2f){return;}delete this._listeners[msg];}},applyContext:function(_30,_31){var old=this.context;if(old&&old.toQuery()==_30.toQuery()){mx.context.destroy(_30);_31&&_31();return;}old&&mx.context.destroy(old);this.context=_30;_30.freeze();var _32=[];var run=function(_33){var _34=_2.findWidgets(_33);for(var i=0,_35;_35=_34[i];i++){if(_35.applyContext){_32.push(function(_36){return function(_37){_36.applyContext(_30,_37);};}(_35));}else{run(_35.domNode);}}};run(this.domNode);mendix.lang.collect(_32,_31,this);},getReturnValue:function(key){return this._returns[key];},setReturnValue:function(key,_38){this._returns[key]=_38;},getCSSClass:function(){return this.cssClass;},getCSSStyle:function(){return this.cssStyle;},hasInterface:function(_39){return _39=="close";},invokeCall:function(_3a){if(_3a=="close"){this.dispose();}},destroy:function(){mxui.wm.focus.removeBox(this.domNode);var _3b=[this.header,this.domNode,this.footer];for(var i=0,l=_3b.length;i<l;i++){if(_3b[i]){mxui.dom.orphan(_3b[i]);}}var top=this.getChildren(),all=this.getChildren(true);for(var i=0,_3c;_3c=top[i];i++){_3c.domNode&&_3c.destroyRecursive();}for(var i=0,_3c;_3c=all[i];i++){if(_3c.domNode){logger.error(_3c.id+": widget not destroyed, check parent's uninitalize method");_3c.destroyRecursive();}}if(this.context){mx.context.destroy(this.context);}}});});