
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/lib/Form",["mendix/lang","mendix/logger","mxui/wm/focus","mxui/widget","mxui/html/parser","mxui/widget/_WidgetBase","mxui/dom","dojo/dom-class","dojo/dom-attr","dojo/_base/array","dojo/_base/lang","dojo/_base/declare","dijit/registry"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){var _e=_c(null,{declaredClass:"mxui.lib.Form",id:"",path:"",title:"",hash:"",place:"",cssClass:"",cssStyle:"",context:null,domNode:null,_params:null,_returns:null,_listeners:null,constructor:function(_f,_10){this.id=_f.id;this.path=_f.path;this.title=_10.title||_f.title;this.place=_10.place;this.hash=+new Date()+"";this.cssClass=_f["class"]||"";this.cssStyle=_f.style||"";this._params=_10;this._returns={};this._listeners={};this.domNode=_7.create("div",{"class":"mx-page"},_f.content||"");if(this.place!="popup"){_8.add(this.domNode,this.cssClass);_9.set(this.domNode,"style",this.cssStyle);}_3.addBox(this.domNode);_3.cyclic(this.domNode,true);},startup:function(_11){var _12=_b.mixin({mxform:this},this._params,{title:undefined,place:undefined}),_13=_5.parse(this.domNode,_12);_4.ready(_13,_11);},onBeforeShow:function(){this.resize();},onBeforeHide:function(){},onAfterShow:function(){_3.first(this.domNode);},onAfterHide:function(){},getTitle:function(){return this.title;},setTitle:function(_14){this.title=_14;},getChildren:function(_15){if(_15){return _a.map(this.domNode.querySelectorAll("[widgetid]"),_d.byNode);}else{return _d.findWidgets(this.domNode);}},callRecursive:function(_16,_17,_18){var _19=this.getChildren(),_1a=Array.prototype.slice.call(arguments,1);for(var i=0,_1b;_1b=_19[i];i++){_1b[_16]&&_1b[_16].apply(_1b,_1a);}},suspend:function(){var _1c=this.getChildren(true);for(var i=0,_1d;_1d=_1c[i];i++){if(_1d instanceof _6){_1d.set("suspended",true);}else{if(_1d.suspend){_1d.suspend();}}}},resume:function(){var _1e=this.getChildren(true);for(var i=0,_1f;_1f=_1e[i];i++){if(_1f instanceof _6){_1f.set("suspended",false);}else{if(_1f.resume){_1f.resume();}}}},reload:function(_20){this.applyContext(this.context,_20);},resize:function(){if(this.place==="content"){var _21=this,_22=this.domNode,_23=_d.findWidgets(_22),_24=_23[0];if(_23.length!==1){return;}if(_24.domNode.parentNode===_22){if(typeof _24.resize==="function"){_22.style.height="100%";_24.resize({w:_22.offsetWidth,h:_22.offsetHeight});_22.style.height="";}}}},enable:function(){this.callRecursive("set","disabled",true);},disable:function(){this.callRecursive("set","disabled",false);},close:function(){var _25=this;this.publish("close",function(){_25.dispose();});},dispose:function(){},validate:function(_26,_27){this.publish("validate",_26,_27);},save:function(_28,_29){this.publish("save",_28,_29);},commit:function(_2a,_2b){this.publish("commit",_2a,_2b);},rollback:function(_2c,_2d){this.publish("rollback",_2c,_2d);},publish:function(_2e,_2f,_30){var _31=this._listeners[_2e];if(_31){var _32=[];for(var _33 in _31){_32.unshift(_b.partial(function(_34,_35){_34(_35,_30);},_31[_33]));}_1.sequence(_32,_2f);}else{_2f&&_2f();}},listen:function(_36,_37){var sid=_1.getUniqueId(),_38=this._listeners[_36]||(this._listeners[_36]={});_38[sid]=_37;return [_36,sid];},unlisten:function(_39){var sid=_39[1],msg=_39[0],_3a=this._listeners[msg];if(_3a){delete _3a[sid];for(var i in _3a){return;}delete this._listeners[msg];}},applyContext:function(_3b,_3c){var old=this.context;if(old&&old.toQuery()==_3b.toQuery()){window.mx.context.destroy(_3b);_3c&&_3c();return;}old&&window.mx.context.destroy(old);this.context=_3b;_3b.freeze();var _3d=[];var run=function(_3e){var _3f=_d.findWidgets(_3e);for(var i=0,_40;_40=_3f[i];i++){if(_40.applyContext){_3d.push(function(_41){return function(_42){_41.applyContext(_3b,_42);};}(_40));}else{run(_40.domNode);}}};run(this.domNode);_1.collect(_3d,_3c,this);},getReturnValue:function(key){return this._returns[key];},setReturnValue:function(key,_43){this._returns[key]=_43;},getCSSClass:function(){return this.cssClass;},getCSSStyle:function(){return this.cssStyle;},hasInterface:function(_44){return _44=="close";},invokeCall:function(_45){if(_45=="close"){this.dispose();}},destroy:function(){_3.removeBox(this.domNode);var _46=[this.header,this.domNode,this.footer];for(var i=0,l=_46.length;i<l;i++){if(_46[i]){_7.orphan(_46[i]);}}var top=this.getChildren(),all=this.getChildren(true);_a.forEach(top,function(_47){_47.domNode&&_47.destroyRecursive();});_a.forEach(all,function(_48){if(_48.domNode){_2.error(_48.id+": widget not destroyed, check parent's uninitalize method");_48.destroyRecursive();}});if(this.context){window.mx.context.destroy(this.context);}}});return _e;});