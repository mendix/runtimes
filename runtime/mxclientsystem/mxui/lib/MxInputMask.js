
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/lib/MxInputMask",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.lib.MxInputMask");mxui.lib.substractNewString=function(_4,_5,_6){var _7=(_4.length-(_5.length-(_6)));for(var i=0;i<_7;i++){if(_4.charAt(i)!=_5.charAt(i)){_7=i;break;}}return _7;};mxui.lib.MxInputMask=function(_8,_9,_a){this.domNode=_8;this.spanMask=null;this.mask="";this.spaceChar="_";this.checker=_a;this.fullMask=(_9!=null)?_9:"99-99-9999";var _b="mxui.lib.MxInputMask";this.onFocus=function(e){if(this.isReadOnly()){return;}var _c=this.oldValue=this.domNode.value;if(this.checker!=null&&this.checker.onFocus!=null){try{this.checker.onFocus(e);}catch(e){}}if(_c==""){this.domNode.value=this.mask;this.spanMask=this.mask;}else{var cc="";var _d=this.mask.length;var _e="";for(var i=0;i<_d,cc=this.fullMask.charAt(i);i++){var _f=_c.charAt(i);if(this.matchBla(cc,_f)){_e+=_f;}else{_e+=this.mask.charAt(i);}}this.spanMask=this.domNode.value=_e;}_1.isIE&&mendix.wm.focus.put(this.domNode);};this.onBlur=function(e){if(this.isReadOnly()){return;}if(this.checker!=null&&this.checker.onBlur!=null){try{this.checker.onBlur(e);}catch(e){}}this.spanMask=null;if(this.mask==this.domNode.value){this.domNode.value="";}if(this.oldValue!=this.domNode.value){mxui.html.dispatchEvent(this.domNode,"onchange");}this.oldValue=null;};this.replaceByMask=function(src,dst,_10){var _11="";src=String(src);dst=String(dst);for(var i=0;i<src.length;i++){var ch=src.substr(i,1);var _12=dst.substr(i,1);var _13=(ch==_10)?_12:ch;_11+=_13;}return _11;};this.onKeyDown=function(evt){if(_1.isIE){var _14=(evt.keyCode==0)?evt.which:evt.keyCode;switch(_14){case 46:this.performDelete(evt);evt.preventDefault();return false;break;case 8:this.performBackspace(evt);evt.preventDefault();return false;break;}}};this.onClick=function(e){if(this.isReadOnly()){return;}this._selection=mxui.dom.getSelection(this.domNode);};this.onSelect=function(e){if(this.isReadOnly()){return;}this._selection=mxui.dom.getSelection(this.domNode);};this.onInput=function(e){if(this.isReadOnly()){return;}if(_1.isIE&&e!=null){try{setTimeout(_1.hitch(this,"onInput",null),1);return;}catch(e){}}var pos=mxui.dom.getCursorPosition(this.domNode);var _15=this.domNode.value;var _16=this.spanMask;this.domNode.value="";if(this._selection&&this._selection.start!=this._selection.end){var _16="";for(var i=0;i<this.spanMask.length;i++){var ch=(i>=this._selection.start&&i<this._selection.end)?"":this.spanMask.charAt(i);_16+=ch;}}var _17=mxui.lib.substractNewString(_16,_15,pos);var _18=pos;var _19=_15.substring(_17,_18);if(this._selection&&this._selection.start!=this._selection.end){var _1a=this._selection.end-this._selection.start;_19=_19.substr(0,_1a);}var _1b=this.fullMask.length;var _1c="";var _1d=0;var _1e=false;var _1f=-1;for(var i=0;i<_1b;i++){if(i==_17){for(var j=0;j<_19.length;j++){_1f=i;var _20=this.fullMask.charAt(i);var _21=_19.charAt(j);if(this.isEditable(_20)){var _22=this.matchBla(_20,_21);if(_22){_1c+=_21;}else{break;}}else{if(_21==_20){_1c+=_20;}else{break;}}i++;}}_1c+=this.spanMask.charAt(i);}this.spanMask=_1c;this.domNode.value=_1c;mxui.dom.selectTextRange(this.domNode,_1f+1,_1f+1);};this.onKeyPress=function(evt){if(this.isReadOnly()){return;}var _23=(evt.keyCode==0)?evt.which:evt.keyCode;var _24=evt.metaKey?evt.metaKey:evt.ctrlKey;if(_24){return true;}this._selection=null;switch(_23){case 13:break;case 27:break;case _1.keys.TAB:break;case 46:this.performDelete(evt);evt.preventDefault();return false;break;case 8:this.performBackspace(evt);evt.preventDefault();return false;break;default:if(this.performKeyPress(evt)){evt.preventDefault();return false;}}};this.performBackspace=function(evt){var _25=mxui.dom.getSelection(this.domNode);var _26="";var _27=this.domNode.value;var _28=(_25.start==_25.end);for(var i=this.mask.length;0<=i;i--){var _29=_27.charAt(i);var _2a=this.mask.charAt(i);if((_28&&(i==_25.start-1))||(i>=(_25.start)&&i<(_25.end))||_29==null){_26=_2a+_26;}else{_26=_29+_26;}}this.domNode.value=this.spanMask=_26;var _2b=(_25.start<=0)?0:_28?_25.start-1:_25.start;mxui.dom.selectTextRange(this.domNode,_2b,_2b);};this.performDelete=function(evt){var _2c=mxui.dom.getSelection(this.domNode);var _2d="";var _2e=this.domNode.value;for(var i=0;i<this.mask.length;i++){var _2f=_2e.substr(i,1);var _30=this.mask.substr(i,1);if((i>=_2c.start&&i<=_2c.end)||_2f==null){_2d+=_30;}else{_2d+=_2f;}}this.domNode.value=this.spanMask=_2d;mxui.dom.selectTextRange(this.domNode,_2c.start,_2c.start);};this.performKeyPress=function(evt){var _31=(evt.keyCode==0)?evt.which:evt.keyCode;if(evt.charCode==null){var _32=evt.shiftKey;switch(evt.keyCode){case 9:case 8:case 13:case 16:case 17:case 18:case 20:case 27:case 33:case 34:if(_32){break;}case 35:case 36:return false;}}else{if(evt.charCode==0){return false;}}var _33=(String.fromCharCode(_31));if(_33.match(/[a-zA-Z0-9]/)!=null){var _34="";var pos=mxui.dom.getCursorPosition(this.domNode);var _35=this.domNode.value;var _36=this.spanMask;var _37=pos;var _38=_35.length;for(var i=0;i<this.mask.length;i++){var _39=_36.substr(i,1);var _3a=this.fullMask.substr(i,1);if(i!=pos){if(this.isEditable(_3a)){_34+=_39;}else{_34+=_3a;}}else{if(this.matchBla(_3a,_33)){++_37;_34+=_33;var _3b;var _3c=i;while((_3b=this.fullMask.substr(++_3c,1))!=""){if(!this.isEditable(_3b)){++_37;}else{break;}}}else{_34+=_39;}}}this.spanMask=_34;this.domNode.value=_34;mxui.dom.selectTextRange(this.domNode,_37,_37);}return true;};this.matchBla=function(_3d,_3e){if(_3d=="9"){return (_3e.match(/^[0-9]$/g)!=null);}else{if(_3d=="U"){return (_3e.match(/^[A-Z]$/g)!=null);}else{if(_3d=="L"){return (_3e.match(/^[a-z]$/g)!=null);}else{if(_3d=="Z"){return (_3e.match(/^[a-zA-Z]$/g)!=null);}else{if(_3d=="*"){return (_3e.match(/^[a-zA-Z0-9]$/g)!=null);}}}}}return false;};this.isEditable=function(str){return (str=="9"||str=="U"||str=="L"||str=="Z"||str=="*");};this.isReadOnly=function(){return this.domNode.readOnly;};var _3f=[];var _40=function(){_3f=[_1.connect(this.domNode,"onfocus",this,"onFocus"),_1.connect(this.domNode,"onkeypress",this,"onKeyPress"),_1.connect(this.domNode,"onblur",this,"onBlur"),_1.connect(this.domNode,_1.isIE?"onpaste":"oninput",this,"onInput"),_1.connect(this.domNode,"onselect",this,"onSelect"),_1.connect(this.domNode,"onclick",this,"onClick")];var _41=this.fullMask.replace(/9/g,this.spaceChar);_41=_41.replace(/Z/g,this.spaceChar);_41=_41.replace(/U/g,this.spaceChar);_41=_41.replace(/L/g,this.spaceChar);_41=_41.replace(/\*/g,this.spaceChar);this.mask=_41;};this.destroy=function(){while(_3f.length){_1.disconnect(_3f.pop());}};_40.call(this);};mxui.lib.MxDateMask=function(_42,_43){this.domNode=_42;this.separator=_43;this.InputMask=null;var _44="mxui.lib.MxDateMask";this.onBlur=function(e){var _45=this.domNode.value.split(this.separator);if(this.domNode.value.match(/[a-zA-Z0-9]/)==null){this.domNode.value="";return;}var _46=_45[0];var _47=_45[1];var _48=_45[2];if(_45[0].indexOf(this.InputMask.spaceChar)!=-1){var dt=new Date().getDate();dt=(dt<10)?("0"+dt):dt;_46=this.InputMask.replaceByMask(_46,dt,this.InputMask.spaceChar);}if(_45[1].indexOf(this.InputMask.spaceChar)!=-1){var _49=new Date().getMonth();if(_49<10){_49="0"+_49;}_47=this.InputMask.replaceByMask(_47,_49,this.InputMask.spaceChar);}if(_45[2].indexOf(this.InputMask.spaceChar)!=-1){var _4a=new Date().getFullYear();_48=this.InputMask.replaceByMask(_48,_4a,this.InputMask.spaceChar);}this.domNode.value=_46+this.separator+_47+this.separator+_48;};this.onFocus=function(e){var _4b=this.domNode.value;if(_4b==""){return;}var _4c=_4b.split(this.separator);var _4d=_4c[0];var _4e=_4c[1];var _4f=_4c[2];if(_4d.length!=2){_4d="0"+_4d;}if(_4e.length!=2){_4e="0"+_4e;}if(_4f.length!=4){}this.domNode.value=_4d+this.separator+_4e+this.separator+_4f;};this.destroy=function(){this.InputMask.destroy();};this.start=function(){var _50="99"+this.separator+"99"+this.separator+"9999";this.InputMask=new mxui.lib.MxInputMask(this.domNode,_50,this);};this.start();};});