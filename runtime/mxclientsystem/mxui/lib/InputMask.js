
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/lib/InputMask",["mendix/logger","mxui/wm/focus","mxui/dom","mxui/html","dojo/sniff","dojo/on","dojo/keys","dojo/_base/lang"],function(_1,_2,_3,_4,_5,_6,_7,_8){function _9(_a,_b,_c){var _d=(_a.length-(_b.length-(_c)));for(var i=0;i<_d;i++){if(_a.charAt(i)!=_b.charAt(i)){_d=i;break;}}return _d;};var _e=function(_f,_10,_11){this.domNode=_f;this.spanMask=null;this.mask="";this.spaceChar="_";this.checker=_11;this.fullMask=(_10!=null)?_10:"99-99-9999";this.onFocus=function(e){if(this.isReadOnly()){return;}var _12=this.oldValue=this.domNode.value;if(this.checker!=null&&this.checker.onFocus!=null){try{this.checker.onFocus(e);}catch(e){}}if(_12==""){this.domNode.value=this.mask;this.spanMask=this.mask;}else{var _13="";for(var i=0,cc;i<this.mask.length,cc=this.fullMask.charAt(i);i++){var val=_12.charAt(i);if(this.matchBla(cc,val)){_13+=val;}else{_13+=this.mask.charAt(i);}}this.spanMask=this.domNode.value=_13;}_5("ie")&&_2.put(this.domNode);};this.onBlur=function(e){if(this.isReadOnly()){return;}if(this.checker!=null&&this.checker.onBlur!=null){try{this.checker.onBlur(e);}catch(e){}}this.spanMask=null;if(this.mask==this.domNode.value){this.domNode.value="";}if(this.oldValue!=this.domNode.value){_4.dispatchEvent(this.domNode,"onchange");}this.oldValue=null;};this.onKeyDown=function(evt){if(_5("ie")){var _14=(evt.keyCode==0)?evt.which:evt.keyCode;switch(_14){case 46:this.performDelete(evt);evt.preventDefault();return false;break;case 8:this.performBackspace(evt);evt.preventDefault();return false;break;}}};this.onClick=function(){if(this.isReadOnly()){return;}this._selection=_3.getSelection(this.domNode);};this.onSelect=function(){if(this.isReadOnly()){return;}this._selection=_3.getSelection(this.domNode);};this.onInput=function(e){if(this.isReadOnly()){return;}if(_5("ie")&&e!=null){try{setTimeout(_8.hitch(this,"onInput",null),1);return;}catch(e){}}var pos=_3.getCursorPosition(this.domNode);var _15=this.domNode.value;var _16=this.spanMask;this.domNode.value="";if(this._selection&&this._selection.start!=this._selection.end){_16="";for(var i=0;i<this.spanMask.length;i++){_16+=(i>=this._selection.start&&i<this._selection.end)?"":this.spanMask.charAt(i);}}var _17=_9(_16,_15,pos);var _18=_15.substring(_17,pos);if(this._selection&&this._selection.start!=this._selection.end){var _19=this._selection.end-this._selection.start;_18=_18.substr(0,_19);}var _1a=this.fullMask.length;var _1b="";var _1c=-1;for(var i=0;i<_1a;i++){if(i==_17){for(var j=0;j<_18.length;j++){_1c=i;var _1d=this.fullMask.charAt(i);var _1e=_18.charAt(j);if(this.isEditable(_1d)){var _1f=this.matchBla(_1d,_1e);if(_1f){_1b+=_1e;}else{break;}}else{if(_1e==_1d){_1b+=_1d;}else{break;}}i++;}}_1b+=this.spanMask.charAt(i);}this.spanMask=_1b;this.domNode.value=_1b;_3.selectTextRange(this.domNode,_1c+1,_1c+1);};this.onKeyPress=function(evt){if(this.isReadOnly()){return;}var _20=(evt.keyCode==0)?evt.which:evt.keyCode;var _21=evt.metaKey?evt.metaKey:evt.ctrlKey;if(_21){return true;}this._selection=null;switch(_20){case 13:break;case 27:break;case _7.TAB:break;case 46:this.performDelete(evt);evt.preventDefault();return false;break;case 8:this.performBackspace(evt);evt.preventDefault();return false;break;default:if(this.performKeyPress(evt)){evt.preventDefault();return false;}}};this.performBackspace=function(){var _22=_3.getSelection(this.domNode);var _23="";var _24=this.domNode.value;var _25=(_22.start==_22.end);for(var i=this.mask.length;0<=i;i--){var _26=_24.charAt(i);var _27=this.mask.charAt(i);if((_25&&(i==_22.start-1))||(i>=(_22.start)&&i<(_22.end))||_26==null){_23=_27+_23;}else{_23=_26+_23;}}this.domNode.value=this.spanMask=_23;var _28=(_22.start<=0)?0:_25?_22.start-1:_22.start;_3.selectTextRange(this.domNode,_28,_28);};this.performDelete=function(){var _29=_3.getSelection(this.domNode);var _2a="";var _2b=this.domNode.value;for(var i=0;i<this.mask.length;i++){var _2c=_2b.substr(i,1);var _2d=this.mask.substr(i,1);if((i>=_29.start&&i<=_29.end)||_2c==null){_2a+=_2d;}else{_2a+=_2c;}}this.domNode.value=this.spanMask=_2a;_3.selectTextRange(this.domNode,_29.start,_29.start);};this.performKeyPress=function(evt){var _2e=(evt.keyCode==0)?evt.which:evt.keyCode;if(evt.charCode==null){var _2f=evt.shiftKey;switch(evt.keyCode){case 9:case 8:case 13:case 16:case 17:case 18:case 20:case 27:case 33:case 34:if(_2f){break;}case 35:case 36:return false;}}else{if(evt.charCode==0){return false;}}var _30=(String.fromCharCode(_2e));if(_30.match(/[a-zA-Z0-9]/)!=null){var _31="";var pos=_3.getCursorPosition(this.domNode);var _32=this.spanMask;var _33=pos;for(var i=0;i<this.mask.length;i++){var _34=_32.substr(i,1);var _35=this.fullMask.substr(i,1);if(i!=pos){if(this.isEditable(_35)){_31+=_34;}else{_31+=_35;}}else{if(this.matchBla(_35,_30)){++_33;_31+=_30;var _36;var _37=i;while((_36=this.fullMask.substr(++_37,1))!=""){if(!this.isEditable(_36)){++_33;}else{break;}}}else{_31+=_34;}}}this.spanMask=_31;this.domNode.value=_31;_3.selectTextRange(this.domNode,_33,_33);}return true;};this.matchBla=function(_38,_39){if(_38=="9"){return (_39.match(/^[0-9]$/g)!=null);}else{if(_38=="U"){return (_39.match(/^[A-Z]$/g)!=null);}else{if(_38=="L"){return (_39.match(/^[a-z]$/g)!=null);}else{if(_38=="Z"){return (_39.match(/^[a-zA-Z]$/g)!=null);}else{if(_38=="*"){return (_39.match(/^[a-zA-Z0-9]$/g)!=null);}}}}}return false;};this.isEditable=function(str){return (str=="9"||str=="U"||str=="L"||str=="Z"||str=="*");};this.isReadOnly=function(){return this.domNode.readOnly;};var _3a=[];this.destroy=function(){while(_3a.length){_3a.pop().remove();}};_3a=[_6(this.domNode,"focus",_8.hitch(this,"onFocus")),_6(this.domNode,"keypress",_8.hitch(this,"onKeyPress")),_6(this.domNode,"blur",_8.hitch(this,"onBlur")),_6(this.domNode,_5("ie")?"paste":"input",_8.hitch(this,"onInput")),_6(this.domNode,"select",_8.hitch(this,"onSelect")),_6(this.domNode,"click",_8.hitch(this,"onClick"))];var _3b=this.fullMask.replace(/9/g,this.spaceChar);_3b=_3b.replace(/Z/g,this.spaceChar);_3b=_3b.replace(/U/g,this.spaceChar);_3b=_3b.replace(/L/g,this.spaceChar);_3b=_3b.replace(/\*/g,this.spaceChar);this.mask=_3b;};return _e;});