
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/lib/InputMask",["mendix/logger","mxui/wm/focus","mxui/dom","mxui/html","dojo/sniff","dojo/on","dojo/keys","dojo/_base/lang"],function(_1,_2,_3,_4,_5,_6,_7,_8){function _9(_a,_b,_c){var _d=(_a.length-(_b.length-(_c)));for(var i=0;i<_d;i++){if(_a.charAt(i)!=_b.charAt(i)){_d=i;break;}}return _d;};var _e=function(_f,_10,_11){this.domNode=_f;this.spanMask=null;this.mask="";this.spaceChar="_";this.checker=_11;this.fullMask=(_10!=null)?_10:"99-99-9999";this.onFocus=function(e){if(this.isReadOnly()){return;}var _12=this.oldValue=this.domNode.value;if(this.checker!=null&&this.checker.onFocus!=null){try{this.checker.onFocus(e);}catch(e){}}if(_12==""){this.domNode.value=this.mask;this.spanMask=this.mask;}else{var _13="";for(var i=0,cc;i<this.mask.length,cc=this.fullMask.charAt(i);i++){var val=_12.charAt(i);if(this.matchBla(cc,val)){_13+=val;}else{_13+=this.mask.charAt(i);}}this.spanMask=this.domNode.value=_13;}_5("ie")&&_2.put(this.domNode);};this.onBlur=function(e){if(this.isReadOnly()){return;}if(this.checker!=null&&this.checker.onBlur!=null){try{this.checker.onBlur(e);}catch(e){}}this.spanMask=null;if(this.mask==this.domNode.value){this.domNode.value="";}if(this.oldValue!=this.domNode.value){_4.dispatchEvent(this.domNode,"onchange");}this.oldValue=null;};this.onClick=function(){if(this.isReadOnly()){return;}this._selection=_3.getSelection(this.domNode);};this.onSelect=function(){if(this.isReadOnly()){return;}this._selection=_3.getSelection(this.domNode);};this.onInput=function(e){if(this.isReadOnly()){return;}if(_5("ie")&&e!=null){try{setTimeout(_8.hitch(this,"onInput",null),1);return;}catch(e){}}var pos=_3.getCursorPosition(this.domNode);var _14=this.domNode.value;var _15=this.spanMask;this.domNode.value="";if(this._selection&&this._selection.start!=this._selection.end){_15="";for(var i=0;i<this.spanMask.length;i++){_15+=(i>=this._selection.start&&i<this._selection.end)?"":this.spanMask.charAt(i);}}var _16=_9(_15,_14,pos);var _17=_14.substring(_16,pos);if(this._selection&&this._selection.start!=this._selection.end){var _18=this._selection.end-this._selection.start;_17=_17.substr(0,_18);}var _19=this.fullMask.length;var _1a="";var _1b=-1;for(var i=0;i<_19;i++){if(i==_16){for(var j=0;j<_17.length;j++){_1b=i;var _1c=this.fullMask.charAt(i);var _1d=_17.charAt(j);if(this.isEditable(_1c)){var _1e=this.matchBla(_1c,_1d);if(_1e){_1a+=_1d;}else{break;}}else{if(_1d==_1c){_1a+=_1c;}else{break;}}i++;}}_1a+=this.spanMask.charAt(i);}this.spanMask=_1a;this.domNode.value=_1a;_3.selectTextRange(this.domNode,_1b+1,_1b+1);};this.onKeyPress=function(evt){if(this.isReadOnly()){return;}var _1f=(evt.keyCode==0)?evt.which:evt.keyCode;var _20=evt.metaKey?evt.metaKey:evt.ctrlKey;if(_20){return true;}this._selection=null;switch(_1f){case 13:break;case 27:break;case _7.TAB:break;case 46:this.performDelete(evt);evt.preventDefault();return false;break;case 8:this.performBackspace(evt);evt.preventDefault();return false;break;default:if(this.performKeyPress(evt)){evt.preventDefault();return false;}}};this.performBackspace=function(){var _21=_3.getSelection(this.domNode);var _22="";var _23=this.domNode.value;var _24=(_21.start==_21.end);for(var i=this.mask.length;0<=i;i--){var _25=_23.charAt(i);var _26=this.mask.charAt(i);if((_24&&(i==_21.start-1))||(i>=(_21.start)&&i<(_21.end))||_25==null){_22=_26+_22;}else{_22=_25+_22;}}this.domNode.value=this.spanMask=_22;var _27=(_21.start<=0)?0:_24?_21.start-1:_21.start;_3.selectTextRange(this.domNode,_27,_27);};this.performDelete=function(){var _28=_3.getSelection(this.domNode);var _29="";var _2a=this.domNode.value;for(var i=0;i<this.mask.length;i++){var _2b=_2a.substr(i,1);var _2c=this.mask.substr(i,1);if((i>=_28.start&&i<=_28.end)||_2b==null){_29+=_2c;}else{_29+=_2b;}}this.domNode.value=this.spanMask=_29;_3.selectTextRange(this.domNode,_28.start,_28.start);};this.performKeyPress=function(evt){var _2d=(evt.keyCode==0)?evt.which:evt.keyCode;if(evt.charCode==null){var _2e=evt.shiftKey;switch(evt.keyCode){case 9:case 8:case 13:case 16:case 17:case 18:case 20:case 27:case 33:case 34:if(_2e){break;}case 35:case 36:return false;}}else{if(evt.charCode==0){return false;}}var _2f=(String.fromCharCode(_2d));if(_2f.match(/[a-zA-Z0-9]/)!=null){var _30="";var pos=_3.getCursorPosition(this.domNode);var _31=this.spanMask;var _32=pos;for(var i=0;i<this.mask.length;i++){var _33=_31.substr(i,1);var _34=this.fullMask.substr(i,1);if(i!=pos){if(this.isEditable(_34)){_30+=_33;}else{_30+=_34;}}else{if(this.matchBla(_34,_2f)){++_32;_30+=_2f;var _35;var _36=i;while((_35=this.fullMask.substr(++_36,1))!=""){if(!this.isEditable(_35)){++_32;}else{break;}}}else{_30+=_33;}}}this.spanMask=_30;this.domNode.value=_30;_3.selectTextRange(this.domNode,_32,_32);}return true;};this.matchBla=function(_37,_38){if(_37=="9"){return (_38.match(/^[0-9]$/g)!=null);}else{if(_37=="U"){return (_38.match(/^[A-Z]$/g)!=null);}else{if(_37=="L"){return (_38.match(/^[a-z]$/g)!=null);}else{if(_37=="Z"){return (_38.match(/^[a-zA-Z]$/g)!=null);}else{if(_37=="*"){return (_38.match(/^[a-zA-Z0-9]$/g)!=null);}}}}}return false;};this.isEditable=function(str){return (str=="9"||str=="U"||str=="L"||str=="Z"||str=="*");};this.isReadOnly=function(){return this.domNode.readOnly;};var _39=[],_3a=this;this.destroy=function(){while(_39.length){_39.pop().remove();}};_39=[_6(this.domNode,"focus",_8.hitch(this,"onFocus")),_6(this.domNode,"keypress",_8.hitch(this,"onKeyPress")),_6(this.domNode,"blur",_8.hitch(this,"onBlur")),_6(this.domNode,_5("ie")?"paste":"input",_8.hitch(this,"onInput")),_6(this.domNode,"select",_8.hitch(this,"onSelect")),_6(this.domNode,"click",_8.hitch(this,"onClick"))];if(_5("ie")||_5("trident")||_5("chrome")){_39.push(_6(this.domNode,"keydown",function(evt){var _3b=(evt.keyCode==0)?evt.which:evt.keyCode;if(_3b==46||_3b==8){_3a.onKeyPress(evt);}}));}var _3c=this.fullMask.replace(/9/g,this.spaceChar);_3c=_3c.replace(/Z/g,this.spaceChar);_3c=_3c.replace(/U/g,this.spaceChar);_3c=_3c.replace(/L/g,this.spaceChar);_3c=_3c.replace(/\*/g,this.spaceChar);this.mask=_3c;};return _e;});