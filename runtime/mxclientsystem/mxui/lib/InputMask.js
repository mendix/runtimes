/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/lib/InputMask",["mendix/logger","mxui/wm/focus","mxui/dom","dojo/sniff","dojo/on","dojo/keys","dojo/_base/lang","dojo/_base/array","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){function _a(_b,_c,_d){var _e=(_b.length-(_c.length-(_d)));for(var i=0;i<_e;i++){if(_b.charAt(i)!=_c.charAt(i)){_e=i;break;}}return _e;};function _f(_10,_11){switch(_10){case "9":return _11.match(/^[0-9]$/g)!=null;case "U":return _11.match(/^[A-Z]$/g)!=null;case "L":return _11.match(/^[a-z]$/g)!=null;case "Z":return _11.match(/^[a-zA-Z]$/g)!=null;case "*":return _11.match(/^[a-zA-Z0-9]$/g)!=null;default:return false;}};var _12=_9(null,{mask:"",displayMask:"",spanMask:null,domNode:null,_connects:null,_selection:null,oldValue:"",constructor:function(_13,_14){this.domNode=_13;this.mask=_14;this.displayMask=this.mask.replace(/[9ZUL*]/g,"_");this._connects=[_5(this.domNode,"focus",_7.hitch(this,"onFocus")),_5(this.domNode,"keypress",_7.hitch(this,"onKeyPress")),_5(this.domNode,"blur",_7.hitch(this,"onBlur")),_5(this.domNode,_4("ie")?"paste":"input",_7.hitch(this,"onInput")),_5(this.domNode,"select",_7.hitch(this,"onSelect")),_5(this.domNode,"click",_7.hitch(this,"onClick"))];var _15=this;if(_4("ie")||_4("trident")||_4("chrome")){this._connects.push(_5(this.domNode,"keydown",function(evt){var _16=(evt.keyCode===0)?evt.which:evt.keyCode;if(_16===46||_16===8){_15.onKeyPress(evt);}}));}},onFocus:function(e){if(this.isReadOnly()){return;}var _17=this.oldValue=this.domNode.value;if(_17===""){this.domNode.value=this.displayMask;this.spanMask=this.displayMask;setTimeout(_7.hitch(this,this.goToFirstEditableCharacter),0);}else{var _18="";for(var i=0,cc;i<this.displayMask.length,cc=this.mask.charAt(i);i++){var val=_17.charAt(i);if(_f(cc,val)){_18+=val;}else{_18+=this.displayMask.charAt(i);}}setTimeout(_7.hitch(this,function(){var sel=_3.getSelection(this.domNode);this.spanMask=this.domNode.value=_18;_3.selectTextRange(this.domNode,sel.start,sel.end);}),0);}},goToFirstEditableCharacter:function(){var _19=this.domNode.value;var _1a=-1;for(var i=0;i<_19.length;i++){if(this.isEditable(this.mask.charAt(i))&&_19.charAt(i)==="_"){_1a=i;break;}}if(_1a!==-1){_3.selectTextRange(this.domNode,_1a,_1a);}},onBlur:function(e){if(this.isReadOnly()){return;}this.spanMask=null;if(this.displayMask===this.domNode.value){this.domNode.value="";}if(this.oldValue!=this.domNode.value){_3.dispatchEvent(this.domNode,"onchange");}this.oldValue=null;},onClick:function(){if(this.isReadOnly()){return;}this._selection=_3.getSelection(this.domNode);},onSelect:function(){if(this.isReadOnly()){return;}this._selection=_3.getSelection(this.domNode);},onInput:function(e){if(this.isReadOnly()){return;}if(_4("ie")&&e!=null){try{setTimeout(_7.hitch(this,"onInput",null),1);return;}catch(e){}}var pos=_3.getCursorPosition(this.domNode);var _1b=this.domNode.value;var _1c=this.spanMask;this.domNode.value="";if(this._selection&&this._selection.start!=this._selection.end){_1c="";for(var i=0;i<this.spanMask.length;i++){_1c+=(i>=this._selection.start&&i<this._selection.end)?"":this.spanMask.charAt(i);}}var _1d=_a(_1c,_1b,pos);var _1e=_1b.substring(_1d,pos);if(this._selection&&this._selection.start!=this._selection.end){var _1f=this._selection.end-this._selection.start;_1e=_1e.substr(0,_1f);}var _20=this.mask.length;var _21="";var _22=-1;for(var i=0;i<_20;i++){if(i===_1d){for(var j=0;j<_1e.length;j++){_22=i;var _23=this.mask.charAt(i);var _24=_1e.charAt(j);if(this.isEditable(_23)){var _25=_f(_23,_24);if(_25){_21+=_24;}else{break;}}else{if(_24===_23){_21+=_23;}else{break;}}i++;}}_21+=this.spanMask.charAt(i);}this.spanMask=_21;this.domNode.value=_21;_3.selectTextRange(this.domNode,_22+1,_22+1);},onKeyPress:function(evt){if(this.isReadOnly()){return;}var _26=(evt.keyCode===0)?evt.which:evt.keyCode;var _27=evt.metaKey?evt.metaKey:evt.ctrlKey;if(_27){return true;}this._selection=null;switch(_26){case 13:break;case 27:break;case _6.TAB:break;case 46:this.performDelete(evt);evt.preventDefault();return false;break;case 8:this.performBackspace(evt);evt.preventDefault();return false;break;default:if(this.performKeyPress(evt)){evt.preventDefault();return false;}}},performBackspace:function(){var _28=_3.getSelection(this.domNode);var _29="";var _2a=this.domNode.value;var _2b=(_28.start===_28.end);for(var i=this.displayMask.length;0<=i;i--){var _2c=_2a.charAt(i);var _2d=this.displayMask.charAt(i);if((_2b&&(i===_28.start-1))||(i>=(_28.start)&&i<(_28.end))||_2c==null){_29=_2d+_29;}else{_29=_2c+_29;}}this.domNode.value=this.spanMask=_29;var _2e=(_28.start<=0)?0:_2b?_28.start-1:_28.start;_3.selectTextRange(this.domNode,_2e,_2e);},performDelete:function(){var _2f=_3.getSelection(this.domNode);if(_2f.start===_2f.end){_2f.end=_2f.start+1;}var _30="";var _31=this.domNode.value;for(var i=0;i<this.displayMask.length;i++){if(i>=_2f.start&&i<_2f.end){_30+=this.displayMask.substr(i,1);}else{_30+=_31.substr(i,1);}}this.domNode.value=this.spanMask=_30;_3.selectTextRange(this.domNode,_2f.start,_2f.start);},_findFirstEditablePosition:function(_32){for(var i=_32;i<this.mask.length;i++){if(this.isEditable(this.mask.charAt(i))){return i;}}return -1;},performKeyPress:function(evt){var _33=(evt.keyCode===0)?evt.which:evt.keyCode;if(evt.charCode==null){var _34=evt.shiftKey;switch(evt.keyCode){case 9:case 8:case 13:case 16:case 17:case 18:case 20:case 27:case 33:case 34:if(_34){break;}case 35:case 36:return false;}}else{if(evt.charCode===0){return false;}}var _35=(String.fromCharCode(_33));if(_35.match(/[a-zA-Z0-9]/)!=null){var _36="";var pos=_3.getCursorPosition(this.domNode);var _37=this.spanMask;var _38=this._findFirstEditablePosition(pos);if(_38!==-1&&_f(this.mask.substr(_38,1),_35)){pos=_38;}var _39=pos;for(var i=0;i<this.displayMask.length;i++){var _3a=_37.substr(i,1);var _3b=this.mask.substr(i,1);if(i!=pos){if(this.isEditable(_3b)){_36+=_3a;}else{_36+=_3b;}}else{if(_f(_3b,_35)){++_39;_36+=_35;var _3c;var _3d=i;while((_3c=this.mask.substr(++_3d,1))!=""){if(!this.isEditable(_3c)){++_39;}else{break;}}}else{_36+=_3a;}}}this.spanMask=_36;this.domNode.value=_36;_3.selectTextRange(this.domNode,_39,_39);}return true;},isEditable:function(str){return (str==="9"||str==="U"||str==="L"||str==="Z"||str==="*");},isReadOnly:function(){return this.domNode.readOnly;},destroy:function(){_8.forEach(this._connects,function(_3e){_3e.remove();});this._connects=null;}});return _12;});