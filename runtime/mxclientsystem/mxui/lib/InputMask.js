
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/lib/InputMask",["mendix/logger","mxui/wm/focus","mxui/dom","dojo/sniff","dojo/on","dojo/keys","dojo/_base/lang"],function(_1,_2,_3,_4,_5,_6,_7){function _8(_9,_a,_b){var _c=(_9.length-(_a.length-(_b)));for(var i=0;i<_c;i++){if(_9.charAt(i)!=_a.charAt(i)){_c=i;break;}}return _c;};var _d=function(_e,_f,_10){this.domNode=_e;this.spanMask=null;this.mask="";this.spaceChar="_";this.checker=_10;this.fullMask=(_f!=null)?_f:"99-99-9999";this.onFocus=function(e){if(this.isReadOnly()){return;}var _11=this.oldValue=this.domNode.value;if(this.checker!=null&&this.checker.onFocus!=null){try{this.checker.onFocus(e);}catch(e){}}if(_11==""){this.domNode.value=this.mask;this.spanMask=this.mask;}else{var _12="";for(var i=0,cc;i<this.mask.length,cc=this.fullMask.charAt(i);i++){var val=_11.charAt(i);if(this.matchBla(cc,val)){_12+=val;}else{_12+=this.mask.charAt(i);}}this.spanMask=this.domNode.value=_12;}_4("ie")&&_2.put(this.domNode);};this.onBlur=function(e){if(this.isReadOnly()){return;}if(this.checker!=null&&this.checker.onBlur!=null){try{this.checker.onBlur(e);}catch(e){}}this.spanMask=null;if(this.mask==this.domNode.value){this.domNode.value="";}if(this.oldValue!=this.domNode.value){_3.dispatchEvent(this.domNode,"onchange");}this.oldValue=null;};this.onClick=function(){if(this.isReadOnly()){return;}this._selection=_3.getSelection(this.domNode);};this.onSelect=function(){if(this.isReadOnly()){return;}this._selection=_3.getSelection(this.domNode);};this.onInput=function(e){if(this.isReadOnly()){return;}if(_4("ie")&&e!=null){try{setTimeout(_7.hitch(this,"onInput",null),1);return;}catch(e){}}var pos=_3.getCursorPosition(this.domNode);var _13=this.domNode.value;var _14=this.spanMask;this.domNode.value="";if(this._selection&&this._selection.start!=this._selection.end){_14="";for(var i=0;i<this.spanMask.length;i++){_14+=(i>=this._selection.start&&i<this._selection.end)?"":this.spanMask.charAt(i);}}var _15=_8(_14,_13,pos);var _16=_13.substring(_15,pos);if(this._selection&&this._selection.start!=this._selection.end){var _17=this._selection.end-this._selection.start;_16=_16.substr(0,_17);}var _18=this.fullMask.length;var _19="";var _1a=-1;for(var i=0;i<_18;i++){if(i==_15){for(var j=0;j<_16.length;j++){_1a=i;var _1b=this.fullMask.charAt(i);var _1c=_16.charAt(j);if(this.isEditable(_1b)){var _1d=this.matchBla(_1b,_1c);if(_1d){_19+=_1c;}else{break;}}else{if(_1c==_1b){_19+=_1b;}else{break;}}i++;}}_19+=this.spanMask.charAt(i);}this.spanMask=_19;this.domNode.value=_19;_3.selectTextRange(this.domNode,_1a+1,_1a+1);};this.onKeyPress=function(evt){if(this.isReadOnly()){return;}var _1e=(evt.keyCode==0)?evt.which:evt.keyCode;var _1f=evt.metaKey?evt.metaKey:evt.ctrlKey;if(_1f){return true;}this._selection=null;switch(_1e){case 13:break;case 27:break;case _6.TAB:break;case 46:this.performDelete(evt);evt.preventDefault();return false;break;case 8:this.performBackspace(evt);evt.preventDefault();return false;break;default:if(this.performKeyPress(evt)){evt.preventDefault();return false;}}};this.performBackspace=function(){var _20=_3.getSelection(this.domNode);var _21="";var _22=this.domNode.value;var _23=(_20.start==_20.end);for(var i=this.mask.length;0<=i;i--){var _24=_22.charAt(i);var _25=this.mask.charAt(i);if((_23&&(i==_20.start-1))||(i>=(_20.start)&&i<(_20.end))||_24==null){_21=_25+_21;}else{_21=_24+_21;}}this.domNode.value=this.spanMask=_21;var _26=(_20.start<=0)?0:_23?_20.start-1:_20.start;_3.selectTextRange(this.domNode,_26,_26);};this.performDelete=function(){var _27=_3.getSelection(this.domNode);var _28="";var _29=this.domNode.value;for(var i=0;i<this.mask.length;i++){var _2a=_29.substr(i,1);var _2b=this.mask.substr(i,1);if((i>=_27.start&&i<=_27.end)||_2a==null){_28+=_2b;}else{_28+=_2a;}}this.domNode.value=this.spanMask=_28;_3.selectTextRange(this.domNode,_27.start,_27.start);};this.performKeyPress=function(evt){var _2c=(evt.keyCode==0)?evt.which:evt.keyCode;if(evt.charCode==null){var _2d=evt.shiftKey;switch(evt.keyCode){case 9:case 8:case 13:case 16:case 17:case 18:case 20:case 27:case 33:case 34:if(_2d){break;}case 35:case 36:return false;}}else{if(evt.charCode==0){return false;}}var _2e=(String.fromCharCode(_2c));if(_2e.match(/[a-zA-Z0-9]/)!=null){var _2f="";var pos=_3.getCursorPosition(this.domNode);var _30=this.spanMask;var _31=pos;for(var i=0;i<this.mask.length;i++){var _32=_30.substr(i,1);var _33=this.fullMask.substr(i,1);if(i!=pos){if(this.isEditable(_33)){_2f+=_32;}else{_2f+=_33;}}else{if(this.matchBla(_33,_2e)){++_31;_2f+=_2e;var _34;var _35=i;while((_34=this.fullMask.substr(++_35,1))!=""){if(!this.isEditable(_34)){++_31;}else{break;}}}else{_2f+=_32;}}}this.spanMask=_2f;this.domNode.value=_2f;_3.selectTextRange(this.domNode,_31,_31);}return true;};this.matchBla=function(_36,_37){if(_36=="9"){return (_37.match(/^[0-9]$/g)!=null);}else{if(_36=="U"){return (_37.match(/^[A-Z]$/g)!=null);}else{if(_36=="L"){return (_37.match(/^[a-z]$/g)!=null);}else{if(_36=="Z"){return (_37.match(/^[a-zA-Z]$/g)!=null);}else{if(_36=="*"){return (_37.match(/^[a-zA-Z0-9]$/g)!=null);}}}}}return false;};this.isEditable=function(str){return (str=="9"||str=="U"||str=="L"||str=="Z"||str=="*");};this.isReadOnly=function(){return this.domNode.readOnly;};var _38=[],_39=this;this.destroy=function(){while(_38.length){_38.pop().remove();}};_38=[_5(this.domNode,"focus",_7.hitch(this,"onFocus")),_5(this.domNode,"keypress",_7.hitch(this,"onKeyPress")),_5(this.domNode,"blur",_7.hitch(this,"onBlur")),_5(this.domNode,_4("ie")?"paste":"input",_7.hitch(this,"onInput")),_5(this.domNode,"select",_7.hitch(this,"onSelect")),_5(this.domNode,"click",_7.hitch(this,"onClick"))];if(_4("ie")||_4("trident")||_4("chrome")){_38.push(_5(this.domNode,"keydown",function(evt){var _3a=(evt.keyCode==0)?evt.which:evt.keyCode;if(_3a==46||_3a==8){_39.onKeyPress(evt);}}));}var _3b=this.fullMask.replace(/9/g,this.spaceChar);_3b=_3b.replace(/Z/g,this.spaceChar);_3b=_3b.replace(/U/g,this.spaceChar);_3b=_3b.replace(/L/g,this.spaceChar);_3b=_3b.replace(/\*/g,this.spaceChar);this.mask=_3b;};return _d;});