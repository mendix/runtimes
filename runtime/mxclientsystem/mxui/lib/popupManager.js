/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/lib/popupManager",["mxui/lib/overflowHelper","mxui/wm/focus","mxui/widget/Underlay","mendix/lang","dojo/_base/array","dojo/window","dojo/dom-geometry","dojo/_base/declare","dojo/dom-style"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){var _a=0,_b=new _3(),_c={},_d=[{name:"popup",index:100,stack:[]},{name:"dialog",index:1000,stack:[]}];var _e={add:function(_f){_1.hideOverflow(document.body);document.body.appendChild(_f.domNode);},show:function(_10,_11,_12){if(_c[_10.id]){return;}if(_a>0){_11=true;}_13(_10,_11);_e.focus(_10);_10.onBeforeShow();_1.showOverflow(document.body);if(_11||_10.getPositionName()=="center"){_10.center();}else{_14(_10);_10.moveIntoView();}_10.onShow(function(){_10.onAfterShow();if(_12){_12();}});},hide:function(_15,_16){var _17=_c[_15.id];if(!_17){return;}_18(_15,_17.focus);_19(_15,_17.modal);_15.onHide(function(){var _1a=_1b(_15);if(_1a){_e.focus(_1a);}_15.destroy();if(_16){_16();}});},focus:function(_1c){if(!_c[_1c.id]){return;}var _1d=_1e(_1c),_1f=_1d.index,_20=[];_5.forEach(_1d.stack,function(_21){if(_21.id!=_1c.id){_20.push(_21);if(_21.deactivate){_21.deactivate();}}else{if(_21.activate){_21.activate();}}});_20.sort(function(a,b){return a.domNode.style.zIndex-b.domNode.style.zIndex;});_20.push(_1c);_1d.stack=_20;for(var x=0,_22;_22=_1d.stack[x];x++){_1f=_1f+2;_22.domNode.style.zIndex=_1f;}if(_c[_1c.id].modal&&!_23(_1c)){_b.setZIndex(_1f-1);}}};function _1b(_24){var _25=_5.indexOf(_d,_1e(_24));do{var _26=_d[_25].stack;for(var i=_26.length-1;i>=0;i--){if(_c[_26[i].id]){return _26[i];}}}while(_25-->0);return null;};function _1e(_27){return _4.find(_d,function(_28){return _28.name==_27.getLayerName();});};function _29(_2a){return _1e(_2a).stack;};function _14(_2b){var _2c=_29(_2b),_2d=_6.getBox(),box=_7.getMarginBox(_2b.domNode),_2e=(_2d.w-box.w)/2,_2f=(_2d.h-box.h)/2*0.7,gap=20;var _30=_2c.slice();_30.sort(function(_31,_32){return _31.domNode.offsetLeft-_32.domNode.offsetLeft;});for(var i=0;i<_2c.length;i++){if(_30[i]===_2b){continue;}var _33=_30[i].domNode,_34=_2e-(0.5*gap),_35=_34+gap;if(_34<_33.offsetLeft&&_33.offsetLeft<_35){_2e+=gap;_2f+=gap;}}_9.set(_2b.domNode,{left:_2e+"px",top:_2f+"px"});};function _23(_36){var _37=_5.indexOf(_d,_1e(_36));return _5.some(_d.slice(_37+1),function(_38){return _5.some(_38.stack,function(_39){return _c[_39.id].modal;});});};function _18(_3a,_3b){if(!_3b){return;}var _3c=_2.get();if(_3c&&_3a.domNode.contains(_3c)){_2.put(_3b);}};function _13(_3d,_3e){if(_3e){if(_a===0){_b.show();}_a++;}_c[_3d.id]={modal:_3e,focus:_2.get()};var _3f=_29(_3d);_3f.push(_3d);};function _19(_40,_41){if(_41){_a--;if(_a===0){_b.hide();}}delete _c[_40.id];var _42=_29(_40);_42.splice(_5.indexOf(_42,_40),1);};return _e;});