/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/lib/popupManager",["mxui/lib/overflowHelper","mxui/wm/focus","mxui/widget/Underlay","mendix/lang","dojo/_base/array","dojo/window","dojo/_base/declare","dojo/dom-style"],function(_1,_2,_3,_4,_5,_6,_7,_8){var _9=0,_a=new _3(),_b={},_c=[{name:"popup",index:100,stack:[]},{name:"dialog",index:1000,stack:[]}];var _d={add:function(_e){_1.hideOverflow(document.body);document.body.appendChild(_e.domNode);},show:function(_f,_10){if(_b[_f.id]){return;}if(_9>0){_10=true;}_11(_f,_10);_d.focus(_f);_f.onBeforeShow();_1.showOverflow(document.body);if(_10||_f.getPositionName()=="center"){_f.center();}else{_12(_f);_f.moveIntoView();}_f.onShow(function(){_f.onAfterShow();});},hide:function(_13){var _14=_b[_13.id];if(!_14){return;}_15(_13,_14.focus);_16(_13,_14.modal);_13.onHide(function(){var _17=_18(_13);if(_17){_d.focus(_17);}_13.destroy();});},focus:function(_19){if(!_b[_19.id]){return;}var _1a=_1b(_19),_1c=_1a.index,_1d=[];_5.forEach(_1a.stack,function(_1e){if(_1e.id!=_19.id){_1d.push(_1e);_1e.deactivate&&_1e.deactivate();}else{_1e.activate&&_1e.activate();}});_1d.sort(function(a,b){return a.domNode.style.zIndex-b.domNode.style.zIndex;});_1d.push(_19);_1a.stack=_1d;for(var x=0,_1f;_1f=_1a.stack[x];x++){_1c=_1c+2;_1f.domNode.style.zIndex=_1c;}if(_b[_19.id].modal&&!_20(_19)){_a.setZIndex(_1c-1);}}};function _18(_21){var _22=_5.indexOf(_c,_1b(_21));do{var _23=_c[_22].stack;for(var i=_23.length-1;i>=0;i--){if(_b[_23[i].id]){return _23[i];}}}while(_22-->0);return null;};function _1b(_24){return _4.find(_c,function(_25){return _25.name==_24.getLayerName();});};function _26(_27){return _1b(_27).stack;};function _12(_28){var _29=_26(_28),_2a=_6.getBox().w*0.2,_2b=50,gap=20;var _2c=_29.slice();_2c.sort(function(_2d,_2e){return _2d.domNode.offsetLeft-_2e.domNode.offsetLeft;});for(var i=0;i<_29.length;i++){if(_2c[i]===_28){continue;}var _2f=_2c[i].domNode,_30=_2a-(0.5*gap),_31=_30+gap;if(_30<_2f.offsetLeft&&_2f.offsetLeft<_31){_2a+=gap;_2b+=gap;}else{break;}}_8.set(_28.domNode,{left:_2a+"px",top:_2b+"px"});};function _20(_32){var _33=_5.indexOf(_c,_1b(_32));return _5.some(_c.slice(_33+1),function(_34){return _5.some(_34.stack,function(_35){return _b[_35.id].modal;});});};function _15(_36,_37){if(!_37){return;}var _38=_2.get(),_39=true;if(_38){_39=false;while(_38=_38.parentNode){if(_38===_36.domNode){_39=true;break;}}}if(_39){_2.put(_37);}};function _11(_3a,_3b){if(_3b){if(_9===0){_a.show();}_9++;}_b[_3a.id]={modal:_3b,focus:_2.get()};var _3c=_26(_3a);_3c.push(_3a);};function _16(_3d,_3e){if(_3e){_9--;if(_9===0){_a.hide();}}delete _b[_3d.id];var _3f=_26(_3d);_3f.splice(_5.indexOf(_3f,_3d),1);};return _d;});