/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/lib/popupManager",["mxui/lib/overflowHelper","mxui/wm/focus","mxui/widget/Underlay","mendix/lang","dojo/_base/array","dojo/window","dojo/dom-geometry","dojo/_base/declare","dojo/dom-style"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9){var _a=0,_b=new _3(),_c={},_d=[{name:"popup",index:100,stack:[]},{name:"dialog",index:1000,stack:[]}];var _e={add:function(_f){_1.hideOverflow(document.body);document.body.appendChild(_f.domNode);},show:function(_10,_11){if(_c[_10.id]){return;}if(_a>0){_11=true;}_12(_10,_11);_e.focus(_10);_10.onBeforeShow();_1.showOverflow(document.body);if(_11||_10.getPositionName()=="center"){_10.center();}else{_13(_10);_10.moveIntoView();}_10.onShow(function(){_10.onAfterShow();});},hide:function(_14){var _15=_c[_14.id];if(!_15){return;}_16(_14,_15.focus);_17(_14,_15.modal);_14.onHide(function(){var _18=_19(_14);if(_18){_e.focus(_18);}_14.destroy();});},focus:function(_1a){if(!_c[_1a.id]){return;}var _1b=_1c(_1a),_1d=_1b.index,_1e=[];_5.forEach(_1b.stack,function(_1f){if(_1f.id!=_1a.id){_1e.push(_1f);if(_1f.deactivate){_1f.deactivate();}}else{if(_1f.activate){_1f.activate();}}});_1e.sort(function(a,b){return a.domNode.style.zIndex-b.domNode.style.zIndex;});_1e.push(_1a);_1b.stack=_1e;for(var x=0,_20;_20=_1b.stack[x];x++){_1d=_1d+2;_20.domNode.style.zIndex=_1d;}if(_c[_1a.id].modal&&!_21(_1a)){_b.setZIndex(_1d-1);}}};function _19(_22){var _23=_5.indexOf(_d,_1c(_22));do{var _24=_d[_23].stack;for(var i=_24.length-1;i>=0;i--){if(_c[_24[i].id]){return _24[i];}}}while(_23-->0);return null;};function _1c(_25){return _4.find(_d,function(_26){return _26.name==_25.getLayerName();});};function _27(_28){return _1c(_28).stack;};function _13(_29){var _2a=_27(_29),_2b=_6.getBox(),box=_7.getMarginBox(_29.domNode),_2c=(_2b.w-box.w)/2,_2d=(_2b.h-box.h)/2*0.7,gap=20;var _2e=_2a.slice();_2e.sort(function(_2f,_30){return _2f.domNode.offsetLeft-_30.domNode.offsetLeft;});for(var i=0;i<_2a.length;i++){if(_2e[i]===_29){continue;}var _31=_2e[i].domNode,_32=_2c-(0.5*gap),_33=_32+gap;if(_32<_31.offsetLeft&&_31.offsetLeft<_33){_2c+=gap;_2d+=gap;}}_9.set(_29.domNode,{left:_2c+"px",top:_2d+"px"});};function _21(_34){var _35=_5.indexOf(_d,_1c(_34));return _5.some(_d.slice(_35+1),function(_36){return _5.some(_36.stack,function(_37){return _c[_37.id].modal;});});};function _16(_38,_39){if(!_39){return;}var _3a=_2.get(),_3b=true;if(_3a){_3b=false;while(_3a=_3a.parentNode){if(_3a===_38.domNode){_3b=true;break;}}}if(_3b){_2.put(_39);}};function _12(_3c,_3d){if(_3d){if(_a===0){_b.show();}_a++;}_c[_3c.id]={modal:_3d,focus:_2.get()};var _3e=_27(_3c);_3e.push(_3c);};function _17(_3f,_40){if(_40){_a--;if(_a===0){_b.hide();}}delete _c[_3f.id];var _41=_27(_3f);_41.splice(_5.indexOf(_41,_3f),1);};return _e;});