/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/lib/pageTemplating/pageProvider",["mxui/lib/pageTemplating/roleFilter","mxui/lib/pageTemplating/PageComponent","mxui/dom","mendix/lib/Error","dojo/sniff","dojo/_base/array","dojo/_base/lang"],function(_1,_2,_3,_4,_5,_6,_7){"use strict";function _8(_9){var _a=[];if(document.adoptNode&&_5("dom-parser")){while(_9.firstChild){_a.push(document.adoptNode(_9.firstChild));}}else{_6.forEach(_9.childNodes,function(_b){var _c=_3.create("div");_c.innerHTML=_b.xml;_a.push(_c.firstChild);});}return _6.filter(_6.map(_a,function(_d){return _1.filterDom(_d);}),function(_e){return _e!=null;});};function _f(_10){var _11=document.createDocumentFragment();_6.forEach(_10,_7.hitch(_11,_11.appendChild));return _11;};function _12(xml){return _6.map(_3.getElementsByTagNameNoNS(xml,"layout"),function(_13){return _13.getAttribute("path");}).reverse();};function _14(xml){return _6.map(_3.getElementsByTagNameNoNS(xml,"argument"),function(_15){return new _2((_15.getAttribute("parameterName")||"main"),_8(_15),(_15.getAttribute("isMain")=="true"));});};function _16(xml){var _17={};_6.forEach(_3.getElementsByTagNameNoNS(xml,"template"),function(_18){var _19={widgetId:_18.getAttribute("widget-id"),templateName:_18.getAttribute("name"),content:_f(_8(_18))};if(!_17[_19.widgetId]){_17[_19.widgetId]={};}_17[_19.widgetId][_19.templateName]=_19.content;});return _17;};function _1a(xml,_1b){var _1c=xml.documentElement;return {id:_1c.getAttribute("id")||"",title:_1c.getAttribute("title")||"","class":_1c.getAttribute("class")||"",style:_1c.getAttribute("style")||"",path:_1b,isBasedOnLegacyLayout:_1c.getAttribute("isBasedOnLegacyLayout")=="true",layouts:_12(xml),components:_14(xml),widgetTemplates:_16(xml)};};var _1d={get:function(_1e,_1f,_20){var _21="pages/"+window.mx.session.getConfig("uiconfig.locale");window.mx.server.get({url:_21+"/"+_1e,failOk:false,handleAs:"xml",load:function(_22){_1f(_1a(_22,_1e));},error:_20});}};return _1d;});