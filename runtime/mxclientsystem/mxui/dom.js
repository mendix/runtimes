/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/dom",["mxui/wm/focus","mendix/lang","webcore/url-helpers","dojo/sniff","dojo/_base/lang","dojo/_base/kernel","dojo/_base/connect","dojo/_base/array","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/window","mendix/logger"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){var _e=0,_f=document.createElement("p");function _10(_11){_11=_11||{};var _12=function(id,_13){if(!id){id=_e++;_13.setAttribute("data-id",id);}return id;};return function(_14,key,_15){var id=typeof _14==="string"?_14:_14.getAttribute("data-id"),map=_11[id];switch(arguments.length){case 1:return map;case 2:if(key===null){delete _11[id];return;}else{if(typeof key=="object"){if(!map){return _11[_12(id,_14)]=key;}else{return _5.mixin(map,key);}}else{return map&&map[key];}}break;case 3:if(_15===null){if(map){delete map[key];}if(_2.objectIsEmpty(map)){return;}delete _11[id];return;}else{if(!map){map=_11[_12(id,_14)]={};}return map[key]=_15;}}};};var dom={minContainerHeight:100,nodeTypes:{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},walkNode:function(_16,_17,_18){var _19=[0],_1a;var _1b=function(_1c){try{_1a=_1c?_17.call(_18,_1c,_19.slice())!==false:false;}catch(e){_d.error("mxui.dom.walkNode: Unable to execute action on node: "+e.message);_1a=false;}if(_1a&&_1c.hasChildNodes){var i=_19.push(0)-1;var _1d=null,_1e=_1c.firstChild;while(_1e){_1e=(_1d=_1e).nextSibling;_1b(_1d);_19[i]++;}_19.pop();}};_1b(_16);},nextNode:function(_1f,_20){if(!_1f||!_20){return true;}var cl=_20.length,sl=_1f.length,_21=_20.length-1;return (sl>cl)||(cl==sl&&_20[_21]>_1f[_21]);},getAncestorNode:function(_22,_23,_24){return _22&&((_22.nodeName==_23)?_22:((--_24===0)?false:arguments.callee(_22.parentNode,_23,_24)));},findOverflowParent:function(_25){while(_25=_25.parentNode){if(_25===document.body){break;}var _26=_b.get(_25,"overflow");if(_26==="auto"||_26==="scroll"){return _25;}}return document.documentElement.scrollTop>0?document.documentElement:document.body;},scrollOverflowParentTo:function(_27,to){var _28=dom.findOverflowParent(_27);if(_28){_28.scrollTop=to;}},getElementsByTagNameNoNS:function(doc,_29){if(doc.getElementsByTagNameNS){return doc.getElementsByTagNameNS("*",_29);}else{if("selectNodes" in doc){doc.setProperty("SelectionLanguage","XPath");return doc.selectNodes("//*[local-name() = '"+_29+"']");}else{throw new Error("mxui.dom.getElementsByTagNameNoNS not supported");}}},escapeHTMLQuotes:function(str){return str.replace(/'/g,"&#39;").replace(/\"/g,"&#34;");},convertNlToBr:function(str){return str.replace(/\n/g,"<br />");},setSelectOptions:function(_2a,_2b,_2c){var $=dom.create;if(!_2a){return;}_2b=_2b||{};dom.empty(_2a);_2a.appendChild($("option",{value:""},""));for(var key in _2b){var _2d=$("option",{value:key},_2b[key]);_2a.appendChild(_2d);if(key==_2c){_2d.selected=true;}}},getSelectedValue:function(_2e){if(_2e.nodeName.toLowerCase()=="select"){return (_2e.selectedIndex!=-1)?_2e.options[_2e.selectedIndex].value:null;}else{return null;}},getSelectedText:function(_2f){return _2f.options[_2f.selectedIndex].text;},selectOptionByValue:function(_30,_31){for(var i=0;i<_30.length;++i){if(_30.options[i].value==_31){_30.options[i].selected=true;}}},selectOptionByText:function(_32,_33){for(var i=0;i<_32.length;++i){if(_32.options[i].text==_33){_32.options[i].selected=true;}}},enableNode:function(_34){_34.removeAttribute("readonly");_34.removeAttribute("disabled");},disableNode:function(_35){_35.setAttribute("disabled","disabled");_35.setAttribute("readonly","readonly");},disableSelection:function(e){if(!_4("ie")){e.style.MozUserSelect="none";}else{e.unselectable="on";}return true;},clearSelection:function(){var w=window,s=document.selection;if(s){try{if(s.empty){s.empty();}}catch(e){}}else{s=w.getSelection&&w.getSelection();if(s&&s.removeAllRanges){s.removeAllRanges();}}},selectTextRange:function(_36,_37,_38){if(_36.createTextRange){var _39=_36.createTextRange();_39.collapse(true);_39.moveEnd("character",_38);_39.moveStart("character",_37);_39.select();}else{if(_36.setSelectionRange){_36.setSelectionRange(_37,_38);}}},getCursorPosition:function(_3a){if(document.selection){var _3b=Math.abs(document.selection.createRange().moveStart("character",-1000000));document.selection.createRange().moveEnd("character",-1000000);return _3b;}else{if(_3a.setSelectionRange){return _3a.selectionStart;}}},getSelection:function(_3c){if(document.selection){var _3d=Math.abs(document.selection.createRange().moveStart("character",-1000000));var end=Math.abs(document.selection.createRange().moveEnd("character",-1000000));return {start:_3d,end:end};}else{if(_3c.setSelectionRange){return {start:_3c.selectionStart,end:_3c.selectionEnd};}}},insertAtCaret:function(_3e,_3f){var _40=this.getSelection(_3e),_41=_40.start+_3f.length,_42=_3e.value;_3e.value=_42.substring(0,_40.start)+_3f+_42.substring(_40.end,_42.length);this.selectTextRange(_3e,_41,_41);},liveConnect:function(_43,evt,_44,r,_45){if(arguments.length==3){r=_44;_44=null;}var _46={},_47=[];for(var i in r){var _48=i.split(".");var tag=_48[0];var _49=_48[1];var _4a=r[i];if((typeof _4a=="string"&&_44[_4a])||typeof _4a=="function"){var _4b={fnc:_4a};if(tag){_46[String(tag).toUpperCase()]=_4b;}else{if(_49){_47.push(_4b);}}if(_49){_4b.clazz=_49;}}}var _4c=function(_4d){for(var i=0,_4a;_4a=_47[i];i++){if(_9.contains(_4d,_4a.clazz)){return _4a;}}return null;};var run=function(fnc,e){if(typeof (fnc)=="function"){fnc(e);}else{if(_44&&_44[fnc]){_44[fnc](e);}}};return _7.connect(_43,evt,function(e){var _4e=e.target;var _4f=_43;var e2={target:e.target};for(var i in e){var val=e[i];if(val==null||!(val instanceof Object)){e2[i]=val;}}while(_4e!=_4f&&_4e!=null){var _50=_46[_4e.nodeName];var _51=_4c(_4e);if(_50){var _52=_50.clazz;_50=((!_52)||(_9.contains(_4e,_52)))?_50:null;}e2.currentTarget=_4e;if(_50){run(_50.fnc,e2);}if(_51){run(_51.fnc,e2);}if(_45&&(_50||_51)){break;}_4e=_4e.parentNode;}});},liveDisconnect:function(_53){_7.disconnect(_53);},create:function(_54,_55,_56){var _57,_58=[].slice.call(arguments,1);_55=_55||{};if(_55.nodeName||typeof _55=="string"){_56=_58;_55={};}else{_56=_58.slice(1);}if(_54=="#"){_57=document.createDocumentFragment();}else{_57=document.createElement(_54);for(var _59 in _55){var _5a=_55[_59];if(_59=="style"&&typeof _5a!="string"){var _5b=_57.style;for(var i in _5a){_5b[i]=_5a[i];}}else{_57.setAttribute(_59,_5a);}}}_8.forEach(_56,function(_5c){if(typeof _5c=="string"){_8.forEach(_5c.split("\r\n"),function(_5d,i){if(i>0){_57.appendChild(dom.create("br"));}_57.appendChild(document.createTextNode(_5d));});}else{_57.appendChild(_5c);}});return _57;},synthesizeEvent:function(evt,_5e){var _5f=_5.mixin({},evt,_5e);_5f.preventDefault=function(){evt.preventDefault();};_5f.stopPropagation=function(){evt.stopPropagation();};return _5f;},capture:function(_60,evt,_61){var _62=!_60.addEventListener,_63=_60[_62?"attachEvent":"addEventListener"],_64=_60[_62?"detachEvent":"removeEventListener"],_65=_62?"on"+evt:evt;_63.call(_60,_65,_61,true);return {remove:function(){_64.call(_60,_65,_61,true);}};},supports:function(_66){var _67=document.body.style;if(_66 in _67){return _66;}},text:function(_68,str){if(typeof str!=="undefined"){_68.innerHTML="";_68.appendChild(document.createTextNode(str));}else{return "textContent" in _68?_68.textContent:_68.innerText;}},html:function(_69,str){if(typeof str!=="undefined"){_69.innerHTML=str;}else{return _69.innerHTML;}},orphan:function(_6a){var p=_6a.parentNode;if(p){p.removeChild(_6a);}},isOrphan:function(_6b){return !_6b.parentNode||_6b.parentNode.nodeType==dom.nodeTypes.DOCUMENT_FRAGMENT_NODE;},empty:function(_6c){var _6d;while(_6d=_6c.firstChild){_6c.removeChild(_6d);}},toArray:function(_6e){return _8.map(_6e,function(_6f){return _6f;});},escapeString:function(str){var _70=str.split(/\r\n|\n/),out=[];for(var i=0;i<_70.length;++i){dom.text(_f,_70[i]);out.push(_f.innerHTML);}return out.join("\n");},unescapeString:function(str){return str.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,"\"").replace(/&amp;/g,"&");},getCss:function(_71,doc){doc=doc||document;_71=_3.getStaticResourceUrl(_71);return _2.find(doc.getElementsByTagName("link"),function(_72){return _72.href==_71;});},createCssLink:function(_73,_74){var _75={rel:"stylesheet",href:_3.getStaticResourceUrl(_73)};if(_74){_75.media=_74;}return dom.create("link",_75);},addCss:function(_76,doc,_77){doc=doc||document;var _78=dom.getCss(_76,doc);if(_78){return _78;}var _79=dom.createCssLink(_76,_77);doc.querySelector("head").appendChild(_79);return _79;},removeCss:function(_7a,doc){var _7b=dom.getCss(_7a,doc);if(_7b){_7b.parentNode.removeChild(_7b);return true;}return false;},ieFocusable:{"a":true,"body":true,"button":true,"frame":true,"iframe":true,"input":true,"isIndex":true,"object":true,"select":true,"textarea":true},getTabIndex:function(_7c){if(!_7c||!_7c.getAttribute){return null;}var _7d;if(_4("ie")||_4("trident")||_4("edge")){_7d=_7c.tabIndex;if(_7d===0){var _7e=_7c.nodeName.toLowerCase(),_7f=_7c.attributes.tabIndex,_80=_7f&&_7f.specified===true;return _80||dom.ieFocusable[_7e]?"0":null;}else{return ""+_7d;}}else{var _81=_7c.getAttribute("tabindex");_7d=String(_7c.tabIndex);if(_81!=null||_7d>=0){if(!_4("ff")){return (_81==="")?null:_7d;}else{return _7d;}}else{return null;}}},moveFocusTo:function(_82){if(_4("mobile")){_1.blur();}else{_1.first(_82);}},data:_10(),getScopedData:_10,moveIntoView:function(_83,_84){_84=_84||0;var pos=_a.position(_83),_85=_c.getBox(),_86=_83.style,_87=pos.y+pos.h+_84,_88=pos.x+pos.w+_84;if(pos.y<_84||pos.h+_84*2>_85.h){_86.top=_84+"px";}else{if(_87>_85.h){_86.top=pos.y-(_87-_85.h)+"px";}}if(pos.x<_84||pos.w+_84*2>_85.w){_86.left=_84+"px";}else{if(_88>_85.w){_86.left=pos.x-(_88-_85.w)+"px";}}},getNodeExtents:function(_89){var cs=_b.getComputedStyle(_89),me=_a.getMarginExtents(_89,cs),be=_a.getBorderExtents(_89,cs),pe=_a.getPadExtents(_89,cs);return {w:me.w+be.w+pe.w,h:me.h+be.h+pe.h};},dispatchEvent:function(_8a,_8b){if("createEvent" in document){var evt=document.createEvent("HTMLEvents");evt.initEvent(_8b.substr(2,_8b.length),true,true);_8a.dispatchEvent(evt);}else{if(_8a.fireEvent){_8a.fireEvent([_8b]);}}}};return dom;});