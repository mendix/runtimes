/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/dom",["mxui/wm/focus","mendix/lang","dojo/sniff","dojo/_base/lang","dojo/_base/kernel","dojo/_base/connect","dojo/_base/array","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/window","mendix/logger"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){var _d=0,_e=document.createElement("p");function _f(url){if(!/^\w+:\/\//.test(url)){url=mx.appUrl+url;}return url;};function _10(_11){_11=_11||{};var _12=function(id,_13){if(!id){id=_d++;_13.setAttribute("data-id",id);}return id;};return function(_14,key,_15){var id=typeof _14==="string"?_14:_14.getAttribute("data-id"),map=_11[id];switch(arguments.length){case 1:return map;case 2:if(key===null){delete _11[id];return;}else{if(typeof key=="object"){if(!map){return _11[_12(id,_14)]=key;}else{return _4.mixin(map,key);}}else{return map&&map[key];}}break;case 3:if(_15===null){if(map){delete map[key];}for(var i in map){return;}delete _11[id];return;}else{if(!map){map=_11[_12(id,_14)]={};}return map[key]=_15;}}};};var dom={minContainerHeight:100,nodeTypes:{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},walkNode:function(_16,_17,_18){var _19=[0],_1a;var _1b=function(_1c){try{_1a=_1c?_17.call(_18,_1c,_19.slice())!==false:false;}catch(e){_c.error("mxui.dom.walkNode: Unable to execute action on node: "+e.message);_1a=false;}if(_1a&&_1c.hasChildNodes){var i=_19.push(0)-1;var _1d=null,_1e=_1c.firstChild;while(_1e){_1e=(_1d=_1e).nextSibling;_1b(_1d);_19[i]++;}_19.pop();}};_1b(_16);},nextNode:function(_1f,_20){if(!_1f||!_20){return true;}var cl=_20.length,sl=_1f.length,_21=_20.length-1;return (sl>cl)||(cl==sl&&_20[_21]>_1f[_21]);},getAncestorNode:function(_22,_23,_24){return _22&&((_22.nodeName==_23)?_22:((--_24==0)?false:arguments.callee(_22.parentNode,_23,_24)));},getFirstChild:function(_25,_26){_5.deprecated("mxui.dom.getFirstChild","Use dojo.query instead","5.0");if(typeof _26=="string"){_26=[_26.toLowerCase()];}var _27=false;var _28=function(_29){for(var i=0;i<_26.length;i++){if(_29.nodeName.toLowerCase()==_26[i]){if(_27==false){_27=_29;return false;}}}return true;};function _2a(_2b,_2c){if(_2b&&_2c(_2b)&&_2b.hasChildNodes){for(var i=0;i<_2b.childNodes.length;i++){_2a(_2b.childNodes[i],_2c);}}};_2a(_25,_28);return _27;},getElementsByTagNameNoNS:function(doc,_2d){if(doc.getElementsByTagNameNS){return doc.getElementsByTagNameNS("*",_2d);}else{if("selectNodes" in doc){doc.setProperty("SelectionLanguage","XPath");return doc.selectNodes("//*[local-name() = '"+_2d+"']");}else{throw new Error("mxui.dom.getElementsByTagNameNoNS not supported");}}},escapeHTMLQuotes:function(str){return str.replace(/\'/g,"&#39;").replace(/\"/g,"&#34;");},convertNlToBr:function(str){return str.replace(/\n/g,"<br />");},setSelectOptions:function(_2e,_2f,_30){var $=dom.create;if(!_2e){return;}_2f=_2f||{};dom.empty(_2e);_2e.appendChild($("option",{value:""},""));for(var key in _2f){var _31=$("option",{value:key},_2f[key]);_2e.appendChild(_31);if(key==_30){_31.selected=true;}}},getSelectedValue:function(_32){if(_32.nodeName.toLowerCase()=="select"){return (_32.selectedIndex!=-1)?_32.options[_32.selectedIndex].value:null;}else{return null;}},getSelectedText:function(_33){return _33.options[_33.selectedIndex].text;},selectOptionByValue:function(_34,_35){for(var i=0;i<_34.length;++i){if(_34.options[i].value==_35){_34.options[i].selected=true;}}},selectOptionByText:function(_36,_37){for(var i=0;i<_36.length;++i){if(_36.options[i].text==_37){_36.options[i].selected=true;}}},enableNode:function(_38){_38.removeAttribute("readonly");_38.removeAttribute("disabled");},disableNode:function(_39){_39.setAttribute("disabled","disabled");_39.setAttribute("readonly","readonly");},disableSelection:function(e){if(!_3("ie")){e.style.MozUserSelect="none";}else{e.unselectable="on";}return true;},clearSelection:function(){var w=window,s=document.selection;if(s){try{s.empty&&s.empty();}catch(e){}}else{s=w.getSelection&&w.getSelection();s&&s.removeAllRanges&&s.removeAllRanges();}},selectTextRange:function(_3a,_3b,_3c){if(_3a.createTextRange){var _3d=_3a.createTextRange();_3d.collapse(true);_3d.moveEnd("character",_3c);_3d.moveStart("character",_3b);_3d.select();}else{if(_3a.setSelectionRange){_3a.setSelectionRange(_3b,_3c);}}},getCursorPosition:function(_3e){if(document.selection){var _3f=Math.abs(document.selection.createRange().moveStart("character",-1000000));document.selection.createRange().moveEnd("character",-1000000);return _3f;}else{if(_3e.setSelectionRange){return _3e.selectionStart;}}},getSelection:function(_40){if(document.selection){var _41=Math.abs(document.selection.createRange().moveStart("character",-1000000));var end=Math.abs(document.selection.createRange().moveEnd("character",-1000000));return {start:_41,end:end};}else{if(_40.setSelectionRange){return {start:_40.selectionStart,end:_40.selectionEnd};}}},insertAtCaret:function(_42,_43){var _44=this.getSelection(_42),_45=_44.start+_43.length,_46=_42.value;_42.value=_46.substring(0,_44.start)+_43+_46.substring(_44.end,_46.length);this.selectTextRange(_42,_45,_45);},liveConnect:function(_47,evt,_48,r,_49){if(arguments.length==3){r=_48;_48=null;}var _4a={},_4b=[];for(var i in r){var _4c=i.split(".");var tag=_4c[0];var _4d=_4c[1];var _4e=r[i];if((typeof _4e=="string"&&_48[_4e])||typeof _4e=="function"){var _4f={fnc:_4e};if(tag){_4a[String(tag).toUpperCase()]=_4f;}else{if(_4d){_4b.push(_4f);}}if(_4d){_4f.clazz=_4d;}}}var _50=function(_51){for(var i=0,_4e;_4e=_4b[i];i++){if(_8.contains(_51,_4e.clazz)){return _4e;}}return null;};var run=function(fnc,e){if(typeof (fnc)=="function"){fnc(e);}else{_48&&_48[fnc](e);}};return _6.connect(_47,evt,function(e){var _52=e.target;var _53=_47;var e2={target:e.target};for(var i in e){var val=e[i];if(val==null||!(val instanceof Object)){e2[i]=val;}}while(_52!=_53&&_52!=null){var _54=_4a[_52.nodeName];var _55=_50(_52);if(_54){var _56=_54.clazz;_54=((!_56)||(_8.contains(_52,_56)))?_54:null;}e2.currentTarget=_52;_54&&run(_54.fnc,e2);_55&&run(_55.fnc,e2);if(_49&&(_54||_55)){break;}_52=_52.parentNode;}});},liveDisconnect:function(_57){_6.disconnect(_57);},create:function(tag,_58,_59){var _5a,_5b=[].slice.call(arguments,1);_58=_58||{};if(_58.nodeName||typeof _58=="string"){_59=_5b;_58={};}else{_59=_5b.slice(1);}if(tag=="#"){_5a=document.createDocumentFragment();}else{_5a=document.createElement(tag);for(var _5c in _58){var _5d=_58[_5c];if(_5c=="style"&&typeof _5d!="string"){var _5e=_5a.style;for(var i in _5d){_5e[i]=_5d[i];}}else{_5a.setAttribute(_5c,_5d);}}}_7.forEach(_59,function(_5f){if(typeof _5f=="string"){_7.forEach(_5f.split("\r\n"),function(_60,i){if(i>0){_5a.appendChild(dom.create("br"));}_5a.appendChild(document.createTextNode(_60));});}else{_5a.appendChild(_5f);}});return _5a;},synthesizeEvent:function(evt,_61){var _62=_4.mixin({},evt,_61);_62.preventDefault=function(){evt.preventDefault();};_62.stopPropagation=function(){evt.stopPropagation();};return _62;},capture:function(_63,evt,_64){var _65=!_63.addEventListener,_66=_63[_65?"attachEvent":"addEventListener"],_67=_63[_65?"detachEvent":"removeEventListener"],_68=_65?"on"+evt:evt;_66.call(_63,_68,_64,true);return {remove:function(){_67.call(_63,_68,_64,true);}};},supports:function(_69){var _6a=document.body.style;if(_69 in _6a){return _69;}},text:function(_6b,str){if(typeof str!=="undefined"){_6b.innerHTML="";_6b.appendChild(document.createTextNode(str));}else{return "textContent" in _6b?_6b.textContent:_6b.innerText;}},html:function(_6c,str){if(typeof str!=="undefined"){_6c.innerHTML=str;}else{return _6c.innerHTML;}},orphan:function(_6d){var p=_6d.parentNode;if(p){p.removeChild(_6d);}},isOrphan:function(_6e){return !_6e.parentNode||_6e.parentNode.nodeType==dom.nodeTypes.DOCUMENT_FRAGMENT_NODE;},empty:function(_6f){var _70;while(_70=_6f.firstChild){_6f.removeChild(_70);}},toArray:function(_71){return _7.map(_71,function(_72){return _72;});},escapeString:function(str){var _73=str.split(/\r\n|\n/),out=[];for(var i=0;i<_73.length;++i){dom.text(_e,_73[i]);out.push(_e.innerHTML);}return out.join("\n");},unescapeString:function(str){return str.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,"\"").replace(/&amp;/g,"&");},getCss:function(_74,doc,_75){doc=doc||document;_74=_f(_74);return _2.find(doc.getElementsByTagName("link"),function(_76){return _76.href==_74;});},createCssLink:function(_77,_78){var _79={rel:"stylesheet",href:_f(_77)};if(_78){_79.media=_78;}return dom.create("link",_79);},addCss:function(_7a,doc,_7b){doc=doc||document;var _7c=dom.getCss(_7a,doc,_7b);if(_7c){return _7c;}var _7d=dom.createCssLink(_7a,_7b);doc.querySelector("head").appendChild(_7d);return _7d;},removeCss:function(_7e,doc,_7f){var _80=dom.getCss(_7e,doc,_7f);if(_80){_80.parentNode.removeChild(_80);return true;}return false;},addScripts:function(_81,_82){var _83=_7.map(_81,function(_84){return function(cb){var tag=dom.create("script",{src:_f(_84)});document.querySelector("head").appendChild(tag);if("onreadystatechange" in tag){tag.onreadystatechange=function(){if(tag.readyState==="loaded"||tag.readyState==="complete"){cb();}};}else{tag.onload=tag.onerror=cb;}};});_2.collect(_83,_82);},ieFocusable:{"a":true,"body":true,"button":true,"frame":true,"iframe":true,"input":true,"isIndex":true,"object":true,"select":true,"textarea":true},getTabIndex:function(_85){if(!_85||!_85.getAttribute){return null;}var _86;if(_3("ie")||_3("trident")){_86=_85.tabIndex;if(_86===0){var _87=_85.nodeName.toLowerCase(),_88=_85.attributes.tabIndex,_89=_88&&_88.specified===true;return _89||dom.ieFocusable[_87]?"0":null;}else{return ""+_86;}}else{var _8a=_85.getAttribute("tabindex");_86=String(_85.tabIndex);if(_8a!=null||_86>=0){if(!_3("ff")){return (_8a==="")?null:_86;}else{return _86;}}else{return null;}}},moveFocusTo:function(_8b){if(_3("mobile")){_1.blur();}else{_1.first(_8b);}},coords:function(_8c){return _4.mixin(_9.position(_8c),_9.getMarginBox(_8c));},data:_10(),getScopedData:_10,moveIntoView:function(_8d,_8e){_8e=_8e||0;var pos=_9.position(_8d),_8f=_b.getBox(),_90=_8d.style,_91=pos.y+pos.h+_8e,_92=pos.x+pos.w+_8e;if(pos.y<_8e||pos.h+_8e*2>_8f.h){_90.top=_8e+"px";}else{if(_91>_8f.h){_90.top=pos.y-(_91-_8f.h)+"px";}}if(pos.x<_8e||pos.w+_8e*2>_8f.w){_90.left=_8e+"px";}else{if(_92>_8f.w){_90.left=pos.x-(_92-_8f.w)+"px";}}},getNodeExtents:function(_93){var cs=_a.getComputedStyle(_93),me=_9.getMarginExtents(_93,cs),be=_9.getBorderExtents(_93,cs),pe=_9.getPadExtents(_93,cs);return {w:me.w+be.w+pe.w,h:me.h+be.h+pe.h};},dispatchEvent:function(_94,_95){if(_3("ie")){_94.fireEvent&&_94.fireEvent([_95]);}else{var evt=document.createEvent("HTMLEvents");evt.initEvent(_95.substr(2,_95.length),true,true);_94.dispatchEvent(evt);}}};return dom;});