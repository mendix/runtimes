
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/dom",["mendix/lang","dojo/sniff","dojo/_base/lang","dojo/_base/kernel","dojo/_base/connect","dojo/_base/array","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/window","mendix/logger"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){var _c=0,_d=document.createElement("p");function _e(_f){if(!/^\w+:\/\//.test(_f)){_f=mx.appUrl+_f;}return _f;};function _10(_11){_11=_11||{};var _12=function(id,_13){if(!id){id=_c++;_13.setAttribute("data-id",id);}return id;};return function(_14,key,_15){var id=typeof _14==="string"?_14:_14.getAttribute("data-id"),map=_11[id];switch(arguments.length){case 1:return map;case 2:if(key===null){delete _11[id];return;}else{if(typeof key=="object"){if(!map){return _11[_12(id,_14)]=key;}else{return _3.mixin(map,key);}}else{return map&&map[key];}}break;case 3:if(_15===null){if(map){delete map[key];}for(var i in map){return;}delete _11[id];return;}else{if(!map){map=_11[_12(id,_14)]={};}return map[key]=_15;}}};};var dom={minContainerHeight:100,nodeTypes:{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},walkTree:function(_16,_17){if(_16&&_16.hasChildNodes){for(var i=0;i<_16.childNodes.length;i++){dom.walkTree(_16.childNodes[i],_17);}}_17(_16);},walkNode:function(_18,_19,_1a){var _1b=[0],_1c;var _1d=function(_1e){try{_1c=_1e?_19.call(_1a,_1e,_1b.slice())!==false:false;}catch(e){_b.error("mxui.dom.walkNode: Unable to execute action on node: "+e.message);_1c=false;}if(_1c&&_1e.hasChildNodes){var i=_1b.push(0)-1;var _1f=null,_20=_1e.firstChild;while(_20){_20=(_1f=_20).nextSibling;_1d(_1f);_1b[i]++;}_1b.pop();}};_1d(_18);},nextNode:function(_21,_22){if(!_21||!_22){return true;}var cl=_22.length,sl=_21.length,_23=_22.length-1;return (sl>cl)||(cl==sl&&_22[_23]>_21[_23]);},getAncestorNode:function(_24,_25,_26){return _24&&((_24.nodeName==_25)?_24:((--_26==0)?false:arguments.callee(_24.parentNode,_25,_26)));},getFirstChild:function(_27,_28){_4.deprecated("mxui.dom.getFirstChild","Use dojo.query instead","5.0");if(typeof _28=="string"){_28=[_28.toLowerCase()];}var _29=false;var _2a=function(_2b){for(var i=0;i<_28.length;i++){if(_2b.nodeName.toLowerCase()==_28[i]){if(_29==false){_29=_2b;return false;}}}return true;};function _2c(_2d,_2e){if(_2d&&_2e(_2d)&&_2d.hasChildNodes){for(var i=0;i<_2d.childNodes.length;i++){_2c(_2d.childNodes[i],_2e);}}};_2c(_27,_2a);return _29;},getElementsByTagNameNoNS:function(doc,_2f){if(doc.getElementsByTagNameNS){return doc.getElementsByTagNameNS("*",_2f);}else{if("selectNodes" in doc){doc.setProperty("SelectionLanguage","XPath");return doc.selectNodes("//*[local-name() = '"+_2f+"']");}else{throw new Error("mxui.dom.getElementsByTagNameNoNS not supported");}}},escapeHTMLQuotes:function(str){return str.replace(/\'/g,"&#39;").replace(/\"/g,"&#34;");},convertNlToBr:function(str){return str.replace(/\n/g,"<br />");},setSelectOptions:function(_30,_31,_32){var $=dom.create;if(!_30){return;}_31=_31||{};dom.empty(_30);_30.appendChild($("option",{value:""},""));for(var key in _31){var _33=$("option",{value:key},_31[key]);_30.appendChild(_33);if(key==_32){_33.selected=true;}}},getSelectedValue:function(_34){if(_34.nodeName.toLowerCase()=="select"){return (_34.selectedIndex!=-1)?_34.options[_34.selectedIndex].value:null;}else{return null;}},getSelectedText:function(_35){return _35.options[_35.selectedIndex].text;},selectOptionByValue:function(_36,_37){for(var i=0;i<_36.length;++i){if(_36.options[i].value==_37){_36.options[i].selected=true;}}},selectOptionByText:function(_38,_39){for(var i=0;i<_38.length;++i){if(_38.options[i].text==_39){_38.options[i].selected=true;}}},enableNode:function(_3a){_3a.removeAttribute("readonly");_3a.removeAttribute("disabled");},disableNode:function(_3b){_3b.setAttribute("disabled","disabled");_3b.setAttribute("readonly","readonly");},disableSelection:function(e){if(!_2("ie")){e.style.MozUserSelect="none";}else{e.unselectable="on";}return true;},clearSelection:function(){var w=window,s=document.selection;if(s){try{s.empty&&s.empty();}catch(e){}}else{s=w.getSelection&&w.getSelection();s&&s.removeAllRanges&&s.removeAllRanges();}},selectTextRange:function(_3c,_3d,_3e){if(_3c.createTextRange){var _3f=_3c.createTextRange();_3f.collapse(true);_3f.moveEnd("character",_3e);_3f.moveStart("character",_3d);_3f.select();}else{if(_3c.setSelectionRange){_3c.setSelectionRange(_3d,_3e);}}},getCursorPosition:function(_40){if(document.selection){var _41=Math.abs(document.selection.createRange().moveStart("character",-1000000));document.selection.createRange().moveEnd("character",-1000000);return _41;}else{if(_40.setSelectionRange){return _40.selectionStart;}}},getSelection:function(_42){if(document.selection){var _43=Math.abs(document.selection.createRange().moveStart("character",-1000000));var end=Math.abs(document.selection.createRange().moveEnd("character",-1000000));return {start:_43,end:end};}else{if(_42.setSelectionRange){return {start:_42.selectionStart,end:_42.selectionEnd};}}},insertAtCaret:function(_44,_45){var _46=this.getSelection(_44),_47=_46.start+_45.length,_48=_44.value;_44.value=_48.substring(0,_46.start)+_45+_48.substring(_46.end,_48.length);this.selectTextRange(_44,_47,_47);},liveConnect:function(_49,evt,_4a,r,_4b){if(arguments.length==3){r=_4a;_4a=null;}var _4c={},_4d=[];for(var i in r){var _4e=i.split(".");var tag=_4e[0];var _4f=_4e[1];var _50=r[i];if((typeof _50=="string"&&_4a[_50])||typeof _50=="function"){var _51={fnc:_50};if(tag){_4c[String(tag).toUpperCase()]=_51;}else{if(_4f){_4d.push(_51);}}if(_4f){_51.clazz=_4f;}}}var _52=function(_53){for(var i=0,_50;_50=_4d[i];i++){if(_7.contains(_53,_50.clazz)){return _50;}}return null;};var run=function(fnc,e){if(typeof (fnc)=="function"){fnc(e);}else{_4a&&_4a[fnc](e);}};return _5.connect(_49,evt,function(e){var _54=e.target;var _55=_49;var e2={target:e.target};for(var i in e){var val=e[i];if(val==null||!(val instanceof Object)){e2[i]=val;}}while(_54!=_55&&_54!=null){var _56=_4c[_54.nodeName];var _57=_52(_54);if(_56){var _58=_56.clazz;_56=((!_58)||(_7.contains(_54,_58)))?_56:null;}e2.currentTarget=_54;_56&&run(_56.fnc,e2);_57&&run(_57.fnc,e2);if(_4b&&(_56||_57)){break;}_54=_54.parentNode;}});},liveDisconnect:function(_59){_5.disconnect(_59);},create:function(tag,_5a,_5b){var _5c,_5d=[].slice.call(arguments,1);_5a=_5a||{};if(_5a.nodeName||typeof _5a=="string"){_5b=_5d;_5a={};}else{_5b=_5d.slice(1);}if(tag=="#"){_5c=document.createDocumentFragment();}else{_5c=document.createElement(tag);for(var _5e in _5a){var _5f=_5a[_5e];if(_5e=="style"&&typeof _5f!="string"){var _60=_5c.style;for(var i in _5f){_60[i]=_5f[i];}}else{_5c.setAttribute(_5e,_5f);}}}_6.forEach(_5b,function(_61){if(typeof _61=="string"){_6.forEach(_61.split("\r\n"),function(_62,i){if(i>0){_5c.appendChild(dom.create("br"));}_5c.appendChild(document.createTextNode(_62));});}else{_5c.appendChild(_61);}});return _5c;},synthesizeEvent:function(evt,_63){var _64=_3.mixin({},evt,_63);_64.preventDefault=function(){evt.preventDefault();};_64.stopPropagation=function(){evt.stopPropagation();};return _64;},capture:function(_65,evt,_66){var _67=!_65.addEventListener,_68=_65[_67?"attachEvent":"addEventListener"],_69=_65[_67?"detachEvent":"removeEventListener"],_6a=_67?"on"+evt:evt;_68.call(_65,_6a,_66,true);return {remove:function(){_69.call(_65,_6a,_66,true);}};},supports:function(_6b){var _6c=document.body.style;if(_6b in _6c){return _6b;}},text:function(_6d,str){if(typeof str!=="undefined"){_6d.innerHTML="";_6d.appendChild(document.createTextNode(str));}else{return "textContent" in _6d?_6d.textContent:_6d.innerText;}},html:function(_6e,str){if(typeof str!=="undefined"){_6e.innerHTML=str;}else{return _6e.innerHTML;}},orphan:function(_6f){var p=_6f.parentNode;if(p){p.removeChild(_6f);}},isOrphan:function(_70){return !_70.parentNode||_70.parentNode.nodeType==dom.nodeTypes.DOCUMENT_FRAGMENT_NODE;},empty:function(_71){var _72;while(_72=_71.firstChild){_71.removeChild(_72);}},toArray:function(_73){return _6.map(_73,function(_74){return _74;});},escapeString:function(str){var _75=str.split(/\r\n|\n/),out=[];for(var i=0;i<_75.length;++i){dom.text(_d,_75[i]);out.push(_d.innerHTML);}return out.join("\n");},unescapeString:function(str){return str.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,"\"").replace(/&amp;/g,"&");},getCss:function(_76,doc,_77){doc=doc||document;_76=_e(_76);return _1.find(doc.getElementsByTagName("link"),function(_78){return _78.href==_76;});},createCssLink:function(_79,_7a){var _7b={rel:"stylesheet",href:_e(_79)};if(_7a){_7b.media=_7a;}return dom.create("link",_7b);},addCss:function(_7c,doc,_7d){doc=doc||document;var _7e=dom.getCss(_7c,doc,_7d);if(_7e){return _7e;}var _7f=dom.createCssLink(_7c,_7d);doc.getElementsByTagName("head")[0].appendChild(_7f);return _7f;},removeCss:function(_80,doc,_81){var _82=dom.getCss(_80,doc,_81);if(_82){_82.parentNode.removeChild(_82);return true;}return false;},addScripts:function(_83,_84){var _85=_6.map(_83,function(_86){return function(cb){var tag=dom.create("script",{type:"text/javascript",src:_86});document.querySelector("head").appendChild(tag);if("onreadystatechange" in tag){tag.onreadystatechange=function(){if(tag.readyState==="loaded"||tag.readyState==="complete"){cb();}};}else{tag.onload=tag.onerror=cb;}};});_1.collect(_85,_84);},ieFocusable:{"a":true,"body":true,"button":true,"frame":true,"iframe":true,"input":true,"isIndex":true,"object":true,"select":true,"textarea":true},getTabIndex:function(_87){if(!_87||!_87.getAttribute){return null;}var _88;if(_2("ie")||_2("trident")){_88=_87.tabIndex;if(_88===0){var _89=_87.nodeName.toLowerCase(),_8a=_87.attributes.tabIndex,_8b=_8a&&_8a.specified===true;return _8b||dom.ieFocusable[_89]?"0":null;}else{return ""+_88;}}else{var _8c=_87.getAttribute("tabindex");_88=String(_87.tabIndex);if(_8c!=null||_88>=0){if(!_2("ff")){return (_8c==="")?null:_88;}else{return _88;}}else{return null;}}},getFocusIndex:function(_8d){var _8e=dom.getTabIndex(_8d);return _8e>=0?_8e:null;},coords:function(_8f){return _3.mixin(_8.position(_8f),_8.getMarginBox(_8f));},data:_10(),getScopedData:_10,moveIntoView:function(_90,_91){_91=_91||0;var pos=_8.position(_90),_92=_a.getBox(),_93=_90.style,_94=pos.y+pos.h+_91,_95=pos.x+pos.w+_91;if(pos.y<_91||pos.h+_91*2>_92.h){_93.top=_91+"px";}else{if(_94>_92.h){_93.top=pos.y-(_94-_92.h)+"px";}}if(pos.x<_91||pos.w+_91*2>_92.w){_93.left=_91+"px";}else{if(_95>_92.w){_93.left=pos.x-(_95-_92.w)+"px";}}},getNodeExtents:function(_96){var cs=_9.getComputedStyle(_96),me=_8.getMarginExtents(_96,cs),be=_8.getBorderExtents(_96,cs),pe=_8.getPadExtents(_96,cs);return {w:me.w+be.w+pe.w,h:me.h+be.h+pe.h};},dispatchEvent:function(_97,_98){if(_2("ie")){_97.fireEvent&&_97.fireEvent([_98]);}else{var evt=document.createEvent("HTMLEvents");evt.initEvent(_98.substr(2,_98.length),true,true);_97.dispatchEvent(evt);}}};return dom;});