
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/dom",["dojo/has","dojo/_base/lang","dojo/_base/kernel","dojo/_base/connect","dojo/_base/array","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/window","mendix/logger"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){var _b=0,_c=[];var _d=function(_e){_e=_e||{};var _f=function(id,_10){if(!id){id=_b++;_10.setAttribute("data-id",id);}return id;};return function(_11,key,_12){var id=typeof _11==="string"?_11:_11.getAttribute("data-id"),map=_e[id];switch(arguments.length){case 1:return map;case 2:if(key===null){delete _e[id];return;}else{if(typeof key=="object"){if(!map){return _e[_f(id,_11)]=key;}else{return _2.mixin(map,key);}}else{return map&&map[key];}}break;case 3:if(_12===null){if(map){delete map[key];}for(var i in map){return;}delete _e[id];return;}else{if(!map){map=_e[_f(id,_11)]={};}return map[key]=_12;}}};};var _13=function(_14,_15){var _16=_14.parentNode;if(_16&&(!_15.parentNode||_15.parentNode.nodeType==11)){_16.insertBefore(_15,_14);_16.removeChild(_14);return true;}return false;};var dom={minContainerHeight:100,nodeTypes:{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},walkTree:function(_17,_18){if(_17&&_17.hasChildNodes){for(var i=0;i<_17.childNodes.length;i++){mxui.dom.walkTree(_17.childNodes[i],_18);}}_18(_17);},walkNode:function(_19,_1a,_1b){var _1c=[0],_1d;var _1e=function(_1f){try{_1d=_1f?_1a.call(_1b,_1f,_1c.slice())!==false:false;}catch(e){_a.error("mxui.dom.walkNode: Unable to execute action on node: "+e.message);_1d=false;}if(_1d&&_1f.hasChildNodes){var i=_1c.push(0)-1;var _20=null,_21=_1f.firstChild;while(_21){_21=(_20=_21).nextSibling;_1e(_20);_1c[i]++;}_1c.pop();}};_1e(_19);},nextNode:function(_22,_23){if(!_22||!_23){return true;}var cl=_23.length,sl=_22.length,_24=_23.length-1;return (sl>cl)||(cl==sl&&_23[_24]>_22[_24]);},getAncestorNode:function(_25,_26,_27){return _25&&((_25.nodeName==_26)?_25:((--_27==0)?false:arguments.callee(_25.parentNode,_26,_27)));},getFirstChild:function(_28,_29){_3.deprecated("mxui.dom.getFirstChild","Use dojo.query instead","5.0");if(typeof _29=="string"){_29=[_29.toLowerCase()];}var _2a=false;var _2b=function(_2c){for(var i=0;i<_29.length;i++){if(_2c.nodeName.toLowerCase()==_29[i]){if(_2a==false){_2a=_2c;return false;}}}return true;};var s=(function(_2d,_2e){if(_2d&&_2e(_2d)&&_2d.hasChildNodes){for(var i=0;i<_2d.childNodes.length;i++){arguments.callee(_2d.childNodes[i],_2e);}}})(_28,_2b);return _2a;},escapeHTMLQuotes:function(str){return str.replace(/\'/g,"&#39;").replace(/\"/g,"&#34;");},convertNlToBr:function(str){return str.replace(/\n/g,"<br />");},setSelectOptions:function(_2f,_30,_31){var $=mxui.dom.create;if(!_2f){return;}_30=_30||{};mxui.dom.empty(_2f);_2f.appendChild($("option",{value:""},""));for(var key in _30){var _32=$("option",{value:key},_30[key]);_2f.appendChild(_32);if(key==_31){_32.selected=true;}}},getSelectedValue:function(_33){if(_33.nodeName.toLowerCase()=="select"){return (_33.selectedIndex!=-1)?_33.options[_33.selectedIndex].value:null;}else{return null;}},getSelectedText:function(_34){return _34.options[_34.selectedIndex].text;},selectOptionByValue:function(_35,_36){for(var i=0;i<_35.length;++i){if(_35.options[i].value==_36){_35.options[i].selected=true;}}},selectOptionByText:function(_37,_38){for(var i=0;i<_37.length;++i){if(_37.options[i].text==_38){_37.options[i].selected=true;}}},enableNode:function(_39){_39.removeAttribute("readonly");_39.removeAttribute("disabled");},disableNode:function(_3a){_3a.setAttribute("disabled","disabled");_3a.setAttribute("readonly","readonly");},disableSelection:function(e){if(!_1("ie")){e.style.MozUserSelect="none";}else{e.unselectable="on";}return true;},clearSelection:function(){var w=window,s=document.selection;if(s){try{s.empty&&s.empty();}catch(e){}}else{s=w.getSelection&&w.getSelection();s&&s.removeAllRanges&&s.removeAllRanges();}},selectTextRange:function(_3b,_3c,_3d){if(_3b.createTextRange){var _3e=_3b.createTextRange();_3e.collapse(true);_3e.moveEnd("character",_3d);_3e.moveStart("character",_3c);_3e.select();}else{if(_3b.setSelectionRange){_3b.setSelectionRange(_3c,_3d);}}},getCursorPosition:function(_3f){if(document.selection){var _40=Math.abs(document.selection.createRange().moveStart("character",-1000000));var end=Math.abs(document.selection.createRange().moveEnd("character",-1000000));return _40;}else{if(_3f.setSelectionRange){return _3f.selectionStart;}}},getSelection:function(_41){if(document.selection){var _42=Math.abs(document.selection.createRange().moveStart("character",-1000000));var end=Math.abs(document.selection.createRange().moveEnd("character",-1000000));return {start:_42,end:end};}else{if(_41.setSelectionRange){return {start:_41.selectionStart,end:_41.selectionEnd};}}},liveConnect:function(_43,evt,_44,r,_45){if(arguments.length==3){r=_44;_44=null;}var _46={},_47=[];for(var i in r){var _48=i.split(".");var tag=_48[0];var _49=_48[1];var _4a=r[i];if((typeof _4a=="string"&&_44[_4a])||typeof _4a=="function"){var _4b={fnc:_4a};if(tag){_46[String(tag).toUpperCase()]=_4b;}else{if(_49){_47.push(_4b);}}if(_49){_4b.clazz=_49;}}}var _4c=_6.hasClass;var _4d=function(_4e){for(var i=0,_4a;_4a=_47[i];i++){if(_4c(_4e,_4a.clazz)){return _4a;}}return null;};var run=function(fnc,e){if(typeof (fnc)=="function"){fnc(e);}else{_44&&_44[fnc](e);}};return _4.connect(_43,evt,function(e){var _4f=e.target;var _50=_43;var e2={target:e.target};for(var i in e){var val=e[i];if(val==null||!(val instanceof Object)){e2[i]=val;}}while(_4f!=_50&&_4f!=null){var _51=_46[_4f.nodeName];var _52=_4d(_4f);if(_51){var _53=_51.clazz;_51=((!_53)||(_4c(_4f,_53)))?_51:null;}e2.currentTarget=_4f;_51&&run(_51.fnc,e2);_52&&run(_52.fnc,e2);if(_45&&(_51||_52)){break;}_4f=_4f.parentNode;}});},liveDisconnect:function(_54){_4.disconnect(_54);},removeTabIndex:function(_55){if(_1("ie")){_55.removeAttribute("tabIndex");}_55.removeAttribute("tabindex");},isChild:function(_56,_57){var _58=_56;while((_58=_58.parentNode)!=null){if(_58==_57){return true;}}return false;},create:function(tag,_59,_5a){var _5b,_5c=[].slice.call(arguments,1);_59=_59||{};if(_59.nodeName||typeof _59=="string"){_5a=_5c;_59={};}else{_5a=_5c.slice(1);}if(tag=="#"){_5b=document.createDocumentFragment();}else{_5b=document.createElement(tag);for(var _5d in _59){var _5e=_59[_5d];if(_5d=="style"&&typeof _5e!="string"){var _5f=_5b.style;for(var i in _5e){_5f[i]=_5e[i];}}else{_5b.setAttribute(_5d,_5e);}}}_5.forEach(_5a,function(_60){if(typeof _60=="string"){dojo.forEach(_60.split("\r\n"),function(_61,i){if(i>0){_5b.appendChild(mxui.dom.create("br"));}_5b.appendChild(document.createTextNode(_61));});}else{_5b.appendChild(_60);}});return _5b;},synthesizeEvent:function(evt,_62){var _63=_2.mixin({},evt,_62);_63.preventDefault=function(){evt.preventDefault();};_63.stopPropagation=function(){evt.stopPropagation();};return _63;},capture:function(_64,evt,_65){var _66=!_64.addEventListener,_67=_64[_66?"attachEvent":"addEventListener"],_68=_64[_66?"detachEvent":"removeEventListener"],_69=_66?"on"+evt:evt;_67.call(_64,_69,_65,true);return {remove:function(){_68.call(_64,_69,_65,true);}};},supports:function(_6a){var _6b=document.body.style;if(_6a in _6b){return _6a;}else{var _6c=["Webkit","Moz"],_6d=_6a.charAt(0).toUpperCase()+_6a.slice(1);for(var i=_6c.length;i--;){var _6e=_6c[i]+_6d;if(_6e in _6b){return _6e;}}}},supportsFixed:function(){var ua=navigator.userAgent,_6f=true,_70;if(/AppleWebKit\/\d+/.test(ua)){if(/iPhone|iPad/.test(ua)){_70=/OS (\d)_/.exec(ua);_6f=_70[1]&&_70[1]>=5;}else{if(/Android/.test(ua)){_70=/Android (\d\.\d)/.exec(ua);_6f=_70[1]&&_70[1]>=2.2;}}}else{if(/Trident\/\d+/.test(ua)){_70=/MSIE (\d+)/.exec(ua);if(_70){_6f=_70[1]&&_70[1]>=10;}else{_6f=true;}}}return _6f;},decodeXML:function(str){return str.replace(/&(lt|gt|apos|quot|amp);/g,function(_71,_72){return {lt:"<",gt:">",apos:"'",quot:"\"",amp:"&"}[_72];});},text:function(_73,str){if(typeof str!=="undefined"){_73.innerHTML="";_73.appendChild(document.createTextNode(str));}else{return "textContent" in _73?_73.textContent:_73.innerText;}},html:function(_74,str){if(typeof str!=="undefined"){_74.innerHTML=str;}else{return _74.innerHTML;}},orphan:function(_75){var p=_75.parentNode;if(p){p.removeChild(_75);}},empty:function(_76){var _77;while(_77=_76.firstChild){_76.removeChild(_77);}},toArray:function(_78){return _5.map(_78,function(_79){return _79;});},escapeString:function(str){var _7a=mxui.dom.create("p");mxui.dom.escapeString=function(str){var _7b=str.split(/\r\n|\n/),out=[];for(var i=0;i<_7b.length;++i){mxui.dom.text(_7a,_7b[i]);out.push(_7a.innerHTML);}return out.join("\n");};return mxui.dom.escapeString(str);},unescapeString:function(str){return str.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,"\"").replace(/&amp;/g,"&");},getCss:function(_7c,doc,_7d){doc=doc||document;var _7e=doc.getElementsByTagName("link"),re=new RegExp(mx.appUrl+_7c);for(var i=0,_7f;_7f=_7e[i];i++){if(re.test(_7f.href)){return _7f;}}return null;},addCss:function(_80,doc,_81){doc=doc||document;if(mxui.dom.getCss(_80,doc,_81)){return;}var _82=doc.getElementsByTagName("head")[0],_83=mxui.dom.create("link",{rel:"stylesheet",type:"text/css",media:_81||"screen",href:mx.appUrl+_80});_82.appendChild(_83);},removeCss:function(_84,doc,_85){var _86=mxui.dom.getCss(_84,doc,_85);if(_86){_86.parentNode.removeChild(_86);return true;}return false;},ieFocusable:{"a":true,"body":true,"button":true,"frame":true,"iframe":true,"input":true,"isIndex":true,"object":true,"select":true,"textarea":true},getTabIndex:function(_87){if(!_87||!_87.getAttribute){return null;}var _88;if(_1("ie")||_1("trident")){_88=_87.tabIndex;if(_88===0){var _89=_87.nodeName.toLowerCase(),_8a=_87.attributes.tabIndex,_8b=_8a&&_8a.specified===true;return _8b||mxui.dom.ieFocusable[_89]?"0":null;}else{return ""+_88;}}else{var _8c=_87.getAttribute("tabindex");_88=String(_87.tabIndex);if(_8c!=null||_88>=0){if(!_1("ff")){return (_8c==="")?null:_88;}else{return _88;}}else{return null;}}},getFocusIndex:function(_8d){var _8e=mxui.dom.getTabIndex(_8d);return _8e>=0?_8e:null;},coords:function(_8f){return _2.mixin(_7.position(_8f),_7.getMarginBox(_8f));},data:_d(),getScopedData:_d,moveIntoView:function(_90,_91){_91=_91||0;var pos=_7.position(_90),_92=_9.getBox(),_93=_90.style,_94=pos.y+pos.h+_91,_95=pos.x+pos.w+_91;if(pos.y<_91||pos.h+_91*2>_92.h){_93.top=_91+"px";}else{if(_94>_92.h){_93.top=pos.y-(_94-_92.h)+"px";}}if(pos.x<_91||pos.w+_91*2>_92.w){_93.left=_91+"px";}else{if(_95>_92.w){_93.left=pos.x-(_95-_92.w)+"px";}}},getNodeExtents:function(_96){var cs=_8.getComputedStyle(_96),me=_7.getMarginExtents(_96,cs),be=_7.getBorderExtents(_96,cs),pe=_7.getPadExtents(_96,cs);return {w:me.w+be.w+pe.w,h:me.h+be.h+pe.h};}};window.mxui.dom=dom;return dom;});