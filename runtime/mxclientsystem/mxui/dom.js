/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/dom",["mxui/wm/focus","mendix/lang","dojo/sniff","dojo/_base/lang","dojo/_base/kernel","dojo/_base/connect","dojo/_base/array","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/window","mendix/logger"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){var _d=0,_e=document.createElement("p");function _f(url){if(!/^\w+:\/\//.test(url)){url=mx.appUrl+url;}var _10=mx.server.getCacheBust();if(_2.startsWith(url,mx.appUrl)&&!_2.endsWith(url,_10)){url+=(/\?/.test(url)?"&":"?")+_10;}return url;};function _11(_12){_12=_12||{};var _13=function(id,_14){if(!id){id=_d++;_14.setAttribute("data-id",id);}return id;};return function(_15,key,_16){var id=typeof _15==="string"?_15:_15.getAttribute("data-id"),map=_12[id];switch(arguments.length){case 1:return map;case 2:if(key===null){delete _12[id];return;}else{if(typeof key=="object"){if(!map){return _12[_13(id,_15)]=key;}else{return _4.mixin(map,key);}}else{return map&&map[key];}}break;case 3:if(_16===null){if(map){delete map[key];}if(_2.objectIsEmpty(map)){return;}delete _12[id];return;}else{if(!map){map=_12[_13(id,_15)]={};}return map[key]=_16;}}};};var dom={minContainerHeight:100,nodeTypes:{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},walkNode:function(_17,_18,_19){var _1a=[0],_1b;var _1c=function(_1d){try{_1b=_1d?_18.call(_19,_1d,_1a.slice())!==false:false;}catch(e){_c.error("mxui.dom.walkNode: Unable to execute action on node: "+e.message);_1b=false;}if(_1b&&_1d.hasChildNodes){var i=_1a.push(0)-1;var _1e=null,_1f=_1d.firstChild;while(_1f){_1f=(_1e=_1f).nextSibling;_1c(_1e);_1a[i]++;}_1a.pop();}};_1c(_17);},nextNode:function(_20,_21){if(!_20||!_21){return true;}var cl=_21.length,sl=_20.length,_22=_21.length-1;return (sl>cl)||(cl==sl&&_21[_22]>_20[_22]);},getAncestorNode:function(_23,_24,_25){return _23&&((_23.nodeName==_24)?_23:((--_25===0)?false:arguments.callee(_23.parentNode,_24,_25)));},getFirstChild:function(_26,_27){_5.deprecated("mxui.dom.getFirstChild","Use dojo.query instead","5.0");if(typeof _27=="string"){_27=[_27.toLowerCase()];}var _28=false;var _29=function(_2a){for(var i=0;i<_27.length;i++){if(_2a.nodeName.toLowerCase()==_27[i]){if(_28===false){_28=_2a;return false;}}}return true;};function _2b(_2c,_2d){if(_2c&&_2d(_2c)&&_2c.hasChildNodes){for(var i=0;i<_2c.childNodes.length;i++){_2b(_2c.childNodes[i],_2d);}}};_2b(_26,_29);return _28;},findOverflowParent:function(_2e){while(_2e=_2e.parentNode){if(_2e===document.body){break;}var _2f=_a.get(_2e,"overflow");if(_2f==="auto"||_2f==="scroll"){return _2e;}}return document.documentElement.scrollTop>0?document.documentElement:document.body;},scrollOverflowParentTo:function(_30,to){var _31=dom.findOverflowParent(_30);if(_31){_31.scrollTop=to;}},getElementsByTagNameNoNS:function(doc,_32){if(doc.getElementsByTagNameNS){return doc.getElementsByTagNameNS("*",_32);}else{if("selectNodes" in doc){doc.setProperty("SelectionLanguage","XPath");return doc.selectNodes("//*[local-name() = '"+_32+"']");}else{throw new Error("mxui.dom.getElementsByTagNameNoNS not supported");}}},escapeHTMLQuotes:function(str){return str.replace(/'/g,"&#39;").replace(/\"/g,"&#34;");},convertNlToBr:function(str){return str.replace(/\n/g,"<br />");},setSelectOptions:function(_33,_34,_35){var $=dom.create;if(!_33){return;}_34=_34||{};dom.empty(_33);_33.appendChild($("option",{value:""},""));for(var key in _34){var _36=$("option",{value:key},_34[key]);_33.appendChild(_36);if(key==_35){_36.selected=true;}}},getSelectedValue:function(_37){if(_37.nodeName.toLowerCase()=="select"){return (_37.selectedIndex!=-1)?_37.options[_37.selectedIndex].value:null;}else{return null;}},getSelectedText:function(_38){return _38.options[_38.selectedIndex].text;},selectOptionByValue:function(_39,_3a){for(var i=0;i<_39.length;++i){if(_39.options[i].value==_3a){_39.options[i].selected=true;}}},selectOptionByText:function(_3b,_3c){for(var i=0;i<_3b.length;++i){if(_3b.options[i].text==_3c){_3b.options[i].selected=true;}}},enableNode:function(_3d){_3d.removeAttribute("readonly");_3d.removeAttribute("disabled");},disableNode:function(_3e){_3e.setAttribute("disabled","disabled");_3e.setAttribute("readonly","readonly");},disableSelection:function(e){if(!_3("ie")){e.style.MozUserSelect="none";}else{e.unselectable="on";}return true;},clearSelection:function(){var w=window,s=document.selection;if(s){try{if(s.empty){s.empty();}}catch(e){}}else{s=w.getSelection&&w.getSelection();if(s&&s.removeAllRanges){s.removeAllRanges();}}},selectTextRange:function(_3f,_40,_41){if(_3f.createTextRange){var _42=_3f.createTextRange();_42.collapse(true);_42.moveEnd("character",_41);_42.moveStart("character",_40);_42.select();}else{if(_3f.setSelectionRange){_3f.setSelectionRange(_40,_41);}}},getCursorPosition:function(_43){if(document.selection){var _44=Math.abs(document.selection.createRange().moveStart("character",-1000000));document.selection.createRange().moveEnd("character",-1000000);return _44;}else{if(_43.setSelectionRange){return _43.selectionStart;}}},getSelection:function(_45){if(document.selection){var _46=Math.abs(document.selection.createRange().moveStart("character",-1000000));var end=Math.abs(document.selection.createRange().moveEnd("character",-1000000));return {start:_46,end:end};}else{if(_45.setSelectionRange){return {start:_45.selectionStart,end:_45.selectionEnd};}}},insertAtCaret:function(_47,_48){var _49=this.getSelection(_47),_4a=_49.start+_48.length,_4b=_47.value;_47.value=_4b.substring(0,_49.start)+_48+_4b.substring(_49.end,_4b.length);this.selectTextRange(_47,_4a,_4a);},liveConnect:function(_4c,evt,_4d,r,_4e){if(arguments.length==3){r=_4d;_4d=null;}var _4f={},_50=[];for(var i in r){var _51=i.split(".");var tag=_51[0];var _52=_51[1];var _53=r[i];if((typeof _53=="string"&&_4d[_53])||typeof _53=="function"){var _54={fnc:_53};if(tag){_4f[String(tag).toUpperCase()]=_54;}else{if(_52){_50.push(_54);}}if(_52){_54.clazz=_52;}}}var _55=function(_56){for(var i=0,_53;_53=_50[i];i++){if(_8.contains(_56,_53.clazz)){return _53;}}return null;};var run=function(fnc,e){if(typeof (fnc)=="function"){fnc(e);}else{if(_4d&&_4d[fnc]){_4d[fnc](e);}}};return _6.connect(_4c,evt,function(e){var _57=e.target;var _58=_4c;var e2={target:e.target};for(var i in e){var val=e[i];if(val==null||!(val instanceof Object)){e2[i]=val;}}while(_57!=_58&&_57!=null){var _59=_4f[_57.nodeName];var _5a=_55(_57);if(_59){var _5b=_59.clazz;_59=((!_5b)||(_8.contains(_57,_5b)))?_59:null;}e2.currentTarget=_57;if(_59){run(_59.fnc,e2);}if(_5a){run(_5a.fnc,e2);}if(_4e&&(_59||_5a)){break;}_57=_57.parentNode;}});},liveDisconnect:function(_5c){_6.disconnect(_5c);},create:function(_5d,_5e,_5f){var _60,_61=[].slice.call(arguments,1);_5e=_5e||{};if(_5e.nodeName||typeof _5e=="string"){_5f=_61;_5e={};}else{_5f=_61.slice(1);}if(_5d=="#"){_60=document.createDocumentFragment();}else{_60=document.createElement(_5d);for(var _62 in _5e){var _63=_5e[_62];if(_62=="style"&&typeof _63!="string"){var _64=_60.style;for(var i in _63){_64[i]=_63[i];}}else{_60.setAttribute(_62,_63);}}}_7.forEach(_5f,function(_65){if(typeof _65=="string"){_7.forEach(_65.split("\r\n"),function(_66,i){if(i>0){_60.appendChild(dom.create("br"));}_60.appendChild(document.createTextNode(_66));});}else{_60.appendChild(_65);}});return _60;},synthesizeEvent:function(evt,_67){var _68=_4.mixin({},evt,_67);_68.preventDefault=function(){evt.preventDefault();};_68.stopPropagation=function(){evt.stopPropagation();};return _68;},capture:function(_69,evt,_6a){var _6b=!_69.addEventListener,_6c=_69[_6b?"attachEvent":"addEventListener"],_6d=_69[_6b?"detachEvent":"removeEventListener"],_6e=_6b?"on"+evt:evt;_6c.call(_69,_6e,_6a,true);return {remove:function(){_6d.call(_69,_6e,_6a,true);}};},supports:function(_6f){var _70=document.body.style;if(_6f in _70){return _6f;}},text:function(_71,str){if(typeof str!=="undefined"){_71.innerHTML="";_71.appendChild(document.createTextNode(str));}else{return "textContent" in _71?_71.textContent:_71.innerText;}},html:function(_72,str){if(typeof str!=="undefined"){_72.innerHTML=str;}else{return _72.innerHTML;}},orphan:function(_73){var p=_73.parentNode;if(p){p.removeChild(_73);}},isOrphan:function(_74){return !_74.parentNode||_74.parentNode.nodeType==dom.nodeTypes.DOCUMENT_FRAGMENT_NODE;},empty:function(_75){var _76;while(_76=_75.firstChild){_75.removeChild(_76);}},toArray:function(_77){return _7.map(_77,function(_78){return _78;});},escapeString:function(str){var _79=str.split(/\r\n|\n/),out=[];for(var i=0;i<_79.length;++i){dom.text(_e,_79[i]);out.push(_e.innerHTML);}return out.join("\n");},unescapeString:function(str){return str.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,"\"").replace(/&amp;/g,"&");},getCss:function(_7a,doc){doc=doc||document;_7a=_f(_7a);return _2.find(doc.getElementsByTagName("link"),function(_7b){return _7b.href==_7a;});},createCssLink:function(_7c,_7d){var _7e={rel:"stylesheet",href:_f(_7c)};if(_7d){_7e.media=_7d;}return dom.create("link",_7e);},addCss:function(_7f,doc,_80){doc=doc||document;var _81=dom.getCss(_7f,doc);if(_81){return _81;}var _82=dom.createCssLink(_7f,_80);doc.querySelector("head").appendChild(_82);return _82;},removeCss:function(_83,doc){var _84=dom.getCss(_83,doc);if(_84){_84.parentNode.removeChild(_84);return true;}return false;},ieFocusable:{"a":true,"body":true,"button":true,"frame":true,"iframe":true,"input":true,"isIndex":true,"object":true,"select":true,"textarea":true},getTabIndex:function(_85){if(!_85||!_85.getAttribute){return null;}var _86;if(_3("ie")||_3("trident")||_3("edge")){_86=_85.tabIndex;if(_86===0){var _87=_85.nodeName.toLowerCase(),_88=_85.attributes.tabIndex,_89=_88&&_88.specified===true;return _89||dom.ieFocusable[_87]?"0":null;}else{return ""+_86;}}else{var _8a=_85.getAttribute("tabindex");_86=String(_85.tabIndex);if(_8a!=null||_86>=0){if(!_3("ff")){return (_8a==="")?null:_86;}else{return _86;}}else{return null;}}},moveFocusTo:function(_8b){if(_3("mobile")){_1.blur();}else{_1.first(_8b);}},coords:function(_8c){return _4.mixin(_9.position(_8c),_9.getMarginBox(_8c));},data:_11(),getScopedData:_11,moveIntoView:function(_8d,_8e){_8e=_8e||0;var pos=_9.position(_8d),_8f=_b.getBox(),_90=_8d.style,_91=pos.y+pos.h+_8e,_92=pos.x+pos.w+_8e;if(pos.y<_8e||pos.h+_8e*2>_8f.h){_90.top=_8e+"px";}else{if(_91>_8f.h){_90.top=pos.y-(_91-_8f.h)+"px";}}if(pos.x<_8e||pos.w+_8e*2>_8f.w){_90.left=_8e+"px";}else{if(_92>_8f.w){_90.left=pos.x-(_92-_8f.w)+"px";}}},getNodeExtents:function(_93){var cs=_a.getComputedStyle(_93),me=_9.getMarginExtents(_93,cs),be=_9.getBorderExtents(_93,cs),pe=_9.getPadExtents(_93,cs);return {w:me.w+be.w+pe.w,h:me.h+be.h+pe.h};},dispatchEvent:function(_94,_95){if("createEvent" in document){var evt=document.createEvent("HTMLEvents");evt.initEvent(_95.substr(2,_95.length),true,true);_94.dispatchEvent(evt);}else{if(_94.fireEvent){_94.fireEvent([_95]);}}}};return dom;});