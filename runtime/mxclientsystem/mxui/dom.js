/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/dom",["mxui/wm/focus","mendix/lang","dojo/sniff","dojo/_base/lang","dojo/_base/kernel","dojo/_base/connect","dojo/_base/array","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/window","mendix/logger"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){var _d=0,_e=document.createElement("p");function _f(url){if(!/^\w+:\/\//.test(url)){url=mx.appUrl+url;}if(url.indexOf(mx.appUrl)===0){url+=(/\?/.test(url)?"&":"?")+mx.server.getCacheBust();}return url;};function _10(_11){_11=_11||{};var _12=function(id,_13){if(!id){id=_d++;_13.setAttribute("data-id",id);}return id;};return function(_14,key,_15){var id=typeof _14==="string"?_14:_14.getAttribute("data-id"),map=_11[id];switch(arguments.length){case 1:return map;case 2:if(key===null){delete _11[id];return;}else{if(typeof key=="object"){if(!map){return _11[_12(id,_14)]=key;}else{return _4.mixin(map,key);}}else{return map&&map[key];}}break;case 3:if(_15===null){if(map){delete map[key];}if(_2.objectIsEmpty(map)){return;}delete _11[id];return;}else{if(!map){map=_11[_12(id,_14)]={};}return map[key]=_15;}}};};var dom={minContainerHeight:100,nodeTypes:{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},walkNode:function(_16,_17,_18){var _19=[0],_1a;var _1b=function(_1c){try{_1a=_1c?_17.call(_18,_1c,_19.slice())!==false:false;}catch(e){_c.error("mxui.dom.walkNode: Unable to execute action on node: "+e.message);_1a=false;}if(_1a&&_1c.hasChildNodes){var i=_19.push(0)-1;var _1d=null,_1e=_1c.firstChild;while(_1e){_1e=(_1d=_1e).nextSibling;_1b(_1d);_19[i]++;}_19.pop();}};_1b(_16);},nextNode:function(_1f,_20){if(!_1f||!_20){return true;}var cl=_20.length,sl=_1f.length,_21=_20.length-1;return (sl>cl)||(cl==sl&&_20[_21]>_1f[_21]);},getAncestorNode:function(_22,_23,_24){return _22&&((_22.nodeName==_23)?_22:((--_24===0)?false:arguments.callee(_22.parentNode,_23,_24)));},getFirstChild:function(_25,_26){_5.deprecated("mxui.dom.getFirstChild","Use dojo.query instead","5.0");if(typeof _26=="string"){_26=[_26.toLowerCase()];}var _27=false;var _28=function(_29){for(var i=0;i<_26.length;i++){if(_29.nodeName.toLowerCase()==_26[i]){if(_27===false){_27=_29;return false;}}}return true;};function _2a(_2b,_2c){if(_2b&&_2c(_2b)&&_2b.hasChildNodes){for(var i=0;i<_2b.childNodes.length;i++){_2a(_2b.childNodes[i],_2c);}}};_2a(_25,_28);return _27;},findOverflowParent:function(_2d){while(_2d=_2d.parentNode){var _2e=_a.get(_2d,"overflow");if(_2e==="auto"||_2e==="scroll"||_2d===document.body){return _2d;}}},scrollOverflowParentTo:function(_2f,to){var _30=dom.findOverflowParent(_2f);if(_30){_30.scrollTop=to;}},getElementsByTagNameNoNS:function(doc,_31){if(doc.getElementsByTagNameNS){return doc.getElementsByTagNameNS("*",_31);}else{if("selectNodes" in doc){doc.setProperty("SelectionLanguage","XPath");return doc.selectNodes("//*[local-name() = '"+_31+"']");}else{throw new Error("mxui.dom.getElementsByTagNameNoNS not supported");}}},escapeHTMLQuotes:function(str){return str.replace(/'/g,"&#39;").replace(/\"/g,"&#34;");},convertNlToBr:function(str){return str.replace(/\n/g,"<br />");},setSelectOptions:function(_32,_33,_34){var $=dom.create;if(!_32){return;}_33=_33||{};dom.empty(_32);_32.appendChild($("option",{value:""},""));for(var key in _33){var _35=$("option",{value:key},_33[key]);_32.appendChild(_35);if(key==_34){_35.selected=true;}}},getSelectedValue:function(_36){if(_36.nodeName.toLowerCase()=="select"){return (_36.selectedIndex!=-1)?_36.options[_36.selectedIndex].value:null;}else{return null;}},getSelectedText:function(_37){return _37.options[_37.selectedIndex].text;},selectOptionByValue:function(_38,_39){for(var i=0;i<_38.length;++i){if(_38.options[i].value==_39){_38.options[i].selected=true;}}},selectOptionByText:function(_3a,_3b){for(var i=0;i<_3a.length;++i){if(_3a.options[i].text==_3b){_3a.options[i].selected=true;}}},enableNode:function(_3c){_3c.removeAttribute("readonly");_3c.removeAttribute("disabled");},disableNode:function(_3d){_3d.setAttribute("disabled","disabled");_3d.setAttribute("readonly","readonly");},disableSelection:function(e){if(!_3("ie")){e.style.MozUserSelect="none";}else{e.unselectable="on";}return true;},clearSelection:function(){var w=window,s=document.selection;if(s){try{if(s.empty){s.empty();}}catch(e){}}else{s=w.getSelection&&w.getSelection();if(s&&s.removeAllRanges){s.removeAllRanges();}}},selectTextRange:function(_3e,_3f,_40){if(_3e.createTextRange){var _41=_3e.createTextRange();_41.collapse(true);_41.moveEnd("character",_40);_41.moveStart("character",_3f);_41.select();}else{if(_3e.setSelectionRange){_3e.setSelectionRange(_3f,_40);}}},getCursorPosition:function(_42){if(document.selection){var _43=Math.abs(document.selection.createRange().moveStart("character",-1000000));document.selection.createRange().moveEnd("character",-1000000);return _43;}else{if(_42.setSelectionRange){return _42.selectionStart;}}},getSelection:function(_44){if(document.selection){var _45=Math.abs(document.selection.createRange().moveStart("character",-1000000));var end=Math.abs(document.selection.createRange().moveEnd("character",-1000000));return {start:_45,end:end};}else{if(_44.setSelectionRange){return {start:_44.selectionStart,end:_44.selectionEnd};}}},insertAtCaret:function(_46,_47){var _48=this.getSelection(_46),_49=_48.start+_47.length,_4a=_46.value;_46.value=_4a.substring(0,_48.start)+_47+_4a.substring(_48.end,_4a.length);this.selectTextRange(_46,_49,_49);},liveConnect:function(_4b,evt,_4c,r,_4d){if(arguments.length==3){r=_4c;_4c=null;}var _4e={},_4f=[];for(var i in r){var _50=i.split(".");var tag=_50[0];var _51=_50[1];var _52=r[i];if((typeof _52=="string"&&_4c[_52])||typeof _52=="function"){var _53={fnc:_52};if(tag){_4e[String(tag).toUpperCase()]=_53;}else{if(_51){_4f.push(_53);}}if(_51){_53.clazz=_51;}}}var _54=function(_55){for(var i=0,_52;_52=_4f[i];i++){if(_8.contains(_55,_52.clazz)){return _52;}}return null;};var run=function(fnc,e){if(typeof (fnc)=="function"){fnc(e);}else{if(_4c&&_4c[fnc]){_4c[fnc](e);}}};return _6.connect(_4b,evt,function(e){var _56=e.target;var _57=_4b;var e2={target:e.target};for(var i in e){var val=e[i];if(val==null||!(val instanceof Object)){e2[i]=val;}}while(_56!=_57&&_56!=null){var _58=_4e[_56.nodeName];var _59=_54(_56);if(_58){var _5a=_58.clazz;_58=((!_5a)||(_8.contains(_56,_5a)))?_58:null;}e2.currentTarget=_56;if(_58){run(_58.fnc,e2);}if(_59){run(_59.fnc,e2);}if(_4d&&(_58||_59)){break;}_56=_56.parentNode;}});},liveDisconnect:function(_5b){_6.disconnect(_5b);},create:function(_5c,_5d,_5e){var _5f,_60=[].slice.call(arguments,1);_5d=_5d||{};if(_5d.nodeName||typeof _5d=="string"){_5e=_60;_5d={};}else{_5e=_60.slice(1);}if(_5c=="#"){_5f=document.createDocumentFragment();}else{_5f=document.createElement(_5c);for(var _61 in _5d){var _62=_5d[_61];if(_61=="style"&&typeof _62!="string"){var _63=_5f.style;for(var i in _62){_63[i]=_62[i];}}else{_5f.setAttribute(_61,_62);}}}_7.forEach(_5e,function(_64){if(typeof _64=="string"){_7.forEach(_64.split("\r\n"),function(_65,i){if(i>0){_5f.appendChild(dom.create("br"));}_5f.appendChild(document.createTextNode(_65));});}else{_5f.appendChild(_64);}});return _5f;},synthesizeEvent:function(evt,_66){var _67=_4.mixin({},evt,_66);_67.preventDefault=function(){evt.preventDefault();};_67.stopPropagation=function(){evt.stopPropagation();};return _67;},capture:function(_68,evt,_69){var _6a=!_68.addEventListener,_6b=_68[_6a?"attachEvent":"addEventListener"],_6c=_68[_6a?"detachEvent":"removeEventListener"],_6d=_6a?"on"+evt:evt;_6b.call(_68,_6d,_69,true);return {remove:function(){_6c.call(_68,_6d,_69,true);}};},supports:function(_6e){var _6f=document.body.style;if(_6e in _6f){return _6e;}},text:function(_70,str){if(typeof str!=="undefined"){_70.innerHTML="";_70.appendChild(document.createTextNode(str));}else{return "textContent" in _70?_70.textContent:_70.innerText;}},html:function(_71,str){if(typeof str!=="undefined"){_71.innerHTML=str;}else{return _71.innerHTML;}},orphan:function(_72){var p=_72.parentNode;if(p){p.removeChild(_72);}},isOrphan:function(_73){return !_73.parentNode||_73.parentNode.nodeType==dom.nodeTypes.DOCUMENT_FRAGMENT_NODE;},empty:function(_74){var _75;while(_75=_74.firstChild){_74.removeChild(_75);}},toArray:function(_76){return _7.map(_76,function(_77){return _77;});},escapeString:function(str){var _78=str.split(/\r\n|\n/),out=[];for(var i=0;i<_78.length;++i){dom.text(_e,_78[i]);out.push(_e.innerHTML);}return out.join("\n");},unescapeString:function(str){return str.replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,"\"").replace(/&amp;/g,"&");},getCss:function(_79,doc){doc=doc||document;_79=_f(_79);return _2.find(doc.getElementsByTagName("link"),function(_7a){return _7a.href==_79;});},createCssLink:function(_7b,_7c){var _7d={rel:"stylesheet",href:_f(_7b)};if(_7c){_7d.media=_7c;}return dom.create("link",_7d);},addCss:function(_7e,doc,_7f){doc=doc||document;var _80=dom.getCss(_7e,doc);if(_80){return _80;}var _81=dom.createCssLink(_7e,_7f);doc.querySelector("head").appendChild(_81);return _81;},removeCss:function(_82,doc){var _83=dom.getCss(_82,doc);if(_83){_83.parentNode.removeChild(_83);return true;}return false;},ieFocusable:{"a":true,"body":true,"button":true,"frame":true,"iframe":true,"input":true,"isIndex":true,"object":true,"select":true,"textarea":true},getTabIndex:function(_84){if(!_84||!_84.getAttribute){return null;}var _85;if(_3("ie")||_3("trident")){_85=_84.tabIndex;if(_85===0){var _86=_84.nodeName.toLowerCase(),_87=_84.attributes.tabIndex,_88=_87&&_87.specified===true;return _88||dom.ieFocusable[_86]?"0":null;}else{return ""+_85;}}else{var _89=_84.getAttribute("tabindex");_85=String(_84.tabIndex);if(_89!=null||_85>=0){if(!_3("ff")){return (_89==="")?null:_85;}else{return _85;}}else{return null;}}},moveFocusTo:function(_8a){if(_3("mobile")){_1.blur();}else{_1.first(_8a);}},coords:function(_8b){return _4.mixin(_9.position(_8b),_9.getMarginBox(_8b));},data:_10(),getScopedData:_10,moveIntoView:function(_8c,_8d){_8d=_8d||0;var pos=_9.position(_8c),_8e=_b.getBox(),_8f=_8c.style,_90=pos.y+pos.h+_8d,_91=pos.x+pos.w+_8d;if(pos.y<_8d||pos.h+_8d*2>_8e.h){_8f.top=_8d+"px";}else{if(_90>_8e.h){_8f.top=pos.y-(_90-_8e.h)+"px";}}if(pos.x<_8d||pos.w+_8d*2>_8e.w){_8f.left=_8d+"px";}else{if(_91>_8e.w){_8f.left=pos.x-(_91-_8e.w)+"px";}}},getNodeExtents:function(_92){var cs=_a.getComputedStyle(_92),me=_9.getMarginExtents(_92,cs),be=_9.getBorderExtents(_92,cs),pe=_9.getPadExtents(_92,cs);return {w:me.w+be.w+pe.w,h:me.h+be.h+pe.h};},dispatchEvent:function(_93,_94){if("createEvent" in document){var evt=document.createEvent("HTMLEvents");evt.initEvent(_94.substr(2,_94.length),true,true);_93.dispatchEvent(evt);}else{if(_93.fireEvent){_93.fireEvent([_94]);}}}};return dom;});