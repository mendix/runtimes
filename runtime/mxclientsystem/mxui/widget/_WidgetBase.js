
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/_WidgetBase",["mxui/dom","mxui/html/parser","mendix/lang","mendix/lib/MxContext","mendix/logger","dijit/_WidgetBase","dijit/registry","dojo/query","dojo/dom-attr","dojo/dom-geometry","dojo/_base/array","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){var _e=_d(_6,{declaredClass:"mxui.widget._WidgetBase",mxid:"",mxform:null,mxcontext:null,doParse:true,readOnly:false,ignoreUpdates:false,autoLoad:true,_loaded:false,_destroyed:false,_cachedDisabled:false,_disabled:false,_suspended:false,_loadCalls:null,_destroyCalls:null,_listeners:null,_subscriptions:null,"-chains-":{constructor:"after",uninitialize:"before"},constructor:function(_f,_10){this._loadCalls=[];this._destroyCalls=[];this._listeners=[];this._subscriptions=[];this.mxcontext=new _4();if(this.autoLoad){this.set("loaded",true);}},getTemplate:function(_11){return window.mx.ui.getTemplate(this.mxid,_11);},parseContent:function(_12,_13,_14){var _15={mxform:this.mxform,validator:this.validator,ignoreUpdates:this.ignoreUpdates};if(this.readOnly){_15.readOnly=true;}if(this.doParse||_14){return _2.parse(_12||this.domNode,_c.mixin(_15,_13));}else{return [];}},getChildren:function(_16){if(_16){return _8("[widgetid]",this.domNode).map(_7.byNode);}else{return _7.findWidgets(this.domNode);}},resizeChildren:function(_17,_18){var _19=_7.findWidgets(_17);if(_19.length>1||_17.children.length>1){_18=true;}_b.forEach(_19,function(_1a){var _1b=_1a.domNode.parentNode;if(_1b===_17||_1b===_1a.mxform.domNode){if(typeof _1a.resize==="function"){if(_18){_1a.resize();}else{var box=_a.getContentBox(_17);_1a.resize({w:box.w,h:box.h});}}}});},applyContext:function(_1c,_1d){var _1e=this.mxcontext;if(!/reset/i.test(this.contextAction)){_1e.mixin(_1c);if(this.dropContext){for(var i=0,_1f;_1f=this.dropContext[i];i++){_1e.unsetContext(_1f);}}}else{if(this.preserveTrackObject){if(_1c){_1e.setObject(_1c.getTrackObject(),_1c.getTrackEntity(),_1c.getTrackId());}else{_1e.setObject(null);}}}if(typeof this.update=="function"){var _20=_1e.getObject(),_21=_1e.getTrackId(),_22=_c.hitch(this,function(obj){try{this.update(obj,_1d);}catch(e){throw new Error(this.id+".applyContext: "+e);}});if(_20){_22(_20);}else{if(_21){window.mx.data.get({guid:_21,callback:function(obj){if(!obj){_5.error(this.id+".applyContext: error while fetching object with guid "+_21);}_22(obj);},error:function(e){window.mx.onError(e);_22(null);}},this);}else{_22(null);}}}else{var _23=_7.findWidgets(this.domNode);this.passContext(_23,_1c,_1d);}},passContext:function(_24,_25,_26){if(typeof _25=="function"){_26=_25;_25=this.mxcontext;}else{_25=_25||this.mxcontext;}var _27=[];for(var i=0,_28;_28=_24[i];i++){if(_28.applyContext){_27.push(function(_29){return function(cb){try{_29.applyContext(_25,cb);}catch(e){throw new Error(_29.id+".applyContext: "+e);}};}(_28));}else{var _2a=_7.findWidgets(_28.domNode);this.passContext(_2a,_25,_26);}}this.collect(_27,_26);},subscribe:function(sub){if(this.ignoreUpdates){return;}var _2b=window.mx.data.subscribe(sub,this);this._subscriptions.push(_2b);return _2b;},unsubscribe:function(_2c){if(this.ignoreUpdates){return;}var _2d=this._subscriptions;for(var i=0,_2e;_2e=_2d[i];i++){if(_2e==_2c){window.mx.data.unsubscribe(_2c);_2d.splice(i,1);break;}}},unsubscribeAll:function(){var _2f=this._subscriptions;while(_2f.length){window.mx.data.unsubscribe(_2f.pop());}},listen:function(_30,_31){var _32=this.mxform.listen(_30,_c.hitch(this,_31));this._listeners.push(_32);return _32;},unlisten:function(_33){var _34=this._listeners;for(var i=0,_35;_35=_34[i];i++){if(_35==_33){this.mxform.unlisten(_33);_34.splice(i,1);break;}}},capture:function(_36,evt,_37){var _38=_1.capture(_36,evt,_c.hitch(this,_37));this.addOnDestroy(_38.remove);},collect:function(_39,_3a){_3.collect(_39,_3a,this);},sequence:function(_3b,_3c){_3.sequence(_3b,_3c,this);},translate:function(str,_3d,_3e){return window.mx.ui.translate(this.declaredClass,str,_3d,_3e);},domData:function(){this.domData=_1.getScopedData();return this.domData.apply(this,arguments);},_getSuspendedAttr:function(){return this._suspended;},_setSuspendedAttr:function(_3f){var _40=!!_3f;if(this._suspended!=_40){this._suspended=_40;var _41=_40?"suspend":"resume";try{this[_41]();}catch(e){throw new Error(this.id+"."+_41+": "+e);}}},resume:function(){},suspend:function(){},checkDisabled:function(){return this.readOnly||this._disabled;},updateDisabled:function(_42){if(_42!=null){this._disabled=!!_42;}_42=this.checkDisabled();if(_42!=this._cachedDisabled){this._cachedDisabled=_42;var _43=_42?"disable":"enable";try{this[_43]();}catch(e){throw new Error(this.id+"."+_43+": "+e);}}},_getDisabledAttr:function(){return this._cachedDisabled;},_setDisabledAttr:function(_44){return this.updateDisabled(_44);},enable:function(){},disable:function(){},_setMxidAttr:function(_45){_9.set(this.domNode,"data-mendix-id",_45);},_setFocusIndexAttr:function(_46){if(_46!=null){_9.set(this.domNode,"focusindex",_46);}},_getLoadedAttr:function(){return this._loaded;},_setLoadedAttr:function(_47){this._loaded=!!_47;if(_47){var _48=this._loadCalls;while(_48.length){_48.shift()();}}},actLoaded:function(_49){this.set("loaded",true);_49&&_49();},addOnLoad:function(fnc){this._loaded?fnc():this._loadCalls.push(fnc);},addOnDestroy:function(fnc){this._destroyed?fnc():this._destroyCalls.push(fnc);},destroy:function(_4a){this._beingDestroyed=true;try{this.uninitialize();}catch(e){throw new Error(this.id+".uninitialize: "+e);}function _4b(w){if(w.destroyRecursive){w.destroyRecursive(_4a);}else{if(w.destroy){w.destroy(_4a);}}};_b.forEach(this._connects,_c.hitch(this,"disconnect"));_b.forEach(this._supportingWidgets,_4b);if(this.domNode){_b.forEach(_7.findWidgets(this.domNode),_4b);}this.destroyRendering(_4a);_7.remove(this.id);this._destroyed=true;},uninitialize:function(){if(this._loaded){var _4c=this._listeners,_4d=this._destroyCalls;while(_4c.length){this.mxform.unlisten(_4c.pop());}this.unsubscribeAll();while(_4d.length){_4d.shift().call(this);}}else{_5.error(this.id+".uninitialize: widget not loaded yet, check widget structure");this.addOnLoad(_c.hitch(this,function(){try{this.uninitialize();}catch(e){throw new Error(this.id+".unitialize: "+e);}}));}}});return _e;});