
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/_WidgetBase",["mxui/dom","mendix/lang","mendix/lib/MxContext","mendix/logger","dijit/_WidgetBase","dijit/registry","dojo/query","dojo/dom-attr","dojo/dom-geometry","dojo/_base/array","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){var _d=_c(_5,{declaredClass:"mxui.widget._WidgetBase",mxid:"",mxform:null,mxcontext:null,doParse:true,readOnly:false,ignoreUpdates:false,autoLoad:true,_loaded:false,_destroyed:false,_cachedDisabled:false,_disabled:false,_suspended:false,_loadCalls:null,_destroyCalls:null,_listeners:null,_subscriptions:null,"-chains-":{constructor:"after",uninitialize:"before"},constructor:function(_e,_f){this._loadCalls=[];this._destroyCalls=[];this._listeners=[];this._subscriptions=[];this.mxcontext=new _3();if(this.autoLoad){this.set("loaded",true);}},getTemplate:function(_10){return window.mx.ui.getTemplate(this.mxid,_10);},parseContent:function(_11,_12,_13){var _14={mxform:this.mxform,validator:this.validator,ignoreUpdates:this.ignoreUpdates};if(this.readOnly){_14.readOnly=true;}if(this.doParse||_13){return mxui.html.parser.parse(_11||this.domNode,_b.mixin(_14,_12));}else{return [];}},getChildren:function(_15){if(_15){return _7("[widgetid]",this.domNode).map(_6.byNode);}else{return _6.findWidgets(this.domNode);}},resizeChildren:function(_16,_17){var _18=_6.findWidgets(_16);if(_18.length>1||_16.children.length>1){_17=true;}_a.forEach(_18,function(_19){var _1a=_19.domNode.parentNode;if(_1a===_16||_1a===_19.mxform.domNode){if(typeof _19.resize==="function"){if(_17){_19.resize();}else{var box=_9.getContentBox(_16);_19.resize({w:box.w,h:box.h});}}}});},applyContext:function(_1b,_1c){var _1d=this.mxcontext;if(!/reset/i.test(this.contextAction)){_1d.mixin(_1b);if(this.dropContext){for(var i=0,_1e;_1e=this.dropContext[i];i++){_1d.unsetContext(_1e);}}}else{if(this.preserveTrackObject){if(_1b){_1d.setObject(_1b.getTrackObject(),_1b.getTrackEntity(),_1b.getTrackId());}else{_1d.setObject(null);}}}if(typeof this.update=="function"){var _1f=_1d.getObject(),_20=_1d.getTrackId(),_21=_b.hitch(this,function(obj){try{this.update(obj,_1c);}catch(e){throw new Error(this.id+".applyContext: "+e);}});if(_1f){_21(_1f);}else{if(_20){window.mx.data.get({guid:_20,callback:function(obj){if(!obj){_4.error(this.id+".applyContext: error while fetching object with guid "+_20);}_21(obj);},error:function(e){window.mx.onError(e);_21(null);}},this);}else{_21(null);}}}else{var _22=_6.findWidgets(this.domNode);this.passContext(_22,_1b,_1c);}},passContext:function(_23,_24,_25){if(typeof _24=="function"){_25=_24;_24=this.mxcontext;}else{_24=_24||this.mxcontext;}var _26=[];for(var i=0,_27;_27=_23[i];i++){if(_27.applyContext){_26.push(function(_28){return function(cb){try{_28.applyContext(_24,cb);}catch(e){throw new Error(_28.id+".applyContext: "+e);}};}(_27));}else{var _29=_6.findWidgets(_27.domNode);this.passContext(_29,_24,_25);}}this.collect(_26,_25);},subscribe:function(sub){if(this.ignoreUpdates){return;}var _2a=window.mx.data.subscribe(sub,this);this._subscriptions.push(_2a);return _2a;},unsubscribe:function(_2b){if(this.ignoreUpdates){return;}var _2c=this._subscriptions;for(var i=0,_2d;_2d=_2c[i];i++){if(_2d==_2b){window.mx.data.unsubscribe(_2b);_2c.splice(i,1);break;}}},unsubscribeAll:function(){var _2e=this._subscriptions;while(_2e.length){window.mx.data.unsubscribe(_2e.pop());}},listen:function(_2f,_30){var _31=this.mxform.listen(_2f,_b.hitch(this,_30));this._listeners.push(_31);return _31;},unlisten:function(_32){var _33=this._listeners;for(var i=0,_34;_34=_33[i];i++){if(_34==_32){this.mxform.unlisten(_32);_33.splice(i,1);break;}}},capture:function(_35,evt,_36){var _37=_1.capture(_35,evt,_b.hitch(this,_36));this.addOnDestroy(_37.remove);},collect:function(_38,_39){_2.collect(_38,_39,this);},sequence:function(_3a,_3b){_2.sequence(_3a,_3b,this);},translate:function(str,_3c,_3d){return window.mx.ui.translate(this.declaredClass,str,_3c,_3d);},domData:function(){this.domData=_1.getScopedData();return this.domData.apply(this,arguments);},_getSuspendedAttr:function(){return this._suspended;},_setSuspendedAttr:function(_3e){var _3f=!!_3e;if(this._suspended!=_3f){this._suspended=_3f;var _40=_3f?"suspend":"resume";try{this[_40]();}catch(e){throw new Error(this.id+"."+_40+": "+e);}}},resume:function(){},suspend:function(){},checkDisabled:function(){return this.readOnly||this._disabled;},updateDisabled:function(_41){if(_41!=null){this._disabled=!!_41;}_41=this.checkDisabled();if(_41!=this._cachedDisabled){this._cachedDisabled=_41;var _42=_41?"disable":"enable";try{this[_42]();}catch(e){throw new Error(this.id+"."+_42+": "+e);}}},_getDisabledAttr:function(){return this._cachedDisabled;},_setDisabledAttr:function(_43){return this.updateDisabled(_43);},enable:function(){},disable:function(){},_setMxidAttr:function(_44){_8.set(this.domNode,"data-mendix-id",_44);},_setFocusIndexAttr:function(_45){if(_45!=null){_8.set(this.domNode,"focusindex",_45);}},_getLoadedAttr:function(){return this._loaded;},_setLoadedAttr:function(_46){this._loaded=!!_46;if(_46){var _47=this._loadCalls;while(_47.length){_47.shift()();}}},actLoaded:function(_48){this.set("loaded",true);_48&&_48();},addOnLoad:function(fnc){this._loaded?fnc():this._loadCalls.push(fnc);},addOnDestroy:function(fnc){this._destroyed?fnc():this._destroyCalls.push(fnc);},destroy:function(_49){this._beingDestroyed=true;try{this.uninitialize();}catch(e){throw new Error(this.id+".uninitialize: "+e);}function _4a(w){if(w.destroyRecursive){w.destroyRecursive(_49);}else{if(w.destroy){w.destroy(_49);}}};_a.forEach(this._connects,_b.hitch(this,"disconnect"));_a.forEach(this._supportingWidgets,_4a);if(this.domNode){_a.forEach(_6.findWidgets(this.domNode),_4a);}this.destroyRendering(_49);_6.remove(this.id);this._destroyed=true;},uninitialize:function(){if(this._loaded){var _4b=this._listeners,_4c=this._destroyCalls;while(_4b.length){this.mxform.unlisten(_4b.pop());}this.unsubscribeAll();while(_4c.length){_4c.shift().call(this);}}else{_4.error(this.id+".uninitialize: widget not loaded yet, check widget structure");this.addOnLoad(_b.hitch(this,function(){try{this.uninitialize();}catch(e){throw new Error(this.id+".unitialize: "+e);}}));}}});return _d;});