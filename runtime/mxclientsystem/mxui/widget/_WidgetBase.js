
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/_WidgetBase",["mxui/dom","mxui/widget","mxui/html/parser","mendix/lang","mendix/lib/MxContext","mendix/logger","dijit/_WidgetBase","dijit/registry","dojo/dom-attr","dojo/dom-geometry","dojo/_base/array","dojo/_base/lang","dojo/_base/declare","dijit/_base"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){var _e=_d(_7,{declaredClass:"mxui.widget._WidgetBase",mxid:"",uniqueid:"",mxform:null,mxcontext:null,doParse:true,readOnly:false,ignoreUpdates:false,autoLoad:true,_loaded:false,_destroyed:false,_cachedDisabled:false,_disabled:false,_loadCalls:null,_destroyCalls:null,_listeners:null,_subscriptions:null,"-chains-":{constructor:"after",uninitialize:"before"},constructor:function(_f,_10){this._loadCalls=[];this._destroyCalls=[];this._listeners=[];this._subscriptions=[];this.mxcontext=new _5();if(this.autoLoad){this.set("loaded",true);}},getTemplate:function(_11){return window.mx.ui.getTemplate(this.mxid,_11);},parseContent:function(_12,_13,_14){var _15={mxform:this.mxform,validator:this.validator,ignoreUpdates:this.ignoreUpdates};if(this.readOnly){_15.readOnly=true;}if(this.doParse){return _3[_14?"parseTopLevel":"parse"](_12||this.domNode,_c.mixin(_15,_13),this.uniqueid);}else{return [];}},getChildren:function(_16){if(_16){return _2.getDescendantWidgets(this.domNode);}else{return _8.findWidgets(this.domNode);}},resizeChildren:function(_17,_18){var _19=_8.findWidgets(_17);if(_19.length>1||_17.children.length>1){_18=true;}_b.forEach(_19,function(_1a){var _1b=_2.findNonPlaceholderParent(_1a.domNode);if(_1b===_17||_1b===_1a.mxform.domNode){if(typeof _1a.resize==="function"){if(_18){_1a.resize();}else{var box=_a.getContentBox(_17);_1a.resize({w:box.w,h:box.h});}}}});},applyContext:function(_1c,_1d){var _1e=this.mxcontext;if(!/reset/i.test(this.contextAction)){_1e.mixin(_1c);if(this.dropContext){for(var i=0,_1f;_1f=this.dropContext[i];i++){_1e.unsetContext(_1f);}}}else{if(this.preserveTrackObject){if(_1c){_1e.setObject(_1c.getTrackObject(),_1c.getTrackEntity(),_1c.getTrackId());}else{_1e.setObject(null);}}}if(typeof this.update=="function"){var _20=_1e.getObject(),_21=_1e.getTrackId(),_22=_c.hitch(this,function(obj){try{this.update(obj,_1d);}catch(e){throw new Error(this.id+".applyContext: "+e);}});if(_20){_22(_20);}else{if(_21){window.mx.data.get({guid:_21,callback:function(obj){if(!obj){_6.error(this.id+".applyContext: error while fetching object with guid "+_21);}_22(obj);},error:function(e){window.mx.onError(e);_22(null);}},this);}else{_22(null);}}}else{var _23=_8.findWidgets(this.domNode);this.passContext(_23,_1c,_1d);}},passContext:function(_24,_25,_26){if(typeof _25=="function"){_26=_25;_25=this.mxcontext;}else{_25=_25||this.mxcontext;}_2.applyContext(_24,_25,_c.hitch(this,_26));},subscribe:function(sub){if(this.ignoreUpdates){return;}var _27=window.mx.data.subscribe(sub,this);this._subscriptions.push(_27);return _27;},unsubscribe:function(_28){if(this.ignoreUpdates){return;}var _29=this._subscriptions;for(var i=0,_2a;_2a=_29[i];i++){if(_2a==_28){window.mx.data.unsubscribe(_28);_29.splice(i,1);break;}}},unsubscribeAll:function(){var _2b=this._subscriptions;while(_2b.length){window.mx.data.unsubscribe(_2b.pop());}},listen:function(_2c,_2d){var _2e=this.mxform.listen(_2c,_c.hitch(this,_2d));this._listeners.push(_2e);return _2e;},unlisten:function(_2f){var _30=this._listeners;for(var i=0,_31;_31=_30[i];i++){if(_31==_2f){this.mxform.unlisten(_2f);_30.splice(i,1);break;}}},capture:function(_32,evt,_33){var _34=_1.capture(_32,evt,_c.hitch(this,_33));this.addOnDestroy(_34.remove);},collect:function(_35,_36){_4.collect(_35,_36,this);},sequence:function(_37,_38){_4.sequence(_37,_38,this);},translate:function(str,_39,_3a){return window.mx.ui.translate(this.declaredClass,str,_39,_3a);},domData:function(){this.domData=_1.getScopedData();return this.domData.apply(this,arguments);},checkDisabled:function(){return this.readOnly||this._disabled;},updateDisabled:function(_3b){if(_3b!=null){this._disabled=!!_3b;}_3b=this.checkDisabled();if(_3b!=this._cachedDisabled){this._cachedDisabled=_3b;var _3c=_3b?"disable":"enable";try{this[_3c]();}catch(e){throw new Error(this.id+"."+_3c+": "+e);}}},_getDisabledAttr:function(){return this._cachedDisabled;},_setDisabledAttr:function(_3d){return this.updateDisabled(_3d);},enable:function(){},disable:function(){},_setMxidAttr:function(_3e){_9.set(this.domNode,"data-mendix-id",_3e);},_setFocusIndexAttr:function(_3f){if(_3f!=null){_9.set(this.domNode,"focusindex",_3f);}},_getLoadedAttr:function(){return this._loaded;},_setLoadedAttr:function(_40){this._loaded=!!_40;if(_40){var _41=this._loadCalls;while(_41.length){_41.shift()();}}},actLoaded:function(_42){this.set("loaded",true);_42&&_42();},addOnLoad:function(fnc){this._loaded?fnc():this._loadCalls.push(fnc);},addOnDestroy:function(fnc){this._destroyed?fnc():this._destroyCalls.push(fnc);},destroy:function(_43){this._beingDestroyed=true;try{this.uninitialize();}catch(e){throw new Error(this.id+".uninitialize: "+e);}function _44(w){if(w.destroyRecursive){w.destroyRecursive(_43);}else{if(w.destroy){w.destroy(_43);}}};_b.forEach(this._connects,_c.hitch(this,"disconnect"));_b.forEach(this._supportingWidgets,_44);if(this.domNode){_b.forEach(_8.findWidgets(this.domNode),_44);}this.destroyRendering(_43);_8.remove(this.id);this._destroyed=true;},destroyRendering:function(){var _45=this.domNode,_46=this.srcNodeRef;this.inherited(arguments,[true]);if(_45){_1.orphan(_45);}this.domNode=_45;this.srcNodeRef=_46;},uninitialize:function(){if(this._loaded){var _47=this._listeners,_48=this._destroyCalls;while(_47.length){this.mxform.unlisten(_47.pop());}this.unsubscribeAll();while(_48.length){_48.shift().call(this);}}else{_6.error(this.id+".uninitialize: widget not loaded yet, check widget structure");this.addOnLoad(_c.hitch(this,function(){try{this.uninitialize();}catch(e){throw new Error(this.id+".unitialize: "+e);}}));}}});return _e;});