
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/_WidgetBase",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.widget._WidgetBase");_1.declare("mxui.widget._WidgetBase",_2._WidgetBase,{mxid:"",mxform:null,mxcontext:null,doParse:true,readOnly:false,ignoreUpdates:false,autoLoad:true,_loaded:false,_destroyed:false,_cachedDisabled:false,_disabled:false,_suspended:false,_loadCalls:null,_destroyCalls:null,_listeners:null,_subscriptions:null,"-chains-":{constructor:"after",uninitialize:"before"},constructor:function(_4,_5){this._loadCalls=[];this._destroyCalls=[];this._listeners=[];this._subscriptions=[];this.mxcontext=new mendix.lib.MxContext();if(this.autoLoad){this.set("loaded",true);}},getTemplate:function(_6){return mx.ui.getTemplate(this.mxid,_6);},parseContent:function(_7,_8,_9){var _a={mxform:this.mxform,validator:this.validator,ignoreUpdates:this.ignoreUpdates};if(this.readOnly){_a.readOnly=true;}if(this.doParse||_9){return mxui.html.parser.parse(_7||this.domNode,_1.mixin(_a,_8));}else{return [];}},getChildren:function(_b){if(_b){return _1.query("[widgetid]",this.domNode).map(_2.byNode);}else{return _2.findWidgets(this.domNode);}},resizeChildren:function(_c,_d){var _e=_2.findWidgets(_c);if(_e.length>1||_c.children.length>1){_d=true;}_1.forEach(_e,function(_f){var _10=_f.domNode.parentNode;if(_10===_c||_10===_f.mxform.domNode){if(typeof _f.resize==="function"){if(_d){_f.resize();}else{var box=_1.contentBox(_c);_f.resize({w:box.w,h:box.h});}}}});},applyContext:function(_11,_12){var _13=this.mxcontext;if(!/reset/i.test(this.contextAction)){_13.mixin(_11);if(this.dropContext){for(var i=0,_14;_14=this.dropContext[i];i++){_13.unsetContext(_14);}}}else{if(this.preserveTrackObject){if(_11){_13.setObject(_11.getTrackObject(),_11.getTrackEntity(),_11.getTrackId());}else{_13.setObject(null);}}}if(typeof this.update=="function"){var _15=_13.getObject(),_16=_13.getTrackId(),_17=_1.hitch(this,function(obj){try{this.update(obj,_12);}catch(e){throw new Error(this.id+".applyContext: "+e);}});if(_15){_17(_15);}else{if(_16){mx.data.get({guid:_16,callback:function(obj){if(!obj){logger.error(this.id+".applyContext: error while fetching object with guid "+_16);}_17(obj);},error:function(e){mx.onError(e);_17(null);}},this);}else{_17(null);}}}else{var _18=_2.findWidgets(this.domNode);this.passContext(_18,_11,_12);}},passContext:function(_19,_1a,_1b){if(typeof _1a=="function"){_1b=_1a;_1a=this.mxcontext;}else{_1a=_1a||this.mxcontext;}var _1c=[];for(var i=0,_1d;_1d=_19[i];i++){if(_1d.applyContext){_1c.push(function(_1e){return function(cb){try{_1e.applyContext(_1a,cb);}catch(e){throw new Error(_1e.id+".applyContext: "+e);}};}(_1d));}else{var _1f=_2.findWidgets(_1d.domNode);this.passContext(_1f,_1a,_1b);}}this.collect(_1c,_1b);},subscribe:function(sub){if(this.ignoreUpdates){return;}var _20=mx.data.subscribe(sub,this);this._subscriptions.push(_20);return _20;},unsubscribe:function(_21){if(this.ignoreUpdates){return;}var _22=this._subscriptions;for(var i=0,_23;_23=_22[i];i++){if(_23==_21){mx.data.unsubscribe(_21);_22.splice(i,1);break;}}},unsubscribeAll:function(){var _24=this._subscriptions;while(_24.length){mx.data.unsubscribe(_24.pop());}},listen:function(_25,_26){var _27=this.mxform.listen(_25,_1.hitch(this,_26));this._listeners.push(_27);return _27;},unlisten:function(_28){var _29=this._listeners;for(var i=0,_2a;_2a=_29[i];i++){if(_2a==_28){this.mxform.unlisten(_28);_29.splice(i,1);break;}}},capture:function(_2b,evt,_2c){var _2d=mxui.dom.capture(_2b,evt,_1.hitch(this,_2c));this.addOnDestroy(_2d.remove);},collect:function(_2e,_2f){mendix.lang.collect(_2e,_2f,this);},sequence:function(_30,_31){mendix.lang.sequence(_30,_31,this);},translate:function(str,_32,_33){return mx.ui.translate(this.declaredClass,str,_32,_33);},domData:function(){this.domData=mxui.dom.getScopedData();return this.domData.apply(this,arguments);},_getSuspendedAttr:function(){return this._suspended;},_setSuspendedAttr:function(_34){var _35=!!_34;if(this._suspended!=_35){this._suspended=_35;var _36=_35?"suspend":"resume";try{this[_36]();}catch(e){throw new Error(this.id+"."+_36+": "+e);}}},resume:function(){},suspend:function(){},checkDisabled:function(){return this.readOnly||this._disabled;},updateDisabled:function(_37){if(_37!=null){this._disabled=!!_37;}_37=this.checkDisabled();if(_37!=this._cachedDisabled){this._cachedDisabled=_37;var _38=_37?"disable":"enable";try{this[_38]();}catch(e){throw new Error(this.id+"."+_38+": "+e);}}},_getDisabledAttr:function(){return this._cachedDisabled;},_setDisabledAttr:function(_39){return this.updateDisabled(_39);},enable:function(){},disable:function(){},_setMxidAttr:function(_3a){_1.attr(this.domNode,"data-mendix-id",_3a);},_setFocusIndexAttr:function(_3b){if(_3b!=null){_1.attr(this.domNode,"focusindex",_3b);}},_getLoadedAttr:function(){return this._loaded;},_setLoadedAttr:function(_3c){this._loaded=!!_3c;if(_3c){var _3d=this._loadCalls;while(_3d.length){_3d.shift()();}}},actLoaded:function(_3e){this.set("loaded",true);_3e&&_3e();},addOnLoad:function(fnc){this._loaded?fnc():this._loadCalls.push(fnc);},addOnDestroy:function(fnc){this._destroyed?fnc():this._destroyCalls.push(fnc);},destroy:function(_3f){this._beingDestroyed=true;try{this.uninitialize();}catch(e){throw new Error(this.id+".uninitialize: "+e);}function _40(w){if(w.destroyRecursive){w.destroyRecursive(_3f);}else{if(w.destroy){w.destroy(_3f);}}};_1.forEach(this._connects,_1.hitch(this,"disconnect"));_1.forEach(this._supportingWidgets,_40);if(this.domNode){_1.forEach(_2.findWidgets(this.domNode),_40);}this.destroyRendering(_3f);_2.registry.remove(this.id);this._destroyed=true;},uninitialize:function(){if(this._loaded){var _41=this._listeners,_42=this._destroyCalls;while(_41.length){this.mxform.unlisten(_41.pop());}this.unsubscribeAll();while(_42.length){_42.shift().call(this);}}else{logger.error(this.id+".uninitialize: widget not loaded yet, check widget structure");this.addOnLoad(_1.hitch(this,function(){try{this.uninitialize();}catch(e){throw new Error(this.id+".unitialize: "+e);}}));}}});mxui.widget.ready=function(_43,_44,_45){var _46=[];for(var i=0,_47;_47=_43[i];i++){if(_47.addOnLoad){_46.push(function(_48){return function(_49){_48.addOnLoad(_49);};}(_47));}}mendix.lang.collect(_46,_44,_45);};});