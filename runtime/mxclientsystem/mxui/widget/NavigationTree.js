
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/NavigationTree",["mxui/widget/_WidgetBase","mxui/mixin/_Stateful","mxui/dom","dojo/_base/event","dojo/dom-class","dojo/_base/array","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8){var $=_3.create;var _9=_8([_1,_2],{declaredClass:"mxui.widget.NavigationTree",menuID:"",buildRendering:function(){var _a=this._getMenu();this.domNode=$("div",{"class":"mx-navigationtree",tabindex:-1},$("div",{"class":"navbar-inner"},this._buildMenu(_a)));},postCreate:function(){var _b=this;this.on("a:click",function(e){_b.onClick(this);_4.stop(e);});},onClick:function(_c){var _d=this.domData(_c,"action");if(_d){if(typeof _d==="function"){_d();}else{window.mx.ui.execute(_d,{context:this.mxcontext});}}else{_5.toggle(_c.parentNode,"mx-navigationtree-collapsed");}},_buildMenu:function(_e){var _f=this.getState("expandedItems",[]),_10=$("ul"),_11;for(var i=0,_12;_12=_e[i];++i){if(_12.action){_11=$("li",this._makeAnchor(_12));}else{_11=$("li",{"class":"mx-navigationtree-has-items"},this._makeAnchor(_12),this._buildMenu(_12.items));if(_6.indexOf(_f,_12.id)==-1){_5.add(_11,"mx-navigationtree-collapsed");}}_10.appendChild(_11);}return _10;},_makeAnchor:function(_13){var _14=["a",{href:"#","class":"dropdown","id":_13.id}],_15;if(_13.icon){_14.push($("img",{src:window.mx.appUrl+_13.icon}));}_14.push(" "+_13.caption+" ");if(_13.items){_14.push($("span",{"class":"caret"}));}_15=$.apply(null,_14);if(_13.action){this.domData(_15,"action",_13.action);}return _15;},_getMenu:function(){function _16(_17,_18){_6.forEach(_17,function(_19,_1a){_19.id=_18+_1a;if(_19.items){_16(_19.items,_19.id+"-");}});};var _1b=_7.clone(window.mx.ui.getMenu(this.menuID));_16(_1b,this.menuID+"-");return _1b;},storeState:function(_1c){var _1d=[];_6.forEach(this.domNode.querySelectorAll("li.mx-navigationtree-has-items"),function(_1e){if(!_5.contains(_1e,"mx-navigationtree-collapsed")){_1d.push(_1e.firstChild.getAttribute("id"));}});_1c("expandedItems",_1d);}});return _9;});