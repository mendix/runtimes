/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/widget/_Popup",["mxui/widget/_WidgetBase","mxui/mixin/_Floatable","mxui/lib/Moveable","mxui/lib/Resizable","mxui/lib/popupManager","mxui/dom","dojo/window","dojo/dom-style","dojo/dom-geometry","dojo/_base/fx","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){var _d=_c([_1,_2],{delay:200,_mover:null,_resizer:null,_prevBox:null,_maximized:false,_visible:false,_minWidth:300,_minHeight:200,_margin:20,getLayerName:function(){return "popup";},getPositionName:function(){return "stack";},buildRendering:function(){this.capture(this.domNode,"mousedown",function(){_5.focus(this);});},postCreate:function(){this.createBackgroundIframe();this._mover=new _3(this.domNode,{handle:this._headerNode,margin:this._margin,delay:5});this.connect(this._mover,"onMoveStart",function(e){if(this._maximized){var _e=this._prevBox;this.resize({l:e.pageX-_e.w/2,w:_e.w,h:_e.h});}});_5.add(this);this._setDimensions({});},show:function(_f){_5.show(this,_f);this.connect(window.mx.ui,"resize",function(){this.resize(null,true);});},onBeforeShow:function(){this._visible=true;var _10=_6.getNodeExtents(this.domNode);this._minWidth+=_10.w;this._minHeight+=_10.h;if(this.resizable){this._resizer=new _4(this.domNode,{margin:this._margin,resizer:_b.hitch(this,"resize"),minWidth:this._minWidth,minHeight:this._minHeight});this.connect(this._headerNode,"dblclick",function(){this.maximize();});}},onShow:function(_11){if(this.delay){_a.fadeIn({node:this.domNode,duration:this.delay,onEnd:_11}).play();}else{_8.set(this.domNode,"opacity",1);_11();}},onAfterShow:function(){},hide:function(){_5.hide(this);},onHide:function(_12){if(this.delay){_a.fadeOut({node:this.domNode,duration:this.delay,onEnd:_12}).play();}else{_12();}},center:function(){var _13=this.domNode,box=_9.getMarginBox(_13),_14=_7.getBox();_8.set(_13,{top:Math.max(0,0.7*(_14.h/2-box.h/2))+"px",left:Math.max(0,_14.w/2-box.w/2)+"px"});},maximize:function(_15){if(this._maximized&&!_15){this._maximized=false;this.resize(this._prevBox);}else{var _16=_7.getBox(),box=_15?this._prevBox:_9.getMarginBox(this.domNode);this.resize({t:0,l:0,w:_16.w,h:_16.h});this._prevBox=box;this._maximized=true;}},_setDimensions:function(box){var _17=this._getMaximumSize(),_18=_b.mixin(_9.getMarginBox(this.domNode),box);if(_18.w>_17.w){box.w=_17.w;}if(_18.h>_17.h){box.h=_17.h;}if(box.w){this.domNode.style.width=box.w+"px";}if(this._visible){if(box.h){this.domNode.style.height=box.h+"px";}if(box.w||box.h){this.layout();}}},resize:function(box,_19){if(!this._visible){return;}if(this._maximized){if(_19){this.maximize(true);return;}else{this._maximized=false;}}box=box||{};this._setDimensions(box);if(box.l){this.domNode.style.left=box.l+"px";}if(box.t){this.domNode.style.top=box.t+"px";}this.moveIntoView();},moveIntoView:function(){_6.moveIntoView(this.domNode,this._margin);},uninitialize:function(){this._mover.destroy();if(this._resizer){this._resizer.destroy();}},_getMaximumSize:function(){var _1a=_7.getBox();return {w:_1a.w-this._margin*2,h:_1a.h-this._margin*2};}});return _d;});