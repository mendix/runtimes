
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/_Popup",["dojo","dijit","dojox","dojo/require!mxui/lib/Moveable,mxui/lib/Resizable"],function(_1,_2,_3){_1.provide("mxui.widget._Popup");_1.require("mxui.lib.Moveable");_1.require("mxui.lib.Resizable");_1.declare("mxui.widget._Popup",mxui.widget._WidgetBase,{modal:false,delay:100,_layers:[{index:100,stack:[]},{index:1000,stack:[]}],_mover:null,_resizer:null,_prevBox:null,_maximized:false,_visible:false,_minWidth:300,_minHeight:150,_margin:10,_underlay:new mxui.widget.Underlay(),postCreate:function(){this._mover=new mxui.lib.Moveable(this.domNode,{handle:this._headerNode,margin:this._margin,delay:5});this.connect(this._mover,"onMoveStart",function(e){if(this._maximized){var _4=this._prevBox;this.resize({l:e.pageX-_4.w/2,w:_4.w,h:_4.h});}});if(this.resizable){this._resizer=new mxui.lib.Resizable(this.domNode,{margin:this._margin,resizer:_1.hitch(this,"resize"),minWidth:this._minWidth,minHeight:this._minHeight});this.connect(this._headerNode,"dblclick",function(){this.maximize();});}var _5=function(){this.resize(null,true);};this.connect(this.mxform,"resize",_5);this.connect(mx.ui,"resize",_5);this._layers[this._layerId].stack.push(this);},center:function(){var _6=this.domNode,_7=_1.contentBox(_6),_8=_2.getViewport();_1.style(_6,{top:Math.max(0,0.7*(_8.h/2-_7.h/2))+"px",left:Math.max(0,_8.w/2-_7.w/2)+"px"});},maximize:function(_9){if(this._maximized&&!_9){this._maximized=false;this.resize(this._prevBox);}else{var _a=_2.getViewport(),_b=_9?this._prevBox:_1.marginBox(this.domNode);this.resize({t:0,l:0,w:_a.w,h:_a.h});this._prevBox=_b;this._maximized=true;}},resize:function(_c,_d){if(!this._visible){return;}if(this._maximized){if(_d){this.maximize(true);return;}else{this._maximized=false;}}_c=_c||{};var _e=this._margin,_f=_2.getViewport(),_10=_f.w-_e*2,_11=_f.h-_e*2,_12=_1.delegate(_1.contentBox(this.domNode),_c);if(_12.w>_10){_c.w=_12.w=_10;}if(_12.w<this._minWidth){_c.w=this._minWidth;}if(_12.h>_11){_c.h=_12.h=_11;}if(_12.h<this._minHeight){_c.h=this._minHeight;}for(var i in _c){_1.contentBox(this.domNode,_c);if("h" in _c){this.layout();}break;}mxui.dom.moveIntoView(this.domNode,_e);},onShow:function(){this._visible=true;if(this.modal){this._underlay.show();}},onHide:function(){this._visible=false;if(this.modal){this._underlay.hide();}this.focusPrevious();},stack:function(){var _13=this._layers[this._layerId].stack,_14=_2.getViewport().w*0.2,_15=50,_16=[],_17=0,gap=20;_1.some(_13,function(_18){var _19=_14+(_17*gap)-(0.5*gap),_1a=_19+gap,_1b=true;_17++;_1.some(_13,function(_1c){var box=_1.marginBox(_1c.domNode);if(_19<box.l&&box.l<_1a){_16.push(box);_1b=false;return true;}});return _1b;});var _1d=gap*_16.length;_1.style(this.domNode,{left:_14+_1d+"px",top:_15+_1d+"px"});},focus:function(){var _1e=this._layers[this._layerId],_1f=_1e.stack,_20=_1e.stack=[],_21=_1e.index;_1.forEach(_1f,function(_22){if(_22.id!=this.id){_20.push(_22);_22.deactivate&&_22.deactivate();}else{_22.activate&&_22.activate();}},this);_20.sort(function(a,b){return a.domNode.style.zIndex-b.domNode.style.zIndex;});_20.push(this);for(var x=0,_23;_23=_20[x];x++){_21=_21+2;_23.domNode.style.zIndex=_21;}if(this.modal){this._underlay.domNode.style.zIndex=_21-1;}},focusPrevious:function(){var id=this._layerId;do{var _24=this._layers[id].stack;for(var i=_24.length-1;i>=0;i--){if(_24[i]._visible){_24[i].focus();return;}}}while(id-->0);},uninitialize:function(){this._mover.destroy();if(this._resizer){this._resizer.destroy();}var _25=this._layers[this._layerId].stack;_25.splice(_1.indexOf(_25,this),1);}});});