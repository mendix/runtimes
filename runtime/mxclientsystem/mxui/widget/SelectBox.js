
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/SelectBox",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.widget.SelectBox");_1.declare("mxui.widget.SelectBox",mxui.widget._Button,{caption:"Select item",items:null,_dropDown:null,_isVisible:false,_docMouseDown:null,_focusBox:null,buildRendering:function(){this.inherited(arguments);_1.place(mxui.dom.create("div",{"class":"mx-selectbox-caret-wrapper"},mxui.dom.create("span",{"class":"caret"})),this.domNode,"first");this.domNode.setAttribute("class","form-control mx-selectbox");this.connect(this.domNode,"keydown","_buttonKeyDown");this.connect(this.domNode,"mouseup","_toggleDropDown");this.connect(this.mxform,"onBeforeHide","_hideDropDown");this._createDropDown();},_buttonKeyDown:function(e){if(e.keyCode===_1.keys.DOWN_ARROW){this._showDropDown();e.preventDefault();}},_toggleDropDown:function(){if(this._isVisible){this._hideDropDown();}else{this._showDropDown();}},_showDropDown:function(){if(this._isVisible){return;}this._isVisible=true;var _4=_1.position(this.domNode),_5={top:_4.y+_4.h+"px"};if(mx.ui.isRtl()){_5.right=_2.getViewport().w-_4.x-_4.w+"px";}else{_5.left=_4.x+"px";}_1.style(this._dropDown,_5);document.body.appendChild(this._dropDown);this._docMouseDown=this.connect(document,"mousedown",function(e){if(e.target!=this.domNode){this._hideDropDown();}});mxui.wm.focus.put(this._dropDown.firstChild);},_hideDropDown:function(){if(!this._isVisible){return;}this._isVisible=false;this._docMouseDown.remove();mxui.dom.orphan(this._dropDown);},_createDropDown:function(){var _6=mxui.dom.create("ul",{"class":"mx-dropdown dropdown-menu"}),_7=this;this.own(_1.on(_6,"li:click",function(e){_7._selectItem(this);}));this.connect(_6,"mousedown",function(e){e.stopPropagation();});this._dropDown=_6;_6.style.display="block";},_selectItem:function(_8){var _9=this.items[mxui.dom.data(_8,"index")];_9.checkbox.checked=_9.selected=!_9.selected;_1.toggleClass(_8,"selected");mxui.wm.focus.put(_8);this.set("caption",this._getCaption());},_getCaption:function(){var _a=[];_1.forEach(this.items,function(_b){if(_b.checkbox.checked){_a.push(_b.caption);}});if(_a.length===0){return "";}else{if(_a.length==1){return _a[0];}else{return this.translate("itemsSelected",[_a.length]);}}},_setItemsAttr:function(_c){this.items=_c;_1.empty(this._dropDown);if(this._focusBox){this._focusBox.destroy();}this._focusBox=mxui.wm.focus.addBox(this._dropDown);this._focusBox.pressed({DOWN_ARROW:this._focusBox.FOCUS_NEXT,UP_ARROW:this._focusBox.FOCUS_PREV,ESCAPE:_1.hitch(this,function(e){this._hideDropDown();mxui.wm.focus.put(this.domNode);}),SPACE:_1.hitch(this,function(e){if(e.target.nodeName!="INPUT"){this._selectItem(e.target);}}),ENTER:_1.hitch(this,function(e){this._hideDropDown();mxui.wm.focus.put(this.domNode);})});_1.forEach(this.items,function(_d,_e){var $=mxui.dom.create,_f=_d.checkbox=$("input",{type:"checkbox"}),_10=$("li",{tabIndex:-1},_f," ",$("label",_d.caption));if(_d.selected){_f.checked=true;_1.addClass(_10,"selected");}mxui.dom.data(_10,"index",_e);this._focusBox.add(_10);this._dropDown.appendChild(_10);},this);this.set("caption",this._getCaption());},_getValueAttr:function(){var _11=[];_1.forEach(this.items,function(_12){if(_12.checkbox.checked){_11.push(_12.value);}});return _11;},_setValueAttr:function(_13){if(typeof _13=="string"){_13=[_13];}_1.forEach(this.items,function(_14){_14.checkbox.checked=_1.indexOf(_13,_14.value)>=0;});this.set("caption",this._getCaption());},uninitialize:function(){this._hideDropDown();_1.forEach(this._dropDown.children,function(_15){mxui.dom.data(_15,null);});if(this._focusBox){this._focusBox.destroy();}}});});