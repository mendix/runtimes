/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/widget/NumberInput",["mxui/widget/_FormWidget","mxui/dom","mendix/logger","mendix/validator","dojo/i18n","dojo/_base/kernel","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8){var $=_2.create;var _9=_8(_1,{declaredClass:"mxui.widget.NumberInput",formatted:false,precision:"",placeholder:"",_type:"",_opts:null,_numloc:null,_mouseupcon:null,_previousValue:"",_mouseDown:false,buildRendering:function(){this.editNode=$("input",{"class":"form-control",type:"text",placeholder:this.placeholder});var _a=window.mx.meta.getEntity(this._entity);this._type=_a.getAttributeType(this._attribute);this._opts={groups:this.formatted};if(this.precision!==""){this._opts.places=this.precision;}this._locale=_5.getLocalization("dojo.cldr","number",_6.locale);this.inherited(arguments);},connectEvents:function(){this.connect(this.editNode,"focus","onFocus");this.connect(this.editNode,"blur","onBlur");this.connect(this.editNode,"mousedown","onMouseDown");this.connect(this.editNode,"keydown","onKeyDown");},_getValueAttr:function(){return window.mx.parser.parseValue2(this.editNode.value,this._type,this._opts);},_setValueAttr:function(_b){var _c=window.mx.parser.formatValue(_b,this._type,this._opts);this.editNode.value=_c;this.readNode.innerHTML=_c||"&nbsp;";this._previousValue=this.get("value");},_match:function(_d,_e,_f){if(_d==_e){return Math.min(_d.length,_f);}var _10=0,len=Math.min(_e.length,_f),_11,_12;for(var i=0;i<len&&_10<_d.length;++i){_11=_e[i];_12=_d[_10];if(_11==_12){++_10;}}return _10;},onMouseDown:function(){var _13=this,_14,_15;this._mouseDown=true;var _16=function(){_13._mouseDown=false;_13.disconnect(_15);_13.disconnect(_14);};_14=this.connect(document,"mouseup",_16);_15=this.connect(window,"blur",function(){_16();this._disconnectFocusMouseUp();});},onFocus:function(){this.handleEvent("focus");var _17=this.editNode,_18=_17.value,_19=window.mx.parser.parseValue2(_18,this._type);if(_19===null){return;}var _1a=_18.split(this._locale.group).join("");if(_1a!=_18){setTimeout(_7.hitch(this,function(){this._disconnectFocusMouseUp();var sel=_2.getSelection(_17);if(sel.start===0&&sel.end==_18.length){_17.value=_1a;_2.selectTextRange(_17,0,_1a.length);}else{if(this._mouseDown){this._mouseupcon=this.connect(document,"mouseup",function(){setTimeout(_7.hitch(this,function(){sel=_2.getSelection(_17);_17.value=_1a;var _1b=this._match(_1a,_18,sel.start),end=this._match(_1a,_18,sel.end);_2.selectTextRange(_17,_1b,end);}),0);this._disconnectFocusMouseUp();});}else{_17.value=_1a;}}}),0);}},onKeyDown:function(_1c){if(_1c.keyCode===110){_1c.preventDefault();var _1d=this._locale["decimal"];_2.insertAtCaret(this.editNode,_1d);}},onBlur:function(){var _1e=this.get("value");if(_1e===null){this.onChange();}else{var _1f=_1e===""?this._previousValue==="":(this._previousValue!==""&&_1e.eq(this._previousValue));if(!_1f){this.onChange();}else{this.set("value",this._previousValue);}}this.handleEvent("blur");},validate:function(){var _20=this.inherited(arguments),_21=this.get("value");if(_20!=null){return _20;}else{if(_21==null){return window.mx.ui.translate("mendix.lib.Validations",this.getType()=="Currency"?"invalid_currency":"invalid_number");}else{return window.mx.ui.validate(_21,this.getType());}}},_disconnectFocusMouseUp:function(){if(this._mouseupcon){this.disconnect(this._mouseupcon);this._mouseupcon=null;}}});return _9;});