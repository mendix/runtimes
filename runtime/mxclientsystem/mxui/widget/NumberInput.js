
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/NumberInput",["dojo","dijit","dojox","dojo/require!mxui/widget/_FormWidget"],function(_1,_2,_3){_1.provide("mxui.widget.NumberInput");_1.require("mxui.widget._FormWidget");_1.declare("mxui.widget.NumberInput",mxui.widget._FormWidget,{formatted:false,precision:"",placeholder:"",_type:"",_opts:null,_numloc:null,_mouseupcon:null,buildRendering:function(){var $=mxui.dom.create;this.editNode=$("input",{"class":"form-control",type:"text",placeholder:this.placeholder});this.readNode=$("label");var _4=mx.meta.getEntity(this._entity);this._type=_4.getAttributeType(this._attribute);this._opts={groups:this.formatted};if(this.precision!==""){this._opts.places=this.precision;}this._numloc=_1.i18n.getLocalization("dojo.cldr","number");this.inherited(arguments);},connectEvents:function(){this.connect(this.editNode,"focus","onFocus");this.connect(this.editNode,"blur","onBlur");},_getValueAttr:function(){var _5=this.editNode.value.replace(this._numloc.group,"","g").replace(this._numloc.decimal,".");var _6=mx.parser.parseValue(_5,this._type,{locale:"en"});return isNaN(_6)?null:_6;},_setValueAttr:function(_7){var _8=mx.parser.formatValue(_7,this._type,this._opts);this.editNode.value=_8;this.readNode.innerHTML=_8||"&nbsp;";},_match:function(_9,_a,_b){if(_9==_a){return Math.min(_9.length,_b);}var _c=0,_d=Math.min(_a.length,_b),_e,_f;for(var i=0;i<_d&&_c<_9.length;++i){_e=_a[i];_f=_9[_c];if(_e==_f){++_c;}}return _c;},onFocus:function(){this.handleEvent("focus");var _10=this.editNode,_11=_10.value,_12=mx.parser.parseValue(_11,this._type);if(isNaN(_12)){return;}var _13=_11.replace(this._numloc.group,"","g");if(_13!=_11){setTimeout(_1.hitch(this,function(){this._disconnectMouseUp();var sel=mxui.dom.getSelection(_10);if(sel.start===0&&sel.end==_11.length){_10.value=_13;mxui.dom.selectTextRange(_10,0,_13.length);}else{this._mouseupcon=this.connect(_10,"mouseup",function(){setTimeout(_1.hitch(this,function(){sel=mxui.dom.getSelection(_10);_10.value=_13;var _14=this._match(_13,_11,sel.start),end=this._match(_13,_11,sel.end);mxui.dom.selectTextRange(_10,_14,end);}),0);this._disconnectMouseUp();});}},0));}},onBlur:function(){this._disconnectMouseUp();this.onChange();this.handleEvent("blur");},validate:function(){var _15=this.inherited(arguments),_16=this.get("value");if(_15!=null){return _15;}else{if(mendix.lang.numberTooBig(_16)){return mx.ui.translate("mendix.lib.Validations","number_too_big");}else{if(_16==null){return mx.ui.translate("mendix.lib.Validations",this.getType()=="Currency"?"invalid_currency":"invalid_number");}else{if(/Integer|Long|AutoNumber/.test(this.getType())&&_16%1){return mx.ui.translate("mendix.lib.Validations","invalid_number");}}}}},_disconnectMouseUp:function(){if(this._mouseupcon){this.disconnect(this._mouseupcon);this._mouseupcon=null;}}});});