/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
require({cache:{"url:mxui/widget/templates/MxInlineEditor.html":"<div class=\"MxInlineEditor\">\n\t<form class=\"inlineEditBox\" style=\"display: none\" dojoAttachPoint=\"form\" onsubmit=\"return false;\">\n\t\t<input type=\"text\" dojoAttachPoint=\"readonly\" style=\"display: none;\" class=\"inlineEditBox_readOnly\"/>\n\t\t<input type=\"text\" dojoAttachPoint=\"enumtext\" style=\"display: none;\" class=\"inlineEditBox_focusEnum\"/>\n\t\t<input type=\"text\" dojoAttachPoint=\"text\" style=\"display: none;\" class=\"inlineEditBox_editable\"/>\n\t\t<textarea dojoAttachPoint=\"textarea\" style=\"display: none;\" class=\"inlineEditBox_editable\"></textarea>\n\t\t<select type=\"select\" dojoAttachPoint=\"select\" style=\"display: none;\" class=\"inlineEditBox_selectbox\" />\n\t</form>\n</div>\n"}});define("mxui/widget/MxInlineEditor",["mxui/widget/_WidgetBase","mxui/mixin/_Templated","mxui/dom","mendix/logger","dojo/sniff","dojo/_base/event","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/i18n","dojo/_base/kernel","dojo/_base/declare","dojo/text!mxui/widget/templates/MxInlineEditor.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e){var _f=function(_10,_11){return (parseInt(_10.getAttribute(_11)));};var _12=function(_13,_14){return _13.getAttribute(_14);};var _15=_d([_1,_2],{declaredClass:"mxui.widget.MxInlineEditor",domNode:null,form:null,text:null,enumtext:null,select:null,minWidth:40,minHeight:200,templateString:_e,textValue:"",targetNode:null,_options:null,_nodeList:[],_status:"inactive",_previousValue:"",_editingmode:"text",constructor:function(){this.boolOptions={};this.boolOptions[window.mx.ui.translate("mxui.widget.DataGrid","true")]="true";this.boolOptions[window.mx.ui.translate("mxui.widget.DataGrid","false")]="false";this._locale=_b.getLocalization("dojo.cldr","number",_c.locale);},postCreate:function(){this._nodeList=[this.text,this.select,this.readonly,this.enumtext];this.connect(document.body,"onkeydown","eventOnKeyDown");this.connect(this.form,"onsubmit","eventOnSubmit");this.connect(this.form,"onclick","eventOnClick");this.connect(this.select,"onclick","selectClicked");this.connect(this.text,"keydown","onKeyDown");},selectClicked:function(e){_6.stop(e);return false;},_hideNodes:function(){for(var i=0;i<this._nodeList.length;i++){this._nodeList[i].style.display="none";}},editNode:function(_16,_17,_18){this._options=_18;this._editingmode=_17.toLowerCase();var _19=this.targetNode&&this.targetNode.parentNode;if(_19){this.targetNode.style.display="";_7.setSelectable(_19,false);}this.targetNode=_16;this._hideNodes();var td=this.targetNode.parentNode;td.appendChild(this.form);_7.setSelectable(td,true);this.textValue=_3.unescapeString(this.targetNode.innerHTML);if(this.textValue==="&nbsp;"){this.textValue="";}if(this.textValue.length===0){this.targetNode.innerHTML="&nbsp;";}this._previousValue=this.textValue;this.setupEditNode();},setStyleFromTarget:function(_1a){_1a.value=_a.trim(this.textValue);if(!_5("ie")){_1a.style.fontSize=_f(this.targetNode,"font-size");_1a.style.fontWeight=_12(this.targetNode,"font-weight");_1a.style.fontStyle=_12(this.targetNode,"font-style");}var bb=_9.getMarginBox(this.targetNode);_1a.style.width="100%";return bb;},setupTextNode:function(){this.text.style.textAlign=this.targetNode.parentNode.style.textAlign;var ee=this.text;ee.value=_a.trim(this.textValue);ee.style.display="";var _1b=this.setStyleFromTarget(ee);this.form.style.display="";this.targetNode.style.display="none";try{ee.select();ee.focus();ee.setAttribute("readonly","readonly");}catch(e){}},setupEditNode:function(){switch(this._editingmode){case "text":case "date":this.setupTextNode();break;case "reference":case "boolean":case "enum":this.setupEnumNode();break;case "readonly":this.setupReadOnlyNode();break;}this._status="ready";},setupEnumNode:function(){this.setStyleFromTarget(this.enumtext);this.setStyleFromTarget(this.select);this.enumtext.style.display="";this.enumtext.value=this._options.items[this._options.selected];this.enumtext.setAttribute("readonly","readonly");_3.setSelectOptions(this.select,this._options.items,this._options.selected);this.form.style.display="";this.targetNode.style.display="none";try{this.enumtext.select();this.enumtext.focus();}catch(e){}},setupReadOnlyNode:function(){this.setStyleFromTarget(this.readonly);this.targetNode.style.display="none";this.readonly.style.display="";this.readonly.value=this.textValue;this.form.style.display="";this.readonly.focus();this.readonly.setAttribute("readonly","readonly");},undoChanges:function(){if(this._status==="active"||this._status==="ready"){if(this.targetNode){this.targetNode.innerHTML=this._previousValue;}if((this._editingmode==="enum")||(this._editingmode==="reference")||this._editingmode==="boolean"){_3.selectOptionByText(this.select,this._previousValue);}else{if(this._editingmode==="readonly"){}else{this.text.value=_3.unescapeString(this._previousValue);}}}},startEditing:function(str){switch(this._editingmode){case "date":case "text":_8.replace(this.text,"inlineeditbox_editable");this.text.removeAttribute("readonly");if(str){this.text.value=_3.unescapeString(str);}try{this.text.select();this.text.focus();this._status="active";}catch(e){this.endEdit();}break;case "boolean":case "reference":case "enum":this.enumtext.style.display="none";this.select.style.display="";this.select.removeAttribute("readonly");this.select.focus();this._status="active";break;case "readonly":this._status="ready";break;default:break;}},focusOnNode:function(){switch(this._editingmode){case "date":case "text":this.text.focus();break;case "boolean":case "reference":case "enum":this.select.focus();break;}},stopEditing:function(){switch(this._editingmode){case "text":case "date":this.text.setAttribute("readonly","readonly");break;case "boolean":case "reference":case "enum":this.select.setAttribute("readonly","readonly");break;case "readonly":break;default:break;}this._status="ready";},endEdit:function(){if(this._status==="ready"||this._status==="active"){this.domNode.appendChild(this.form);if(this.targetNode){this.targetNode.style.display="";}this._status="inactive";}},eventOnClick:function(){if(this._status==="ready"){this.startEditing();}},eventOnKeyDown:function(e){this.eventKeyHandler(e);},onKeyDown:function(_1c){if(this._options&&this._options.hasDecimalPoint&&_1c.keyCode===110){_1c.preventDefault();var _1d=this._locale.decimal;_3.insertAtCaret(this.text,_1d);}},hasChanges:function(){if(this._editingmode==="readonly"||this._status==="inactive"){return false;}var _1e="";switch(this._editingmode){case "boolean":case "reference":case "enum":_1e=_3.getSelectedText(this.select);break;default:_1e=this.text.value;break;}return (this._previousValue!=_1e);},getValue:function(){if((this._editingmode==="enum")||(this._editingmode==="reference")||this._editingmode==="boolean"){this.targetNode.innerHTML=_3.getSelectedText(this.select);return (this.textValue=_3.getSelectedValue(this.select));}else{if(this._editingmode==="readonly"){return false;}else{this.textValue=this.text.value;_3.text(this.targetNode,this.textValue);return this.textValue;}}},getEditorStatus:function(){return this._status;},isActive:function(){return this._status==="active";},isInActive:function(){return this._status==="inactive";},isReady:function(){return this._status==="ready";},eventKeyHandler:function(){},eventOnSubmit:function(){return false;}});return _15;});