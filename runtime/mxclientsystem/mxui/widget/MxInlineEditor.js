
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/MxInlineEditor",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.widget.MxInlineEditor");mxui.widget.declare("mxui.widget.MxInlineEditor",{mixins:[_2._TemplatedMixin],inputargs:[],constructor:function(){this.templateString=_1.cache("mxui.widget","templates/MxInlineEditor.html","<div class=\"MxInlineEditor\">\n\t<form class=\"inlineEditBox\" style=\"display: none\" dojoAttachPoint=\"form\" onsubmit=\"return false;\">\n\t\t<input type=\"text\" dojoAttachPoint=\"readonly\" style=\"display: none;\" class=\"inlineEditBox_readOnly\"/>\n\t\t<input type=\"text\" dojoAttachPoint=\"enumtext\" style=\"display: none;\" class=\"inlineEditBox_focusEnum\"/>\n\t\t<input type=\"text\" dojoAttachPoint=\"text\" style=\"display: none;\" class=\"inlineEditBox_editable\"/>\n\t\t<textarea dojoAttachPoint=\"textarea\" style=\"display: none;\" class=\"inlineEditBox_editable\"></textarea>\n\t\t<select type=\"select\" dojoAttachPoint=\"select\" style=\"display: none;\" class=\"inlineEditBox_selectbox\" />\n\t</form>\n</div>\n");this.domNode=null;this.form=null;this.text=null;this.textarea=null;this.enumtext=null;this.select=null;this.minWidth=40;this.minHeight=200;this.textValue="";this.targetNode=null;this.boolOptions={};this.boolOptions[mx.ui.translate("mxui.widget.DataGrid","true")]="true";this.boolOptions[mx.ui.translate("mxui.widget.DataGrid","false")]="false";var _4=null;var _5=[];var _6="inactive";var _7="";var _8="text";this.postCreate=function(){_5=[this.text,this.textarea,this.select,this.readonly,this.enumtext];this.connect(document.body,"onkeydown","eventOnKeyDown");this.connect(this.form,"onsubmit","eventOnSubmit");this.connect(this.form,"onclick","eventOnClick");this.connect(this.select,"onclick","selectClicked");this.loaded();};this.selectClicked=function(e){_1.stopEvent(e);return false;};var _9=function(){for(var i=0;i<_5.length;i++){_5[i].style.display="none";}};this.editNode=function(_a,_b,_c){_4=_c;_8=_b.toLowerCase();var _d=this.targetNode&&this.targetNode.parentNode;if(_d){this.targetNode.style.display="";_1.setSelectable(_d,false);}this.targetNode=_a;_9();var td=this.targetNode.parentNode;td.appendChild(this.form);_1.setSelectable(td,true);this.textValue=mxui.html.sanitizeHTMLString(this.targetNode.innerHTML);if(this.textValue=="&nbsp;"){this.textValue="";}if(this.textValue.length==0){this.targetNode.innerHTML="&nbsp;";}_7=this.textValue;this.setupEditNode();};var _e=function(_f,_10){return (parseInt(_f.getAttribute(_10)));};var _11=function(_12,_13){return _12.getAttribute(_13);};this.setStyleFromTarget=function(_14){_14.value=_1.string.trim(this.textValue);if(!_1.isIE){_14.style.fontSize=_e(this.targetNode,"font-size");_14.style.fontWeight=_11(this.targetNode,"font-weight");_14.style.fontStyle=_11(this.targetNode,"font-style");}var bb=_1.marginBox(this.targetNode);_14.style.width="100%";return bb;};this.setupTextNode=function(_15){this.text.style.textAlign=this.targetNode.parentNode.style.textAlign;var ee=this.text;ee.value=_1.string.trim(this.textValue);var _16=this.setStyleFromTarget(ee);if(_8=="textarea"){ee.style.display="block";ee.style.height=Math.max(_16.height,this.minHeight)+"px";}else{ee.style.display="";}this.form.style.display="";this.targetNode.style.display="none";try{ee.select();ee.focus();ee.setAttribute("readonly","readonly");}catch(e){}};this.setupEditNode=function(e){switch(_8){case "text":case "textarea":case "date":this.setupTextNode();break;case "reference":case "boolean":case "enum":this.setupEnumNode();break;case "readonly":this.setupReadOnlyNode();break;default:break;}_6="ready";};this.setupEnumNode=function(_17){this.setStyleFromTarget(this.enumtext);this.setStyleFromTarget(this.select);this.enumtext.style.display="";this.enumtext.value=_4.items[_4.selected];this.enumtext.setAttribute("readonly","readonly");mxui.dom.setSelectOptions(this.select,_4.items,_4.selected);this.form.style.display="";this.targetNode.style.display="none";try{this.enumtext.select();this.enumtext.focus();}catch(e){}};this.setupReadOnlyNode=function(_18){this.setStyleFromTarget(this.readonly);this.targetNode.style.display="none";this.readonly.style.display="";this.readonly.value=this.textValue;this.form.style.display="";this.readonly.focus();this.readonly.setAttribute("readonly","readonly");};this.undoChanges=function(){if(_6=="active"||_6=="ready"){this.targetNode&&(this.targetNode.innerHTML=_7);if((_8=="enum")||(_8=="reference")||_8=="boolean"){mxui.dom.selectOptionByText(this.select,_7);}else{if(_8=="readonly"){}else{this.text.value=mxui.html.sanitizeHTMLString(_7);}}}};this.startEditing=function(str){switch(_8){case "date":case "text":case "textarea":_1.replaceClass(this.text,"inlineeditbox_editable");this.text.removeAttribute("readonly");if(str){this.text.value=mxui.html.sanitizeHTMLString(str);}try{this.text.select();this.text.focus();_6="active";}catch(e){this.endEdit();}break;case "boolean":case "reference":case "enum":this.enumtext.style.display="none";this.select.style.display="";this.select.removeAttribute("readonly");this.select.focus();_6="active";break;case "readonly":_6="ready";break;default:break;}};this.focusOnNode=function(){switch(_8){case "date":case "text":case "textarea":this.text.focus();break;case "boolean":case "reference":case "enum":this.select.focus();break;}};this.stopEditing=function(){switch(_8){case "text":case "textarea":case "date":this.text.setAttribute("readonly","readonly");break;case "boolean":case "reference":case "enum":this.select.setAttribute("readonly","readonly");break;case "readonly":break;default:break;}_6="ready";};this.endEdit=function(){if(_6=="ready"||_6=="active"){this.domNode.appendChild(this.form);this.targetNode&&(this.targetNode.style.display="");_6="inactive";}};this.eventOnClick=function(e){if(_6=="ready"){this.startEditing();}};var _19=_1.fixEvent;this.eventOnKeyDown=function(e){this.eventKeyHandler(e);};this.hasChanges=function(){if(_8=="readonly"||_6=="inactive"){return false;}var _1a="";switch(_8){case "boolean":case "reference":case "enum":_1a=mxui.dom.getSelectedText(this.select);break;default:_1a=mxui.html.sanitizeHTMLString(this.text.value);break;}return (_7!=_1a);};this.getValue=function(){if((_8=="enum")||(_8=="reference")||_8=="boolean"){this.targetNode.innerHTML=mxui.dom.getSelectedText(this.select);return (this.textValue=mxui.dom.getSelectedValue(this.select));}else{if(_8=="readonly"){return false;}else{this.textValue=mxui.html.sanitizeHTMLString(this.text.value);mxui.html.setContent(this.targetNode,this.textValue);return this.textValue;}}};this.getEditorStatus=function(){return _6;};this.isActive=function(){return (_6=="active");};this.isInActive=function(){return (_6=="inactive");};this.isReady=function(){return (_6=="ready");};this.eventKeyHandler=function(e){};this.eventOnSubmit=function(){return false;};}});});