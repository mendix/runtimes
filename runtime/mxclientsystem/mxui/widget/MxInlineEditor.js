
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
require({cache:{"url:mxui/widget/templates/MxInlineEditor.html":"<div class=\"MxInlineEditor\">\n\t<form class=\"inlineEditBox\" style=\"display: none\" dojoAttachPoint=\"form\" onsubmit=\"return false;\">\n\t\t<input type=\"text\" dojoAttachPoint=\"readonly\" style=\"display: none;\" class=\"inlineEditBox_readOnly\"/>\n\t\t<input type=\"text\" dojoAttachPoint=\"enumtext\" style=\"display: none;\" class=\"inlineEditBox_focusEnum\"/>\n\t\t<input type=\"text\" dojoAttachPoint=\"text\" style=\"display: none;\" class=\"inlineEditBox_editable\"/>\n\t\t<textarea dojoAttachPoint=\"textarea\" style=\"display: none;\" class=\"inlineEditBox_editable\"></textarea>\n\t\t<select type=\"select\" dojoAttachPoint=\"select\" style=\"display: none;\" class=\"inlineEditBox_selectbox\" />\n\t</form>\n</div>\n"}});define("mxui/widget/MxInlineEditor",["mxui/widget/_WidgetBase","mxui/mixin/_Templated","mxui/dom","mendix/logger","dojo/sniff","dojo/_base/event","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/_base/lang","dojo/_base/declare","dojo/text!mxui/widget/templates/MxInlineEditor.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){var _d=function(_e,_f){return (parseInt(_e.getAttribute(_f)));};var _10=function(_11,_12){return _11.getAttribute(_12);};var _13=_b([_1,_2],{declaredClass:"mxui.widget.MxInlineEditor",domNode:null,form:null,text:null,textarea:null,enumtext:null,select:null,minWidth:40,minHeight:200,templateString:_c,textValue:"",targetNode:null,_options:null,_nodeList:[],_status:"inactive",_previousValue:"",_editingmode:"text",constructor:function(){this.boolOptions={};this.boolOptions[window.mx.ui.translate("mxui.widget.DataGrid","true")]="true";this.boolOptions[window.mx.ui.translate("mxui.widget.DataGrid","false")]="false";},postCreate:function(){this._nodeList=[this.text,this.textarea,this.select,this.readonly,this.enumtext];this.connect(document.body,"onkeydown","eventOnKeyDown");this.connect(this.form,"onsubmit","eventOnSubmit");this.connect(this.form,"onclick","eventOnClick");this.connect(this.select,"onclick","selectClicked");},selectClicked:function(e){_6.stop(e);return false;},_hideNodes:function(){for(var i=0;i<this._nodeList.length;i++){this._nodeList[i].style.display="none";}},editNode:function(_14,_15,_16){this._options=_16;this._editingmode=_15.toLowerCase();var _17=this.targetNode&&this.targetNode.parentNode;if(_17){this.targetNode.style.display="";_7.setSelectable(_17,false);}this.targetNode=_14;this._hideNodes();var td=this.targetNode.parentNode;td.appendChild(this.form);_7.setSelectable(td,true);this.textValue=_3.unescapeString(this.targetNode.innerHTML);if(this.textValue=="&nbsp;"){this.textValue="";}if(this.textValue.length==0){this.targetNode.innerHTML="&nbsp;";}this._previousValue=this.textValue;this.setupEditNode();},setStyleFromTarget:function(_18){_18.value=_a.trim(this.textValue);if(!_5("ie")){_18.style.fontSize=_d(this.targetNode,"font-size");_18.style.fontWeight=_10(this.targetNode,"font-weight");_18.style.fontStyle=_10(this.targetNode,"font-style");}var bb=_9.getMarginBox(this.targetNode);_18.style.width="100%";return bb;},setupTextNode:function(){this.text.style.textAlign=this.targetNode.parentNode.style.textAlign;var ee=this.text;ee.value=_a.trim(this.textValue);var _19=this.setStyleFromTarget(ee);if(this._editingmode=="textarea"){ee.style.display="block";ee.style.height=Math.max(_19.height,this.minHeight)+"px";}else{ee.style.display="";}this.form.style.display="";this.targetNode.style.display="none";try{ee.select();ee.focus();ee.setAttribute("readonly","readonly");}catch(e){}},setupEditNode:function(){switch(this._editingmode){case "text":case "textarea":case "date":this.setupTextNode();break;case "reference":case "boolean":case "enum":this.setupEnumNode();break;case "readonly":this.setupReadOnlyNode();break;default:break;}this._status="ready";},setupEnumNode:function(){this.setStyleFromTarget(this.enumtext);this.setStyleFromTarget(this.select);this.enumtext.style.display="";this.enumtext.value=this._options.items[this._options.selected];this.enumtext.setAttribute("readonly","readonly");_3.setSelectOptions(this.select,this._options.items,this._options.selected);this.form.style.display="";this.targetNode.style.display="none";try{this.enumtext.select();this.enumtext.focus();}catch(e){}},setupReadOnlyNode:function(){this.setStyleFromTarget(this.readonly);this.targetNode.style.display="none";this.readonly.style.display="";this.readonly.value=this.textValue;this.form.style.display="";this.readonly.focus();this.readonly.setAttribute("readonly","readonly");},undoChanges:function(){if(this._status=="active"||this._status=="ready"){this.targetNode&&(this.targetNode.innerHTML=this._previousValue);if((this._editingmode=="enum")||(this._editingmode=="reference")||this._editingmode=="boolean"){_3.selectOptionByText(this.select,this._previousValue);}else{if(this._editingmode=="readonly"){}else{this.text.value=_3.unescapeString(this._previousValue);}}}},startEditing:function(str){switch(this._editingmode){case "date":case "text":case "textarea":_8.replace(this.text,"inlineeditbox_editable");this.text.removeAttribute("readonly");if(str){this.text.value=_3.unescapeString(str);}try{this.text.select();this.text.focus();this._status="active";}catch(e){this.endEdit();}break;case "boolean":case "reference":case "enum":this.enumtext.style.display="none";this.select.style.display="";this.select.removeAttribute("readonly");this.select.focus();this._status="active";break;case "readonly":this._status="ready";break;default:break;}},focusOnNode:function(){switch(this._editingmode){case "date":case "text":case "textarea":this.text.focus();break;case "boolean":case "reference":case "enum":this.select.focus();break;}},stopEditing:function(){switch(this._editingmode){case "text":case "textarea":case "date":this.text.setAttribute("readonly","readonly");break;case "boolean":case "reference":case "enum":this.select.setAttribute("readonly","readonly");break;case "readonly":break;default:break;}this._status="ready";},endEdit:function(){if(this._status=="ready"||this._status=="active"){this.domNode.appendChild(this.form);this.targetNode&&(this.targetNode.style.display="");this._status="inactive";}},eventOnClick:function(){if(this._status=="ready"){this.startEditing();}},eventOnKeyDown:function(e){this.eventKeyHandler(e);},hasChanges:function(){if(this._editingmode=="readonly"||this._status=="inactive"){return false;}var _1a="";switch(this._editingmode){case "boolean":case "reference":case "enum":_1a=_3.getSelectedText(this.select);break;default:_1a=this.text.value;break;}return (this._previousValue!=_1a);},getValue:function(){if((this._editingmode=="enum")||(this._editingmode=="reference")||this._editingmode=="boolean"){this.targetNode.innerHTML=_3.getSelectedText(this.select);return (this.textValue=_3.getSelectedValue(this.select));}else{if(this._editingmode=="readonly"){return false;}else{this.textValue=this.text.value;_3.text(this.targetNode,this.textValue);return this.textValue;}}},getEditorStatus:function(){return this._status;},isActive:function(){return (this._status=="active");},isInActive:function(){return (this._status=="inactive");},isReady:function(){return (this._status=="ready");},eventKeyHandler:function(){},eventOnSubmit:function(){return false;}});return _13;});