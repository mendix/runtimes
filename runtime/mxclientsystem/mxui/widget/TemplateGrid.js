/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
require({cache:{"url:mxui/widget/templates/TemplateGrid.html":"<div class=\"${baseClass} mx-templategrid\">\n    <div class=\"${baseClass}-searchbar clearfix\" dojoAttachPoint=\"searchNode\" focusIndex=\"0\">\n        <div class=\"${baseClass}-search-controls\" focusIndex=\"1\" dojoAttachPoint=\"searchControlNode\"></div>\n        <div class=\"${baseClass}-search-inputs\" focusIndex=\"0\" dojoAttachPoint=\"searchArgumentNode\"></div>\n        <div class=\"${baseClass}-search-message\" dojoAttachPoint=\"messageNode\"></div>\n    </div>\n    \n    <div class=\"${baseClass}-controlbar clearfix\" dojoAttachPoint=\"controlNode\" focusIndex=\"1\">\n        <div class=\"${baseClass}-pagingbar\" dojoAttachPoint=\"pagingBarNode\"></div>\n        <div class=\"${baseClass}-toolbar\" dojoAttachPoint=\"toolBarNode\"></div>\n    </div>\n\t\n    <div class=\"${baseClass}-content\" dojoAttachPoint=\"contentNode\" focusIndex=\"2\">\n        <div class=\"${subClass}-content-wrapper\" dojoAttachPoint=\"itemNode\"></div>\n    </div>\n</div>\n"}});define("mxui/widget/TemplateGrid",["mxui/widget/_Grid","mxui/widget/TemplateGridItem","mendix/lib/MxContext","mxui/widget","mxui/dom","mendix/logger","mendix/lang","dojo/sniff","dojo/on","dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/text!mxui/widget/templates/TemplateGrid.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){var $=_5.create;var _e=_b(_1,{declaredClass:"mxui.widget.TemplateGrid",templateString:_d,subClass:"mx-templategrid",cssmap:_4.createCSSMap("mx-templategrid",{row:"row",item:"item",empty:"empty"}),itemNode:null,_mxObjects:[],_itemCache:[],constructor:function(){this._mxObjects=[];this._itemCache=[];this._gridState={selectable:true,selectionmode:"single",searchbar:true,controlbar:true,pagingbar:true,inDenial:false,searchBarVisible:false,searchBarTogglable:true,xpathConstraint:"",dynamicconstraint:"",loading:false,invertedSelection:false};},postCreate:function(){this.inherited(arguments);if(this._metaEntity){this.connectEvents();}this.loaded();},setupGridState:function(){this.inherited(arguments);this._gridState.columns=this._gridConfig.gridSetting("columns");this._gridState.rows=this._gridConfig.gridSetting("rows");this._gridState.cellwidth=String(_8("ie")?(100/this._gridState.columns-0.05):(100/this._gridState.columns))+"%";},connectEvents:function(){var _f=this;this.own(_9(this.itemNode,_9.selector("."+this.cssmap.item,"click"),function(e){_f.eventItemClicked(e,this);}));var _10=function(e){_f.eventActionBindingHandler(this,e.type);};for(var _11 in this._gridConfig.gridActionBindings()){this.own(_9(this.itemNode,_9.selector("."+this.cssmap.item,_11.replace(/^on/,"")),_10));}},fillGrid:function(){this._mxObjects=this._dataSource.getObjects();if(this._gridState.selectfirst&&!this._gridState.invertedSelection&&this._mxObjects.length>0&&!this._hasSelection()){this._addToSelection(this._mxObjects[0].getGuid());}this._shareSelection(this._metaEntity.getEntity());var _12=$("#"),_13=this._itemCache.length,_14=0,_15=false,_16=[],_17;for(var row=0;row<this._gridState.rows;++row){var _18=$("div",{"class":this.cssmap.row});_12.appendChild(_18);for(var col=0;col<this._gridState.columns;++col){if(_14<this._mxObjects.length){if(_14>=this._itemCache.length){this._itemCache[_14]=new _2({uniqueid:this.uniqueid+"_obj"+this._mxObjects[_14].getGuid(),name:"mx-name-index-"+_14,mxform:this.mxform,template:window.mx.ui.getTemplate(this.mxid,"content"),cssClass:this.cssmap.item});_15=true;}_17=this._itemCache[_14].domNode;_17.style.width=this._gridState.cellwidth;this.domData(_17,{gridrow:_14,mendixguid:this._mxObjects[_14].getGuid()});this.addFocusBox(_17);_18.appendChild(_17);if(this._isSelected(this._mxObjects[_14].getGuid())){this.selectRow(_17);}else{this.deselectRow(_17);}}else{var _19=$("div",{"class":this.cssmap.empty},$("br"));_18.appendChild(_19);}++_14;}if(_14>=this._mxObjects.length&&!this._gridState.showemptyrows){break;}}_5.empty(this.itemNode);this.itemNode.appendChild(_12);for(_14=0;_14<this._mxObjects.length;++_14){var _1a=new _3({mxcontext:this.mxcontext});_1a.setObject(this._mxObjects[_14]);if(_14>=_13){this._itemCache[_14].startup();}this._itemCache[_14].set("disabled",false);_16.push(_a.hitch(this._itemCache[_14],"applyContext",_1a));}for(_14=this._mxObjects.length;_14<this._itemCache.length;_14++){this._itemCache[_14].set("disabled",true);}_7.collect(_16,function(){if(_15){this.mxform.resize();}},this);},deselectGridRows:function(){for(var i=0,l=this._itemCache.length;i<l;++i){this.deselectRow(this._itemCache[i].domNode);}},_getEntity:function(_1b){return _7.firstKey(_1b);},_getCurrentGuid:function(){return this.selection[0];},_getObjectFromNode:function(_1c){return this._mxObjects[this.domData(_1c,"gridrow")];}});return _e;});