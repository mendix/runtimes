/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
require({cache:{"url:mxui/widget/templates/TemplateGrid.html":"<div class=\"${baseClass} mx-templategrid\">\n    <div class=\"${baseClass}-searchbar clearfix\" dojoAttachPoint=\"searchNode\" focusIndex=\"0\">\n        <div class=\"${baseClass}-search-controls\" focusIndex=\"1\" dojoAttachPoint=\"searchControlNode\"></div>\n        <div class=\"${baseClass}-search-inputs\" focusIndex=\"0\" dojoAttachPoint=\"searchArgumentNode\"></div>\n        <div class=\"${baseClass}-search-message\" dojoAttachPoint=\"messageNode\"></div>\n    </div>\n    \n    <div class=\"${baseClass}-controlbar clearfix\" dojoAttachPoint=\"controlNode\" focusIndex=\"1\">\n        <div class=\"${baseClass}-pagingbar\" dojoAttachPoint=\"pagingBarNode\"></div>\n        <div class=\"${baseClass}-toolbar\" dojoAttachPoint=\"toolBarNode\"></div>\n    </div>\n\t\n    <div class=\"${baseClass}-content\" dojoAttachPoint=\"contentNode\" focusIndex=\"2\">\n        <div class=\"${subClass}-content-wrapper\" dojoAttachPoint=\"itemNode\"></div>\n    </div>\n</div>\n"}});define("mxui/widget/TemplateGrid",["mxui/widget/_Grid","mxui/widget/TemplateGridItem","mendix/lib/MxContext","mxui/widget","mxui/dom","mendix/logger","mendix/lang","dojo/sniff","dojo/on","dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/text!mxui/widget/templates/TemplateGrid.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){var $=_5.create;var _e=_b(_1,{declaredClass:"mxui.widget.TemplateGrid",templateString:_d,subClass:"mx-templategrid",cssmap:_4.createCSSMap("mx-templategrid",{row:"row",item:"item",empty:"empty"}),itemNode:null,_mxObjects:[],_itemCache:[],constructor:function(){this._mxObjects=[];this._itemCache=[];this._gridState={selectable:true,selectionmode:"single",searchbar:true,controlbar:true,pagingbar:true,inDenial:false,searchBarVisible:false,searchBarTogglable:true,xpathConstraint:"",dynamicconstraint:"",loading:false,invertedSelection:false};},postCreate:function(){this.inherited(arguments);if(this._metaEntity){this.connectEvents();}this.loaded();},setupGridState:function(){this.inherited(arguments);this._gridState.columns=this._gridConfig.gridSetting("columns");this._gridState.rows=this._gridConfig.gridSetting("rows");this._gridState.cellwidth=String(_8("ie")?(100/this._gridState.columns-0.05):(100/this._gridState.columns))+"%";},connectEvents:function(){var _f=this;this.own(_9(this.itemNode,_9.selector("."+this.cssmap.item,"click"),function(e){_f.eventItemClicked(e,this);}));var _10=this._gridConfig.getDefaultButton();if(_10){var evt=_10.clickType==="single"?"click":"dblclick";this.own(_9(this.itemNode,_9.selector("."+this.cssmap.item,evt),function(){_f.triggerDefaultAction(this);}));}},fillGrid:function(){this._mxObjects=this._dataSource.getObjects();if(this._gridState.selectfirst&&!this._gridState.invertedSelection&&this._mxObjects.length>0&&!this._hasSelection()){this._addToSelection(this._mxObjects[0].getGuid());}this._shareSelection(this._metaEntity.getEntity());var _11=$("#"),_12=this._itemCache.length,_13=0,_14=false,_15=[],_16;for(var row=0;row<this._gridState.rows;++row){var _17=$("div",{"class":this.cssmap.row});_11.appendChild(_17);for(var col=0;col<this._gridState.columns;++col){if(_13<this._mxObjects.length){if(_13>=this._itemCache.length){this._itemCache[_13]=new _2({uniqueid:this.uniqueid+"_obj"+this._mxObjects[_13].getGuid(),name:"mx-name-index-"+_13,mxform:this.mxform,template:window.mx.ui.getTemplate(this.mxid,"content"),cssClass:this.cssmap.item});_14=true;}_16=this._itemCache[_13].domNode;_16.style.width=this._gridState.cellwidth;this.domData(_16,{gridrow:_13,mendixguid:this._mxObjects[_13].getGuid()});this.addFocusBox(_16);_17.appendChild(_16);if(this._isSelected(this._mxObjects[_13].getGuid())){this.selectRow(_16);}else{this.deselectRow(_16);}}else{var _18=$("div",{"class":this.cssmap.empty},$("br"));_17.appendChild(_18);}++_13;}if(_13>=this._mxObjects.length&&!this._gridState.showemptyrows){break;}}_5.empty(this.itemNode);this.itemNode.appendChild(_11);for(_13=0;_13<this._mxObjects.length;++_13){var _19=new _3({mxcontext:this.mxcontext});_19.setObject(this._mxObjects[_13]);if(_13>=_12){this._itemCache[_13].startup();}this._itemCache[_13].set("disabled",false);_15.push(_a.hitch(this._itemCache[_13],"applyContext",_19));}for(_13=this._mxObjects.length;_13<this._itemCache.length;_13++){this._itemCache[_13].set("disabled",true);}_7.collect(_15,function(){if(_14){this.mxform.resize();}},this);},deselectGridRows:function(){for(var i=0,l=this._itemCache.length;i<l;++i){this.deselectRow(this._itemCache[i].domNode);}},_getEntity:function(_1a){return _7.firstKey(_1a);},_getCurrentGuid:function(){return this.selection[0];},_getObjectFromNode:function(_1b){return this._mxObjects[this.domData(_1b,"gridrow")];}});return _e;});