
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/MenuBar",["mxui/widget/_WidgetBase","mxui/mixin/_Stateful","mxui/dom","mendix/lang","dojo/aspect","dojo/dom-class","dojo/on","dojo/_base/event","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){var $=_3.create;var _b=_a([_1,_2],{declaredClass:"mxui.widget.MenuBar",menuID:"",orientation:"horizontal",_view:null,_items:null,_currentSelection:-1,_initialSelection:-1,buildRendering:function(){this._items=window.mx.ui.getMenu(this.menuID);this._view=new _c(this,this.orientation,this._items);this.domNode=this._view.domNode;this._view.subscribeToClick(_9.hitch(this,"_onClick"));this._restoreSelection();this.connect(this.mxform,"onNavigation",this._restoreSelection);},_restoreSelection:function(){this._currentSelection=this.getState("selectedIndex",this._currentSelection);this._initialSelection=this._currentSelection;this._view.select(this._currentSelection);},_onClick:function(_d){var _e=this,_f=this._items[_d].action;if(_f.microflow&&_f.microflow.validate=="view"){this.mxform.validate(_9.hitch(this,_10));}else{_10();}function _10(){_e._currentSelection=_d;_e._view.select(_e._currentSelection);window.mx.ui.execute(_f);};},storeState:function(_11){_11("selectedIndex",this._initialSelection);}});var _c=_a(null,{_handlerScope:null,_orientation:"",_list:null,domNode:null,constructor:function(_12,_13,_14){this._handlerScope=_12;this._orientation=_13;this._render(_14);},_render:function(_15){var _16=this;this._list=$("ul",{"class":"nav nav-pills mx-menubar-list"});if(this._orientation=="vertical"){_6.add(this._list,"nav-stacked");}_4.forEach(_15,function(_17,_18){var _19=$("a",{href:"#"}," "+_17.caption);if(_17.icon){_19.insertBefore($("img",{"class":"mx-menubar-icon",src:window.mx.appUrl+_17.icon}),_19.firstChild);}_16._list.appendChild($("li",{"class":"mx-menubar-item mx-name-index-"+_18},_19));});this.domNode=$("div",{"class":"mx-menubar mx-menubar-"+this._orientation},this._list);},subscribeToClick:function(_1a){var _1b=this._handlerScope;_4.forEach(this.domNode.querySelectorAll(".mx-menubar-item>a"),function(_1c,_1d){_1b.own(_7(_1c,"click",function(_1e){_8.stop(_1e);_1a(_1d);}));});},select:function(_1f){var _20=this.domNode.querySelector(".mx-menubar-item.active");if(_20){_6.remove(_20,"active");}if(_1f!=-1){_6.add(this._list.children[_1f],"active");}}});return _b;});