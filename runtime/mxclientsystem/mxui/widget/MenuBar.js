/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/widget/MenuBar",["mxui/widget/_WidgetBase","mxui/mixin/_Stateful","mxui/lib/menuAnchorFactory","mxui/dom","mendix/lang","dojo/aspect","dojo/dom-class","dojo/on","dojo/_base/event","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){var $=_4.create;var _c=_b([_1,_2],{declaredClass:"mxui.widget.MenuBar",menuID:"",orientation:"horizontal",_view:null,_items:null,_currentSelection:-1,_initialSelection:-1,buildRendering:function(){this._items=window.mx.ui.getMenu(this.menuID);this._view=new _d(this,this.orientation,this._items);this.domNode=this._view.domNode;this._view.subscribeToClick(_a.hitch(this,"_onClick"));this._restoreSelection();this.connect(this.mxform,"onNavigation",this._restoreSelection);},_restoreSelection:function(){this._currentSelection=this.getState("selectedIndex",this._currentSelection);this._initialSelection=this._currentSelection;this._view.select(this._currentSelection);},_onClick:function(_e){var _f=this,_10=this._items[_e].action;if(_10.microflow&&_10.microflow.validate=="view"){this.mxform.validate(_a.hitch(this,_11));}else{_11();}function _11(){_f._currentSelection=_e;_f._view.select(_f._currentSelection);window.mx.ui.execute(_10);};},storeState:function(_12){_12("selectedIndex",this._initialSelection);}});var _d=_b(null,{_handlerScope:null,_orientation:"",_list:null,domNode:null,constructor:function(_13,_14,_15){this._handlerScope=_13;this._orientation=_14;this._render(_15);},_render:function(_16){var _17=this;this._list=$("ul",{"class":"nav nav-pills mx-menubar-list"});if(this._orientation=="vertical"){_7.add(this._list,"nav-stacked");}_5.forEach(_16,function(_18,_19){var _1a=_3.create(_18);_17._list.appendChild($("li",{"class":"mx-menubar-item mx-name-index-"+_19},_1a));});this.domNode=$("div",{"class":"mx-menubar mx-menubar-"+this._orientation},this._list);},subscribeToClick:function(_1b){var _1c=this._handlerScope;_5.forEach(this.domNode.querySelectorAll(".mx-menubar-item>a"),function(_1d,_1e){_1c.own(_8(_1d,"click",function(_1f){_9.stop(_1f);_1b(_1e);}));});},select:function(_20){var _21=this.domNode.querySelector(".mx-menubar-item.active");if(_21){_7.remove(_21,"active");}if(_20!=-1){_7.add(this._list.children[_20],"active");}}});return _c;});