/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/widget/Progress",["mxui/widget/_WidgetBase","mxui/dom","mendix/lang","mendix/logger","dojo/dom-class","dojo/dom-style","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8){"use strict";var _9=_8(_1,{declaredClass:"mxui.widget.Progress",showDelay:500,_showing:false,_messageId:0,_messages:null,_showTimer:null,_msgNode:null,_hideCon:null,constructor:function(){this._messages=[];},buildRendering:function(){this.domNode=_2.create("div",{"class":"mx-progress mx-progress-hidden"},this._msgNode=_2.create("div",{"class":"mx-progress-message"}),_2.create("div",{"class":"mx-progress-indicator"}));},add:function(_a,_b){var id=this._messageId++;this._messages.push({id:id,text:_a,modal:_b});this._updateMessage();if(!this._showing){this._show(_b);}else{if(_b){if(this._showTimer){clearTimeout(this._showTimer);this._showTimer=null;this._show(true);}else{window.mx.ui.showUnderlay();}}}return id;},remove:function(id){var _c=_3.find(this._messages,function(_d){return _d.id==id;});if(_c){if(_c.modal){window.mx.ui.hideUnderlay();}this._removeMessage(id);if(this._messages.length>0){this._updateMessage();}else{this._hide();}}else{_4.error(this.id+".remove: Message id not found!");}},_show:function(_e){this._showing=true;if(_e){window.mx.ui.showUnderlay();}var _f=_7.hitch(this,function(){this._showTimer=null;if(this._hideCon){this._hideCon.remove();this._hideCon=null;}else{document.body.appendChild(this.domNode);_6.get(this.domNode,"width");}_5.remove(this.domNode,"mx-progress-hidden");});if(this._hideCon||_e){_f();}else{this._showTimer=setTimeout(_f,this.showDelay);}},_hide:function(_10){this._showing=false;if(this._showTimer){clearTimeout(this._showTimer);this._showTimer=null;}else{if(_10){window.mx.ui.hideUnderlay();}var _11=_6.get(this.domNode,"opacity")==="0";if(_2.supports("transition")&&!_11){this._hideCon=this.connect(this.domNode,"transitionend",function(){this._hideCon.remove();this._hideCon=null;document.body.removeChild(this.domNode);});}else{document.body.removeChild(this.domNode);}_5.add(this.domNode,"mx-progress-hidden");}},_updateMessage:function(){var _12=_3.findLast(this._messages,function(_13){return _13.text;});if(_12){_5.remove(this.domNode,"mx-progress-empty");}else{_5.add(this.domNode,"mx-progress-empty");}_2.text(this._msgNode,_12?_12.text:"");},_removeMessage:function(id){var _14=_3.findIndex(this._messages,function(_15){return _15.id==id;});this._messages.splice(_14,1);}});return _9;});