
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/Image",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.widget.Image");_1.declare("mxui.widget.Image",mxui.widget.StaticImage,{path:"",defaultUrl:"",_entity:"",_xpath:"",_referred:"",postCreate:function(){this.inherited(arguments);if(this.path){var _4=this.path.split("/");this._entity=_4.pop();this._referred=!!_4.length;this._xpath="//"+this._entity;if(this._referred){this._xpath+="["+_4.reverse().join("/")+"=[%CurrentObject%]]";}}},applyContext:function(_5,_6){this.unsubscribeAll();this.mxcontext.mixin(_5);var _7=this.mxcontext.getTrackId();var _8=function(e){mx.onError(e);_6&&_6();};if(!_7){this.update(null,_6);}else{if(this._referred){mx.data.get({xpath:this._xpath.replace("[%CurrentObject%]",_7),callback:function(_9){this.updateReferred(_9[0],_6,_5);},error:_8},this);}else{mx.data.get({guid:_7,noCache:true,callback:function(_a){this.update(_a,_6);},error:_8},this);}}},update:function(_b,_c){if(_b){this.subscribe({guid:_b.getGuid(),callback:function(){this.update(_b);}});}this._setImage(_b,_c);},updateReferred:function(_d,_e,_f){if(_d){this.subscribe({guid:_f.getTrackId(),callback:function(){this.applyContext(_f);}});}this.mxcontext.setContext(this._entity,_d?_d.getGuid():"");this.update(_d,_e);},_setImage:function(obj,_10){var url=this.defaultUrl;if(obj&&obj.get("HasContents")){url=mx.appUrl;url+="file?guid="+obj.getGuid()+"&thumb="+this.thumb;url+="&changedDate="+obj.get("changedDate");}this.setUrl(url,_10);}});});