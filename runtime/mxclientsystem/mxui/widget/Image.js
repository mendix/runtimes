
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/Image",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.widget.Image");_1.declare("mxui.widget.Image",mxui.widget.StaticImage,{path:"",defaultUrl:"",_xpath:"",_referred:"",postCreate:function(){this.inherited(arguments);if(this.path){var _4=this.path.split("/"),_5=_4.pop();this._referred=!!_4.length;this._xpath="//"+_5;if(this._referred){this._xpath+="["+_4.reverse().join("/")+"=[%CurrentObject%]]";}}},applyContext:function(_6,_7){this.mxcontext.mixin(_6);var _8=this.mxcontext.getTrackId();var _9=function(e){mx.onError(e);_7&&_7();};if(!_8){this.update(null,_7);}else{if(this._referred){mx.data.get({xpath:this._xpath.replace("[%CurrentObject%]",_8),callback:function(_a){this.update(_a[0],_7);},error:_9},this);}else{mx.data.get({guid:_8,noCache:true,callback:function(_b){this.update(_b,_7);},error:_9},this);}}},update:function(_c,_d){this.unsubscribeAll();if(_c){this.subscribe({guid:_c.getGuid(),callback:function(){this.update(_c);}});if(this._referred){this.subscribe({guid:this.mxcontext.getTrackId(),callback:function(){this.applyContext(this.mxcontext);}});}}this._setImage(_c,_d);},_setImage:function(_e,_f){var url=this.defaultUrl;if(_e&&_e.get("HasContents")){url=mx.appUrl;url+="file?guid="+_e.getGuid()+"&thumb="+this.thumb;url+="&changedDate="+_e.get("changedDate");}this.setUrl(url,_f);}});});