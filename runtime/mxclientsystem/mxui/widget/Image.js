/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/widget/Image",["mxui/widget/StaticImage","mendix/logger","webcore/url-helpers","dojo/_base/declare"],function(_1,_2,_3,_4){var _5=_4(_1,{declaredClass:"mxui.widget.Image",datasource:null,defaultUrl:"",thumb:false,_entity:"",_xpath:"",_referred:"",_absDefaultUrl:"",postCreate:function(){this.inherited(arguments);var _6=this.datasource.path.split("/");this._entity=_6.pop();this._referred=!!_6.length;this._xpath="//"+this._entity;if(this._referred){this._xpath+="["+_6.reverse().join("/")+"=[%CurrentObject%]]";}if(this.defaultUrl){this._absDefaultUrl=_3.getStaticResourceUrlFromPath(this.defaultUrl);}},applyContext:function(_7,_8){this.unsubscribeAll();this.mxcontext.mixin(_7);var _9=this.mxcontext.getTrackId();var _a=function(e){window.mx.onError(e);_8&&_8();};if(!_9){this.update(null,_8);}else{if(this._referred){window.mx.data.get({xpath:this._xpath.replace("[%CurrentObject%]",_9),callback:function(_b){this.updateReferred(_b[0],_8,_7);},error:_a},this);}else{window.mx.data.get({guid:_9,noCache:true,callback:function(_c){this.update(_c,_8);},error:_a},this);}}},update:function(_d,_e){if(_d){this.subscribe({guid:_d.getGuid(),callback:function(){this.update(_d);}});}this._setImage(_d,_e);},updateReferred:function(_f,_10,_11){if(_f){this.subscribe({guid:_11.getTrackId(),callback:function(){this.applyContext(_11);}});}this.mxcontext.setContext(this._entity,_f?_f.getGuid():"");this.update(_f,_10);},_setImage:function(obj,_12){var url;if(obj&&obj.get2("HasContents")){url=mx.data.getDocumentUrl(obj.getGuid(),obj.get2("changedDate"),this.thumb);}else{url=this._absDefaultUrl;}this.setUrl(url,_12);}});return _5;});