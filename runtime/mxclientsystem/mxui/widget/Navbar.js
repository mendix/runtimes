
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/Navbar",["mxui/widget/_WidgetBase","mxui/mixin/_Stateful","mxui/dom","mendix/lang","dojo/_base/event","dojo/dom-class","dojo/on","dojo/aspect","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){var $=_3.create;function _b(_c,_d,_e){_4.forEach(_c,function(_f,_10){_f.id=_e+_10;_d[_f.id]=_f;_b(_f.items,_d,_f.id+"-");});};function _11(_12){var map={};_b(_12,map,"");return map;};var _13=_a([_1,_2],{declaredClass:"mxui.widget.Navbar",menuID:"",_view:null,_itemMap:null,_expandedItem:"",_currentSelection:"",_initialSelection:"",buildRendering:function(){var _14=_9.clone(window.mx.ui.getMenu(this.menuID));this._itemMap=_11(_14);this._view=new _15(this,_14);this.domNode=this._view.domNode;this._view.subscribeToClick(_9.hitch(this,"_onClick"));this._view.subscribeToGlobalClick(_9.hitch(this,"_onClickOutside"));this._restoreSelection();this.connect(this.mxform,"onNavigation",this._restoreSelection);},_onClickOutside:function(){this._view.collapseAll();this._expandedItem="";},_onClick:function(_16){var _17=this._itemMap[_16];var _18=this._expandedItem;this._view.collapseAll();this._expandedItem="";if(_17.action){this._view.deselectAll();this._view.select(_16);this._currentSelection=_16;if(typeof _17.action==="function"){_17.action();}else{window.mx.ui.execute(_17.action,{context:this.mxcontext});}}else{if(_18!=_16){this._expandedItem=_16;this._view.expand(_16);}}},_restoreSelection:function(){this._currentSelection=this.getState("selectedItem",this._currentSelection);this._initialSelection=this._currentSelection;this._view.deselectAll();this._view.select(this._currentSelection);},storeState:function(_19){_19("selectedItem",this._initialSelection);}});var _15=_a(null,{_handlerScope:null,domNode:null,constructor:function(_1a,_1b){this._handlerScope=_1a;this._render(_1b);},_render:function(_1c){var _1d=$("ul",{"class":"nav navbar-nav"});_4.forEach(_1c,function(_1e,_1f){_1d.appendChild(_20(_1e,_1f));});this.domNode=$("div",{"class":"navbar navbar-default mx-navbar",tabindex:-1},_1d);function _20(_21,_22){var _23=$("li",{"class":"mx-navbar-item"},_24(_21,_22));if(_21.items){var _25=$("ul",{"class":"dropdown-menu mx-navbar-submenu"});_4.forEach(_21.items,function(_26,_27){_25.appendChild($("li",{"class":"mx-navbar-subitem"},_24(_26,_27)));});_6.add(_23,"dropdown");_23.appendChild(_25);}return _23;};function _24(_28,_29){var _2a=$("a",{href:"#","class":"mx-name-index-"+_29,"data-item-id":_28.id}," "+_28.caption+" ");if(_28.icon){_2a.insertBefore($("img",{src:window.mx.appUrl+_28.icon}),_2a.firstChild);}if(_28.items){_2a.appendChild($("b",{"class":"caret"}));}return _2a;};},subscribeToClick:function(_2b){this._handlerScope.own(_7(this.domNode,"a:click",function(e){_5.stop(e);_2b(this.getAttribute("data-item-id"));}));},subscribeToGlobalClick:function(_2c){this._handlerScope.own(_7(window.document,"click",function(){_2c();}));},expand:function(_2d){var _2e=this.domNode.querySelector("[data-item-id='"+_2d+"']");if(_2e){_6.add(_2e.parentNode,"open");}},deselectAll:function(){var _2f=this.domNode.querySelector("li.active");if(_2f){_6.remove(_2f,"active");}},select:function(_30){var _31=this.domNode.querySelector("[data-item-id='"+_30+"']");if(_31){_6.add(_31.parentNode,"active");}},collapseAll:function(){var _32=this.domNode.querySelector("li.open");if(_32){_6.remove(_32,"open");}}});return _13;});