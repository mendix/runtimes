/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/widget/Navbar",["mxui/widget/_WidgetBase","mxui/mixin/_Stateful","mxui/lib/menuAnchorFactory","mxui/dom","mendix/lang","dojo/_base/event","dojo/dom-class","dojo/on","dojo/aspect","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){var $=_4.create;function _c(_d){var _e={};_f(_d);return _e;function _f(_10){_5.forEach(_10,function(_11){_e[_11.id]=_11;_f(_11.items);});};};var _12=_b([_1,_2],{declaredClass:"mxui.widget.Navbar",menuID:"",_view:null,_itemMap:null,_expandedItem:"",_currentSelection:"",_initialSelection:"",buildRendering:function(){var _13=window.mx.ui.getMenu(this.menuID);this._itemMap=_c(_13);this._view=new _14(this,_13);this.domNode=this._view.domNode;this._view.subscribeToClick(_a.hitch(this,"_onClick"));this._view.subscribeToGlobalClick(_a.hitch(this,"_onClickOutside"));this._restoreSelection();this.connect(this.mxform,"onNavigation",this._restoreSelection);},_onClickOutside:function(){this._view.collapseAll();this._expandedItem="";},_onClick:function(_15){var _16=this._itemMap[_15];var _17=this._expandedItem;this._view.collapseAll();this._expandedItem="";if(_16.action){this._view.deselectAll();this._view.select(_15);this._currentSelection=_15;if(typeof _16.action==="function"){_16.action();}else{window.mx.ui.execute(_16.action);}}else{if(_17!=_15){this._expandedItem=_15;this._view.expand(_15);}}},_restoreSelection:function(){this._currentSelection=this.getState("selectedItem",this._currentSelection);this._initialSelection=this._currentSelection;this._view.deselectAll();this._view.select(this._currentSelection);},storeState:function(_18){_18("selectedItem",this._initialSelection);}});var _14=_b(null,{_handlerScope:null,domNode:null,constructor:function(_19,_1a){this._handlerScope=_19;this._render(_1a);},_render:function(_1b){var _1c=$("ul",{"class":"nav navbar-nav"});_5.forEach(_1b,function(_1d,_1e){_1c.appendChild(_1f(_1d,_1e));});this.domNode=$("div",{"class":"navbar navbar-default mx-navbar",tabindex:-1},_1c);function _1f(_20){var _21=$("li",{"class":"mx-navbar-item"},_22(_20));if(_20.items){var _23=$("ul",{"class":"dropdown-menu mx-navbar-submenu"});_5.forEach(_20.items,function(_24){_23.appendChild($("li",{"class":"mx-navbar-subitem"},_22(_24)));});_7.add(_21,"dropdown");_21.appendChild(_23);}return _21;};function _22(_25){var _26=_3.create(_25);_26.setAttribute("data-item-id",_25.id);if(_25.items){_26.appendChild($("b",{"class":"caret"}));}return _26;};},subscribeToClick:function(_27){this._handlerScope.own(_8(this.domNode,"a:click",function(e){_6.stop(e);_27(this.getAttribute("data-item-id"));}));},subscribeToGlobalClick:function(_28){this._handlerScope.own(_8(window.document,"click",function(){_28();}));},expand:function(_29){var _2a=this.domNode.querySelector("[data-item-id='"+_29+"']");if(_2a){_7.add(_2a.parentNode,"open");}},deselectAll:function(){var _2b=this.domNode.querySelector("li.active");if(_2b){_7.remove(_2b,"active");}},select:function(_2c){var _2d=this.domNode.querySelector("[data-item-id='"+_2c+"']");if(_2d){_7.add(_2d.parentNode,"active");}},collapseAll:function(){var _2e=this.domNode.querySelector("li.open");if(_2e){_7.remove(_2e,"open");}}});return _12;});