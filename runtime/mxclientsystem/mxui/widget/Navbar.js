/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/widget/Navbar",["mxui/widget/_WidgetBase","mxui/mixin/_Stateful","mxui/dom","mendix/lang","dojo/_base/event","dojo/dom-class","dojo/on","dojo/aspect","dojo/_base/lang","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){var $=_3.create;function _b(_c){var _d={};_e(_c);return _d;function _e(_f){_4.forEach(_f,function(_10){_d[_10.id]=_10;_e(_10.items);});};};var _11=_a([_1,_2],{declaredClass:"mxui.widget.Navbar",menuID:"",_view:null,_itemMap:null,_expandedItem:"",_currentSelection:"",_initialSelection:"",buildRendering:function(){var _12=window.mx.ui.getMenu(this.menuID);this._itemMap=_b(_12);this._view=new _13(this,_12);this.domNode=this._view.domNode;this._view.subscribeToClick(_9.hitch(this,"_onClick"));this._view.subscribeToGlobalClick(_9.hitch(this,"_onClickOutside"));this._restoreSelection();this.connect(this.mxform,"onNavigation",this._restoreSelection);},_onClickOutside:function(){this._view.collapseAll();this._expandedItem="";},_onClick:function(_14){var _15=this._itemMap[_14];var _16=this._expandedItem;this._view.collapseAll();this._expandedItem="";if(_15.action){this._view.deselectAll();this._view.select(_14);this._currentSelection=_14;if(typeof _15.action==="function"){_15.action();}else{window.mx.ui.execute(_15.action);}}else{if(_16!=_14){this._expandedItem=_14;this._view.expand(_14);}}},_restoreSelection:function(){this._currentSelection=this.getState("selectedItem",this._currentSelection);this._initialSelection=this._currentSelection;this._view.deselectAll();this._view.select(this._currentSelection);},storeState:function(_17){_17("selectedItem",this._initialSelection);}});var _13=_a(null,{_handlerScope:null,domNode:null,constructor:function(_18,_19){this._handlerScope=_18;this._render(_19);},_render:function(_1a){var _1b=$("ul",{"class":"nav navbar-nav"});_4.forEach(_1a,function(_1c,_1d){_1b.appendChild(_1e(_1c,_1d));});this.domNode=$("div",{"class":"navbar navbar-default mx-navbar",tabindex:-1},_1b);function _1e(_1f){var _20=$("li",{"class":"mx-navbar-item"},_21(_1f));if(_1f.items){var _22=$("ul",{"class":"dropdown-menu mx-navbar-submenu"});_4.forEach(_1f.items,function(_23){_22.appendChild($("li",{"class":"mx-navbar-subitem"},_21(_23)));});_6.add(_20,"dropdown");_20.appendChild(_22);}return _20;};function _21(_24){var _25=$("a",{href:"#","class":"mx-name-"+_24.id,"data-item-id":_24.id}," "+_24.caption+" ");if(_24.icon){_25.insertBefore($("img",{src:window.mx.appUrl+_24.icon}),_25.firstChild);}if(_24.items){_25.appendChild($("b",{"class":"caret"}));}return _25;};},subscribeToClick:function(_26){this._handlerScope.own(_7(this.domNode,"a:click",function(e){_5.stop(e);_26(this.getAttribute("data-item-id"));}));},subscribeToGlobalClick:function(_27){this._handlerScope.own(_7(window.document,"click",function(){_27();}));},expand:function(_28){var _29=this.domNode.querySelector("[data-item-id='"+_28+"']");if(_29){_6.add(_29.parentNode,"open");}},deselectAll:function(){var _2a=this.domNode.querySelector("li.active");if(_2a){_6.remove(_2a,"active");}},select:function(_2b){var _2c=this.domNode.querySelector("[data-item-id='"+_2b+"']");if(_2c){_6.add(_2c.parentNode,"active");}},collapseAll:function(){var _2d=this.domNode.querySelector("li.open");if(_2d){_6.remove(_2d,"open");}}});return _11;});