/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/widget/StaticImage",["mxui/widget/_WidgetBase","mxui/widget/ImageZoom","mxui/dom","mendix/logger","dojo/on","dojo/_base/event","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7){var $=_3.create;var _8=_7(_1,{declaredClass:"mxui.widget.StaticImage",url:"",width:"",height:"",action:null,_overlay:null,buildRendering:function(){var _9=this.width,_a=this.height,_b=parseInt(_9,10),_c=parseInt(_a,10),_d=this.domNode=$("img",{"class":"mx-image"}),_e=_d.style;var _f=_9.indexOf("px")!==-1&&_a.indexOf("px")!==-1;if(_f&&_b>0&&_c>0){this.connect(_d,"load",function(){var _10=_d.width/_d.height,_11=_b/_c;if(_10<_11){_e.width="";_e.height=_a;}else{_e.width=_9;_e.height="";}});}else{if(_b){_d.style.width=_9;}if(_c){_d.style.height=_a;}}if(this.action){this.connect(_d,"click","onClick");_d.style.cursor="pointer";}this.setUrl("");},applyContext:function(_12,_13){this.mxcontext.mixin(_12);this.setUrl(this.url,_13);},setUrl:function(url,_14){this.domNode.removeAttribute("width");this.domNode.removeAttribute("height");if(!url){this.domNode.style.display="none";this.domNode.src=this._blankGif;if(_14){_14();}}else{url=window.mx.appUrl+url;if(this.domNode.src===url){if(_14){_14();}}else{if(_14){var _15=_5(this.domNode,"load",function(){_15.remove();_14();});var _16=_5(this.domNode,"error",function(){_4.error(this.id+": Failed to load image with url "+url);_16.remove();_14();});}this.domNode.style.display="";this.domNode.src=url;}}},onClick:function(e){var _17=this.action,_18=this.mxcontext,run,_19;if("microflow" in _17||"form" in _17){_19={caller:this.mxform};run=function(){window.mx.ui.execute(_17,{context:_18,store:_19});};if(_17.microflow&&_17.microflow.validate=="view"){this.mxform.validate(run);}else{run();}}else{if(_17.type=="enlarge"){if(!this._overlay){this._overlay=new _2({src:this.domNode.src});}else{this._overlay.set("src",this.domNode.src);}this._overlay.show();}}_6.stop(e);},uninitialize:function(){if(this._overlay){this._overlay.destroy();}},_setWidthAttr:function(){},_setHeightAttr:function(){}});return _8;});