/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/widget/StaticImage",["mxui/widget/_WidgetBase","mxui/widget/ImageZoom","mxui/dom","mendix/logger","webcore/url-helpers","dojo/on","dojo/_base/event","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8){var $=_3.create;var _9=_8(_1,{declaredClass:"mxui.widget.StaticImage",url:"",width:"",height:"",action:null,_overlay:null,_absUrl:"",buildRendering:function(){var _a=this.width,_b=this.height,_c=parseInt(_a,10),_d=parseInt(_b,10),_e=this.domNode=$("img",{"class":"mx-image"}),_f=_e.style;var _10=_a.indexOf("px")!==-1&&_b.indexOf("px")!==-1;if(_10&&_c>0&&_d>0){this.connect(_e,"load",function(){var _11=_e.width/_e.height,_12=_c/_d;if(_11<_12){_f.width="";_f.height=_b;}else{_f.width=_a;_f.height="";}});}else{if(_c){_e.style.width=_a;}if(_d){_e.style.height=_b;}}if(this.action){this.connect(_e,"click","onClick");_e.style.cursor="pointer";}if(this.url){this._absUrl=_5.getStaticResourceUrlFromPath(this.url);}this.setUrl("");},applyContext:function(_13,_14){this.mxcontext.mixin(_13);this.setUrl(this._absUrl,_14);},setUrl:function(url,_15){this.domNode.removeAttribute("width");this.domNode.removeAttribute("height");if(!url){this.domNode.style.display="none";this.domNode.src=_5.getStaticResourceUrlFromPath(this._blankGif);if(_15){_15();}}else{if(this.domNode.src===url){if(_15){_15();}}else{if(_15){var _16=_6(this.domNode,"load",function(){_16.remove();_15();});var _17=_6(this.domNode,"error",function(){_4.error(this.id+": Failed to load image with url "+url);_17.remove();_15();});}this.domNode.style.display="";this.domNode.src=url;}}},onClick:function(e){var _18=this.action,_19=this.mxcontext,run,_1a;if("microflow" in _18||"form" in _18){_1a={caller:this.mxform};run=function(){window.mx.ui.execute(_18,{context:_19,store:_1a});};if(_18.microflow&&_18.microflow.validate=="view"){this.mxform.validate(run);}else{run();}}else{if(_18.type=="enlarge"){if(!this._overlay){this._overlay=new _2({src:this.domNode.src});}else{this._overlay.set("src",this.domNode.src);}this._overlay.show();}}_7.stop(e);},uninitialize:function(){if(this._overlay){this._overlay.destroy();}},_setWidthAttr:function(){},_setHeightAttr:function(){}});return _9;});