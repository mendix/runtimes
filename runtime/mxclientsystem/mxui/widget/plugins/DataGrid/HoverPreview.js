
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/plugins/DataGrid/HoverPreview",["dojo","dijit","dojox","dojo/require!mxui/widget/DataGrid,mxui/widget/Tooltip,mxui/html/render"],function(_1,_2,_3){_1.provide("mxui.widget.plugins.DataGrid.HoverPreview");_1.require("mxui.widget.DataGrid");_1.require("mxui.widget.Tooltip");_1.require("mxui.html.render");if(!mxui.widget.plugins){mxui.widget.plugins={};}if(!mxui.widget.plugins.DataGrid){mxui.widget.plugins.DataGrid={};}mxui.widget.plugins.DataGrid.HoverPreview=function(_4){var _5="mxui.widget.plugins.DataGrid.HoverPreview";var _6=_4.parent;var _7=_4.config;var _8=null;var _9=0;var _a={onLoad:"plugineventOnLoad",onRefresh:"plugineventOnRefresh",onDestroy:"plugineventOnDestroy",onRowMouseOver:"plugineventOnRowMouseOver",onRowMouseOut:"plugineventOnRowMouseOut"};var _b=null;var _c=null;var _d={active:false,node:null,mxobject:null,oldNode:null,firstTime:true,closable:true,closeTimer:null,openTimer:null};var _e=null;var _f;var _10=function(){var b=_d.mxobject;var _11=new mendix.lib.MxContext();_11.setTrackId(b.getGuid());_11.setTrackEntity(_6.entity);_11.setContext(_6.entity,b.getGuid());_9=+new Date();_8.applyContext(_11,(function(_12,_13){return function(){if(_13==_9&&_12==_d.mxobject){var dv=_2.findWidgets(_b)[0];mxui.widget.showTooltip(_b,_d.node,null,dv);}};})(b,_9));mx.ui.destroyContext(_11);};var _14=function(){var _15=new mendix.lib.MxContext();_8.applyContext(_15);mx.ui.destroyContext(_15);};var _16=function(e){e.stopPropagation();_17();};var _18=function(e){e.stopPropagation();_19();};var _1a=function(){_e=_1.connect(_b,"mouseover",_16);_f=_1.connect(_b,"mouseleave",_18);};var _1b=function(){_1.disconnect(_e);_1.disconnect(_f);_e=_f=null;};var _1c=function(){_d.active=false;_d.firstTime=true;if(_d.oldNode!=null){_1b();mxui.widget.hideTooltip(_d.oldNode);_d.oldNode=null;_d.mxobject=null;_8.suspend();_14();}};var _1d=function(){var _1e=mxui.dom.coords(_d.node);if(!_1e.x&&!_1e.y){return;}if(_d.oldNode!=_d.node){_1a();_d.active=true;_d.oldNode=_d.node;mxui.widget.showTooltip(null,_d.node);_8.resume();_10();}};this.plugineventOnLoad=function(e){};this.plugineventOnDestroy=function(e){this.destroy();if(_d.active){_1c();}};this.plugineventOnRefresh=function(e){if(_d.active){_1c();}};var _19=function(){_d.closable=true;if(!_d.closeTimer){_d.closeTimer=setTimeout(_1f,200);}};var _17=function(){_d.closable=false;if(_d.closeTimer){clearTimeout(_d.closeTimer);_d.closeTimer=null;}};var _20=mxui.dom.getAncestorNode;this.plugineventOnRowMouseOver=function(e){var _21=e.currentTarget;var _22=e.target;if(!_6.domData(_22,"key")){_22=_20(_22,"TD",3);}var _23=_6.domData(_22,"key");var _24=_7.hoveron||"";if(_24.match(_23)==null){return true;}_22.setAttribute("title","");_17();var _25=_6.getMxObjectAtRow(parseInt(_6.domData(_21,"gridrow")));var _26=_25.getGuid();if(_d.mxobject==null||_26!=_d.mxobject.getGuid()){_21=_22;_d.mxobject=_25;_d.node=_21;}_d.openTimer=setTimeout(_1d,200);};var _1f=_1.hitch(this,function(){_d.closeTimer=null;if(_d.closable){_c&&clearTimeout(_c);_1c();}});this.plugineventOnRowMouseOut=function(e){_19();var _27=parseInt(e.currentTarget.getAttribute("gridrow"));var _28=_6.getMxObjectAtRow(_27);if(_d.mxobject==_28){clearTimeout(_d.openTimer);}};this.destroy=function(){_1f();_6=_7=_b=null;_8&&_8.destroy();};this.actFetchForm=function(_29){var _2a=_7.form.replace(/\.mxf/,"$Popup.mxf");mx.ui.getForm(_2a,{params:{readOnly:true,hideControls:true},callback:function(_2b){_8=_2b;_b=_2b.domNode;_8.startup(_29);}});};this.actSetupRegistrations=function(_2c){for(var i in _a){_6.registerToPluginEvent(i,_1.hitch(this,_a[i]));}_2c();};if(!_6&&(_6.widgetType!="DataGrid")){throw new Error(_5+".initialize : can only register to DataGrid!");}if(!_7.form){throw new Error(_5+".initialize : Requires a path parameter!");}mendix.lang.sequence(["actFetchForm","actSetupRegistrations"],this);};});