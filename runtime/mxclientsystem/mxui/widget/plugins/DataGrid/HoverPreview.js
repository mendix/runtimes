
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/plugins/DataGrid/HoverPreview",["mxui/widget","mxui/dom","mendix/logger","dojo/on","dojo/_base/lang","dijit"],function(_1,_2,_3,_4,_5,_6){function _7(_8){var _9="mxui.widget.plugins.DataGrid.HoverPreview";var _a=_8.parent;var _b=_8.config;var _c=null;var _d=0;var _e={onLoad:"plugineventOnLoad",onRefresh:"plugineventOnRefresh",onDestroy:"plugineventOnDestroy",onRowMouseOver:"plugineventOnRowMouseOver",onRowMouseOut:"plugineventOnRowMouseOut"};var _f=null;var _10=null;var _11={active:false,node:null,mxobject:null,oldNode:null,firstTime:true,closable:true,closeTimer:null,openTimer:null};var _12=null;var _13;var _14=function(){var b=_11.mxobject;var _15=new mendix.lib.MxContext();_15.setTrackId(b.getGuid());_15.setTrackEntity(_a.entity);_15.setContext(_a.entity,b.getGuid());_d=+new Date();_c.applyContext(_15,(function(_16,_17){return function(){if(_17==_d&&_16==_11.mxobject){var dv=_6.findWidgets(_f)[0];_1.showTooltip(_f,_11.node,null,dv);}};})(b,_d));window.mx.ui.destroyContext(_15);};var _18=function(){var _19=new mendix.lib.MxContext();_c.applyContext(_19);window.mx.ui.destroyContext(_19);};var _1a=function(e){e.stopPropagation();_1b();};var _1c=function(e){e.stopPropagation();_1d();};var _1e=function(){_12=_4(_f,"mouseover",_1a);_13=_4(_f,"mouseleave",_1c);};var _1f=function(){_12.remove();_13.remove();_12=_13=null;};var _20=function(){_11.active=false;_11.firstTime=true;if(_11.oldNode!=null){_1f();_1.hideTooltip(_11.oldNode);_11.oldNode=null;_11.mxobject=null;_c.suspend();_18();}};var _21=function(){var _22=_2.coords(_11.node);if(!_22.x&&!_22.y){return;}if(_11.oldNode!=_11.node){_1e();_11.active=true;_11.oldNode=_11.node;_1.showTooltip(null,_11.node);_c.resume();_14();}};this.plugineventOnLoad=function(e){};this.plugineventOnDestroy=function(e){this.destroy();if(_11.active){_20();}};this.plugineventOnRefresh=function(e){if(_11.active){_20();}};var _1d=function(){_11.closable=true;if(!_11.closeTimer){_11.closeTimer=setTimeout(_23,200);}};var _1b=function(){_11.closable=false;if(_11.closeTimer){clearTimeout(_11.closeTimer);_11.closeTimer=null;}};this.plugineventOnRowMouseOver=function(e){var _24=e.currentTarget;var _25=e.target;if(!_a.domData(_25,"key")){_25=_2.getAncestorNode(_25,"TD",3);}var _26=_a.domData(_25,"key");var _27=_b.hoveron||"";if(_27.match(_26)==null){return true;}_25.setAttribute("title","");_1b();var _28=_a.getMxObjectAtRow(parseInt(_a.domData(_24,"gridrow")));var _29=_28.getGuid();if(_11.mxobject==null||_29!=_11.mxobject.getGuid()){_24=_25;_11.mxobject=_28;_11.node=_24;}_11.openTimer=setTimeout(_21,200);};var _23=_5.hitch(this,function(){_11.closeTimer=null;if(_11.closable){_10&&clearTimeout(_10);_20();}});this.plugineventOnRowMouseOut=function(e){_1d();var _2a=parseInt(e.currentTarget.getAttribute("gridrow"));var _2b=_a.getMxObjectAtRow(_2a);if(_11.mxobject==_2b){clearTimeout(_11.openTimer);}};this.destroy=function(){_23();_a=_b=_f=null;_c&&_c.destroy();};this.actFetchForm=function(_2c){var _2d=_b.form.replace(/\.mxf/,"$Popup.mxf");window.mx.ui.getForm(_2d,{params:{readOnly:true,hideControls:true},callback:function(_2e){_c=_2e;_f=_2e.domNode;_c.startup(_2c);}});};this.actSetupRegistrations=function(_2f){for(var i in _e){_a.registerToPluginEvent(i,_5.hitch(this,_e[i]));}_2f();};if(!_a&&(_a.widgetType!="DataGrid")){throw new Error(_9+".initialize : can only register to DataGrid!");}if(!_b.form){throw new Error(_9+".initialize : Requires a path parameter!");}mendix.lang.sequence(["actFetchForm","actSetupRegistrations"],this);};return _7;});