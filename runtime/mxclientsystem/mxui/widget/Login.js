
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/Login",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.widget.Login");_1.declare("mxui.widget.Login",mxui.widget.Dialog,{autoFocus:false,closable:false,_userNode:null,_passNode:null,_cancelBtn:null,_hasError:false,_shown:false,buildRendering:function(){var $=mxui.dom.create,_4,_5,_6;this.caption=this.translate("loginButton");this.inherited(arguments);_1.addClass(this.domNode,"mx-login");this.domNode.removeChild(this._contentNode);this._contentNode=_4=$("form",{"class":"modal-content mx-dialog-content"},this._headerNode,this._bodyNode,this._footerNode);this.domNode.appendChild(_4);this.setContent($("#",_5=this._userNode=$("input",{"class":"form-control",name:"username",type:"text",autocorrect:"off",autocapitalize:"none",placeholder:this.translate("username")}),_6=this._passNode=$("input",{"class":"form-control",name:"password",type:"password",autocorrect:"off",autocapitalize:"none",placeholder:this.translate("password")})));if(_5.placeholder==null){_5.parentNode.insertBefore($("label",this.translate("username")),_5);_6.parentNode.insertBefore($("label",this.translate("password")),_6);}var _7=$("button",{type:"submit","class":"btn btn-primary"},this.translate("loginButton")),_8=this._cancelBtn=$("button",{"class":"btn"},"Cancel");this.setButtons([_7,_8]);this.connect(_5,"keydown","reset");this.connect(_6,"keydown","reset");this.connect(_4,"submit","submit");this.connect(_8,"click",function(){this.hide();});},translate:function(_9){return window.i18nMap[_9];},getStatusMessage:function(_a){return this.translate("http"+_a)||this.translate("httpdefault");},submit:function(e){var _b=this;_1.xhrPost({url:mx.baseUrl,handleAs:"json",contentType:"application/json",postData:_1.toJson({action:"login",params:{username:this._userNode.value,password:this._passNode.value}}),handle:function(_c,_d){var _e=_d.xhr.status;if(_e==200){_b._passNode.value="";mx.login();}else{_b.setCaption(_b.getStatusMessage(_e));_1.addClass(_b.domNode,"error");_b._hasError=true;}}});_1.stopEvent(e);},show:function(_f){if(_f&&(!_f.no_alert||/402|404|500|503/.test(_f.http_code))){this.setCaption(_f.http_code==401?mx.ui.translate("mendix.session","session_expired"):this.getStatusMessage(_f.http_code));}this._cancelBtn.style.display=mx.isLoaded()?"":"none";this.inherited(arguments);if(this._shown){this._passNode.focus();}else{this._userNode.focus();this._shown=true;}},reset:function(){if(this._hasError){this._hasError=false;this.setCaption(this.translate("loginButton"));_1.removeClass(this.domNode,"error");}}});});