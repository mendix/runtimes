
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/_Grid",["dojo","dijit","dojox","dojo/require!dojo/fx,mxui/lib/MxGridConfig,mxui/mixin/_OverflowHelper,mxui/mixin/_Contextable,mxui/mixin/_Pluggable,mxui/mixin/_Scriptable,mxui/mixin/_Internationalized"],function(_1,_2,_3){_1.provide("mxui.widget._Grid");_1.require("dojo.fx");_1.require("mxui.lib.MxGridConfig");_1.require("mxui.mixin._OverflowHelper");_1.require("mxui.mixin._Contextable");_1.require("mxui.mixin._Pluggable");_1.require("mxui.mixin._Scriptable");_1.require("mxui.mixin._Internationalized");mxui.widget.declare("mxui.widget._Grid",{mixins:[_2._TemplatedMixin,mxui.mixin._Contextable,mxui.mixin._Scriptable,mxui.mixin._Pluggable,mxui.mixin._OverflowHelper],baseClass:"mx-grid",css:mxui.widget.createCSSMap("mx-grid",{pagingStatus:"paging-status",searchButton:"search-button",resetButton:"reset-button"}),entity:"",schema:"",reference:"",useContext:false,reqConstraints:"",xpathConstraint:"",customDataSource:null,pagingBarNode:null,searchNode:null,toolBarNode:null,messageNode:null,searchButton:null,resetButton:null,_dataSource:null,_gridConfig:null,_gridState:null,_metaEntity:null,_toolWidgets:null,_pagingStatusNode:null,fetchMetaObject:function(){this._metaEntity=mx.meta.getEntity(this.entity);if(this._metaEntity==null){logger.error(this.id+": This grid has been configured for an entity the current user doesn't have access to.");return false;}return true;},_saveSelection:function(){this.mxform.setReturnValue("selection",this._getSelectedGuids());},setupGridConfig:function(){this._gridConfig=new mxui.lib.MxGridConfig({config:this.config,nested:this.nested});},setupGridState:function(){var _4=this._gridConfig,_5=this._gridState;_5.updateperiod=_4.gridSetting("refresh");_5.searchbar=_4.gridSetting("searchbar");_5.controlbar=_4.gridSetting("controlbar");_5.pagingbar=_4.gridSetting("pagingbar");_5.selectionmode=_4.gridSetting("selectionmode");_5.editable=_4.gridSetting("editable");_5.showemptyrows=_4.gridSetting("showemptyrows");_5.selectfirst=_4.gridSetting("selectfirst");_5.selectable=(_5.selectionmode!=="none");if(this.selectable){_5.selectable=/^(single|multi)$/.test(this.selectable);if(this.selectable!=="multi"||_5.selectionmode!=="simplemulti"){_5.selectionmode=this.selectable;}this.mxform.setReturnValue("selection",[]);}},setupDataSource:function(){var _6=this._gridConfig,_7=_6.getDataSource(),_8;if(this.customDataSource){_8=this.customDataSource;_8.setPageSize(_6.gridSetting("pageSize"));_8.setOffset(0);var _9=_6.gridSetting("sortparams");if(_9){_8.setSortOptions(_9[0][0],_9[0][1]);}}else{if(_7){var _a=this instanceof mxui.widget.DataGrid?this.schema:"";if(_7.microflow){_8=new mendix.lib.MicroflowSource({microflow:_7.microflow.name,queryid:_a,context:this.mxcontext,page:_6.gridSetting("pageSize")});}else{if(_7.entityPath){_8=new mendix.lib.EntityPathSource({path:_7.entityPath.path,queryid:_a,context:this.mxcontext,page:_6.gridSetting("pageSize")});}else{_8=new mendix.lib.XPathSource({entity:this.entity,queryid:_a,constraint:this.constraint,useContext:this.useContext,context:this.mxcontext,page:_6.gridSetting("pageSize"),sortparams:_6.gridSetting("sortparams"),aggregates:"Calculations" in this._gridConfig.getPlugins()});}}}}this._dataSource=_8;},resizeGrid:function(){this.contentNode.scrollTop=0;},setUpdateInterval:function(){var _b=this._gridState.updateperiod;if(_b&&_b.toString()!="0"){this.clearInterval();this._gridState.update=setInterval(_1.hitch(this,"reload"),parseInt(_b*1000,10));}},clearInterval:function(){if(this._gridState.update!=null){clearInterval(this._gridState.update);}},setupDevMode:function(_c){if(mx.session.inDevMode()){this.devBlock=new mxui.widget.MxDevBlock({parent:this,xpath:true,guid:false});}},shareSelected:function(){var _d=this.createContext();_d.setTrackEntity(this._metaEntity.getEntity());var _e=this._getCurrentGuid();if(_e){_d.setContext(this._metaEntity.getEntity(),_e);}else{_d.setContext(this._metaEntity.getEntity(),null);}_d.freeze();this.notifyListeners(_d);mx.ui.cleanContext(_d.ident,this);},actionSelectPage:function(_f){if(!this._gridState.invertedSelection){for(var i=0,_10=this._dataSource.getObjects(),_11;_11=_10[i];i++){this._addObjectToSelection(_11);}}this._saveSelection();this.refreshGrid();},actionSelectAllPages:function(_12){this._clearSelection();this._gridState.invertedSelection=true;this.refreshGrid();},actionClearSelection:function(_13){if(this._getSelectedGuids().length>0||this._gridState.invertedSelection){this._clearSelection();this._gridState.invertedSelection=false;this.refreshGrid();}},actionEditSelection:function(_14){var _15=this._getSelectedGuids();if(_15.length===0&&!this._gridState.invertedSelection){mx.ui.info(mx.ui.translate("mxui.widget.DataGrid","no_selection"));}else{for(var i=0,obj;obj=_15[i];i++){var _16=this._dataSource.getObject(obj),_17=_14[_16.getEntity()];if(_17){var _18=this.createContext();_18.dupFrom(this.mxcontext);_18.setObject(null,_16.getEntity(),_16.getGuid());mx.ui.execute(_17,{context:_18});}}}},actionInsertNew:function(_19){var _1a=this._getEntity(_19),_1b=_19[_1a];if(_1b&&_1a){mx.data.create({entity:_1a,context:this.useContext?this.mxcontext:null,persistent:_1b.persistent,callback:function(obj){if(!this.useContext){var _1c=this._gridConfig.getDataSource(),_1d=_1c.entityPath&&_1c.entityPath.path||this.reference,_1e=_1d.split("/"),_1f=this.mxcontext.getTrackId();if(_1e.length==2&&_1f){var _20=_1e[1];if(obj.isReference(_20)){obj.set(_20,_1f);}}}var _21=this.createContext();_21.setContext(obj);mx.ui.execute(_1b,{context:_21});},error:function(e){mx.onError(e);}},this);}},selectRow:function(row){this._gridState.invertedSelection?_1.removeClass(row,"selected"):_1.addClass(row,"selected");},deselectRow:function(row){!this._gridState.invertedSelection?_1.removeClass(row,"selected"):_1.addClass(row,"selected");},postCreate:function(){var req=this.reqConstraints,ref=this.reference;this.reqConstraints=req?req.split(","):[];if(ref){this.reqConstraints.push(ref.substr(0,ref.indexOf("/")));}var box=this.addFocusBox(this.controlNode);box.pressed({RIGHT_ARROW:box.FOCUS_NEXT,LEFT_ARROW:box.FOCUS_PREV});this.offerInterfaces(["close"]);this.initContext();if(this.fetchMetaObject()){this.setupGridConfig();this.setupGridState();this.buildSearchBar();this.buildControlBar();this.buildToolBar();this.buildPagingBar();this.setupDevMode();this.setupDataSource();}},getSchemaId:function(){return this.schema;},postCreateSpecific:function(){},getSelected:function(){return this._getSelectedGuids();},deselectAll:function(){this._clearSelection();this.deselectGridRows();},registerSubscriptions:function(){this.removeSubscriptions();var _22=this.mxcontext.getTrackId();if(_22){this.subscribe({guid:this.mxcontext.getTrackId(),callback:_1.hitch(this,"objectUpdate")});}this.subscribe({entity:this.entity,callback:_1.hitch(this,"objectUpdate")});},eventItemClicked:function(e,_23){if(!this._gridState.selectable){return;}var _24=this._gridState.selectionmode,_25=this.domData(_23,"mendixguid"),_26=this._getSelectedGuids(),_27=_1.indexOf(_26,_25),_28=_24!="singleandmaintain"||_26.length>1;if(_25){var obj=this._dataSource.getObject(_25);if(_24=="simplemulti"||_24=="multi"&&(_1.isMac&&e.metaKey||e.ctrlKey)){if(_27==-1){this.selectRow(_23);this._addObjectToSelection(obj);}else{if(_28){this.deselectRow(_23);this._removeObjectFromSelection(obj);}}}else{if(_27==-1){this.deselectAll();this.selectRow(_23);this._addObjectToSelection(obj);}else{if(_28){this.deselectRow(_23);this._removeObjectFromSelection(obj);}}}this.shareSelected();}},eventActionBindingHandler:function(_29,_2a){var _2b=this._gridConfig.gridActionBindings(),_2c=this._gridConfig.getActionsByKey(_2b["on"+_2a]),_2d=_2c?this["action"+_2c.actionCall]:null,_2e=this._getObjectFromNode(_29);if(this._gridState.invertedSelection){return;}if(_2c&&_2d&&_29&&_2e){if(this._gridState.selectable){this.deselectAll();mxui.dom.clearSelection();this.selectRow(_29);}this._addObjectToSelection(_2e);_2d&&_2d.call(this,_2c.params);}else{}},eventControlBarButtonClicked:function(e){var _2f=e.currentTarget,_30=_2f.getAttribute("data-mendix-id");if(_30){var _31=this._gridConfig.getActionsByKey(_30);if(_31){if(_31.actionCall==="ActionSelected"){_31.actionCall="EditSelection";}else{if(_31.actionCall==="Create"){_31.actionCall="InsertNew";}}var _32="action"+_31.actionCall;if(this[_32]){this[_32](_31.params);}else{logger.error(this.id+".eventControlBarButtonClicked: Called function '"+_32+"' does not exist in this component");}}else{logger.error(this.id+".eventControlBarButtonClicked: Action with action key '"+_30+"' is not defined");}}else{logger.error(this.id+".eventControlBarButtonClicked: No action key defined!");}},actionInvokeMicroflow:function(_33){this.triggerPluginEvent("invokeMicroflow",null,_1.hitch(this,"invokeMicroflow",_33));},invokeMicroflow:function(_34){var _35=this.entity,_36=_34[_35],_37=_36.microflow,_38={applyto:_36.applyTo};if(_36&&_35){var _39=this._gridState.invertedSelection,_3a=this._getSelectedGuids(),_3b=this._dataSource,_3c=this.schema,_3d;switch(_36.applyTo){case "selection":if(_39){_3d=[];_3b.each(function(obj){var _3e=obj.getGuid();if(_1.indexOf(_3a,_3e)===-1){_3d.push(_3e);}});}else{_3d=_3a;}if(_3d.length===0){mx.ui.info(mx.ui.translate("mxui.widget.DataGrid","no_selection"));return;}_38.guids=_3d;if(_3d.length===1){_38.gridid=_3c;}break;case "all":_3d=_1.clone(_3b.getObjects());_1.mixin(_38,{guids:_3d,applyto:"selection"});if(_3d.length===1){_38.gridid=_3c;}break;case "selectionset":var _3f,_40,_41;if(_39){_41=_3b.getSetSize()-_3a.length;_3f=_3b.getCurrentXPath();}else{_41=_3a.length;_3f="//"+_35;}if(_41===0){mx.ui.info(mx.ui.translate("mxui.widget.DataGrid","no_selection"));return;}var _42=[];for(var i=0,id;id=_3a[i];++i){var obj=_3b.getObject(id);_42.push("id"+(_39?"!=":"=")+"\""+id+"\"");}if(_42.length===0){_40="";}else{_40="["+_42.join(_39?" and ":" or ")+"]";}_1.mixin(_38,{xpath:_3f,constraints:_40,sort:_3b.getSortSettings()});if(_41===1){_38.gridid=_3c;}break;case "set":if(_3b.getSetSize()===0){_38.applyto="none";}else{_1.mixin(_38,{xpath:_3b.getCurrentXPath(),sort:_3b.getSortSettings()});}break;}var _43=this,_44=_37.confirmation,_45=[];var _46=function(cb){mx.ui.confirmation({cancel:_44.cancel,proceed:_44.proceed,content:_44.question,handler:cb});};if(this.actTriggerOnSync){_45.push("actTriggerOnSync");}if(this.actDeferSyncAction){_45.push("actDeferSyncAction");}var run=function(_47){mx.ui.execute({microflow:_37},{params:_38,context:_43.mxcontext,store:{caller:_43},callback:_47});};if(_44){_45.push(_46);}if(_37&&_37.validate==="view"){_45.push(_1.hitch(this.mxform,"validate"));}_45.push(run);_45.push(function(_48){if(!(this._destroyed||_36.maintainSelection||this._gridState.selectionmode=="singleandmaintain")){this.deselectAll();this.shareSelected();}_48();});this.sequence(_45);}},actionReturnSelection:function(_49){var _4a=this,_4b=this.mxform;this._saveSelection();_4b.suspend();_4b.validate(function(){_4b.suspend();var _4c=function(e){_4b.resume();if(!(e instanceof mendix.lib.ValidationError)){mx.onError(e);}};_4b.save(function(){_4b.commit(function(){_4b.dispose();},_4c);},_4c);});},controlNode:null,_setToolbarAttr:function(_4d){for(var i=0,btn;btn=this._toolWidgets[i++];){btn.set("disabled",_4d);}},buildControlBar:function(){if(!this._gridState.controlbar&&!this._gridState.pagingbar){this.controlNode.style.display="none";}},buildToolBar:function(){this._toolWidgets=[];if(!this._gridState.controlbar){this.toolBarNode.style.display="none";return;}var _4e=this._gridConfig.gridTools();var box=this.getFocusBox(this.controlNode);var _4f=document.createDocumentFragment();for(var i in _4e){var _50=_4e[i];var _51=new mxui.widget.Button({"mxid":_50.mxid,"caption":_50.title,"iconUrl":_50.icon,"onClick":_1.hitch(this,"eventControlBarButtonClicked"),"cssClasses":_50.cssClass,"cssStyle":_50.cssStyle});this._toolWidgets.push(_51);var _52=_51.domNode;try{if(_4e[i].gridFunction){_52.setAttribute("gridFunction",_4e[i].gridFunction);_52.setAttribute("param",_4e[i].param);if(_4e[i].background){_52.setAttribute("background-job",_4e[i].background);}if(_4e[i].progress){_52.setAttribute("progress",_4e[i].progress);}if(_4e[i].message){_52.setAttribute("message",_4e[i].message);}}if(i>0){_4e[i-1]._nextNode=_52;}_4e[i]._domNode=_52;_4f.appendChild(_52);_4f.appendChild(document.createTextNode(" "));box.add(_52);_51.startup();}catch(e){}}this.toolBarNode.appendChild(_4f);mxui.dom.disableSelection(this.toolBarNode);},buildPagingBar:function(){if(!this._gridState.pagingbar){this.pagingBarNode.style.display="none";return;}var ltr=this.isLeftToRight(),css=this.css,_53=document.createDocumentFragment(),box=this.getFocusBox(this.controlNode),$=mxui.dom.create;this.btFirst=new mxui.widget.Button({iconClass:"glyphicon "+(ltr?"glyphicon-step-backward":"glyphicon-step-forward"),"onClick":_1.hitch(this,"eventPagingFirstClicked")});_53.appendChild($("#",this.btFirst.domNode," "));box.add(this.btFirst.domNode);this.btPrevious=new mxui.widget.Button({iconClass:"glyphicon "+(ltr?"glyphicon-backward":"glyphicon-forward"),"onClick":_1.hitch(this,"eventPagingPreviousClicked")});_53.appendChild($("#",this.btPrevious.domNode," "));box.add(this.btPrevious.domNode);this._pagingStatusNode=mxui.dom.div({"class":"dijitInline "+this.css.pagingStatus});_53.appendChild($("#",this._pagingStatusNode," "));this.btNext=new mxui.widget.Button({iconClass:"glyphicon "+(ltr?"glyphicon-forward":"glyphicon-backward"),"onClick":_1.hitch(this,"eventPagingNextClicked")});_53.appendChild($("#",this.btNext.domNode," "));box.add(this.btNext.domNode);this.btLast=new mxui.widget.Button({iconClass:"glyphicon "+(ltr?"glyphicon-step-forward":"glyphicon-step-backward"),"onClick":_1.hitch(this,"eventPagingLastClicked")});_53.appendChild($("#",this.btLast.domNode," "));box.add(this.btLast.domNode);this.pagingBarNode.appendChild(_53);mxui.dom.disableSelection(this.pagingBarNode);},updatePagingStatus:function(_54){if(!this._gridState.pagingbar){return;}var _55=this._dataSource.getStatusMessage();mxui.html.setContent(this._pagingStatusNode,_55);if(this._dataSource.atBeginning()){this.btFirst.set("disabled",true);this.btPrevious.set("disabled",true);}else{this.btFirst.set("disabled",false);this.btPrevious.set("disabled",false);}if(this._dataSource.atEnd()){this.btNext.set("disabled",true);this.btLast.set("disabled",true);}else{this.btNext.set("disabled",false);this.btLast.set("disabled",false);}},eventPagingFirstClicked:function(){if(!this._dataSource.atBeginning()){this._dataSource.first(_1.hitch(this,"refreshGrid"));}},eventPagingPreviousClicked:function(){if(!this._dataSource.atBeginning()){this._dataSource.previous(_1.hitch(this,"refreshGrid"));}},eventPagingNextClicked:function(){if(!this._dataSource.atEnd()){this._dataSource.next(_1.hitch(this,"refreshGrid"));}},eventPagingLastClicked:function(){if(!this._dataSource.atEnd()){this._dataSource.last(_1.hitch(this,"refreshGrid"));}},_searchElements:null,_searchFilled:false,searchArgumentNode:null,searchControlNode:null,_searchGetConstraints:function(){var _56="";var _57=[];_1.forEach(this._searchElements,function(_58){var _59=_58.get("value");(_59!=="")&&_57.push(_59);});if(_57.length){_56="["+_57.join(" and ")+"]";}return _56+this._gridState.xpathConstraint;},buildSearchBlock:function(){var css=this.CSS,$=mxui.dom.create;if(this._gridState.isSearchBuild){return;}this._gridState.isSearchBuild=true;var _5a=this.searchButton=new mxui.widget.Button({"caption":mx.ui.translate("mxui.widget.DataGrid",["search"]),"onClick":_1.hitch(this,"eventSearchActivated"),"class":this.css.searchButton});this.searchControlNode.appendChild($("#",_5a.domNode," "));var _5b=this.resetButton=new mxui.widget.Button({"caption":mx.ui.translate("mxui.widget.DataGrid",["reset"]),"onClick":_1.hitch(this,"eventSearchResetClicked"),"class":this.css.resetButton});this.searchControlNode.appendChild($("#",_5b.domNode," "));var _5c=document.createDocumentFragment();this._searchElements=_1.map(this._gridConfig.searchBarItems(),_1.hitch(this,function(_5d){var _5e=new mxui.widget.SearchInput(_1.mixin({entity:this.entity,mxcontext:this.mxcontext},_5d));this.connect(_5e,"onKeyUp","eventSearchActivated");_5c.appendChild(_5e.domNode);_5e.startup();return _5e;}));this.searchArgumentNode.appendChild(_5c);},buildSearchBar:function(){if(!this._gridState.searchbar){this.searchNode.style.display="none";this._searchFilled=true;return;}var _5f=this._gridConfig.searchBarConfig();if(_5f){this._gridState.searchBarVisible=!_5f.startFolded;this._gridState.searchBarTogglable=!!_5f.foldable;}else{this._gridState.searchBarVisible=true;}if(!this._gridState.searchBarVisible){var _60=false;var _61=this._gridConfig.searchBarItems();for(var i in _61){var _62=_61[i];if(_62.defaults){this.buildSearchBlock();_60=true;break;}}this.searchNode.style.display="none";this._gridState.isSearchBuild=_60;}else{this.buildSearchBlock();this.searchNode.style.display="";}this.checkSearchFields();},eventSearchActivated:function(e){var _63=this;_1.stopEvent(e);var _64=this.searchButton;var _65=_1.hitch(this,function(){this._clearSelection();this.refreshGrid();if(this.triggerOnSearchChanged){this.triggerOnSearchChanged();}_64.set("disabled",false);});var _66=false;if(e.type==="click"){this.checkSearchFields();_66=true;}else{if(e.shiftKey&&e.keyCode===13){}else{if(e.keyCode===13){this.checkSearchFields();_66=true;}}}if(!this.constraintsFilled()){_66=false;}if(_66){_64.set("disabled",true);this._dataSource.isValid(function(_67){if(_67){_63._dataSource.setConstraints(_63._searchGetConstraints(),_65);}else{_64.set("disabled",false);}});}},eventSearchResetClicked:function(e){var _68=this._dataSource;_1.forEach(this._searchElements,function(_69){_69.reset();});this.checkSearchFields();_68.setConstraints(this._searchGetConstraints());var _6a=_1.hitch(this,function(){this.refreshGrid();if(this.triggerOnSearchChanged){this.triggerOnSearchChanged();}});if(this.constraintsFilled()){_68.isValid(function(_6b){if(_6b){_68.refresh(_6a);}else{_68.clean(_6a);}});}},checkSearchFields:function(){var _6c=this._gridConfig.gridSetting("waitforsearch");if(!_6c){this._searchFilled=true;return;}this._searchFilled=_1.some(this._searchElements,_1.hitch(this,function(_6d){if(_6d.get("value")!==""){this.messageNode.innerHTML="";this.messageNode.style.display="none";return true;}}));if(!this._searchFilled){this.messageNode.innerHTML=mx.ui.translate("mxui.widget.DataGrid","waitForSearch");this.messageNode.style.display="block";}},constraintsFilled:function(){if(!this._searchFilled){return false;}for(var i=0,_6e;_6e=this.reqConstraints[i];i++){if(!this.mxcontext.getContext(_6e)){return false;}}return true;},reload:function(_6f){if(this.constraintsFilled()){var _70=this;this._dataSource.isValid(function(_71){if(_71){_70._dataSource.refresh(function(){_70.refreshGrid();_6f&&_6f();});}});}},actionToggleSearch:function(_72){var _73=this;if(!this._gridState.searchBarTogglable){return;}this.buildSearchBlock();if(!(this._gridState.searchBarVisible=!this._gridState.searchBarVisible)){this._searchWipeOut=this._searchWipeOut||_1.fx.wipeOut({node:this.searchNode,duration:200,onEnd:function(){setTimeout(function(){_73.resize(_73._resizeBox);},0);_1.forEach(_73._searchElements,function(_74){_74.cleanup();});}});this._searchWipeOut.play();}else{this._searchWipeIn=this._searchWipeIn||_1.fx.wipeIn({node:this.searchNode,duration:200,onEnd:function(){setTimeout(function(){_73.showOverflow();_73.resize(_73._resizeBox);},0);try{_1.some(_73._searchElements,function(_75){if(!_75.get("hidden")){_75.focus();return true;}});}catch(e){}}});this.hideOverflow();this._searchWipeIn.play();}},applyContext:function(_76,_77){var _78=this;if(this._metaEntity==null){_77&&_77();return;}if(!this._dataSource){logger.error(this.id+".applyContext: Applying context before rendered!!!");_77&&_77();return;}this._clearSelection();this.cloneContext(_76);this.setUpdateInterval();this._gridState.xpathConstraint=this.xpathConstraint;var _79=this.mxcontext.getParam("xpathConstraint");if(_79){this._gridState.xpathConstraint+=_79;}this.removeSubscriptions();this.registerSubscriptions();if(this.reference){var _7a=this.reference.split(/\//),_7b=_7a[0],_7c=_7a[1];var id=this.mxcontext.getContext(_7b);if(id){var _7d="["+_7c+"=\""+id+"\"]";this._gridState.xpathConstraint+=_7d;}else{}}if(!this._gridState.inDenial){var _7e=[];if(this.constraintsFilled()){var _7f=[];var _80=function(_81){return function(_82){_81.reinit(_82);};};_1.forEach(this._searchElements,function(_83){_7f.push(_80(_83));});_7e.push(function(cb){this.collect(_7f,cb);});_7e.push(function(_84){if(this._dataSource.setConstraints){this._dataSource.setConstraints(_78._searchGetConstraints());}this._dataSource.reload(_84);});}else{_7e.push("actCleanDS");}this.sequence(_7e,function(){this.filterSelected();this.refreshGrid();this.shareSelected();_77();});}else{_77&&_77();}},objectUpdateNotification:function(){var _85=this;if(!this._gridState.inDenial&&this.constraintsFilled()){this._dataSource.isValid(function(_86){if(_86){_85.sequence([_1.hitch(_85._dataSource,"entityUpdate"),function(_87){this.filterSelected();this.refreshGrid();_87&&_87();}]);}});}},refreshGrid:function(){this.updatePagingStatus();this.fillGrid();this.resizeGrid();},actCleanDS:function(_88){this._clearSelection();this._dataSource.clean(_88);},resumed:function(){this.setUpdateInterval();},suspended:function(){this.clearInterval();},actionDeleteSelection:function(_89){var _8a=this._getSelectedGuids();if(this._gridState.invertedSelection){}else{if(!_8a.length){mx.ui.info(mx.ui.translate("mxui.widget.DataGrid","no_selection"));}else{var _8b=this;var _8c=function(){var _8d=_8a;_8b.deselectAll();_8b.shareSelected();mx.data.remove({guids:_8d,callback:function(){mx.data.sendClassUpdate(_8b.entity);},error:function(e){mx.onError(e);}});};if(_89===true){_8c();}else{mx.ui.confirmation({content:mx.ui.translate("mxui.widget.DataGrid","confirm_delete",_8a.length),handler:_8c});}}}},resize:function(box){var _8e=this.domNode,_8f=this.contentNode;_1.style(_8f,"height","auto");if(box){var _90=_1.marginBox(_8e),_91=_1.marginBox(_8f),_92=box.h-(_90.h-_91.h);if(_92>mxui.dom.minContainerHeight){_1.style(_8f,"height",_92+"px");if(this.headTable){_1.style(this.headTable,"top","0px");}}}this._resizeBox=box;},close:function(){this.disposeContent();},onHide:function(e){_1.forEach(this._searchElements,function(_93){_93.cleanup();});},uninitialize:function(_94){var _95=null;try{this.clearInterval();this.removeSubscriptions();mxui.widget.destroyChildren(this.searchControlNode);mxui.widget.destroyChildren(this.toolBarNode);mxui.widget.destroyChildren(this.pagingBarNode);if(this.itemNode){mxui.widget.destroyChildren(this.itemNode);}if(_95){_95.destroy();}_1.forEach(this._searchElements,function(_96){_96.destroy();});this.devBlock&&this.devBlock.destroyRecursive();}catch(e){logger.error(this.id+".uninitialize : error : "+e.message);}this._dataSource=null;this._gridConfig=null;this._metaEntity=null;this._searchElements=null;}});});