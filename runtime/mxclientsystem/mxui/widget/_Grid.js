
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/_Grid",["require","mxui/mixin/_Contextable","mxui/mixin/_Scriptable","mxui/mixin/_Pluggable","mxui/mixin/_OverflowHelper","mxui/lib/MxGridConfig","mxui/widget/SearchInput","mxui/widget/Button","mxui/widget","mxui/dom","mendix/lib/EntityPathSource","mendix/lib/MicroflowSource","mendix/lib/ValidationError","mendix/lib/XPathSource","mendix/logger","dijit/_TemplatedMixin","dojo/fx","dojo/sniff","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/_base/array","dojo/_base/lang","dojo/_base/event"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18){var _19=_9.declare("mxui.widget._Grid",{mixins:[_10,_2,_3,_4,_5],baseClass:"mx-grid",css:_9.createCSSMap("mx-grid",{pagingStatus:"paging-status",searchButton:"search-button",resetButton:"reset-button"}),entity:"",schema:"",reference:"",useContext:false,reqConstraints:"",xpathConstraint:"",customDataSource:null,pagingBarNode:null,searchNode:null,toolBarNode:null,messageNode:null,searchButton:null,resetButton:null,_dataSource:null,_gridConfig:null,_gridState:null,_metaEntity:null,_toolWidgets:null,_pagingStatusNode:null,fetchMetaObject:function(){this._metaEntity=window.mx.meta.getEntity(this.entity);if(this._metaEntity==null){_f.error(this.id+": This grid has been configured for an entity the current user doesn't have access to.");return false;}return true;},_saveSelection:function(){this.mxform.setReturnValue("selection",this._getSelectedGuids());},setupGridConfig:function(){this._gridConfig=new _6({config:this.config,nested:this.nested});},setupGridState:function(){var _1a=this._gridConfig,_1b=this._gridState;_1b.updateperiod=_1a.gridSetting("refresh");_1b.searchbar=_1a.gridSetting("searchbar");_1b.controlbar=_1a.gridSetting("controlbar");_1b.pagingbar=_1a.gridSetting("pagingbar");_1b.selectionmode=_1a.gridSetting("selectionmode");_1b.editable=_1a.gridSetting("editable");_1b.showemptyrows=_1a.gridSetting("showemptyrows");_1b.selectfirst=_1a.gridSetting("selectfirst");_1b.selectable=(_1b.selectionmode!=="none");if(this.selectable){_1b.selectable=/^(single|multi)$/.test(this.selectable);if(this.selectable!=="multi"||_1b.selectionmode!=="simplemulti"){_1b.selectionmode=this.selectable;}this.mxform.setReturnValue("selection",[]);}},setupDataSource:function(){var _1c=this._gridConfig,_1d=_1c.getDataSource(),_1e;if(this.customDataSource){_1e=this.customDataSource;_1e.setPageSize(_1c.gridSetting("pageSize"));_1e.setOffset(0);var _1f=_1c.gridSetting("sortparams");if(_1f){_1e.setSortOptions(_1f[0][0],_1f[0][1]);}}else{if(_1d){var _20=this instanceof _1("mxui/widget/DataGrid")?this.schema:"";if(_1d.microflow){_1e=new _c({microflow:_1d.microflow.name,queryid:_20,context:this.mxcontext,page:_1c.gridSetting("pageSize")});}else{if(_1d.entityPath){_1e=new _b({path:_1d.entityPath.path,queryid:_20,context:this.mxcontext,page:_1c.gridSetting("pageSize")});}else{_1e=new _e({entity:this.entity,queryid:_20,constraint:this.constraint,useContext:this.useContext,context:this.mxcontext,page:_1c.gridSetting("pageSize"),sortparams:_1c.gridSetting("sortparams"),aggregates:"Calculations" in this._gridConfig.getPlugins()});}}}}this._dataSource=_1e;},resizeGrid:function(){this.contentNode.scrollTop=0;},setUpdateInterval:function(){var _21=this._gridState.updateperiod;if(_21&&_21.toString()!="0"){this.clearInterval();this._gridState.update=setInterval(_17.hitch(this,"reload"),parseInt(_21*1000,10));}},clearInterval:function(){if(this._gridState.update!=null){clearInterval(this._gridState.update);}},shareSelected:function(){var _22=this.createContext();_22.setTrackEntity(this._metaEntity.getEntity());var _23=this._getCurrentGuid();if(_23){_22.setContext(this._metaEntity.getEntity(),_23);}else{_22.setContext(this._metaEntity.getEntity(),null);}_22.freeze();this.notifyListeners(_22);window.mx.ui.cleanContext(_22.ident,this);},actionSelectPage:function(_24){if(!this._gridState.invertedSelection){for(var i=0,_25=this._dataSource.getObjects(),_26;_26=_25[i];i++){this._addObjectToSelection(_26);}}this._saveSelection();this.refreshGrid();},actionSelectAllPages:function(_27){this._clearSelection();this._gridState.invertedSelection=true;this.refreshGrid();},actionClearSelection:function(_28){if(this._getSelectedGuids().length>0||this._gridState.invertedSelection){this._clearSelection();this._gridState.invertedSelection=false;this.refreshGrid();}},actionEditSelection:function(_29){var _2a=this._getSelectedGuids();if(_2a.length===0&&!this._gridState.invertedSelection){window.mx.ui.info(window.mx.ui.translate("mxui.widget.DataGrid","no_selection"));}else{for(var i=0,obj;obj=_2a[i];i++){var _2b=this._dataSource.getObject(obj),_2c=_29[_2b.getEntity()];if(_2c){var _2d=this.createContext();_2d.dupFrom(this.mxcontext);_2d.setObject(null,_2b.getEntity(),_2b.getGuid());window.mx.ui.execute(_2c,{context:_2d});}}}},actionInsertNew:function(_2e){var _2f=this._getEntity(_2e),_30=_2e[_2f];if(_30&&_2f){window.mx.data.create({entity:_2f,context:this.useContext?this.mxcontext:null,persistent:_30.persistent,callback:function(obj){if(!this.useContext){var _31=this._gridConfig.getDataSource(),_32=_31.entityPath&&_31.entityPath.path||this.reference,_33=_32.split("/"),_34=this.mxcontext.getTrackId();if(_33.length==2&&_34){var _35=_33[1];if(obj.isReference(_35)){obj.set(_35,_34);}}}var _36=this.createContext();_36.setContext(obj);window.mx.ui.execute(_30,{context:_36});},error:function(e){window.mx.onError(e);}},this);}},selectRow:function(row){this._gridState.invertedSelection?_13.remove(row,"selected"):_13.add(row,"selected");},deselectRow:function(row){!this._gridState.invertedSelection?_13.remove(row,"selected"):_13.add(row,"selected");},postCreate:function(){var req=this.reqConstraints,ref=this.reference;this.reqConstraints=req?req.split(","):[];if(ref){this.reqConstraints.push(ref.substr(0,ref.indexOf("/")));}var box=this.addFocusBox(this.controlNode);box.pressed({RIGHT_ARROW:box.FOCUS_NEXT,LEFT_ARROW:box.FOCUS_PREV});this.offerInterfaces(["close"]);this.initContext();if(this.fetchMetaObject()){this.setupGridConfig();this.setupGridState();this.buildSearchBar();this.buildControlBar();this.buildToolBar();this.buildPagingBar();this.setupDataSource();}},getSchemaId:function(){return this.schema;},postCreateSpecific:function(){},getSelected:function(){return this._getSelectedGuids();},deselectAll:function(){this._clearSelection();this.deselectGridRows();},registerSubscriptions:function(){this.removeSubscriptions();var _37=this.mxcontext.getTrackId();if(_37){this.subscribe({guid:this.mxcontext.getTrackId(),callback:_17.hitch(this,"objectUpdate")});}this.subscribe({entity:this.entity,callback:_17.hitch(this,"objectUpdate")});},eventItemClicked:function(e,_38){if(!this._gridState.selectable){return;}var _39=this._gridState.selectionmode,_3a=this.domData(_38,"mendixguid"),_3b=this._getSelectedGuids(),_3c=_16.indexOf(_3b,_3a),_3d=_39!="singleandmaintain"||_3b.length>1;if(_3a){var obj=this._dataSource.getObject(_3a);if(_39=="simplemulti"||_39=="multi"&&(_12("mac")&&e.metaKey||e.ctrlKey)){if(_3c==-1){this.selectRow(_38);this._addObjectToSelection(obj);}else{if(_3d){this.deselectRow(_38);this._removeObjectFromSelection(obj);}}}else{if(_3c==-1){this.deselectAll();this.selectRow(_38);this._addObjectToSelection(obj);}else{if(_3d){this.deselectRow(_38);this._removeObjectFromSelection(obj);}}}this.shareSelected();}},eventActionBindingHandler:function(_3e,_3f){var _40=this._gridConfig.gridActionBindings(),_41=this._gridConfig.getActionsByKey(_40["on"+_3f]),_42=_41?this["action"+_41.actionCall]:null,_43=this._getObjectFromNode(_3e);if(this._gridState.invertedSelection){return;}if(_41&&_42&&_3e&&_43){if(this._gridState.selectable){this.deselectAll();_a.clearSelection();this.selectRow(_3e);}this._addObjectToSelection(_43);_42&&_42.call(this,_41.params);}else{}},eventControlBarButtonClicked:function(e){var _44=e.currentTarget,_45=_44.getAttribute("data-mendix-id");if(_45){var _46=this._gridConfig.getActionsByKey(_45);if(_46){if(_46.actionCall==="ActionSelected"){_46.actionCall="EditSelection";}else{if(_46.actionCall==="Create"){_46.actionCall="InsertNew";}}var _47="action"+_46.actionCall;if(this[_47]){this[_47](_46.params);}else{_f.error(this.id+".eventControlBarButtonClicked: Called function '"+_47+"' does not exist in this component");}}else{_f.error(this.id+".eventControlBarButtonClicked: Action with action key '"+_45+"' is not defined");}}else{_f.error(this.id+".eventControlBarButtonClicked: No action key defined!");}},actionInvokeMicroflow:function(_48){this.triggerPluginEvent("invokeMicroflow",null,_17.hitch(this,"invokeMicroflow",_48));},invokeMicroflow:function(_49){var _4a=this.entity,_4b=_49[_4a],_4c=_4b.microflow,_4d={applyto:_4b.applyTo};if(_4b&&_4a){var _4e=this._gridState.invertedSelection,_4f=this._getSelectedGuids(),_50=this._dataSource,_51=this.schema,_52;switch(_4b.applyTo){case "selection":if(_4e){_52=[];_50.each(function(obj){var _53=obj.getGuid();if(_16.indexOf(_4f,_53)===-1){_52.push(_53);}});}else{_52=_4f;}if(_52.length===0){window.mx.ui.info(window.mx.ui.translate("mxui.widget.DataGrid","no_selection"));return;}_4d.guids=_52;if(_52.length===1){_4d.gridid=_51;}break;case "all":_52=_16.map(_50.getObjects(),function(obj){return obj.getGuid();});_17.mixin(_4d,{guids:_52,applyto:"selection"});if(_52.length===1){_4d.gridid=_51;}break;case "selectionset":var _54,_55,_56;if(_4e){_56=_50.getSetSize()-_4f.length;_54=_50.getCurrentXPath();}else{_56=_4f.length;_54="//"+_4a;}if(_56===0){window.mx.ui.info(window.mx.ui.translate("mxui.widget.DataGrid","no_selection"));return;}var _57=[];for(var i=0,id;id=_4f[i];++i){var obj=_50.getObject(id);_57.push("id"+(_4e?"!=":"=")+"\""+id+"\"");}if(_57.length===0){_55="";}else{_55="["+_57.join(_4e?" and ":" or ")+"]";}_17.mixin(_4d,{xpath:_54,constraints:_55,sort:_50.getSortSettings()});if(_56===1){_4d.gridid=_51;}break;case "set":if(_50.getSetSize()===0){_4d.applyto="none";}else{_17.mixin(_4d,{xpath:_50.getCurrentXPath(),sort:_50.getSortSettings()});}break;}var _58=this,_59=_4c.confirmation,_5a=[];var _5b=function(cb){window.mx.ui.confirmation({cancel:_59.cancel,proceed:_59.proceed,content:_59.question,handler:cb});};if(this.actTriggerOnSync){_5a.push("actTriggerOnSync");}if(this.actDeferSyncAction){_5a.push("actDeferSyncAction");}var run=function(_5c){window.mx.ui.execute({microflow:_4c},{params:_4d,context:_58.mxcontext,store:{caller:_58},callback:_5c});};if(_59){_5a.push(_5b);}if(_4c&&_4c.validate==="view"){_5a.push(_17.hitch(this.mxform,"validate"));}_5a.push(run);_5a.push(function(_5d){if(!(this._destroyed||_4b.maintainSelection||this._gridState.selectionmode=="singleandmaintain")){this.deselectAll();this.shareSelected();}_5d();});this.sequence(_5a);}},actionReturnSelection:function(_5e){var _5f=this,_60=this.mxform;this._saveSelection();_60.suspend();_60.validate(function(){_60.suspend();var _61=function(e){_60.resume();if(!(e instanceof _d)){window.mx.onError(e);}};_60.save(function(){_60.commit(function(){_60.dispose();},_61);},_61);});},controlNode:null,_setToolbarAttr:function(_62){for(var i=0,btn;btn=this._toolWidgets[i++];){btn.set("disabled",_62);}},buildControlBar:function(){if(!this._gridState.controlbar&&!this._gridState.pagingbar){this.controlNode.style.display="none";}},buildToolBar:function(){this._toolWidgets=[];if(!this._gridState.controlbar){this.toolBarNode.style.display="none";return;}var _63=this._gridConfig.gridTools();var box=this.getFocusBox(this.controlNode);var _64=document.createDocumentFragment();for(var i in _63){var _65=_63[i];var _66=new _8({"mxid":_65.mxid,"caption":_65.title,"iconUrl":_65.icon,"onClick":_17.hitch(this,"eventControlBarButtonClicked"),"cssClasses":"mx-name-"+_65.name+(_65.cssClass?(" "+_65.cssClass):""),"cssStyle":_65.cssStyle});this._toolWidgets.push(_66);var _67=_66.domNode;try{if(_63[i].gridFunction){_67.setAttribute("gridFunction",_63[i].gridFunction);_67.setAttribute("param",_63[i].param);if(_63[i].background){_67.setAttribute("background-job",_63[i].background);}if(_63[i].progress){_67.setAttribute("progress",_63[i].progress);}if(_63[i].message){_67.setAttribute("message",_63[i].message);}}if(i>0){_63[i-1]._nextNode=_67;}_63[i]._domNode=_67;_64.appendChild(_67);_64.appendChild(document.createTextNode(" "));box.add(_67);_66.startup();}catch(e){}}this.toolBarNode.appendChild(_64);_a.disableSelection(this.toolBarNode);},buildPagingBar:function(){if(!this._gridState.pagingbar){this.pagingBarNode.style.display="none";return;}var ltr=this.isLeftToRight(),_68=document.createDocumentFragment(),box=this.getFocusBox(this.controlNode),$=_a.create;this.btFirst=new _8({iconClass:"glyphicon "+(ltr?"glyphicon-step-backward":"glyphicon-step-forward"),"onClick":_17.hitch(this,"eventPagingFirstClicked"),"class":"mx-name-paging-first"});_68.appendChild($("#",this.btFirst.domNode," "));box.add(this.btFirst.domNode);this.btPrevious=new _8({iconClass:"glyphicon "+(ltr?"glyphicon-backward":"glyphicon-forward"),"onClick":_17.hitch(this,"eventPagingPreviousClicked"),"class":"mx-name-paging-previous"});_68.appendChild($("#",this.btPrevious.domNode," "));box.add(this.btPrevious.domNode);this._pagingStatusNode=$("div",{"class":"dijitInline "+this.css.pagingStatus});_68.appendChild($("#",this._pagingStatusNode," "));this.btNext=new _8({iconClass:"glyphicon "+(ltr?"glyphicon-forward":"glyphicon-backward"),"onClick":_17.hitch(this,"eventPagingNextClicked"),"class":"mx-name-paging-next"});_68.appendChild($("#",this.btNext.domNode," "));box.add(this.btNext.domNode);this.btLast=new _8({iconClass:"glyphicon "+(ltr?"glyphicon-step-forward":"glyphicon-step-backward"),"onClick":_17.hitch(this,"eventPagingLastClicked"),"class":"mx-name-paging-last"});_68.appendChild($("#",this.btLast.domNode," "));box.add(this.btLast.domNode);this.pagingBarNode.appendChild(_68);_a.disableSelection(this.pagingBarNode);},updatePagingStatus:function(_69){if(!this._gridState.pagingbar){return;}var _6a=this._dataSource.getStatusMessage();mxui.html.setContent(this._pagingStatusNode,_6a);if(this._dataSource.atBeginning()){this.btFirst.set("disabled",true);this.btPrevious.set("disabled",true);}else{this.btFirst.set("disabled",false);this.btPrevious.set("disabled",false);}if(this._dataSource.atEnd()){this.btNext.set("disabled",true);this.btLast.set("disabled",true);}else{this.btNext.set("disabled",false);this.btLast.set("disabled",false);}},eventPagingFirstClicked:function(){if(!this._dataSource.atBeginning()){this._dataSource.first(_17.hitch(this,"refreshGrid"));}},eventPagingPreviousClicked:function(){if(!this._dataSource.atBeginning()){this._dataSource.previous(_17.hitch(this,"refreshGrid"));}},eventPagingNextClicked:function(){if(!this._dataSource.atEnd()){this._dataSource.next(_17.hitch(this,"refreshGrid"));}},eventPagingLastClicked:function(){if(!this._dataSource.atEnd()){this._dataSource.last(_17.hitch(this,"refreshGrid"));}},_searchElements:null,_searchFilled:false,searchArgumentNode:null,searchControlNode:null,_searchGetConstraints:function(){var _6b="";var _6c=[];_16.forEach(this._searchElements,function(_6d){var _6e=_6d.get("value");(_6e!=="")&&_6c.push(_6e);});if(_6c.length){_6b="["+_6c.join(" and ")+"]";}return _6b+this._gridState.xpathConstraint;},buildSearchBlock:function(){var $=_a.create;if(this._gridState.isSearchBuild){return;}this._gridState.isSearchBuild=true;var _6f=this.searchButton=new _8({"caption":window.mx.ui.translate("mxui.widget.DataGrid",["search"]),"onClick":_17.hitch(this,"eventSearchActivated"),"class":"mx-name-search "+this.css.searchButton});this.searchControlNode.appendChild($("#",_6f.domNode," "));var _70=this.resetButton=new _8({"caption":window.mx.ui.translate("mxui.widget.DataGrid",["reset"]),"onClick":_17.hitch(this,"eventSearchResetClicked"),"class":"mx-name-reset "+this.css.resetButton});this.searchControlNode.appendChild($("#",_70.domNode," "));var _71=document.createDocumentFragment();this._searchElements=_16.map(this._gridConfig.searchBarItems(),_17.hitch(this,function(_72){var _73=new _7(_17.mixin({entity:this.entity,mxcontext:this.mxcontext},_72));this.connect(_73,"onKeyUp","eventSearchActivated");_71.appendChild(_73.domNode);_73.startup();return _73;}));this.searchArgumentNode.appendChild(_71);},buildSearchBar:function(){if(!this._gridState.searchbar){this.searchNode.style.display="none";this._searchFilled=true;return;}var _74=this._gridConfig.searchBarConfig();if(_74){this._gridState.searchBarVisible=!_74.startFolded;this._gridState.searchBarTogglable=!!_74.foldable;}else{this._gridState.searchBarVisible=true;}if(!this._gridState.searchBarVisible){var _75=false;var _76=this._gridConfig.searchBarItems();for(var i in _76){var _77=_76[i];if(_77.defaults){this.buildSearchBlock();_75=true;break;}}this.searchNode.style.display="none";this._gridState.isSearchBuild=_75;}else{this.buildSearchBlock();this.searchNode.style.display="";}this.checkSearchFields();},eventSearchActivated:function(e){var _78=this;_18.stop(e);var _79=this.searchButton;var _7a=_17.hitch(this,function(){this._clearSelection();this.refreshGrid();if(this.triggerOnSearchChanged){this.triggerOnSearchChanged();}_79.set("disabled",false);});var _7b=false;if(e.type==="click"){this.checkSearchFields();_7b=true;}else{if(e.shiftKey&&e.keyCode===13){}else{if(e.keyCode===13){this.checkSearchFields();_7b=true;}}}if(!this.constraintsFilled()){_7b=false;}if(_7b){_79.set("disabled",true);this._dataSource.isValid(function(_7c){if(_7c){_78._dataSource.setConstraints(_78._searchGetConstraints(),_7a);}else{_79.set("disabled",false);}});}},eventSearchResetClicked:function(){var _7d=this._dataSource;_16.forEach(this._searchElements,function(_7e){_7e.reset();});this.checkSearchFields();_7d.setConstraints(this._searchGetConstraints());var _7f=_17.hitch(this,function(){this.refreshGrid();if(this.triggerOnSearchChanged){this.triggerOnSearchChanged();}});if(this.constraintsFilled()){_7d.isValid(function(_80){if(_80){_7d.refresh(_7f);}else{_7d.clean(_7f);}});}},checkSearchFields:function(){var _81=this._gridConfig.gridSetting("waitforsearch");if(!_81){this._searchFilled=true;return;}this._searchFilled=_16.some(this._searchElements,_17.hitch(this,function(_82){if(_82.get("value")!==""){this.messageNode.innerHTML="";this.messageNode.style.display="none";return true;}}));if(!this._searchFilled){this.messageNode.innerHTML=window.mx.ui.translate("mxui.widget.DataGrid","waitForSearch");this.messageNode.style.display="block";}},constraintsFilled:function(){if(!this._searchFilled){return false;}for(var i=0,_83;_83=this.reqConstraints[i];i++){if(!this.mxcontext.getContext(_83)){return false;}}return true;},reload:function(_84){if(this.constraintsFilled()){var _85=this;this._dataSource.isValid(function(_86){if(_86){_85._dataSource.refresh(function(){_85.refreshGrid();_84&&_84();});}});}},actionToggleSearch:function(_87){var _88=this;if(!this._gridState.searchBarTogglable){return;}this.buildSearchBlock();if(!(this._gridState.searchBarVisible=!this._gridState.searchBarVisible)){this._searchWipeOut=this._searchWipeOut||_11.wipeOut({node:this.searchNode,duration:200,onEnd:function(){setTimeout(function(){_88.resize(_88._resizeBox);},0);_16.forEach(_88._searchElements,function(_89){_89.cleanup();});}});this._searchWipeOut.play();}else{this._searchWipeIn=this._searchWipeIn||_11.wipeIn({node:this.searchNode,duration:200,onEnd:function(){setTimeout(function(){_88.showOverflow();_88.resize(_88._resizeBox);},0);try{_16.some(_88._searchElements,function(_8a){if(!_8a.get("hidden")){_8a.focus();return true;}});}catch(e){}}});this.hideOverflow();this._searchWipeIn.play();}},applyContext:function(_8b,_8c){var _8d=this;if(this._metaEntity==null){_8c&&_8c();return;}if(!this._dataSource){_f.error(this.id+".applyContext: Applying context before rendered!!!");_8c&&_8c();return;}this._clearSelection();this.cloneContext(_8b);this.setUpdateInterval();this._gridState.xpathConstraint=this.xpathConstraint;var _8e=this.mxcontext.getParam("xpathConstraint");if(_8e){this._gridState.xpathConstraint+=_8e;}this.removeSubscriptions();this.registerSubscriptions();if(this.reference){var _8f=this.reference.split(/\//),_90=_8f[0],_91=_8f[1];var id=this.mxcontext.getContext(_90);if(id){var _92="["+_91+"=\""+id+"\"]";this._gridState.xpathConstraint+=_92;}else{}}if(!this._gridState.inDenial){var _93=[];if(this.constraintsFilled()){var _94=[];var _95=function(_96){return function(_97){_96.reinit(_97);};};_16.forEach(this._searchElements,function(_98){_94.push(_95(_98));});_93.push(function(cb){this.collect(_94,cb);});_93.push(function(_99){if(this._dataSource.setConstraints){this._dataSource.setConstraints(_8d._searchGetConstraints());}this._dataSource.reload(_99);});}else{_93.push("actCleanDS");}this.sequence(_93,function(){this.filterSelected();this.refreshGrid();this.shareSelected();_8c();});}else{_8c&&_8c();}},objectUpdateNotification:function(){var _9a=this;if(!this._gridState.inDenial&&this.constraintsFilled()){this._dataSource.isValid(function(_9b){if(_9b){_9a.sequence([_17.hitch(_9a._dataSource,"entityUpdate"),function(_9c){this.filterSelected();this.refreshGrid();_9c&&_9c();}]);}});}},refreshGrid:function(){this.updatePagingStatus();this.fillGrid();this.resizeGrid();},actCleanDS:function(_9d){this._clearSelection();this._dataSource.clean(_9d);},resumed:function(){this.setUpdateInterval();},suspended:function(){this.clearInterval();},actionDeleteSelection:function(_9e){var _9f=this._getSelectedGuids();if(this._gridState.invertedSelection){}else{if(!_9f.length){window.mx.ui.info(window.mx.ui.translate("mxui.widget.DataGrid","no_selection"));}else{var _a0=this;var _a1=function(){var _a2=_9f;_a0.deselectAll();_a0.shareSelected();window.mx.data.remove({guids:_a2,callback:function(){window.mx.data.sendClassUpdate(_a0.entity);},error:function(e){window.mx.onError(e);}});};if(_9e===true){_a1();}else{window.mx.ui.confirmation({content:window.mx.ui.translate("mxui.widget.DataGrid","confirm_delete",_9f.length),handler:_a1});}}}},resize:function(box){var _a3=false;if(box){var _a4=_15.getMarginBox(this.domNode),_a5=_15.getMarginBox(this.contentNode),_a6=box.h-(_a4.h-_a5.h);if(_a6>_a.minContainerHeight){_14.set(this.contentNode,"height",_a6+"px");_a3=true;if(this.headTable){_14.set(this.headTable,"top","0px");}}}if(!_a3){_14.set(this.contentNode,"height","auto");}this._resizeBox=box;},close:function(){this.disposeContent();},onHide:function(e){_16.forEach(this._searchElements,function(_a7){_a7.cleanup();});},uninitialize:function(_a8){var _a9=null;try{this.clearInterval();this.removeSubscriptions();_9.destroyChildren(this.searchControlNode);_9.destroyChildren(this.toolBarNode);_9.destroyChildren(this.pagingBarNode);if(this.itemNode){_9.destroyChildren(this.itemNode);}if(_a9){_a9.destroy();}_16.forEach(this._searchElements,function(_aa){_aa.destroy();});}catch(e){_f.error(this.id+".uninitialize : error : "+e.message);}this._dataSource=null;this._gridConfig=null;this._metaEntity=null;this._searchElements=null;}});return _19;});