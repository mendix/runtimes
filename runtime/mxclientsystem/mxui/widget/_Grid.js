/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/widget/_Grid",["require","mxui/mixin/_Contextable","mxui/mixin/_Stateful","mxui/mixin/_Pluggable","mxui/lib/overflowHelper","mxui/mixin/_ContainingSelection","mxui/mixin/_Templated","mxui/lib/MxGridConfig","mxui/widget/SearchInput","mxui/widget/Button","mxui/widget/ControlBarButton","mxui/widget","mxui/dom","mendix/lib/MxContext","mendix/lib/ValidationError","webcore/dataSourceFactory","webcore/datasource/XPathSource","mendix/logger","dojo/fx","dojo/sniff","dojo/dom-class","dojo/dom-style","dojo/dom-geometry","dojo/_base/array","dojo/_base/lang","dojo/_base/event","dojo/fx/Toggler"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a){var _1b=_c.declare("mxui.widget._Grid",{mixins:[_7,_2,_3,_4,_6],baseClass:"mx-grid",css:_c.createCSSMap("mx-grid",{pagingStatus:"paging-status",searchButton:"search-button",resetButton:"reset-button"}),entity:"",schema:"",useContext:false,customDataSource:null,dataSourceMixin:null,_previousSearchConstraints:"",pagingBarNode:null,searchNode:null,toolBarNode:null,messageNode:null,searchButton:null,resetButton:null,_dataSource:null,_gridConfig:null,_gridState:null,_metaEntity:null,_toolWidgets:null,_pagingStatusNode:null,_preserveSelection:false,_defaultButtonWidget:null,_restoreSearchState:true,constructor:function(_1c){this._preserveSelection="selection" in _1c;},fetchMetaObject:function(){this._metaEntity=window.mx.meta.getEntity(this.entity);if(this._metaEntity==null){_12.error(this.id+": This grid has been configured for an entity the current user doesn't have access to.");return false;}return true;},setupGridConfig:function(){this._gridConfig=new _8({config:this.config,nested:this.nested});},setupGridState:function(){var _1d=this._gridConfig,_1e=this._gridState;_1e.updateperiod=_1d.gridSetting("refresh");_1e.searchbar=_1d.gridSetting("searchbar");_1e.controlbar=_1d.gridSetting("controlbar");_1e.pagingbar=_1d.gridSetting("pagingbar");_1e.selectionmode=_1d.gridSetting("selectionmode");_1e.selectable=(_1e.selectionmode!=="none");_1e.editable=_1d.gridSetting("editable");_1e.showemptyrows=_1d.gridSetting("showemptyrows");_1e.selectfirst=_1d.gridSetting("selectfirst");},setupDataSource:function(){var _1f=this._gridConfig,_20=_1f.getDataSource(),_21=this.getState("pageOffset",0),_22=_1f.gridSetting("pageSize"),_23;if(this.customDataSource){_23=this.customDataSource;_23.setPageSize(_22);_23.setOffset(_21);var _24=this.getState("sortOptions",_1f.gridSetting("sortparams"));if(_24){_23.setSortOptions(_24[0][0],_24[0][1]);}}else{if(_20){_23=_10.create(_19.mixin({sort:this.getState("sortOptions",_1f.gridSetting("sortparams")),aggregates:"Calculations" in this._gridConfig.getPlugins(),queryid:this instanceof _1("mxui/widget/DataGrid")?this.schema:"",context:this.mxcontext,page:_22,offset:_21,useContext:this.useContext},_20,this.dataSourceMixin));}}this._dataSource=_23;},resizeGrid:function(){this.contentNode.scrollTop=0;},setUpdateInterval:function(){var _25=this._gridState.updateperiod;if(_25&&_25.toString()!="0"){this.clearInterval();this._gridState.update=setInterval(_19.hitch(this,"reload"),parseInt(_25*1000,10));}},clearInterval:function(){if(this._gridState.update!=null){clearInterval(this._gridState.update);}},actionSelectPage:function(){if(!this._gridState.invertedSelection){for(var i=0,_26=this._dataSource.getObjects(),_27;_27=_26[i];i++){this._addToSelection(_27.getGuid());}}this.refreshGrid();},actionSelectAllPages:function(){this.selection=[];this._gridState.invertedSelection=true;this.refreshGrid();},actionClearSelection:function(){if(this._hasSelection()||this._gridState.invertedSelection){this.selection=[];this._gridState.invertedSelection=false;this.refreshGrid();}},actionEditSelection:function(_28){if(!this._hasSelection()&&!this._gridState.invertedSelection){window.mx.ui.info(window.mx.ui.translate("mxui.widget.DataGrid","no_selection"));}else{for(var i=0,obj;obj=this.selection[i];i++){var _29=this._dataSource.getObject(obj),_2a=_28[_29.getEntity()],_2b=this.createContext();_2b.dupFrom(this.mxcontext);_2b.setObject(null,_29.getEntity(),_29.getGuid());window.mx.ui.execute({type:"openPage",params:_2a.pageSettings},{origin:this.mxform,context:_2b});}}},actionInsertNew:function(_2c){var _2d=this._getEntity(_2c),_2e=_2c[_2d];window.mx.data.create({entity:_2d,context:this.useContext?this.mxcontext:null,callback:function(obj){if(!this.useContext){var _2f=this._gridConfig.getDataSource(),_30=_2f.path||"",_31=_30.split("/"),_32=this.mxcontext.getTrackId();if(_31.length==2&&_32){var _33=_31[0];if(obj.isReference(_33)){obj.set(_33,_32);}}}var _34=this.createContext();_34.setContext(obj);window.mx.ui.execute({type:"openPage",params:_2e.pageSettings},{origin:this.mxform,context:_34});},error:function(e){window.mx.onError(e);}},this);},selectRow:function(row){if(this._gridState.invertedSelection){_15.remove(row,"selected");}else{_15.add(row,"selected");}},deselectRow:function(row){if(!this._gridState.invertedSelection){_15.remove(row,"selected");}else{_15.add(row,"selected");}},postCreate:function(){var box=this.addFocusBox(this.controlNode);box.pressed({RIGHT_ARROW:box.FOCUS_NEXT,LEFT_ARROW:box.FOCUS_PREV});this.initContext();this._previousSearchConstraints=this.getState("searchConstraints","");if(this.fetchMetaObject()){this.setupGridConfig();this.setupGridState();this.buildSearchBar();this.buildControlBar();this.buildToolBar();this.buildPagingBar();this.setupDataSource();}},getSchemaId:function(){return this.schema;},deselectAll:function(){this.selection=[];this.deselectGridRows();},registerSubscriptions:function(){this.removeSubscriptions();var _35=this.mxcontext.getTrackId();if(_35){this.subscribe({guid:this.mxcontext.getTrackId(),callback:_19.hitch(this,"objectUpdate")});}this.subscribe({entity:this.entity,callback:_19.hitch(this,"objectUpdate")});},eventItemClicked:function(e,_36){if(!this._gridState.selectable){return;}var obj=this._getObjectFromNode(_36);if(!obj){return;}var _37=_18.indexOf(this.selection,obj),_38=this._gridState.selectionmode,_39=_38!="singleandmaintain"||this.selection.length>1;if(_38=="simplemulti"||_38=="multi"&&(_14("mac")&&e.metaKey||e.ctrlKey)){if(_37==-1){this.selectRow(_36);this._addToSelection(obj.getGuid());}else{if(_39){this.deselectRow(_36);this._removeFromSelection(obj.getGuid());}}}else{if(_37==-1){this.deselectAll();this.selectRow(_36);this._addToSelection(obj.getGuid());}else{if(_39){this.deselectRow(_36);this._removeFromSelection(obj.getGuid());}}}this._shareSelection(this._metaEntity.getEntity());},triggerDefaultAction:function(_3a){var _3b=this._getObjectFromNode(_3a);if(!_3b){return;}if(!this._defaultButtonWidget||!this._defaultButtonWidget.isConditionallyVisible()){return;}this.deselectAll();if(this._gridState.selectable){this.selectRow(_3a);_d.clearSelection();}this._addToSelection(_3b.getGuid());this.eventControlBarButtonClicked(this._defaultButtonWidget.domNode);if(!this._gridState.selectable){this.deselectAll();}},eventControlBarButtonClicked:function(_3c){var _3d=_3c.getAttribute("data-mendix-id"),_3e=this._gridConfig.getActionsByKey(_3d);if(_3e.actionCall==="ActionSelected"){_3e.actionCall="EditSelection";}else{if(_3e.actionCall==="Create"){_3e.actionCall="InsertNew";}}var _3f="action"+_3e.actionCall;if(this[_3f]){this[_3f](_3e.params);}else{_12.error(this.id+".eventControlBarButtonClicked: Called function '"+_3f+"' does not exist in this component");}},actionInvokeAction:function(_40){this.triggerPluginEvent("invokeAction",null,_19.hitch(this,"invokeAction",_40));},_getPlainSelection:function(){if(!this._gridState.invertedSelection){return this.selection;}var _41=this,_42=[];this._dataSource.each(function(obj){var _43=obj.getGuid();if(_18.indexOf(_41.selection,_43)===-1){_42.push(_43);}});return _42;},_getXpathSelection:function(){var _44,_45,_46,_47=this._gridState.invertedSelection;if(_47){_46=this._dataSource.getSetSize()-this.selection.length;_44=this._dataSource.getCurrentXPath();}else{_46=this.selection.length;_44="//"+this.entity;}if(_46===0){return null;}var _48=[];_18.forEach(this.selection,function(id){_48.push("id"+(_47?"!=":"=")+"\""+id+"\"");});if(_48.length===0){_45="";}else{_45="["+_48.join(_47?" and ":" or ")+"]";}return {xpath:_44,constraints:_45,sort:this._dataSource.getSortSettings()};},_getMicroflowParameters:function(_49){var _4a={gridid:this.schema};if(!_49){_4a.applyto="none";}else{if(_49=="selection"){if(this._dataSource instanceof _11){var _4b=this._getXpathSelection();if(!_4b){return null;}_4a.applyto="selectionset";_19.mixin(_4a,_4b);}else{var _4c=this._getPlainSelection();if(_4c.length===0){return null;}_4a.applyto="selection";_4a.guids=_4c;}}else{if(_49=="allPages"){if(this._dataSource instanceof _11){if(this._dataSource.getSetSize()===0){_4a.applyto="none";}_19.mixin(_4a,{xpath:this._dataSource.getCurrentXPath(),sort:this._dataSource.getSortSettings(),applyto:"set"});}else{var _4d=_18.map(this._dataSource.getObjects(),function(obj){return obj.getGuid();});_4a.applyto="selection";_4a.guids=_4d;}}}}return _4a;},invokeAction:function(_4e){var _4f=this,_50=_4e[this.entity],_51=_50.action,_52;if(_51.type==="callMicroflow"){var _53=this._getMicroflowParameters(_51.params.applyTo);if(!_53){window.mx.ui.info(window.mx.ui.translate("mxui.widget.DataGrid","no_selection"));return;}_52={origin:this.mxform,context:this.mxcontext,params:_53,abortOnClientValidations:true,abortOnServerValidations:true,callback:_54};}else{if(_51.type==="openPage"){var _55=new _e();if(_51.hasParameter){var _56=this._getPlainSelection();if(!_56.length){window.mx.ui.info(window.mx.ui.translate("mxui.widget.DataGrid","no_selection"));return;}_55.setTrackId(_56[0]);_55.setTrackEntity(this.entity);}_52={origin:this.mxform,context:_55,callback:_54};}}if(this.actDeferSyncAction){this.actDeferSyncAction(_57);}else{_57();}function _57(){window.mx.ui.execute(_51,_52);};function _54(){if(!(_4f._destroyed||_50.maintainSelection||_4f._gridState.selectionmode=="singleandmaintain")){_4f.deselectAll();_4f._shareSelection(_4f._metaEntity.getEntity());}};},actionReturnSelection:function(){var _58=this.mxform;_58.validate(function(){var _59=function(e){if(!(e instanceof _f)){window.mx.onError(e);}};_58.commit(function(){_58.close();},_59);});},controlNode:null,_setToolbarAttr:function(_5a){for(var i=0,btn;btn=this._toolWidgets[i++];){btn.set("disabled",_5a);}},buildControlBar:function(){if(!this._gridState.controlbar&&!this._gridState.pagingbar){this.controlNode.style.display="none";}},buildToolBar:function(){this._toolWidgets=[];if(!this._gridState.controlbar){this.toolBarNode.style.display="none";}var _5b=this._gridConfig.gridTools(),box=this.getFocusBox(this.controlNode),_5c=document.createDocumentFragment(),_5d=this._gridConfig.getDefaultButton();for(var i in _5b){var _5e=_5b[i];var _5f={mxid:_5e.mxid,caption:_5e.caption,title:_5e.title,onClick:_19.hitch(this,function(e){this.eventControlBarButtonClicked(e.currentTarget);}),cssClasses:"mx-name-"+_5e.name+(_5e.cssClass?(" "+_5e.cssClass):""),cssStyle:_5e.cssStyle,alwaysHidden:_5e.alwaysHidden};if(_5e.iconClass){_5f.iconClass=_5e.iconClass;}else{if(_5e.iconUrl){_5f.iconUrl=_5e.iconUrl;}}var _60=new _b(_5f),_61=_60.domNode;if(_5d&&_5e.mxid===_5d.mxid){this._defaultButtonWidget=_60;}_60.applyContext(this.mxcontext);this._toolWidgets.push(_60);try{if(_5b[i].gridFunction){_61.setAttribute("gridFunction",_5b[i].gridFunction);_61.setAttribute("param",_5b[i].param);if(_5b[i].background){_61.setAttribute("background-job",_5b[i].background);}if(_5b[i].progress){_61.setAttribute("progress",_5b[i].progress);}if(_5b[i].message){_61.setAttribute("message",_5b[i].message);}}if(i>0){_5b[i-1]._nextNode=_61;}_5b[i]._domNode=_61;_5c.appendChild(_61);_5c.appendChild(document.createTextNode(" "));box.add(_61);_60.startup();}catch(e){}}this.toolBarNode.appendChild(_5c);_d.disableSelection(this.toolBarNode);},buildPagingBar:function(){if(!this._gridState.pagingbar){this.pagingBarNode.style.display="none";return;}var ltr=this.isLeftToRight(),_62=document.createDocumentFragment(),box=this.getFocusBox(this.controlNode),$=_d.create;this.btFirst=new _a({iconClass:ltr?"glyphicon-step-backward":"glyphicon-step-forward","onClick":_19.hitch(this,"eventPagingFirstClicked"),"class":"mx-name-paging-first"});_62.appendChild($("#",this.btFirst.domNode," "));box.add(this.btFirst.domNode);this.btPrevious=new _a({iconClass:ltr?"glyphicon-backward":"glyphicon-forward","onClick":_19.hitch(this,"eventPagingPreviousClicked"),"class":"mx-name-paging-previous"});_62.appendChild($("#",this.btPrevious.domNode," "));box.add(this.btPrevious.domNode);this._pagingStatusNode=$("div",{"class":"dijitInline "+this.css.pagingStatus});_62.appendChild($("#",this._pagingStatusNode," "));this.btNext=new _a({iconClass:ltr?"glyphicon-forward":"glyphicon-backward","onClick":_19.hitch(this,"eventPagingNextClicked"),"class":"mx-name-paging-next"});_62.appendChild($("#",this.btNext.domNode," "));box.add(this.btNext.domNode);this.btLast=new _a({iconClass:ltr?"glyphicon-step-forward":"glyphicon-step-backward","onClick":_19.hitch(this,"eventPagingLastClicked"),"class":"mx-name-paging-last"});_62.appendChild($("#",this.btLast.domNode," "));box.add(this.btLast.domNode);this.pagingBarNode.appendChild(_62);_d.disableSelection(this.pagingBarNode);},updatePagingStatus:function(){if(!this._gridState.pagingbar){return;}var _63=this._dataSource.getStatusMessage();_d.text(this._pagingStatusNode,_63);if(this._dataSource.atBeginning()){this.btFirst.set("disabled",true);this.btPrevious.set("disabled",true);}else{this.btFirst.set("disabled",false);this.btPrevious.set("disabled",false);}if(this._dataSource.atEnd()){this.btNext.set("disabled",true);this.btLast.set("disabled",true);}else{this.btNext.set("disabled",false);this.btLast.set("disabled",false);}},eventPagingFirstClicked:function(){if(!this._dataSource.atBeginning()){this._dataSource.first(_19.hitch(this,"refreshGrid"));}},eventPagingPreviousClicked:function(){if(!this._dataSource.atBeginning()){this._dataSource.previous(_19.hitch(this,"refreshGrid"));}},eventPagingNextClicked:function(){if(!this._dataSource.atEnd()){this._dataSource.next(_19.hitch(this,"refreshGrid"));}},eventPagingLastClicked:function(){if(!this._dataSource.atEnd()){this._dataSource.last(_19.hitch(this,"refreshGrid"));}},_searchElements:null,_searchFilled:false,searchArgumentNode:null,searchControlNode:null,_searchGetConstraints:function(){var _64="";var _65=[];_18.forEach(this._searchElements,function(_66){var _67=_66.get("query");if(_67!==""){_65.push(_67);}});if(_65.length){_64="["+_65.join(" and ")+"]";}return _64+this._gridState.xpathConstraint;},buildSearchBlock:function(){var $=_d.create;var _68=this.searchButton=new _a({"caption":window.mx.ui.translate("mxui.widget.DataGrid",["search"]),"onClick":_19.hitch(this,"eventSearchActivated"),"class":"btn-default mx-name-search "+this.css.searchButton});this.searchControlNode.appendChild($("#",_68.domNode," "));var _69=this.resetButton=new _a({"caption":window.mx.ui.translate("mxui.widget.DataGrid",["reset"]),"onClick":_19.hitch(this,"eventSearchResetClicked"),"class":"btn-default mx-name-reset "+this.css.resetButton});this.searchControlNode.appendChild($("#",_69.domNode," "));var _6a=document.createDocumentFragment();this._searchElements=_18.map(this._gridConfig.searchBarItems(),_19.hitch(this,function(_6b){var _6c=new _9(_19.mixin({entity:this.entity,mxcontext:this.mxcontext},_6b));this.connect(_6c,"onKeyUp","eventSearchActivated");_6a.appendChild(_6c.domNode);_6c.startup();return _6c;}));this.searchArgumentNode.appendChild(_6a);},buildSearchBar:function(){if(!this._gridState.searchbar){this.searchNode.style.display="none";this._searchFilled=true;return;}var _6d=this._gridConfig.searchBarConfig();this._gridState.searchBarVisible=this.getState("searchBarVisible",!_6d.toggledByDefault);this._gridState.searchBarTogglable=!!_6d.toggleable;this.buildSearchBlock();if(!this._gridState.searchBarVisible){this.searchNode.style.display="none";}this.checkSearchFields();},eventSearchActivated:function(e){_1a.stop(e);if(!(e.type==="click"||(e.keyCode===13&&!e.shiftKey))){return;}var _6e=this,_6f=this.searchButton;this.checkSearchFields();if(!this.constraintsFilled()){return;}_6f.set("disabled",true);this._dataSource.isValid(function(_70){if(_70){_6e._dataSource.setConstraints(_6e._searchGetConstraints(),function(){if(!_6e._preserveSelection){_6e.selection=[];}_6e.refreshGrid();if(_6e.triggerOnSearchChanged){_6e.triggerOnSearchChanged();}_6f.set("disabled",false);});}else{_6f.set("disabled",false);}});},eventSearchResetClicked:function(){var _71=this._dataSource;_18.forEach(this._searchElements,function(_72){_72.reset();});this.checkSearchFields();_71.setConstraints(this._searchGetConstraints());var _73=_19.hitch(this,function(){this.refreshGrid();if(this.triggerOnSearchChanged){this.triggerOnSearchChanged();}});if(this.constraintsFilled()){_71.isValid(function(_74){if(_74){_71.refresh(_73);}else{_71.clean(_73);}});}},checkSearchFields:function(){if(!this._gridConfig.gridSetting("waitforsearch")){this._searchFilled=true;return;}this._searchFilled=_18.some(this._searchElements,function(_75){return _75.get("query")!=="";});if(this._searchFilled){this.messageNode.innerHTML="";this.messageNode.style.display="none";}else{this.messageNode.innerHTML=window.mx.ui.translate("mxui.widget.DataGrid","waitForSearch");this.messageNode.style.display="block";}},constraintsFilled:function(){return this._searchFilled;},reload:function(_76){if(this.constraintsFilled()){var _77=this;this._dataSource.isValid(function(_78){if(_78){_77._dataSource.refresh(function(){_77.refreshGrid();if(_76){_76();}});}});}},actionToggleSearch:function(){var _79=this;this._gridState.searchBarVisible=!this._gridState.searchBarVisible;if(!this._gridState.searchBarVisible){this._searchWipeOut=this._searchWipeOut||_13.wipeOut({node:this.searchNode,duration:200,onEnd:function(){setTimeout(function(){_79.resize(_79._resizeBox);},0);_18.forEach(_79._searchElements,function(_7a){_7a.cleanup();});}});this._searchWipeOut.play();}else{this._searchWipeIn=this._searchWipeIn||_13.wipeIn({node:this.searchNode,duration:200,onEnd:function(){setTimeout(function(){_5.showOverflow(_79.domNode);_79.resize(_79._resizeBox);},0);try{_18.some(_79._searchElements,function(_7b){if(!_7b.get("hidden")){_7b.focus();return true;}});}catch(e){}}});_5.hideOverflow(this.domNode);this._searchWipeIn.play();}},applyContext:function(_7c,_7d){if(this._metaEntity==null){if(_7d){_7d();}return;}if(!this._dataSource){_12.error(this.id+".applyContext: Applying context before rendered!!!");if(_7d){_7d();}return;}this.cloneContext(_7c);this.setUpdateInterval();_18.forEach(this._toolWidgets,function(_7e){_7e.applyContext(this.mxcontext);},this);this._gridState.xpathConstraint="";var _7f=this.mxcontext.getParam("xpathConstraint");if(_7f){this._gridState.xpathConstraint+=_7f;}this.removeSubscriptions();this.registerSubscriptions();if(!this._gridState.inDenial){var _80=[this.reinitSearchFields];if(this.constraintsFilled()){_80.push(function(_81){if(this._dataSource.setConstraints){var _82=this._previousSearchConstraints?this._previousSearchConstraints:this._searchGetConstraints();this._previousSearchConstraints="";this._dataSource.setConstraints(_82);}this._dataSource.setOffset(this.getState("pageOffset",0));this._dataSource.reload(_81);});}else{_80.push(this.actCleanDS);}this.sequence(_80,function(){if(!this._preserveSelection){this.selection=this.getState("selectedGuids",[]);this.filterSelected();}this.refreshGrid();_7d();},this);}else{_7d();}},reinitSearchFields:function(_83){var _84=this._restoreSearchState&&this.getState("searchInput")||{};this._restoreSearchState=false;this.collect(_18.map(this._searchElements,function(_85){return function(cb){_86(_85,cb);};}),_83);function _86(_87,cb){_87.reinit(function(){if(_87.path in _84){_87.set("value",_84[_87.path]);}cb();});};},filterSelected:function(){this.selection=_18.filter(this.selection,function(_88){return this._dataSource.getObject(_88)!=null;},this);},objectUpdateNotification:function(){var _89=this;if(!this._gridState.inDenial&&this.constraintsFilled()){this._dataSource.isValid(function(_8a){if(_8a){_89.sequence([_19.hitch(_89._dataSource,"entityUpdate"),function(_8b){this.filterSelected();this.refreshGrid();if(_8b){_8b();}}]);}});}},refreshGrid:function(){if(this._dataSource.afterEnd()){this._dataSource.first(_19.hitch(this,"refreshGrid"));return;}this.updatePagingStatus();this.fillGrid();this.resizeGrid();},actCleanDS:function(_8c){this.selection=[];this._dataSource.clean(_8c);},actionDeleteSelection:function(_8d){if(this._gridState.invertedSelection){}else{if(!this._hasSelection()){window.mx.ui.info(window.mx.ui.translate("mxui.widget.DataGrid","no_selection"));}else{var _8e=this;var _8f=function(){var _90=_8e.selection;_8e.deselectAll();_8e._shareSelection(_8e._metaEntity.getEntity());window.mx.data.remove({guids:_90,callback:function(){window.mx.data.sendClassUpdate(_8e.entity);},error:function(e){window.mx.onError(e);}});};if(_8d===true){_8f();}else{window.mx.ui.confirmation({content:window.mx.ui.translate("mxui.widget.DataGrid","confirm_delete",this.selection.length),handler:_8f});}}}},resize:function(box){var _91=false;if(box){var _92=_17.getMarginBox(this.domNode),_93=_17.getMarginBox(this.contentNode),_94=box.h-(_92.h-_93.h);if(_94>_d.minContainerHeight){_16.set(this.contentNode,"height",_94+"px");_91=true;if(this.headTable){_16.set(this.headTable,"top","0px");}}}this.contentNode.style.overflow=_91?"auto":"";if(!_91){_16.set(this.contentNode,"height","auto");}this._resizeBox=box;},onHide:function(){_18.forEach(this._searchElements,function(_95){_95.cleanup();});},storeState:function(_96){_96("searchBarVisible",this._gridState.searchBarVisible);_96("searchConstraints",this._dataSource.getConstraints&&this._dataSource.getConstraints());_96("pageOffset",this._dataSource.getOffset());if(this._gridState.selectable){_96("selectedGuids",this.selection);}if(this._dataSource.getSortSettings){_96("sortOptions",this._dataSource.getSortSettings());}var _97={};_18.forEach(this._searchElements,function(_98){_97[_98.path]=_98.get("value");});_96("searchInput",_97);},uninitialize:function(){this.clearInterval();this.removeSubscriptions();this._clearSelectionStore();_c.destroyWidgetsIn(this.searchControlNode);_c.destroyWidgetsIn(this.toolBarNode);_c.destroyWidgetsIn(this.pagingBarNode);if(this.itemNode){_c.destroyWidgetsIn(this.itemNode);}if(this._dataSource){this._dataSource.destroy();}_18.forEach(this._searchElements,function(_99){_99.destroy();});}});return _1b;});