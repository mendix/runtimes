
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/DataGrid",["dojo","dijit","dojox","dojo/require!mxui/mixin/_Grid,mxui/mixin/_Contextable,mxui/mixin/_Pluggable,mxui/mixin/_Scriptable,mxui/mixin/_Internationalized,mxui/lib/MxGridConfig,mxui/html/render,mxui/widget/plugins/DataGrid/Calculations,mxui/widget/plugins/DataGrid/GridEditor,mxui/widget/plugins/DataGrid/HoverPreview,mxui/widget/plugins/DataGrid/KeyNavigation"],function(_1,_2,_3){_1.provide("mxui.widget.DataGrid");_1.require("mxui.mixin._Grid");_1.require("mxui.mixin._Contextable");_1.require("mxui.mixin._Pluggable");_1.require("mxui.mixin._Scriptable");_1.require("mxui.mixin._Internationalized");_1.require("mxui.lib.MxGridConfig");_1.require("mxui.html.render");_1.require("mxui.widget.plugins.DataGrid.Calculations");_1.require("mxui.widget.plugins.DataGrid.GridEditor");_1.require("mxui.widget.plugins.DataGrid.HoverPreview");_1.require("mxui.widget.plugins.DataGrid.KeyNavigation");mxui.widget.declare("mxui.widget.DataGrid",{mixins:[_2._TemplatedMixin,_2._Container,_2._Contained,mxui.mixin._Grid,mxui.mixin._Internationalized,mxui.mixin._Pluggable,mxui.mixin._Scriptable,mxui.mixin._Contextable],inputargs:{entity:"",schema:"",contenturl:"",autoconfig:false,xpathConstraint:"",selected:"",reference:"",useContext:false,reqConstraints:"",customDataSource:null},cssmap:mxui.widget.createCSSMap("mx-datagrid",{sortText:"sort-text",sortIcon:"sort-icon",headCaption:"head-caption",headWrapper:"head-wrapper",columnResizer:"column-resizer",dataWrapper:"data-wrapper"}),constructor:function(){this.templateString=_1.cache("mxui.widget","templates/DataGrid.html","<div class=\"${baseClass} mx-datagrid\">\n    <div class=\"${baseClass}-searchbar clearfix\" dojoAttachPoint=\"searchNode\" focusIndex=\"0\">\n        <div class=\"${baseClass}-search-controls\" focusIndex=\"1\" dojoAttachPoint=\"searchControlNode\"></div>\n        <div class=\"${baseClass}-search-inputs\" focusIndex=\"0\" dojoAttachPoint=\"searchArgumentNode\"></div>\n        <div class=\"${baseClass}-search-message\" dojoAttachPoint=\"messageNode\"></div>\n    </div>\n    \n    <div class=\"${baseClass}-controlbar clearfix\" dojoAttachPoint=\"controlNode\" focusIndex=\"1\">\n        <div class=\"${baseClass}-pagingbar\" dojoAttachPoint=\"pagingBarNode\"></div>\n        <div class=\"${baseClass}-toolbar\" dojoAttachPoint=\"toolBarNode\"></div>\n    </div>\n        \n    <div class=\"${baseClass}-content\" dojoAttachPoint=\"contentNode\" focusIndex=\"2\">\n        <div class=\"${subClass}-content-wrapper\" dojoAttachPoint=\"tableWrapper\">\n            <table class=\"table table-bordered ${subClass}-head-table\" dojoAttachPoint=\"headTable\">\n                <colgroup dojoAttachPoint=\"headTableGroupNode\"></colgroup>\n                <thead class=\"${subClass}-head\" dojoAttachPoint=\"gridHeadNode\"></thead>\n            </table>\n            <table class=\"table table-striped table-bordered ${subClass}-body-table\" dojoAttachPoint=\"gridTable\">\n                <colgroup dojoAttachPoint=\"bodyTableGroupNode\"></colgroup>\n                <tbody class=\"${subClass}-body\" dojoAttachPoint=\"gridBodyNode\"></tbody>\n                <tfoot class=\"${subClass}-foot\" dojoAttachPoint=\"gridFootNode\"></tfoot>\n            </table>\n        </div>\n    </div>\n</div>\n");this.templateCssPath=require.toUrl("mxui.widget","styles/DataGrid.css");this.contentUrl="";this.entity="";this.autoconfig=false;this.xpathConstraint="";this.nested=false;this.selected=null;this.readOnly=false;this.subClass=this.cssmap.baseClass;var _4=this.cssmap;this.domNode=null;this.pagingBarNode=null;this.searchNode=null;this.toolBarNode=null;this.messageNode=null;this.searchButton=null;this.resetButton=null;this.gridBodyNode=null;this.gridFootNode=null;var _5=0;var _6=null;var _7=_1.hitch;var _8=_1.addClass;var _9=_1.removeClass;var _a=_1.addClass;var _b=null;var _c=null;var _d=[];var _e=[];var _f={};var _10={};var _11=[];var _12=[];var _13=[];var _14={sortable:true,selectable:true,selectionmode:"single",searchbar:true,controlbar:true,pagingbar:true,inDenial:false,searchBarVisible:false,searchBarTogglable:true,xpathConstraint:"",loading:false,invertedSelection:false};var _15=this;var _16=null;this.postCreateSpecific=function(){_16=this.id;this.startdormant=true;this._addFocusBoxForTable();if(this.fetchMetaObject()){this.setupGridConfig();this.setupGridState();this.setupScroll();this.buildSearchBar();this.buildControlBar();this.buildToolBar();this.buildPagingBar();this.buildGridBody();this.setupDevMode();this.loadPlugins();this.setupDataSource();this.doGridAttributes();this.triggerOnLoad();this.loaded();}};this.setColumnStyle=function(_17,_18){var _19=_18.display,_1a=_19.align||"left",_1b=_19.cssClass||"",_1c=_19.cssStyle;if(mx.ui.isRtl()){_1a=_1a=="right"?"left":"right";}if(_1c){_17.style=_1c;}_1.addClass(_17,[_1a==="right"?"mx-right-aligned":"mx-left-aligned",_1b].join(" "));};var _1d=function(_1e,_1f){var tr=mxui.dom.tr();_15.domData(tr,"gridrow",_1f);var td,div=null,row=[];for(var i=0,_20;_20=_1e[i];i++){td=mxui.dom.td();_15.domData(td,{row:_1f,column:i,key:_20.tag});_15.setColumnStyle(td,_20);td.appendChild(mxui.dom.div({"class":_4.dataWrapper}));tr.appendChild(td);row[i]=td;}_12.push(row);return (tr);};var _21=function(_22,_23){_23=_23||_22;var _24=_23.textContent?_23.textContent:_23.innerText;_24&&_22.setAttribute("title",_24.replace(/^\s\s*/,"").replace(/\s\s*$/,""));};var _25=function(_26,_27,_28){var _29=null,_2a;if(_27.has(_28)){_2a=_27.get(_28);switch(_26.render.toLowerCase()){case "icon":case "enumicon":var src=_26.display.mapping[_2a];_2a=src?"<img src='"+src+"'/>":"";break;case "weblink":break;default:try{var _2b=_26.display,_2c=_2b.dateFormat,_2d=_2b.format;_2a=mxui.html.renderValue(_27,_28,{format:_2c?_2c.toLowerCase().replace("custom","date"):"date",datepattern:_2d,precision:_2b.precision});_2a=mxui.dom.escapeString(_2a.replace(/\n/g," "));}catch(e){logger.error("mxui.widget.DataGrid.gridbodyFillCell : "+e.message);}break;}_2a=(_2a?_2a:String.fromCharCode(160));}else{_2a=String.fromCharCode(160);}return _2a;};var _2e=function(obj,_2f,_30){return ({mxobj:obj,attrname:_2f,attrs:_30});};var _31=this._gridbodyFillRow=function(_32,_33,_34){var _35=[];var _36=" - ";var _37=null;for(var i=0,td;td=_33[i];i++){var _38=[];var _39=_34[i];var _3a=false;_35=_39.attrs;if(_35.length==1){_38.push(_2e(_32,_35[0],_39));}else{var _3b=_32;var _3c=_35.concat([]);while(_3c.length>3){var _3d=_3c.shift();var _3e=_3c.shift();var _3f=_3b.getChildren(_3d);if(_3b=_3f[0]){if(!_3b.isA(_3e)){logger.error(_16+".gridBodyFillRow: Entity and reference do not match");_3b=null;break;}}else{_3b=null;break;}}if(_3b!=null&&(_3c.length)==3){_37=_3b.getChildren(_3c[0]);_1.forEach(_37,function(_40){_38.push(_2e(_40,_3c[2],_39));});if(_35.length==3&&_37.length===0){_3a=!!_32.get(_35[0]);}}}var _41=td.firstChild;td.innerHTML="";td.appendChild(_41);if(!_3a){var _42=[];try{if(_38.length!==0){var _43=[];for(var j=0,_44;_44=_38[j];j++){var _36=_25(_44.attrs,_44.mxobj,_44.attrname);if(_36!=null){_43.push(_36);}else{logger.error(_16+".gridBodyFillRow: Received NO content!!!");}if(/^(enum)?icon$/i.test(_44.attrs.render)){_42.push(_44.mxobj.getEnumCaption(_44.attrname));}}_41.innerHTML=_43.join(_43.length>1?", ":"");}}catch(e){logger.error(_16+".gridBodyFillRow :"+e.message);}if(_41.childNodes.length===0){_41.innerHTML="&nbsp;";}if(_42.length!==0){td.setAttribute("title",_42.join(";"));}else{_21(td);}}else{if(_32.isReference(_35[0])){(function(td){var _45=_39;var _46=(_35.length==3)?_35[2]:_35[3];var _47=_32.getReferences(_35[0]);var _48=_41;mx.data.get({guids:_47,callback:function(_49){var _4a=[],_42=[];_1.forEach(_49,function(obj){var _4b=_25(_45,obj,_46);if(_4b!=null){_4a.push(_4b);}else{logger.error(_16+".gridBodyFillRow: Recivied NO content!!!");}if(/^(enum)?icon$/i.test(_45.render)){_42.push(obj.getEnumCaption(_46));}});var _4c=_4a.length;_48.innerHTML=_4c===0?"&nbsp;":_4a.join(_4c>1?";":"");if(_48.childNodes.length===0){_48.innerHTML="&nbsp;";}if(_42.length!==0){td.setAttribute("title",_42.join(";"));}else{_21(td);}},error:mx.onError});})(td);}else{logger.error(_16+".gridBodyFillRow: Attribute "+_35[0]+" is not a reference(set)");}}}};var _4d=function(tr){tr.style.display="";_15.domData(tr,"mendixguid",null);var tds=tr.getElementsByTagName("td");for(var i=0;i<tds.length;i++){tds[i].firstChild.innerHTML="&nbsp";tds[i].setAttribute("title","");}};this.setupGridStateSpecific=function(){_14.sortable=_c.gridSetting("sortable");};this.loadPlugins=function(_4e){this.hideFootNode();if(_14.editable){this.loadPlugin("GridEditor");mxui.wm.focus.removeBox(this.contentNode);}var _4f=_c.getPlugins();for(var i in _4f){this.loadPlugin(i,_4f[i]);}};this.eventToolbarClick=function(_50){if(!_50){return;}var _51=_2.byNode(_50);_51&&_51._onClick();};this.setupScroll=function(_52){var _53=this.headTable,_54=this.contentNode;this.connect(_54,"scroll",function(e){_53.style.top=_54.scrollTop+"px";});};this.buildGridBody=function(){var _55=_c.gridAttributes();var _56=null;var _57=null;var _58=null;var _59=null;var row=mxui.dom.tr();var _5a=mxui.dom.div({"class":_4.headCaption});var _5b=mxui.dom.div({"class":_4.headWrapper});mxui.dom.disableSelection(row);var _5c=_c.gridSetting("sortparams"),_5d={};if(_5c){for(var j=0,_5e;_5e=_5c[j];j++){_5d[_5e[0]]=_5e;}}var _5f=_c.getPlugins()["Calculations"]||{};var _60=0;for(var i=0,_61;_61=_55[i];i++,_60+=_61.tag in _5f?1:0){var _62=_56;var _63=_61.display.width;if(_63!=null&&_63=="0"){if(_61.tag in _5f){_13.push(_60);}_55.splice(i--,1);continue;}_56=mxui.dom.th();this.domData(_56,{datakey:_61.tag,key:i});this.setColumnStyle(_56,_61);var _64=_61.display.string;_59=_5a.cloneNode(true);_59.innerHTML=!_64?"&nbsp;":_64;var _65=_5b.cloneNode(true);_57=mxui.dom.div({"class":_4.sortIcon,style:"display: none"},_58=mxui.dom.span({"class":_4.sortText}));_65.appendChild(_57);_65.appendChild(_59);_56.appendChild(_65);_21(_56,_59);var _66=_61.display.width+"%";var col=mxui.dom.col({style:"width:"+_66}),_67=col.cloneNode(true);this.headTableGroupNode.appendChild(col);this.bodyTableGroupNode.appendChild(_67);_f[i]=[col,_67];var _68=_5d[_61.tag];if(_68){var _69=_68[1];this.domData(_56,"sortorder",_69);if(_69=="asc"){_58.innerHTML="&#9650;";}else{_58.innerHTML="&#9660;";}_57.style.display="";}_10[i]=_56;row.appendChild(_56);}_5d=null;this.gridHeadNode.appendChild(row);if(_14.sortable){this.own(_1.on(this.gridHeadNode,"th:click",function(e){var key=_15.domData(this,"key");if(_55[key].sortable!==false){_15.eventColumnClicked(e,this);}}));}this._resizer=new mxui.widget.ColumnResizer({thNodes:mxui.dom.toArray(row.children),colNodes:_f,rtl:!this.isLeftToRight()});if(_14.showemptyrows){var _6a=_c.gridSetting("rows");for(var i=0;i<_6a;i++){this.addNewRow();}}this.own(_1.on(this.gridBodyNode,"tr:click",function(e){_15.eventGridRowClicked(e,this);}));this.liveConnect(this.gridBodyNode,"onclick",{td:"eventCellClicked"});this.liveConnect(this.gridBodyNode,"onmouseover",{tr:"eventRowMouseOver"});this.liveConnect(this.gridBodyNode,"onmouseout",{tr:"eventRowMouseOut"});var _6b=function(e){_15.eventActionBindingHandler(this,e.type);};var _6c=_c.gridActionBindings();for(var _6d in _6c){this.own(_1.on(this.gridBodyNode,"tr:"+_6d.replace(/^on/,""),_6b));}};this.addNewRow=function(){var _6e=_c.gridAttributes();var _6f=_c.gridSetting("rows");var _70=_11.length;if(_70>_6f){return null;}var tr=_1d(_6e,_70);_11.push(tr);this.gridBodyNode.appendChild(tr);var box=this.getFocusBox(this.contentNode);box.add&&box.add(tr);return tr;};this.isInverted=function(){return !!_14.invertedSelection;};this._setSelectableAttr=function(_71){_14.selectable=!!_71;};this.selectRow=function(row){_14.invertedSelection?_9(row,"selected"):_a(row,"selected");};this.deselectRow=function(row){!_14.invertedSelection?_9(row,"selected"):_a(row,"selected");};this.doGridAttributes=function(){var _72=_c.gridAttributes();for(var i=0,_73;_73=_72[i];i++){var _74=_73.tag.split("/");switch(_74.length){case 2:_74=[_74[1]];break;case 1:break;case 4:_74=[_74[1],_74[2],_74[3]];break;}_73.attrs=_74;}};this.fillGrid=function(){_e=_b.getObjects()||[];var _75=_c.gridAttributes();var _76,_77=null;try{if(_14.selectfirst&&!_14.invertedSelection&&_e.length>0&&_d.length===0){_d.push(_e[0].getGuid());setTimeout(_1.hitch(this,function(){this.shareSelected();}),1000);}var _78=_e.length-_11.length,i,l,id;if(_78>0){for(i=0;i<_78;i++){this.addNewRow();}this.mxform.resize();}else{if(_78<0){var _79=function(_7a){_7a.style.display="none";};var app=(!_14.showemptyrows)?_79:_4d;var _7b=_11.length;var _7c=_7b+_78;for(i=_7c;i<_7b;i++){app(_11[i]);}}}var _7d={};for(i=0,id;id=_d[i];i++){_7d[id]=true;}for(i=0,l=_e.length;i<l;i++){_76=_e[i].getGuid();_77=_11[i];this.domData(_77,"mendixguid",_76);_31(_e[i],_12[i],_75);if(!_7d[_76]){this.deselectRow(_77);}else{this.selectRow(_77);}_77.style.display="";}if(_14.showemptyrows){var _7e=_e.length;var _7f=_11.length;if(_7e<_7f){for(i=_7e;i<_7f;i++){this.deselectRow(_11[i]);}}}_7d=null;}catch(e){}};this.reload=this.actReloadGrid=function(_80){if(this.constraintsFilled()){_b.isValid(function(_81){if(_81){_b.refresh(function(){_15.refreshGrid();_80&&_80();});}});}};this.refreshGrid=function(){this.triggerPreRefresh();this.updatePagingStatus();this.fillGrid();this.resizeGrid();this.triggerOnRefresh();};this.triggerOnLoad=function(){this.triggerPluginEvent("onLoad");};this.triggerOnSync=function(){this.triggerPluginEvent("onSync");};this.triggerOnRefresh=function(){this.triggerPluginEvent("onRefresh");};this.triggerPreRefresh=function(){this.triggerPluginEvent("preRefresh");};this.triggerOnSearchChanged=function(){this.triggerPluginEvent("onSearchChanged");};this.actDeferSyncAction=function(_82){if(_5===0){_82&&_82();}else{if(_6==null){_6=_82;}else{}}};this.eventCellClicked=function(e){this.triggerPluginEvent("onCellClicked",e);};this.eventRowMouseOver=function(e){this.triggerPluginEvent("onRowMouseOver",e);};this.eventRowMouseOut=function(e){this.triggerPluginEvent("onRowMouseOut",e);};this.eventCellMouseOut=function(e){this.triggerPluginEvent("onCellMouseOut",e);};this.eventCellMouseOver=function(e){this.triggerPluginEvent("onCellMouseOver",e);};this.eventSelectRow=function(e){this.triggerPluginEvent("onSelectRow",e);};this.eventGridRowClicked=function(e,_83){if(!_14.selectable){return;}var _84=this.domData(_83,"mendixguid");if(_84){var _85=_1.indexOf(_d,_84);if(_14.selectionmode=="simplemulti"){if(_85!=-1){_d.splice(_85,1);this.deselectRow(_83);_84=null;}else{_d.push(_84);this.selectRow(_83);}}else{if((_14.selectionmode=="multi")&&((_1.isMac&&e.metaKey)||(e.ctrlKey))){if(_85!=-1){_d.splice(_85,1);this.deselectRow(_83);_84=null;}else{_d.push(_84);this.selectRow(_83);}}else{this.deselectAll();if(_85==-1||_14.selectionmode=="multi"){this.selectRow(_83);_d=[_84];}}}this.shareSelected();}else{logger.error(this.id+".eventGridRowClicked : Can't find matching guid for row");}};this.eventColumnClicked=function(e,_86){var _87=e.shiftKey;var _88=null;if(!_87){for(var i in _10){_88=_10[i];_1.query("."+_4.sortIcon,_88)[0].style.display="none";}}else{mxui.dom.clearSelection();}var _89=this.domData(_86,"datakey");var _8a="asc";if(this.domData(_86,"sortorder")){_8a=this.domData(_86,"sortorder");_8a=(_8a=="asc")?"desc":"asc";}this.domData(_86,"sortorder",_8a);var _8b=_1.query("."+_4.sortText,_86)[0];if(_8a=="asc"){_8b.innerHTML="&#9650;";}else{_8b.innerHTML="&#9660;";}_8b.parentNode.style.display="";_b.setSortOptions(_89,_8a,_87);if(this.constraintsFilled()){_b.refresh(_7(_15,"refreshGrid"));}};this.filterSelected=function(){var _8c=[];for(var i=0,_8d;_8d=_d[i];i++){if(_b.getObject(_8d)!=null){_8c.push(_8d);}}_d=_8c;};this.actCleanDS=function(_8e){this._clearSelection();_b.clean(_8e);};this.resumed=function(){this.setUpdateInterval();};this.suspended=function(){this.clearInterval();};this._setDisabledAttr=function(_8f){};this._setReadOnlyAttr=function(_90){if(_14.controlbar&&_90!=this.readOnly){var _91=_c.gridTools();if(_90==true){for(var i=_91.length-1,_92;_92=_91[i];i--){if(_92.mxid){var _93=_c.getActionsByKey(_92.mxid);if(_93&&/AddRef|DeleteRef|CreateRef/.test(_93.actionCall)){this.toolBarNode.removeChild(_92._domNode);}}}}else{for(var i=_91.length-1,_92;_92=_91[i];i--){if(_92.mxid){var _93=_c.getActionsByKey(_92.mxid);if(_93&&/AddRef|DeleteRef|CreateRef/.test(_93.actionCall)){if(_92._nextNode){this.toolBarNode.insertBefore(_92._domNode,_92._nextNode);}else{this.toolBarNode.appendChild(_92._domNode);}}}}}this.readOnly=!!_90;}};this.deselectGridRows=function(){for(var i=0,l=_11.length;i<l;++i){this.deselectRow(_11[i]);}};this.getAggregates=function(){return _b.getAggregates();};this.actionExport=function(_94){if(this.constraintsFilled()){var _95=mx.ui.getProgressIndicator("popup");_95.start();_b.generateExport({params:_94,callback:function(){_95.stop();},error:function(e){_95.stop();mx.onError(e);}});}};this.actionInsertNewAtTop=function(_96){var _97=this._getEntity(_96);if(_97){this._insertNewFirstOrLast(_97,_96[_97],false);}};this.actionInsertNewAtBottom=function(_98){var _99=this._getEntity(_98);if(_99){this._insertNewFirstOrLast(_99,_98[_99],true);}};this._insertNewFirstOrLast=function(_9a,_9b,_9c){var _9d=function(_9e){mx.data.create({entity:_9a,context:this.mxcontext,persistent:_9b.persistent,callback:function(obj){if(!_9c){_b.insertMxObjectAtStart(obj);}else{_b.insertMxObjectAtEnd(obj);}_9e();},error:mx.onError});};this.triggerOnSync();this.sequence([_9d,"actDeferSyncAction",function(){this.refreshGrid();var row=_9c?_b.getObjects().length-1:0;this.eventSelectRow({row:row});}]);};this._clearSelection=function(){_d=[];};this._getEntity=function(_9f){return mendix.lang.firstKey(_9f);};this._getGridConfig=function(){return _c;};this._setGridConfig=function(v){_c=v;};this._getGridState=function(){return _14;};this._getSelectedGuids=function(){return _d;};this._getCurrentGuid=function(){return _d[_d.length-1];};this._setDataSource=function(_a0){_b=_a0;},this._addObjectToSelection=function(obj){var _a1=obj.getGuid();if(_1.indexOf(_d,_a1)==-1){_d.push(_a1);}};this._getDataSource=function(){return _b;};this._setDataSource=function(v){_b=v;};this._getNodeFromEvent=function(e){return mxui.dom.getAncestorNode(e.target,"TR");};this._getActionFromEvent=function(e){var _a2=_c.gridActionBindings(),_a3=_a2["on"+e.type];return _c.getActionsByKey(_a3);};this._getObjectFromNode=function(_a4){return _e[this.domData(_a4,"gridrow")];};this.getCellNode=function(row,key){var rob=_12[row];if(rob){for(var i=0;i<rob.length;i++){if(this.domData(rob[i],"key")==key){return rob[i];}}}return null;};this.getMxObjectAtRow=function(x){return (_e.length>=x)?_e[x]:false;};this.getRowForMxObject=function(_a5){var ret=null;if(!_a5||!_a5.getEntity){return ret;}var _a6=_a5.getGuid();for(var i=0,obj;obj=_e[i];i++){if(obj.getGuid()==_a6){ret=i;}}return ret;};this.getKeyPositions=function(){var pos={};var _a7=0;for(var i in _10){pos[i]=_a7++;}return pos;};this.getEntityProperties=function(){return _c.gridAttributes();};this.getHiddenAggregates=function(){return _13.slice();};this.getActionProperties=function(_a8,_a9){var _aa=_c.dataEntityConfigs();var act=null;if(_aa[_a8]){act=_aa[_a8][_a9];}return act;};this.getCurrentGridSize=function(){return _e.length;};this.getGridNodeHash=function(){return _12;};this.getCurrentXPath=function(){var _ab=_b?_b.getCurrentXPath()||"":"";return _ab+_14.xpathConstraint;};this.preventUpdates=function(){_14.inDenial=true;};this.acceptUpdates=function(){_14.inDenial=false;};this.acceptingUpdates=function(){return !_14.inDenial;};this.updateMxObject=function(_ac,_ad){var row=this.getRowForMxObject(_ac);if(row!=null){try{_31(_ac,_12[row],_c.gridAttributes());}catch(e){}}_ad&&_ad();};this.showFootNode=function(){this.gridFootNode.style.display="";};this.hideFootNode=function(){this.gridFootNode.style.display="none";};this.addToSyncDeferQueue=function(){_5++;};this.removeFromSyncDeferQueue=function(){_5--;if(_5===0){if(_6!=null){_6();_6=null;}else{}}};this.onHide=function(e){for(var i in this._searchElements){this._searchElements[i].hideTooltip();}};this.clearInterval=function(){if(_14.update!=null){clearInterval(_14.update);}};this._uninitializeGrid=function(){this._resizer.destroy();this.triggerPluginEvent("onDestroy");};},_addFocusBoxForTable:function(){var box=this.addFocusBox(this.contentNode);box.pressed({DOWN_ARROW:box.FOCUS_NEXT,UP_ARROW:box.FOCUS_PREV,SPACE:function(e){this.eventGridRowClicked(e,e.target);},ENTER:function(e,_ae){if(_ae){this.eventActionBindingHandler(_ae,"dblclick");}},LEFT_ARROW:function(){var _af=this._getDataSource();if(!_af.atBeginning()){_af.previous(_1.hitch(this,function(){this.refreshGrid();mxui.wm.focus.restore();}));}},RIGHT_ARROW:function(){var _b0=this._getDataSource();if(!_b0.atEnd()){_b0.next(_1.hitch(this,function(){this.refreshGrid();mxui.wm.focus.restore();}));}}},this);}});_1.declare("mxui.widget.ColumnResizer",null,{columns:null,thNodes:null,rowNode:null,minWidth:40,cssClass:"mx-datagrid-column-resizer",rtl:false,active:0,startPos:0,startWidth:0,totalWidth:0,bodyCursor:"",handles:null,connects:null,resizing:false,constructor:function(_b1){_b1=_b1||{};var ths=_b1.thNodes,_b2=_b1.colNodes;this.columns=[];this.thNodes=ths;this.rowNode=ths[0].parentNode;this.minWidth=_b1.minWidth||40;this.rtl=_b1.rtl;this.prepareTable(ths,_b2);},prepareTable:function(ths,_b3){_1.forEach(ths,function(th,_b4){if(_b4>0){var _b5=mxui.dom.create("div",{"class":this.cssClass});mxui.dom.data(_b5,"index",_b4);th.firstChild.appendChild(_b5);}this.columns[_b4]={node:th,cols:_b3[_b4],width:0,rounded:0,minWidth:0,startWidth:0};},this);var _b6=this;this.connects=[_1.on(this.rowNode,"."+this.cssClass+":click",_1.stopEvent),_1.on(this.rowNode,"."+this.cssClass+":mousedown",function(e){var _b7=mxui.dom.data(this,"index");_b6.startResize(_b7-1,e);})];},startResize:function(_b8,e){if(this.resizing){this.endResize();return;}this.resizing=true;this.active=_b8;this.startPos=e.pageX;this.startWidth=0;this.totalWidth=this.rowNode.offsetWidth;this.bodyCursor=_1.style(document.body,"cursor");_1.style(document.body,"cursor","col-resize");_1.forEach(this.columns,function(_b9,i){var _ba=this.getColWidth(_b9);_b9.width=_b9.startWidth=_ba;_b9.minWidth=Math.min(_ba,this.minWidth);if(i<=_b8){this.startWidth+=_ba;}},this);this.handles=[_1.connect(document,"mousemove",_1.hitch(this,"moveResize")),_1.connect(document,"mouseup",_1.hitch(this,"endResize"))];e.preventDefault();},moveResize:function(e){var _bb=0,_bc=this.active,_bd=this.columns,_be=this.startWidth+(this.rtl?-1:1)*(e.pageX-this.startPos);this.scaleColumns(_bc,_be);for(var i=0,_bf;_bf=_bd[i];i++){var _c0=Math.round(_bf.width);this.setColWidth(_bf,_c0);_bb+=_c0;}var _c1=this.totalWidth-_bb;this.setColWidth(_bd[_bc],_bd[_bc].rounded+_c1);e.preventDefault();},endResize:function(e){this.resizing=false;while(this.handles.length){_1.disconnect(this.handles.pop());}var _c2=this.columns;for(var i=0,_c3;_c3=_c2[i];i++){var _c4=_c3.rounded/this.totalWidth*100;this.setColWidth(_c3,_c4,"%");}_1.style(document.body,"cursor",this.bodyCursor);},getColWidth:function(_c5){return _c5.node.offsetWidth;},setColWidth:function(_c6,_c7,_c8){_c8=_c8||"px";if(_c8==="px"){_c6.rounded=_c7;}_c6.cols[0].style.width=_c6.cols[1].style.width=_c7+_c8;},scaleColumns:function(_c9,_ca){var _cb=this.columns,_cc=_cb.slice(0,_c9+1),_cd=_cb.slice(_c9+1).reverse(),_ce=this.totalWidth,_cf=0;for(var i=0;i<=_c9;i++){_cf+=_cb[i].width;}if(_ca<_cf){var _d0=this.calcScale(_cc,_ca);this.calcScale(_cd,_ce-_d0);}else{if(_ca>_cf){var _d0=this.calcScale(_cd,_ce-_ca);this.calcScale(_cc,_ce-_d0);}}},calcScale:function(_d1,_d2){var _d3=0,_d4=0,_d5=0,_d6=_d1.pop();for(var i=0;i<_d1.length;i++){_d3+=_d1[i].minWidth;_d4+=_d1[i].startWidth;}_d6.width=Math.max(_d6.minWidth,_d2-_d4);_d2-=_d6.width;for(var i=0;i<_d1.length;i++){var _d7=_d1[i];_d3-=_d7.minWidth;var _d8=Math.min(_d7.startWidth,_d2-_d5-_d3),_d9=Math.min(_d8,_d7.startWidth/_d4*_d2);_d7.width=Math.max(_d7.minWidth,_d9);_d5+=_d7.width;}return _d5+_d6.width;},destroy:function(){while(this.connects.length){_1.disconnect(this.connects.pop());}_1.forEach(this.thNodes,function(th){mxui.dom.data(th,"index",null);});}});});