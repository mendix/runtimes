
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/DataGrid",["dojo","dijit","dojox","dojo/require!mxui/widget/_Grid,mxui/html/render,mxui/lib/ColumnResizer,mxui/widget/plugins/DataGrid/Calculations,mxui/widget/plugins/DataGrid/GridEditor,mxui/widget/plugins/DataGrid/HoverPreview,mxui/widget/plugins/DataGrid/KeyNavigation"],function(_1,_2,_3){_1.provide("mxui.widget.DataGrid");_1.require("mxui.widget._Grid");_1.require("mxui.html.render");_1.require("mxui.lib.ColumnResizer");_1.require("mxui.widget.plugins.DataGrid.Calculations");_1.require("mxui.widget.plugins.DataGrid.GridEditor");_1.require("mxui.widget.plugins.DataGrid.HoverPreview");_1.require("mxui.widget.plugins.DataGrid.KeyNavigation");_1.declare("mxui.widget.DataGrid",mxui.widget._Grid,{templateString:_1.cache("mxui.widget","templates/DataGrid.html","<div class=\"${baseClass} mx-datagrid\">\n    <div class=\"${baseClass}-searchbar clearfix\" dojoAttachPoint=\"searchNode\" focusIndex=\"0\">\n        <div class=\"${baseClass}-search-controls\" focusIndex=\"1\" dojoAttachPoint=\"searchControlNode\"></div>\n        <div class=\"${baseClass}-search-inputs\" focusIndex=\"0\" dojoAttachPoint=\"searchArgumentNode\"></div>\n        <div class=\"${baseClass}-search-message\" dojoAttachPoint=\"messageNode\"></div>\n    </div>\n    \n    <div class=\"${baseClass}-controlbar clearfix\" dojoAttachPoint=\"controlNode\" focusIndex=\"1\">\n        <div class=\"${baseClass}-pagingbar\" dojoAttachPoint=\"pagingBarNode\"></div>\n        <div class=\"${baseClass}-toolbar\" dojoAttachPoint=\"toolBarNode\"></div>\n    </div>\n        \n    <div class=\"${baseClass}-content\" dojoAttachPoint=\"contentNode\" focusIndex=\"2\">\n        <div class=\"${subClass}-content-wrapper\" dojoAttachPoint=\"tableWrapper\">\n            <table class=\"table table-bordered ${subClass}-head-table\" dojoAttachPoint=\"headTable\">\n                <colgroup dojoAttachPoint=\"headTableGroupNode\"></colgroup>\n                <thead class=\"${subClass}-head\" dojoAttachPoint=\"gridHeadNode\"></thead>\n            </table>\n            <table class=\"table table-striped table-bordered ${subClass}-body-table\" dojoAttachPoint=\"gridTable\">\n                <colgroup dojoAttachPoint=\"bodyTableGroupNode\"></colgroup>\n                <tbody class=\"${subClass}-body\" dojoAttachPoint=\"gridBodyNode\"></tbody>\n                <tfoot class=\"${subClass}-foot\" dojoAttachPoint=\"gridFootNode\"></tfoot>\n            </table>\n        </div>\n    </div>\n</div>\n"),subClass:"mx-datagrid",cssmap:mxui.widget.createCSSMap("mx-datagrid",{sortText:"sort-text",sortIcon:"sort-icon",headCaption:"head-caption",headWrapper:"head-wrapper",columnResizer:"column-resizer",dataWrapper:"data-wrapper"}),readOnly:false,gridBodyNode:null,gridFootNode:null,_deferSyncQueue:0,_deferSyncCallback:null,_selectedGuids:null,_mxObjects:null,_gridColumnNodes:null,_gridRowNodes:null,_gridMatrix:null,_hiddenAggregates:null,constructor:function(){this._selectedGuids=[];this._mxObjects=[];this._gridColumnNodes={};this._gridRowNodes=[];this._gridMatrix=[];this._hiddenAggregates=[];this._gridState={sortable:true,selectable:true,selectionmode:"single",searchbar:true,controlbar:true,pagingbar:true,inDenial:false,searchBarVisible:false,searchBarTogglable:true,xpathConstraint:"",loading:false,invertedSelection:false};},postCreate:function(){this.inherited(arguments);this._addFocusBoxForTable();if(this.fetchMetaObject()){this.setupGridConfig();this.setupGridState();this.setupScroll();this.buildSearchBar();this.buildControlBar();this.buildToolBar();this.buildPagingBar();this.buildGridBody();this.setupDevMode();this.loadPlugins();this.setupDataSource();this.doGridAttributes();this.triggerOnLoad();this.loaded();}},setColumnStyle:function(_4,_5){var _6=_5.display,_7=_6.align||"left",_8=_6.cssClass||"",_9=_6.cssStyle;if(mx.ui.isRtl()){_7=_7=="right"?"left":"right";}if(_9){_4.style=_9;}_1.addClass(_4,[_7==="right"?"mx-right-aligned":"mx-left-aligned",_8].join(" "));},buildGridRow:function(_a,_b){var tr=mxui.dom.tr();this.domData(tr,"gridrow",_b);var td,_c=null,_d=[];for(var i=0,_e;_e=_a[i];i++){td=mxui.dom.td();this.domData(td,{row:_b,column:i,key:_e.tag});this.setColumnStyle(td,_e);td.appendChild(mxui.dom.div({"class":this.cssmap.dataWrapper}));tr.appendChild(td);_d[i]=td;}this._gridMatrix.push(_d);return tr;},setNodeTitle:function(_f,_10){_10=_10||_f;var _11=_10.textContent?_10.textContent:_10.innerText;_11&&_f.setAttribute("title",_11.replace(/^\s\s*/,"").replace(/\s\s*$/,""));},gridbodyFillCell:function(_12,_13,_14){var _15=null,_16;if(_13.has(_14)){_16=_13.get(_14);switch(_12.render.toLowerCase()){case "icon":case "enumicon":var src=_12.display.mapping[_16];_16=src?"<img src='"+src+"'/>":"";break;case "weblink":break;default:try{var _17=_12.display,_18=_17.dateFormat||"date";_16=mxui.html.renderValue(_13,_14,{format:_18.toLowerCase().replace("custom","date"),datepattern:_17.format,formatted:_17.formatted,precision:_17.precision});_16=mxui.dom.escapeString(_16.replace(/\n/g," "));}catch(e){logger.error("mxui.widget.DataGrid.gridbodyFillCell : "+e.message);}break;}_16=(_16?_16:String.fromCharCode(160));}else{_16=String.fromCharCode(160);}return _16;},createRenderItem:function(obj,_19,_1a){return ({mxobj:obj,attrname:_19,attrs:_1a});},disableRow:function(tr){tr.style.display="";this.domData(tr,"mendixguid",null);var tds=tr.getElementsByTagName("td");for(var i=0;i<tds.length;i++){tds[i].firstChild.innerHTML="&nbsp";tds[i].setAttribute("title","");}},setupGridState:function(){this.inherited(arguments);this._gridState.sortable=this._gridConfig.gridSetting("sortable");},loadPlugins:function(_1b){this.hideFootNode();if(this._gridState.editable){this.loadPlugin("GridEditor");mxui.wm.focus.removeBox(this.contentNode);}var _1c=this._gridConfig.getPlugins();for(var i in _1c){this.loadPlugin(i,_1c[i]);}},eventToolbarClick:function(_1d){if(!_1d){return;}var _1e=_2.byNode(_1d);_1e&&_1e._onClick();},setupScroll:function(_1f){var _20=this.headTable,_21=this.contentNode;this.connect(_21,"scroll",function(e){_20.style.top=_21.scrollTop+"px";});},resize:function(box){this.inherited(arguments);this._resizer.recalculate();},buildGridBody:function(){var _22=this._gridConfig.gridAttributes();var _23=this;var _24=null;var _25=null;var _26=null;var _27=null;var row=mxui.dom.tr();var _28=mxui.dom.div({"class":this.cssmap.headCaption});var _29=mxui.dom.div({"class":this.cssmap.headWrapper});var _2a=[];mxui.dom.disableSelection(row);var _2b=this._gridConfig.gridSetting("sortparams"),_2c={};if(_2b){for(var j=0,_2d;_2d=_2b[j];j++){_2c[_2d[0]]=_2d;}}var _2e=this._gridConfig.getPlugins()["Calculations"]||{};var _2f=0;for(var i=0,_30;_30=_22[i];i++,_2f+=_30.tag in _2e?1:0){var _31=_24;var _32=_30.display.width;if(_32!=null&&_32=="0"){if(_30.tag in _2e){this._hiddenAggregates.push(_2f);}_22.splice(i--,1);continue;}_24=mxui.dom.th();this.domData(_24,{datakey:_30.tag,key:i});this.setColumnStyle(_24,_30);var _33=_30.display.string;_27=_28.cloneNode(true);_27.innerHTML=!_33?"&nbsp;":_33;var _34=_29.cloneNode(true);_25=mxui.dom.div({"class":this.cssmap.sortIcon,style:"display: none"},_26=mxui.dom.span({"class":this.cssmap.sortText}));_34.appendChild(_25);_34.appendChild(_27);_24.appendChild(_34);this.setNodeTitle(_24,_27);var _35=_30.display.width;var col=mxui.dom.col({style:"width:"+_35}),_36=col.cloneNode(true);this.headTableGroupNode.appendChild(col);this.bodyTableGroupNode.appendChild(_36);_2a[i]=[col,_36];var _37=_2c[_30.tag];if(_37){var _38=_37[1];this.domData(_24,"sortorder",_38);if(_38=="asc"){_26.innerHTML="&#9650;";}else{_26.innerHTML="&#9660;";}_25.style.display="";}this._gridColumnNodes[i]=_24;row.appendChild(_24);}_2c=null;this.gridHeadNode.appendChild(row);if(this._gridState.sortable){this.own(_1.on(this.gridHeadNode,"th:click",function(e){var key=_23.domData(this,"key");if(_22[key].sortable!==false){_23.eventColumnClicked(e,this);}}));}this._resizer=new mxui.lib.ColumnResizer({thNodes:mxui.dom.toArray(row.children),colNodes:_2a,colUnits:_22[0].display.width.indexOf("%")>0?"%":"px",rtl:!this.isLeftToRight(),tableNode:this.headTable,gridNode:this.gridTable});if(this._gridState.showemptyrows){var _39=this._gridConfig.gridSetting("rows");for(var i=0;i<_39;i++){this.addNewRow();}}this.own(_1.on(this.gridBodyNode,"tr:click",function(e){_23.eventGridRowClicked(e,this);}));this.liveConnect(this.gridBodyNode,"onclick",{td:"eventCellClicked"});this.liveConnect(this.gridBodyNode,"onmouseover",{tr:"eventRowMouseOver"});this.liveConnect(this.gridBodyNode,"onmouseout",{tr:"eventRowMouseOut"});var _3a=function(e){_23.eventActionBindingHandler(this,e.type);};var _3b=this._gridConfig.gridActionBindings();for(var _3c in _3b){this.own(_1.on(this.gridBodyNode,"tr:"+_3c.replace(/^on/,""),_3a));}},addNewRow:function(){var _3d=this._gridConfig.gridAttributes();var _3e=this._gridConfig.gridSetting("rows");var _3f=this._gridRowNodes.length;if(_3f>_3e){return null;}var tr=this.buildGridRow(_3d,_3f);this._gridRowNodes.push(tr);this.gridBodyNode.appendChild(tr);var box=this.getFocusBox(this.contentNode);box.add&&box.add(tr);return tr;},isInverted:function(){return !!this._gridState.invertedSelection;},selectRow:function(row){this._gridState.invertedSelection?_1.removeClass(row,"selected"):_1.addClass(row,"selected");},deselectRow:function(row){!this._gridState.invertedSelection?_1.removeClass(row,"selected"):_1.addClass(row,"selected");},doGridAttributes:function(){var _40=this._gridConfig.gridAttributes();for(var i=0,_41;_41=_40[i];i++){var _42=_41.tag.split("/");switch(_42.length){case 2:_42=[_42[1]];break;case 1:break;case 4:_42=[_42[1],_42[2],_42[3]];break;}_41.attrs=_42;}},fillGrid:function(){this._mxObjects=this._dataSource.getObjects()||[];var _43=this._gridConfig.gridAttributes();var _44,_45=null;try{if(this._gridState.selectfirst&&!this._gridState.invertedSelection&&this._mxObjects.length>0&&this._selectedGuids.length===0){this._selectedGuids.push(this._mxObjects[0].getGuid());setTimeout(_1.hitch(this,function(){this.shareSelected();}),1000);}var _46=this._mxObjects.length-this._gridRowNodes.length,i,l,id;if(_46>0){for(i=0;i<_46;i++){this.addNewRow();}this.mxform.resize();}else{if(_46<0){var _47=this._gridRowNodes.length;var _48=_47+_46;for(i=_48;i<_47;i++){var _49=this._gridRowNodes[i];if(this._gridState.showemptyrows){this.disableRow(_49);}else{_49.style.display="none";}}}}var _4a={};for(i=0;id=this._selectedGuids[i];i++){_4a[id]=true;}for(i=0,l=this._mxObjects.length;i<l;i++){_44=this._mxObjects[i].getGuid();_45=this._gridRowNodes[i];this.domData(_45,"mendixguid",_44);this._gridbodyFillRow(this._mxObjects[i],this._gridMatrix[i],_43);if(!_4a[_44]){this.deselectRow(_45);}else{this.selectRow(_45);}_45.style.display="";}if(this._gridState.showemptyrows){var _4b=this._mxObjects.length;var _4c=this._gridRowNodes.length;if(_4b<_4c){for(i=_4b;i<_4c;i++){this.deselectRow(this._gridRowNodes[i]);}}}_4a=null;}catch(e){}},actReloadGrid:function(_4d){if(this.constraintsFilled()){var _4e=this;this._dataSource.isValid(function(_4f){if(_4f){_4e._dataSource.refresh(function(){_4e.refreshGrid();_4d&&_4d();});}});}},refreshGrid:function(){this.triggerPreRefresh();this.updatePagingStatus();this.fillGrid();this.resizeGrid();this.triggerOnRefresh();},triggerOnLoad:function(){this.triggerPluginEvent("onLoad");},triggerOnSync:function(){this.triggerPluginEvent("onSync");},triggerOnRefresh:function(){this.triggerPluginEvent("onRefresh");},triggerPreRefresh:function(){this.triggerPluginEvent("preRefresh");},triggerOnSearchChanged:function(){this.triggerPluginEvent("onSearchChanged");},actDeferSyncAction:function(_50){if(this._deferSyncQueue===0){_50&&_50();}else{if(this._deferSyncCallback==null){this._deferSyncCallback=_50;}else{}}},eventCellClicked:function(e){this.triggerPluginEvent("onCellClicked",e);},eventRowMouseOver:function(e){this.triggerPluginEvent("onRowMouseOver",e);},eventRowMouseOut:function(e){this.triggerPluginEvent("onRowMouseOut",e);},eventCellMouseOut:function(e){this.triggerPluginEvent("onCellMouseOut",e);},eventCellMouseOver:function(e){this.triggerPluginEvent("onCellMouseOver",e);},eventSelectRow:function(e){this.triggerPluginEvent("onSelectRow",e);},eventGridRowClicked:function(e,_51){if(!this._gridState.selectable){return;}var _52=this.domData(_51,"mendixguid");if(_52){var _53=_1.indexOf(this._selectedGuids,_52);if(this._gridState.selectionmode=="simplemulti"){if(_53!=-1){this._selectedGuids.splice(_53,1);this.deselectRow(_51);_52=null;}else{this._selectedGuids.push(_52);this.selectRow(_51);}}else{if((this._gridState.selectionmode=="multi")&&((_1.isMac&&e.metaKey)||(e.ctrlKey))){if(_53!=-1){this._selectedGuids.splice(_53,1);this.deselectRow(_51);_52=null;}else{this._selectedGuids.push(_52);this.selectRow(_51);}}else{this.deselectAll();if(_53==-1||this._gridState.selectionmode=="multi"){this.selectRow(_51);this._selectedGuids=[_52];}}}this.shareSelected();}else{logger.error(this.id+".eventGridRowClicked : Can't find matching guid for row");}},eventColumnClicked:function(e,_54){var _55=e.shiftKey;var _56=null;if(!_55){for(var i in this._gridColumnNodes){_56=this._gridColumnNodes[i];_1.query("."+this.cssmap.sortIcon,_56)[0].style.display="none";}}else{mxui.dom.clearSelection();}var _57=this.domData(_54,"datakey");var _58="asc";if(this.domData(_54,"sortorder")){_58=this.domData(_54,"sortorder");_58=(_58=="asc")?"desc":"asc";}this.domData(_54,"sortorder",_58);var _59=_1.query("."+this.cssmap.sortText,_54)[0];if(_58=="asc"){_59.innerHTML="&#9650;";}else{_59.innerHTML="&#9660;";}_59.parentNode.style.display="";this._dataSource.setSortOptions(_57,_58,_55);if(this.constraintsFilled()){this._dataSource.refresh(_1.hitch(this,"refreshGrid"));}},filterSelected:function(){var _5a=[];for(var i=0,_5b;_5b=this._selectedGuids[i];i++){if(this._dataSource.getObject(_5b)!=null){_5a.push(_5b);}}this._selectedGuids=_5a;},actCleanDS:function(_5c){this._clearSelection();this._dataSource.clean(_5c);},resumed:function(){this.setUpdateInterval();},suspended:function(){this.clearInterval();},deselectGridRows:function(){for(var i=0,l=this._gridRowNodes.length;i<l;++i){this.deselectRow(this._gridRowNodes[i]);}},getAggregates:function(){return this._dataSource.getAggregates();},actionExport:function(_5d){if(this.constraintsFilled()){var _5e=mx.ui.getProgressIndicator("popup");_5e.start();this._dataSource.generateExport({params:_5d,callback:function(){_5e.stop();},error:function(e){_5e.stop();mx.onError(e);}});}},actionInsertNewAtTop:function(_5f){var _60=this._getEntity(_5f);if(_60){this._insertNewFirstOrLast(_60,_5f[_60],false);}},actionInsertNewAtBottom:function(_61){var _62=this._getEntity(_61);if(_62){this._insertNewFirstOrLast(_62,_61[_62],true);}},getCellNode:function(row,key){var rob=this._gridMatrix[row];if(rob){for(var i=0;i<rob.length;i++){if(this.domData(rob[i],"key")==key){return rob[i];}}}return null;},getMxObjectAtRow:function(x){return (this._mxObjects.length>=x)?this._mxObjects[x]:false;},getRowForMxObject:function(_63){var ret=null;if(!_63||!_63.getEntity){return ret;}var _64=_63.getGuid();for(var i=0,obj;obj=this._mxObjects[i];i++){if(obj.getGuid()==_64){ret=i;}}return ret;},getKeyPositions:function(){var pos={};var _65=0;for(var i in this._gridColumnNodes){pos[i]=_65++;}return pos;},getEntityProperties:function(){return this._gridConfig.gridAttributes();},getHiddenAggregates:function(){return this._hiddenAggregates.slice();},getActionProperties:function(_66,_67){var _68=this._gridConfig.dataEntityConfigs();var act=null;if(_68[_66]){act=_68[_66][_67];}return act;},getCurrentGridSize:function(){return this._mxObjects.length;},getGridNodeHash:function(){return this._gridMatrix;},getCurrentXPath:function(){var _69=this._dataSource?this._dataSource.getCurrentXPath()||"":"";return _69+this._gridState.xpathConstraint;},preventUpdates:function(){this._gridState.inDenial=true;},acceptUpdates:function(){this._gridState.inDenial=false;},acceptingUpdates:function(){return !this._gridState.inDenial;},updateMxObject:function(_6a,_6b){var row=this.getRowForMxObject(_6a);if(row!=null){try{this._gridbodyFillRow(_6a,this._gridMatrix[row],this._gridConfig.gridAttributes());}catch(e){}}_6b&&_6b();},showFootNode:function(){this.gridFootNode.style.display="";},hideFootNode:function(){this.gridFootNode.style.display="none";},addToSyncDeferQueue:function(){this._deferSyncQueue++;},removeFromSyncDeferQueue:function(){this._deferSyncQueue--;if(this._deferSyncQueue===0){if(this._deferSyncCallback!=null){this._deferSyncCallback();this._deferSyncCallback=null;}else{}}},clearInterval:function(){if(this._gridState.update!=null){clearInterval(this._gridState.update);}},uninitialize:function(){this._resizer.destroy();this.triggerPluginEvent("onDestroy");this.inherited(arguments);},_setSelectableAttr:function(_6c){this._gridState.selectable=!!_6c;},_setDisabledAttr:function(_6d){},_setReadOnlyAttr:function(_6e){if(this._gridState.controlbar&&_6e!=this.readOnly){var _6f=this._gridConfig.gridTools();if(_6e==true){for(var i=_6f.length-1,_70;_70=_6f[i];i--){if(_70.mxid){var _71=this._gridConfig.getActionsByKey(_70.mxid);if(_71&&/AddRef|DeleteRef|CreateRef/.test(_71.actionCall)){this.toolBarNode.removeChild(_70._domNode);}}}}else{for(var i=_6f.length-1,_70;_70=_6f[i];i--){if(_70.mxid){var _71=this._gridConfig.getActionsByKey(_70.mxid);if(_71&&/AddRef|DeleteRef|CreateRef/.test(_71.actionCall)){if(_70._nextNode){this.toolBarNode.insertBefore(_70._domNode,_70._nextNode);}else{this.toolBarNode.appendChild(_70._domNode);}}}}}this.readOnly=!!_6e;}},_gridbodyFillRow:function(_72,_73,_74){var _75=[];var _76=" - ";var _77=null;for(var i=0,td;td=_73[i];i++){var _78=[];var _79=_74[i];var _7a=false;_75=_79.attrs;if(_75.length==1){_78.push(this.createRenderItem(_72,_75[0],_79));}else{var _7b=_72;var _7c=_75.concat([]);while(_7c.length>3){var _7d=_7c.shift();var _7e=_7c.shift();var _7f=_7b.getChildren(_7d);if(_7b=_7f[0]){if(!_7b.isA(_7e)){logger.error(this.id+".gridBodyFillRow: Entity and reference do not match");_7b=null;break;}}else{_7b=null;break;}}if(_7b!=null&&(_7c.length)==3){_77=_7b.getChildren(_7c[0]);_1.forEach(_77,function(_80){_78.push(this.createRenderItem(_80,_7c[2],_79));},this);if(_75.length==3&&_77.length===0){_7a=!!_72.get(_75[0]);}}}var _81=td.firstChild;_81.innerHTML="";if(!_7a){var _82=[];try{if(_78.length!==0){var _83=[];for(var j=0,_84;_84=_78[j];j++){var _76=this.gridbodyFillCell(_84.attrs,_84.mxobj,_84.attrname);if(_76!=null){_83.push(_76);}else{logger.error(this.id+".gridBodyFillRow: Received NO content!!!");}if(/^(enum)?icon$/i.test(_84.attrs.render)){_82.push(_84.mxobj.getEnumCaption(_84.attrname));}}_81.innerHTML=_83.join(_83.length>1?", ":"");}}catch(e){logger.error(this.id+".gridBodyFillRow :"+e.message);}if(_81.childNodes.length===0){_81.innerHTML="&nbsp;";}if(_82.length!==0){td.setAttribute("title",_82.join(";"));}else{this.setNodeTitle(td);}}else{if(_72.isReference(_75[0])){(function(td){var _85=_79;var _86=(_75.length==3)?_75[2]:_75[3];var _87=_72.getReferences(_75[0]);var _88=_81;mx.data.get({guids:_87,callback:function(_89){var _8a=[],_82=[];_1.forEach(_89,function(obj){var _8b=this.gridbodyFillCell(_85,obj,_86);if(_8b!=null){_8a.push(_8b);}else{logger.error(this.id+".gridBodyFillRow: Recivied NO content!!!");}if(/^(enum)?icon$/i.test(_85.render)){_82.push(obj.getEnumCaption(_86));}});var _8c=_8a.length;_88.innerHTML=_8c===0?"&nbsp;":_8a.join(_8c>1?";":"");if(_88.childNodes.length===0){_88.innerHTML="&nbsp;";}if(_82.length!==0){td.setAttribute("title",_82.join(";"));}else{this.setNodeTitle(td);}},error:mx.onError},this);}).call(this,td);}else{logger.error(this.id+".gridBodyFillRow: Attribute "+_75[0]+" is not a reference(set)");}}}},_insertNewFirstOrLast:function(_8d,_8e,_8f){var _90=function(_91){mx.data.create({entity:_8d,context:this.mxcontext,persistent:_8e.persistent,callback:function(obj){if(!_8f){this._dataSource.insertMxObjectAtStart(obj);}else{this._dataSource.insertMxObjectAtEnd(obj);}_91();},error:mx.onError},this);};this.triggerOnSync();this.sequence([_90,"actDeferSyncAction",function(){this.refreshGrid();var row=_8f?this._dataSource.getObjects().length-1:0;this.eventSelectRow({row:row});}]);},_clearSelection:function(){this._selectedGuids=[];},_getEntity:function(_92){return mendix.lang.firstKey(_92);},_getSelectedGuids:function(){return this._selectedGuids;},_getCurrentGuid:function(){return this._selectedGuids[this._selectedGuids.length-1];},_addObjectToSelection:function(obj){var _93=obj.getGuid();if(_1.indexOf(this._selectedGuids,_93)==-1){this._selectedGuids.push(_93);}},_getNodeFromEvent:function(e){return mxui.dom.getAncestorNode(e.target,"TR");},_getActionFromEvent:function(e){var _94=this._gridConfig.gridActionBindings(),_95=_94["on"+e.type];return this._gridConfig.getActionsByKey(_95);},_getObjectFromNode:function(_96){return this._mxObjects[this.domData(_96,"gridrow")];},_addFocusBoxForTable:function(){var box=this.addFocusBox(this.contentNode);box.pressed({DOWN_ARROW:box.FOCUS_NEXT,UP_ARROW:box.FOCUS_PREV,SPACE:function(e){this.eventGridRowClicked(e,e.target);},ENTER:function(e,_97){if(_97){this.eventActionBindingHandler(_97,"dblclick");}},LEFT_ARROW:function(){if(!this._dataSource.atBeginning()){this._dataSource.previous(_1.hitch(this,function(){this.refreshGrid();mxui.wm.focus.restore();}));}},RIGHT_ARROW:function(){if(!this._dataSource.atEnd()){this._dataSource.next(_1.hitch(this,function(){this.refreshGrid();mxui.wm.focus.restore();}));}}},this);}});});