
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/DataGrid",["dojo","dijit","dojox","dojo/require!mxui/widget/_Grid,mxui/html/render,mxui/lib/ColumnResizer,mxui/widget/plugins/DataGrid/Calculations,mxui/widget/plugins/DataGrid/GridEditor,mxui/widget/plugins/DataGrid/HoverPreview,mxui/widget/plugins/DataGrid/KeyNavigation"],function(_1,_2,_3){_1.provide("mxui.widget.DataGrid");_1.require("mxui.widget._Grid");_1.require("mxui.html.render");_1.require("mxui.lib.ColumnResizer");_1.require("mxui.widget.plugins.DataGrid.Calculations");_1.require("mxui.widget.plugins.DataGrid.GridEditor");_1.require("mxui.widget.plugins.DataGrid.HoverPreview");_1.require("mxui.widget.plugins.DataGrid.KeyNavigation");_1.declare("mxui.widget.DataGrid",mxui.widget._Grid,{templateString:_1.cache("mxui.widget","templates/DataGrid.html","<div class=\"${baseClass} mx-datagrid\">\n    <div class=\"${baseClass}-searchbar clearfix\" dojoAttachPoint=\"searchNode\" focusIndex=\"0\">\n        <div class=\"${baseClass}-search-controls\" focusIndex=\"1\" dojoAttachPoint=\"searchControlNode\"></div>\n        <div class=\"${baseClass}-search-inputs\" focusIndex=\"0\" dojoAttachPoint=\"searchArgumentNode\"></div>\n        <div class=\"${baseClass}-search-message\" dojoAttachPoint=\"messageNode\"></div>\n    </div>\n    \n    <div class=\"${baseClass}-controlbar clearfix\" dojoAttachPoint=\"controlNode\" focusIndex=\"1\">\n        <div class=\"${baseClass}-pagingbar\" dojoAttachPoint=\"pagingBarNode\"></div>\n        <div class=\"${baseClass}-toolbar\" dojoAttachPoint=\"toolBarNode\"></div>\n    </div>\n        \n    <div class=\"${baseClass}-content\" dojoAttachPoint=\"contentNode\" focusIndex=\"2\">\n        <div class=\"${subClass}-content-wrapper\" dojoAttachPoint=\"tableWrapper\">\n            <table class=\"table table-bordered ${subClass}-head-table\" dojoAttachPoint=\"headTable\">\n                <colgroup dojoAttachPoint=\"headTableGroupNode\"></colgroup>\n                <thead class=\"${subClass}-head\" dojoAttachPoint=\"gridHeadNode\"></thead>\n            </table>\n            <table class=\"table table-striped table-bordered ${subClass}-body-table\" dojoAttachPoint=\"gridTable\">\n                <colgroup dojoAttachPoint=\"bodyTableGroupNode\"></colgroup>\n                <tbody class=\"${subClass}-body\" dojoAttachPoint=\"gridBodyNode\"></tbody>\n                <tfoot class=\"${subClass}-foot\" dojoAttachPoint=\"gridFootNode\"></tfoot>\n            </table>\n        </div>\n    </div>\n</div>\n"),subClass:"mx-datagrid",cssmap:mxui.widget.createCSSMap("mx-datagrid",{sortText:"sort-text",sortIcon:"sort-icon",headCaption:"head-caption",headWrapper:"head-wrapper",columnResizer:"column-resizer",dataWrapper:"data-wrapper"}),readOnly:false,gridBodyNode:null,gridFootNode:null,_deferSyncQueue:0,_deferSyncCallback:null,_selectedGuids:null,_mxObjects:null,_gridColumnNodes:null,_gridRowNodes:null,_gridMatrix:null,_hiddenAggregates:null,constructor:function(){this._selectedGuids=[];this._mxObjects=[];this._gridColumnNodes={};this._gridRowNodes=[];this._gridMatrix=[];this._hiddenAggregates=[];this._gridState={sortable:true,selectable:true,selectionmode:"single",searchbar:true,controlbar:true,pagingbar:true,inDenial:false,searchBarVisible:false,searchBarTogglable:true,xpathConstraint:"",loading:false,invertedSelection:false};},postCreate:function(){this.inherited(arguments);this._addFocusBoxForTable();if(this.fetchMetaObject()){this.setupGridConfig();this.setupGridState();this.setupScroll();this.buildSearchBar();this.buildControlBar();this.buildToolBar();this.buildPagingBar();this.buildGridBody();this.setupDevMode();this.loadPlugins();this.setupDataSource();this.doGridAttributes();this.triggerOnLoad();this.loaded();}},setColumnStyle:function(_4,_5){var _6=_5.display,_7=_6.align||"left",_8=_6.cssClass||"",_9=_6.cssStyle;if(mx.ui.isRtl()){_7=_7=="right"?"left":"right";}if(_9){_4.style=_9;}_1.addClass(_4,[_7==="right"?"mx-right-aligned":"mx-left-aligned",_8].join(" "));},buildGridRow:function(_a,_b){var tr=mxui.dom.tr();this.domData(tr,"gridrow",_b);var td,_c=null,_d=[];for(var i=0,_e;_e=_a[i];i++){td=mxui.dom.td();this.domData(td,{row:_b,column:i,key:_e.tag});this.setColumnStyle(td,_e);td.appendChild(mxui.dom.div({"class":this.cssmap.dataWrapper}));tr.appendChild(td);_d[i]=td;}this._gridMatrix.push(_d);return tr;},setNodeTitle:function(_f,_10){_10=_10||_f;var _11=_10.textContent?_10.textContent:_10.innerText;_11&&_f.setAttribute("title",_11.replace(/^\s\s*/,"").replace(/\s\s*$/,""));},gridbodyFillCell:function(_12,_13,_14){var _15=null,_16;if(_13.has(_14)){_16=_13.get(_14);switch(_12.render.toLowerCase()){case "icon":case "enumicon":var src=_12.display.mapping[_16];_16=src?"<img src='"+src+"'/>":"";break;case "weblink":break;default:try{var _17=_12.display,_18=_17.dateFormat,_19=_17.format;_16=mxui.html.renderValue(_13,_14,{format:_18?_18.toLowerCase().replace("custom","date"):"date",datepattern:_19,precision:_17.precision});_16=mxui.dom.escapeString(_16.replace(/\n/g," "));}catch(e){logger.error("mxui.widget.DataGrid.gridbodyFillCell : "+e.message);}break;}_16=(_16?_16:String.fromCharCode(160));}else{_16=String.fromCharCode(160);}return _16;},createRenderItem:function(obj,_1a,_1b){return ({mxobj:obj,attrname:_1a,attrs:_1b});},disableRow:function(tr){tr.style.display="";this.domData(tr,"mendixguid",null);var tds=tr.getElementsByTagName("td");for(var i=0;i<tds.length;i++){tds[i].firstChild.innerHTML="&nbsp";tds[i].setAttribute("title","");}},setupGridState:function(){this.inherited(arguments);this._gridState.sortable=this._gridConfig.gridSetting("sortable");},loadPlugins:function(_1c){this.hideFootNode();if(this._gridState.editable){this.loadPlugin("GridEditor");mxui.wm.focus.removeBox(this.contentNode);}var _1d=this._gridConfig.getPlugins();for(var i in _1d){this.loadPlugin(i,_1d[i]);}},eventToolbarClick:function(_1e){if(!_1e){return;}var _1f=_2.byNode(_1e);_1f&&_1f._onClick();},setupScroll:function(_20){var _21=this.headTable,_22=this.contentNode;this.connect(_22,"scroll",function(e){_21.style.top=_22.scrollTop+"px";});},resize:function(box){this.inherited(arguments);this._resizer.recalculate();},buildGridBody:function(){var _23=this._gridConfig.gridAttributes();var _24=this;var _25=null;var _26=null;var _27=null;var _28=null;var row=mxui.dom.tr();var _29=mxui.dom.div({"class":this.cssmap.headCaption});var _2a=mxui.dom.div({"class":this.cssmap.headWrapper});var _2b=[];mxui.dom.disableSelection(row);var _2c=this._gridConfig.gridSetting("sortparams"),_2d={};if(_2c){for(var j=0,_2e;_2e=_2c[j];j++){_2d[_2e[0]]=_2e;}}var _2f=this._gridConfig.getPlugins()["Calculations"]||{};var _30=0;for(var i=0,_31;_31=_23[i];i++,_30+=_31.tag in _2f?1:0){var _32=_25;var _33=_31.display.width;if(_33!=null&&_33=="0"){if(_31.tag in _2f){this._hiddenAggregates.push(_30);}_23.splice(i--,1);continue;}_25=mxui.dom.th();this.domData(_25,{datakey:_31.tag,key:i});this.setColumnStyle(_25,_31);var _34=_31.display.string;_28=_29.cloneNode(true);_28.innerHTML=!_34?"&nbsp;":_34;var _35=_2a.cloneNode(true);_26=mxui.dom.div({"class":this.cssmap.sortIcon,style:"display: none"},_27=mxui.dom.span({"class":this.cssmap.sortText}));_35.appendChild(_26);_35.appendChild(_28);_25.appendChild(_35);this.setNodeTitle(_25,_28);var _36=_31.display.width;var col=mxui.dom.col({style:"width:"+_36}),_37=col.cloneNode(true);this.headTableGroupNode.appendChild(col);this.bodyTableGroupNode.appendChild(_37);_2b[i]=[col,_37];var _38=_2d[_31.tag];if(_38){var _39=_38[1];this.domData(_25,"sortorder",_39);if(_39=="asc"){_27.innerHTML="&#9650;";}else{_27.innerHTML="&#9660;";}_26.style.display="";}this._gridColumnNodes[i]=_25;row.appendChild(_25);}_2d=null;this.gridHeadNode.appendChild(row);if(this._gridState.sortable){this.own(_1.on(this.gridHeadNode,"th:click",function(e){var key=_24.domData(this,"key");if(_23[key].sortable!==false){_24.eventColumnClicked(e,this);}}));}this._resizer=new mxui.lib.ColumnResizer({thNodes:mxui.dom.toArray(row.children),colNodes:_2b,colUnits:_23[0].display.width.indexOf("%")>0?"%":"px",rtl:!this.isLeftToRight(),tableNode:this.headTable,gridNode:this.gridTable});if(this._gridState.showemptyrows){var _3a=this._gridConfig.gridSetting("rows");for(var i=0;i<_3a;i++){this.addNewRow();}}this.own(_1.on(this.gridBodyNode,"tr:click",function(e){_24.eventGridRowClicked(e,this);}));this.liveConnect(this.gridBodyNode,"onclick",{td:"eventCellClicked"});this.liveConnect(this.gridBodyNode,"onmouseover",{tr:"eventRowMouseOver"});this.liveConnect(this.gridBodyNode,"onmouseout",{tr:"eventRowMouseOut"});var _3b=function(e){_24.eventActionBindingHandler(this,e.type);};var _3c=this._gridConfig.gridActionBindings();for(var _3d in _3c){this.own(_1.on(this.gridBodyNode,"tr:"+_3d.replace(/^on/,""),_3b));}},addNewRow:function(){var _3e=this._gridConfig.gridAttributes();var _3f=this._gridConfig.gridSetting("rows");var _40=this._gridRowNodes.length;if(_40>_3f){return null;}var tr=this.buildGridRow(_3e,_40);this._gridRowNodes.push(tr);this.gridBodyNode.appendChild(tr);var box=this.getFocusBox(this.contentNode);box.add&&box.add(tr);return tr;},isInverted:function(){return !!this._gridState.invertedSelection;},selectRow:function(row){this._gridState.invertedSelection?_1.removeClass(row,"selected"):_1.addClass(row,"selected");},deselectRow:function(row){!this._gridState.invertedSelection?_1.removeClass(row,"selected"):_1.addClass(row,"selected");},doGridAttributes:function(){var _41=this._gridConfig.gridAttributes();for(var i=0,_42;_42=_41[i];i++){var _43=_42.tag.split("/");switch(_43.length){case 2:_43=[_43[1]];break;case 1:break;case 4:_43=[_43[1],_43[2],_43[3]];break;}_42.attrs=_43;}},fillGrid:function(){this._mxObjects=this._dataSource.getObjects()||[];var _44=this._gridConfig.gridAttributes();var _45,_46=null;try{if(this._gridState.selectfirst&&!this._gridState.invertedSelection&&this._mxObjects.length>0&&this._selectedGuids.length===0){this._selectedGuids.push(this._mxObjects[0].getGuid());setTimeout(_1.hitch(this,function(){this.shareSelected();}),1000);}var _47=this._mxObjects.length-this._gridRowNodes.length,i,l,id;if(_47>0){for(i=0;i<_47;i++){this.addNewRow();}this.mxform.resize();}else{if(_47<0){var _48=this._gridRowNodes.length;var _49=_48+_47;for(i=_49;i<_48;i++){var _4a=this._gridRowNodes[i];if(this._gridState.showemptyrows){this.disableRow(_4a);}else{_4a.style.display="none";}}}}var _4b={};for(i=0;id=this._selectedGuids[i];i++){_4b[id]=true;}for(i=0,l=this._mxObjects.length;i<l;i++){_45=this._mxObjects[i].getGuid();_46=this._gridRowNodes[i];this.domData(_46,"mendixguid",_45);this._gridbodyFillRow(this._mxObjects[i],this._gridMatrix[i],_44);if(!_4b[_45]){this.deselectRow(_46);}else{this.selectRow(_46);}_46.style.display="";}if(this._gridState.showemptyrows){var _4c=this._mxObjects.length;var _4d=this._gridRowNodes.length;if(_4c<_4d){for(i=_4c;i<_4d;i++){this.deselectRow(this._gridRowNodes[i]);}}}_4b=null;}catch(e){}},actReloadGrid:function(_4e){if(this.constraintsFilled()){var _4f=this;this._dataSource.isValid(function(_50){if(_50){_4f._dataSource.refresh(function(){_4f.refreshGrid();_4e&&_4e();});}});}},refreshGrid:function(){this.triggerPreRefresh();this.updatePagingStatus();this.fillGrid();this.resizeGrid();this.triggerOnRefresh();},triggerOnLoad:function(){this.triggerPluginEvent("onLoad");},triggerOnSync:function(){this.triggerPluginEvent("onSync");},triggerOnRefresh:function(){this.triggerPluginEvent("onRefresh");},triggerPreRefresh:function(){this.triggerPluginEvent("preRefresh");},triggerOnSearchChanged:function(){this.triggerPluginEvent("onSearchChanged");},actDeferSyncAction:function(_51){if(this._deferSyncQueue===0){_51&&_51();}else{if(this._deferSyncCallback==null){this._deferSyncCallback=_51;}else{}}},eventCellClicked:function(e){this.triggerPluginEvent("onCellClicked",e);},eventRowMouseOver:function(e){this.triggerPluginEvent("onRowMouseOver",e);},eventRowMouseOut:function(e){this.triggerPluginEvent("onRowMouseOut",e);},eventCellMouseOut:function(e){this.triggerPluginEvent("onCellMouseOut",e);},eventCellMouseOver:function(e){this.triggerPluginEvent("onCellMouseOver",e);},eventSelectRow:function(e){this.triggerPluginEvent("onSelectRow",e);},eventGridRowClicked:function(e,_52){if(!this._gridState.selectable){return;}var _53=this.domData(_52,"mendixguid");if(_53){var _54=_1.indexOf(this._selectedGuids,_53);if(this._gridState.selectionmode=="simplemulti"){if(_54!=-1){this._selectedGuids.splice(_54,1);this.deselectRow(_52);_53=null;}else{this._selectedGuids.push(_53);this.selectRow(_52);}}else{if((this._gridState.selectionmode=="multi")&&((_1.isMac&&e.metaKey)||(e.ctrlKey))){if(_54!=-1){this._selectedGuids.splice(_54,1);this.deselectRow(_52);_53=null;}else{this._selectedGuids.push(_53);this.selectRow(_52);}}else{this.deselectAll();if(_54==-1||this._gridState.selectionmode=="multi"){this.selectRow(_52);this._selectedGuids=[_53];}}}this.shareSelected();}else{logger.error(this.id+".eventGridRowClicked : Can't find matching guid for row");}},eventColumnClicked:function(e,_55){var _56=e.shiftKey;var _57=null;if(!_56){for(var i in this._gridColumnNodes){_57=this._gridColumnNodes[i];_1.query("."+this.cssmap.sortIcon,_57)[0].style.display="none";}}else{mxui.dom.clearSelection();}var _58=this.domData(_55,"datakey");var _59="asc";if(this.domData(_55,"sortorder")){_59=this.domData(_55,"sortorder");_59=(_59=="asc")?"desc":"asc";}this.domData(_55,"sortorder",_59);var _5a=_1.query("."+this.cssmap.sortText,_55)[0];if(_59=="asc"){_5a.innerHTML="&#9650;";}else{_5a.innerHTML="&#9660;";}_5a.parentNode.style.display="";this._dataSource.setSortOptions(_58,_59,_56);if(this.constraintsFilled()){this._dataSource.refresh(_1.hitch(this,"refreshGrid"));}},filterSelected:function(){var _5b=[];for(var i=0,_5c;_5c=this._selectedGuids[i];i++){if(this._dataSource.getObject(_5c)!=null){_5b.push(_5c);}}this._selectedGuids=_5b;},actCleanDS:function(_5d){this._clearSelection();this._dataSource.clean(_5d);},resumed:function(){this.setUpdateInterval();},suspended:function(){this.clearInterval();},deselectGridRows:function(){for(var i=0,l=this._gridRowNodes.length;i<l;++i){this.deselectRow(this._gridRowNodes[i]);}},getAggregates:function(){return this._dataSource.getAggregates();},actionExport:function(_5e){if(this.constraintsFilled()){var _5f=mx.ui.getProgressIndicator("popup");_5f.start();this._dataSource.generateExport({params:_5e,callback:function(){_5f.stop();},error:function(e){_5f.stop();mx.onError(e);}});}},actionInsertNewAtTop:function(_60){var _61=this._getEntity(_60);if(_61){this._insertNewFirstOrLast(_61,_60[_61],false);}},actionInsertNewAtBottom:function(_62){var _63=this._getEntity(_62);if(_63){this._insertNewFirstOrLast(_63,_62[_63],true);}},getCellNode:function(row,key){var rob=this._gridMatrix[row];if(rob){for(var i=0;i<rob.length;i++){if(this.domData(rob[i],"key")==key){return rob[i];}}}return null;},getMxObjectAtRow:function(x){return (this._mxObjects.length>=x)?this._mxObjects[x]:false;},getRowForMxObject:function(_64){var ret=null;if(!_64||!_64.getEntity){return ret;}var _65=_64.getGuid();for(var i=0,obj;obj=this._mxObjects[i];i++){if(obj.getGuid()==_65){ret=i;}}return ret;},getKeyPositions:function(){var pos={};var _66=0;for(var i in this._gridColumnNodes){pos[i]=_66++;}return pos;},getEntityProperties:function(){return this._gridConfig.gridAttributes();},getHiddenAggregates:function(){return this._hiddenAggregates.slice();},getActionProperties:function(_67,_68){var _69=this._gridConfig.dataEntityConfigs();var act=null;if(_69[_67]){act=_69[_67][_68];}return act;},getCurrentGridSize:function(){return this._mxObjects.length;},getGridNodeHash:function(){return this._gridMatrix;},getCurrentXPath:function(){var _6a=this._dataSource?this._dataSource.getCurrentXPath()||"":"";return _6a+this._gridState.xpathConstraint;},preventUpdates:function(){this._gridState.inDenial=true;},acceptUpdates:function(){this._gridState.inDenial=false;},acceptingUpdates:function(){return !this._gridState.inDenial;},updateMxObject:function(_6b,_6c){var row=this.getRowForMxObject(_6b);if(row!=null){try{this._gridbodyFillRow(_6b,this._gridMatrix[row],this._gridConfig.gridAttributes());}catch(e){}}_6c&&_6c();},showFootNode:function(){this.gridFootNode.style.display="";},hideFootNode:function(){this.gridFootNode.style.display="none";},addToSyncDeferQueue:function(){this._deferSyncQueue++;},removeFromSyncDeferQueue:function(){this._deferSyncQueue--;if(this._deferSyncQueue===0){if(this._deferSyncCallback!=null){this._deferSyncCallback();this._deferSyncCallback=null;}else{}}},clearInterval:function(){if(this._gridState.update!=null){clearInterval(this._gridState.update);}},uninitialize:function(){this._resizer.destroy();this.triggerPluginEvent("onDestroy");this.inherited(arguments);},_setSelectableAttr:function(_6d){this._gridState.selectable=!!_6d;},_setDisabledAttr:function(_6e){},_setReadOnlyAttr:function(_6f){if(this._gridState.controlbar&&_6f!=this.readOnly){var _70=this._gridConfig.gridTools();if(_6f==true){for(var i=_70.length-1,_71;_71=_70[i];i--){if(_71.mxid){var _72=this._gridConfig.getActionsByKey(_71.mxid);if(_72&&/AddRef|DeleteRef|CreateRef/.test(_72.actionCall)){this.toolBarNode.removeChild(_71._domNode);}}}}else{for(var i=_70.length-1,_71;_71=_70[i];i--){if(_71.mxid){var _72=this._gridConfig.getActionsByKey(_71.mxid);if(_72&&/AddRef|DeleteRef|CreateRef/.test(_72.actionCall)){if(_71._nextNode){this.toolBarNode.insertBefore(_71._domNode,_71._nextNode);}else{this.toolBarNode.appendChild(_71._domNode);}}}}}this.readOnly=!!_6f;}},_gridbodyFillRow:function(_73,_74,_75){var _76=[];var _77=" - ";var _78=null;for(var i=0,td;td=_74[i];i++){var _79=[];var _7a=_75[i];var _7b=false;_76=_7a.attrs;if(_76.length==1){_79.push(this.createRenderItem(_73,_76[0],_7a));}else{var _7c=_73;var _7d=_76.concat([]);while(_7d.length>3){var _7e=_7d.shift();var _7f=_7d.shift();var _80=_7c.getChildren(_7e);if(_7c=_80[0]){if(!_7c.isA(_7f)){logger.error(this.id+".gridBodyFillRow: Entity and reference do not match");_7c=null;break;}}else{_7c=null;break;}}if(_7c!=null&&(_7d.length)==3){_78=_7c.getChildren(_7d[0]);_1.forEach(_78,function(_81){_79.push(this.createRenderItem(_81,_7d[2],_7a));},this);if(_76.length==3&&_78.length===0){_7b=!!_73.get(_76[0]);}}}var _82=td.firstChild;td.innerHTML="";td.appendChild(_82);if(!_7b){var _83=[];try{if(_79.length!==0){var _84=[];for(var j=0,_85;_85=_79[j];j++){var _77=this.gridbodyFillCell(_85.attrs,_85.mxobj,_85.attrname);if(_77!=null){_84.push(_77);}else{logger.error(this.id+".gridBodyFillRow: Received NO content!!!");}if(/^(enum)?icon$/i.test(_85.attrs.render)){_83.push(_85.mxobj.getEnumCaption(_85.attrname));}}_82.innerHTML=_84.join(_84.length>1?", ":"");}}catch(e){logger.error(this.id+".gridBodyFillRow :"+e.message);}if(_82.childNodes.length===0){_82.innerHTML="&nbsp;";}if(_83.length!==0){td.setAttribute("title",_83.join(";"));}else{this.setNodeTitle(td);}}else{if(_73.isReference(_76[0])){(function(td){var _86=_7a;var _87=(_76.length==3)?_76[2]:_76[3];var _88=_73.getReferences(_76[0]);var _89=_82;mx.data.get({guids:_88,callback:function(_8a){var _8b=[],_83=[];_1.forEach(_8a,function(obj){var _8c=this.gridbodyFillCell(_86,obj,_87);if(_8c!=null){_8b.push(_8c);}else{logger.error(this.id+".gridBodyFillRow: Recivied NO content!!!");}if(/^(enum)?icon$/i.test(_86.render)){_83.push(obj.getEnumCaption(_87));}});var _8d=_8b.length;_89.innerHTML=_8d===0?"&nbsp;":_8b.join(_8d>1?";":"");if(_89.childNodes.length===0){_89.innerHTML="&nbsp;";}if(_83.length!==0){td.setAttribute("title",_83.join(";"));}else{this.setNodeTitle(td);}},error:mx.onError},this);}).call(this,td);}else{logger.error(this.id+".gridBodyFillRow: Attribute "+_76[0]+" is not a reference(set)");}}}},_insertNewFirstOrLast:function(_8e,_8f,_90){var _91=function(_92){mx.data.create({entity:_8e,context:this.mxcontext,persistent:_8f.persistent,callback:function(obj){if(!_90){this._dataSource.insertMxObjectAtStart(obj);}else{this._dataSource.insertMxObjectAtEnd(obj);}_92();},error:mx.onError},this);};this.triggerOnSync();this.sequence([_91,"actDeferSyncAction",function(){this.refreshGrid();var row=_90?this._dataSource.getObjects().length-1:0;this.eventSelectRow({row:row});}]);},_clearSelection:function(){this._selectedGuids=[];},_getEntity:function(_93){return mendix.lang.firstKey(_93);},_getSelectedGuids:function(){return this._selectedGuids;},_getCurrentGuid:function(){return this._selectedGuids[this._selectedGuids.length-1];},_addObjectToSelection:function(obj){var _94=obj.getGuid();if(_1.indexOf(this._selectedGuids,_94)==-1){this._selectedGuids.push(_94);}},_getNodeFromEvent:function(e){return mxui.dom.getAncestorNode(e.target,"TR");},_getActionFromEvent:function(e){var _95=this._gridConfig.gridActionBindings(),_96=_95["on"+e.type];return this._gridConfig.getActionsByKey(_96);},_getObjectFromNode:function(_97){return this._mxObjects[this.domData(_97,"gridrow")];},_addFocusBoxForTable:function(){var box=this.addFocusBox(this.contentNode);box.pressed({DOWN_ARROW:box.FOCUS_NEXT,UP_ARROW:box.FOCUS_PREV,SPACE:function(e){this.eventGridRowClicked(e,e.target);},ENTER:function(e,_98){if(_98){this.eventActionBindingHandler(_98,"dblclick");}},LEFT_ARROW:function(){if(!this._dataSource.atBeginning()){this._dataSource.previous(_1.hitch(this,function(){this.refreshGrid();mxui.wm.focus.restore();}));}},RIGHT_ARROW:function(){if(!this._dataSource.atEnd()){this._dataSource.next(_1.hitch(this,function(){this.refreshGrid();mxui.wm.focus.restore();}));}}},this);}});});