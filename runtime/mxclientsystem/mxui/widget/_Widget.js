/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/widget/_Widget",["mxui/wm/focus","mxui/dom","mendix/lang","mendix/logger","dijit/_Widget","dijit/registry","dojo/query","dojo/_base/array","dojo/_base/lang","dojo/_base/kernel","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){_5.prototype.destroy=function(_c){this._beingDestroyed=true;if(this.uninitializer){this.uninitializer();}try{this.uninitialize();}catch(e){throw new Error(this.id+".uninitialize: "+e);}function _d(w){if(w.destroyRecursive){w.destroyRecursive(_c);}else{if(w.destroy){w.destroy(_c);}}};_8.forEach(this._connects,_9.hitch(this,"disconnect"));_8.forEach(this._supportingWidgets,_d);if(this.domNode){_8.forEach(_6.findWidgets(this.domNode),_d);}this.destroyRendering(_c);_6.remove(this.id);this._destroyed=true;};var _e=_b(null,{applyContext:function(_f,_10){this.mxcontext=_f;if(this.isContainer){this.applyContextRecursive(_10);}else{if(typeof this.update=="function"){var _11=_f.getTrackObject(),_12=_f.getTrackId();if(_11){this.update(_11,_10);}else{if(_12){window.mx.data.get({guid:_12,callback:function(obj){if(!obj){_4.error(this.id+".applyContext: error while fetching object with guid "+_12);}this.update(obj,_10);},error:function(e){window.mx.onError(e);this.update(null,_10);}},this);}else{this.update(null,_10);}}}else{_10&&_10();}}},applyContextRecursive:function(_13){var _14=_6.findWidgets(this.domNode);if(_14.length==0){_13&&_13();return;}this.callFetchOnChildren(this.mxcontext,_14,_13);},patchChildImpl:function(_15){if(_15.applyContext==null){if(_15.constructor){_9.extend(_15.constructor,_e.prototype);}else{_9.mixin(_15,_e.prototype);}}},callFetchOnChildren:function(_16,_17,_18){var id=this.id,_19=[],_1a=null;if(this.createContext){_1a=this.createContext();_1a.dupFrom(_16);}else{_1a=_16;}_1a.freeze();_8.forEach(_17,function(_1b,i){this.patchChildImpl(_1b);_19.push(function(_1c){var _1d=function(){try{_1b.applyContext(_1a,_1c);}catch(e){_4.error(id+".applyContextRecursive: ERROR:"+_1b.id+": "+e.message,e);_1c();}};if((i+1)%10===0){setTimeout(_1d,0);}else{_1d();}});},this);var _1e=_9.hitch(window.mx.ui,"cleanContext",_1a.ident,this);_3.sequence(_19,function(){_1e();_18&&_18();});},isLoadedRecursive:function(_1f,_20){var _21=_7("[widgetId]",(_20!=null?_20:this.domNode)),_22=_21.map(_6.byNode),_23=[],id=this.id;_8.forEach(_22,function(kid){if(kid.addOnLoad){_23.push(function(_24){kid.addOnLoad(_24);});}else{}});_3.collect(_23,function(){_1f&&_1f();});}});var _25=_b([_e],{declaredClass:"mxui.widget._Widget",_mx_:true,_loaded:false,_loadCalls:null,_destroyCalls:null,_liveConnects:null,_subscriptions:null,mxid:"",uniqueid:"",content_id:"",app_flow_id:"",tabIndex:"",focusIndex:"",isInactive:false,attributeMap:_9.delegate(_5.prototype.attributeMap,{mxid:"",isInactive:"",focusIndex:""}),constructor:function(){this._loadCalls=[];this._destroyCalls=[];this._liveConnects=[];this._subscriptions=[];},_getDisabledAttr:function(){return this.isInactive;},_setDisabledAttr:function(_26){this.isInactive=!!_26;},loaded:function(){this._loaded=true;var _27=this._loadCalls;while(_27.length!=0){try{(_27.shift())();}catch(e){_4.error(this.id+".loaded/actLoaded: Broken onLoad function!!! "+e.message);}}this.loaded=function(){return false;};return true;},actLoaded:function(_28){this.loaded();_28&&_28();},isLoaded:function(){return this._loaded;},addOnLoad:function(fnc){this._loaded?fnc():this._loadCalls.push(fnc);},addOnDestroy:function(fnc){this._destroyCalls.push(fnc);},subscribe:function(sub){var _29=this._subscriptions,_2a=sub.guid,val=sub.val,_2b=sub.attr,_2c=sub.entity;if(sub.attr){if(_8.some(_29,function(sub){return ((sub.guid==_2a)&&(sub.attr==_2b));})){return;}}else{if(sub.val){if(_8.some(_29,function(sub){return sub.guid==_2a&&sub.val;})){return;}}else{if(sub.guid){if(_8.some(_29,function(sub){return ((sub.guid==_2a)&&(sub.attr==null));})){return;}}else{if(sub.entity){if(_8.some(_29,function(sub){return (sub.entity&&sub.entity==_2c);})){return;}}}}}var _2d=window.mx.data.subscribe(sub,this);_29.push(_2d);return _2d;},unsubscribe:function(_2e){var _2f=this._subscriptions;for(var i=_2f.length-1,sub;sub=_2f[i];i--){if(sub==_2e){window.mx.data.unsubscribe(sub);_2f.splice(i,1);break;}}},removeSubscriptions:function(){var _30=this._subscriptions;while(_30.length!=0){window.mx.data.unsubscribe(_30.shift());}this._subscriptions=[];},liveConnect:function(_31,evt,map){this._liveConnects.push(_2.liveConnect(_31,evt,this,map));},liveDisconnect:function(_32){var _33=this._liveConnects;for(var i=0,_34;_34=_33[i];i++){if(_34==_32){_2.liveDisconnect(_32);_33.splice(i,1);return;}}},domData:function(){this.domData=_2.getScopedData();return this.domData.apply(this,arguments);},markupFactory:function(_35,_36,_37){var _38=_2.getTabIndex(_36);if(_38){_35.focusIndex=_38;}_35.content_id=_35.content_id?_35.content_id:_36.getAttribute("content_id");return new _37(_35,_36);},resizeContent:function(){this.mxform.resize();},disposeContent:function(){this.mxform.dispose();},getTitle:function(){return this.mxform.getTitle();},getUIPlace:function(){return this.mxform.place;},getContent:function(){return this.content_id;},objectUpdate:function(obj,_39){if(this.objectUpdateNotification.length==2){this.objectUpdateNotification(obj,_39);}else{this.objectUpdateNotification(obj);_39&&_39();}},objectUpdateNotification:function(obj){},validationUpdate:function(){return this.refresh();},sequence:function(_3a,_3b){_3.sequence(_3a,_3b,this);},collect:function(_3c,_3d){_3.collect(_3c,_3d,this);},addFocusBox:function(_3e){var box=_1.addBox(_3e);this.addOnDestroy(function(){_1.unregister(box);});return box;},getFocusBox:function(_3f){return _1.byNode(_3f);},resize:function(box){},uninitialize:function(){if(!_25.prototype.isLoaded.call(this)){_4.error("Looks like "+this.id+" never loads up, check the structure of the widget");this.addOnLoad(_9.hitch(this,function(){try{this.uninitialize();}catch(e){_4.error(this.id+".uninitialize: ERROR when calling uninitialize");}}));}else{this.removeSubscriptions();var _40=this._liveConnects,_41=this._destroyCalls;while(_40.length){_2.liveDisconnect(_40.pop());}while(_41.length){(_41.shift()).call(this);}}}});return _25;});