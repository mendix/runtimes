
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/widget/_Widget",["mxui/dom","mendix/lang","mendix/logger","dijit/_Widget","dijit/registry","dojo/query","dojo/_base/array","dojo/_base/lang","dojo/_base/kernel","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a){_4.prototype.destroy=function(_b){if(!this._destroyed){this._beingDestroyed=true;this.uninitializer&&this.uninitializer();try{this.uninitialize();}catch(e){throw new Error(this.id+".destroy: Some trouble in uninitialize function: "+e.message);}var d=dojo,_c=d.forEach,_d=d.unsubscribe;_c(this._connects,function(_e){_c(_e,d.disconnect);});_c(this._subscribes,function(_f){_d(_f);});_c(this._supportingWidgets||[],function(w){if(w.destroyRecursive){w.destroyRecursive();}else{if(w.destroy){w.destroy();}}});this.destroyRendering(_b);_5.remove(this.id);this._destroyed=true;}};var _10=_a(null,{applyContext:function(_11,_12){this.mxcontext=_11;if(this.isContainer){this.applyContextRecursive(_12);}else{if(typeof this.update=="function"){var _13=_11.getTrackObject(),_14=_11.getTrackId();if(_13){this.update(_13,_12);}else{if(_14){window.mx.data.get({guid:_14,callback:function(obj){if(!obj){_3.error(this.id+".applyContext: error while fetching object with guid "+_14);}this.update(obj,_12);},error:function(e){window.mx.onError(e);this.update(null,_12);}},this);}else{this.update(null,_12);}}}else{_12&&_12();}}},applyContextRecursive:function(_15){var _16=_5.findWidgets(this.domNode);if(_16.length==0){_15&&_15();return;}this.callFetchOnChildren(this.mxcontext,_16,_15);},patchChildImpl:function(_17){if(_17.applyContext==null){if(_17.constructor){_8.extend(_17.constructor,_10.prototype);}else{_8.mixin(_17,_10.prototype);}}},callFetchOnChildren:function(_18,_19,_1a){var id=this.id,_1b=[],_1c=null;if(this.createContext){_1c=this.createContext();_1c.dupFrom(_18);}else{_1c=_18;}_1c.freeze();_7.forEach(_19,function(_1d,i){this.patchChildImpl(_1d);_1b.push(function(_1e){var _1f=function(){try{_1d.applyContext(_1c,_1e);}catch(e){_3.error(id+".applyContextRecursive: ERROR:"+_1d.id+": "+e.message,e);_1e();}};if((i+1)%10===0){setTimeout(_1f,0);}else{_1f();}});},this);var _20=_8.hitch(window.mx.ui,"cleanContext",_1c.ident,this);_2.sequence(_1b,function(){_20();_1a&&_1a();});},isLoadedRecursive:function(_21,_22){var _23=_6("[widgetId]",(_22!=null?_22:this.domNode)),_24=_23.map(_5.byNode),_25=[],id=this.id;_7.forEach(_24,function(kid){if(kid.addOnLoad){_25.push(function(_26){kid.addOnLoad(_26);});}else{}});_2.collect(_25,function(){_21&&_21();});}});var _27=_a([_10],{declaredClass:"mxui.widget._Widget",_mx_:true,_loaded:false,_suspended:false,_loadCalls:null,_destroyCalls:null,_liveConnects:null,_subscriptions:null,mxid:"",content_id:"",app_flow_id:"",tabIndex:"",focusIndex:"",isInactive:false,attributeMap:_8.delegate(_4.prototype.attributeMap,{mxid:"",isInactive:"",focusIndex:""}),constructor:function(){this._loadCalls=[];this._destroyCalls=[];this._liveConnects=[];this._subscriptions=[];},_getDisabledAttr:function(){return this.isInactive;},_setDisabledAttr:function(_28){this.isInactive=!!_28;},loaded:function(){this._loaded=true;var _29=this._loadCalls;while(_29.length!=0){try{(_29.shift())();}catch(e){_3.error(this.id+".loaded/actLoaded: Broken onLoad function!!! "+e.message);}}this.loaded=function(){return false;};return true;},actLoaded:function(_2a){this.loaded();_2a&&_2a();},isLoaded:function(){return this._loaded;},rendered:function(){_9.deprecated(this.id+".rendered is deprecated, use loaded instead","","3.1");this.loaded();},actRendered:function(_2b){_9.deprecated(this.id+".actRendered is deprecated, use actLoaded instead","","3.1");this.actLoaded(_2b);},isRendered:function(){_9.deprecated(this.id+".isRendered is deprecated, use isLoaded instead","","3.1");return this.isLoaded();},addOnLoad:function(fnc){this._loaded?fnc():this._loadCalls.push(fnc);},addOnDestroy:function(fnc){this._destroyCalls.push(fnc);},registerOnDestroy:function(f1){_9.deprecated(this.id+"registerOnDestroy is deprecated, use addOnDestroy instead","","3.1");this.addOnDestroy(f1);},subscribe:function(sub){var _2c=this._subscriptions,_2d=sub.guid,val=sub.val,_2e=sub.attr,_2f=sub.entity;if(sub.attr){if(_7.some(_2c,function(sub){return ((sub.guid==_2d)&&(sub.attr==_2e));})){return;}}else{if(sub.val){if(_7.some(_2c,function(sub){return sub.guid==_2d&&sub.val;})){return;}}else{if(sub.guid){if(_7.some(_2c,function(sub){return ((sub.guid==_2d)&&(sub.attr==null));})){return;}}else{if(sub.entity){if(_7.some(_2c,function(sub){return (sub.entity&&sub.entity==_2f);})){return;}}}}}var _30=window.mx.data.subscribe(sub,this);_2c.push(_30);return _30;},unsubscribe:function(_31){var _32=this._subscriptions;for(var i=_32.length-1,sub;sub=_32[i];i--){if(sub==_31){window.mx.data.unsubscribe(sub);_32.splice(i,1);break;}}},subscribeToClass:function(_33){_9.deprecated(this.id+"subscribeToClass is deprecated, use subscribe instead","","3.1");this.subscribe({entity:_33,callback:_8.hitch(this,"objectUpdate")});},subscribeToGuid:function(_34){_9.deprecated(this.id+"subscribeToGuid is deprecated, use subscribe instead","","3.1");this.subscribe({guid:_34,callback:_8.hitch(this,"objectUpdate")});},subscribeToChange:function(_35,_36,_37){_9.deprecated(this.id+"subscribeToChange is deprecated, use subscribe instead","","3.1");if(!isNaN(_35)){this.subscribe({guid:_35,attr:_36,callback:_8.hitch(this,_37)});}},removeClassSubscriptions:function(_38){_9.deprecated(this.id+".removeClassSubscriptions is deprecated, use this.unsubscribe instead","","3.1");this._subscriptions=_7.filter(this._subscriptions,function(sub){if(sub.entity!=null){window.mx.data.unsubscribe(sub);return false;}return true;});_38&&_38();},removeGuidSubscriptions:function(_39){_9.deprecated(this.id+".removeGuidSubscriptions is deprecated, use this.unsubscribe instead","","3.1");this._subscriptions=_7.filter(this._subscriptions,function(sub){if((sub.guid!=null)&&(sub.attr==null)){window.mx.data.unsubscribe(sub);return false;}return false;});_39&&_39();},removeChangeSubscriptions:function(){_9.deprecated(this.id+".removeChangeSubscriptions is deprecated, use this.unsubscribe instead","","3.1");this._subscriptions=_7.filter(this._subscriptions,function(sub){if((sub.guid!=null)&&(sub.attr!=null)){window.mx.data.unsubscribe(sub);return false;}return true;});},removeSubscriptions:function(){var _3a=this._subscriptions;while(_3a.length!=0){window.mx.data.unsubscribe(_3a.shift());}this._subscriptions=[];delete this._updatedObject;},liveConnect:function(_3b,evt,map){this._liveConnects.push(_1.liveConnect(_3b,evt,this,map));},liveDisconnect:function(_3c){var _3d=this._liveConnects;for(var i=0,_3e;_3e=_3d[i];i++){if(_3e==_3c){_1.liveDisconnect(_3c);_3d.splice(i,1);return;}}},disconnectLive:function(){_9.deprecated(this.id+".disconnectLive is deprecated, use liveDisconnect instead","","3.1");var _3f=this._liveConnects;while(_3f.length){_1.liveDisconnect(_3f.pop());}},domData:function(){this.domData=_1.getScopedData();return this.domData.apply(this,arguments);},getLocalUrl:function(_40){_9.deprecated(this.id+".getLocalUrl is deprecated","","3.1");return require.toUrl(this.moduleName,_40);},markupFactory:function(_41,_42,_43){var _44=_1.getTabIndex(_42);if(_44){_41.focusIndex=_44;}_41.content_id=_41.content_id?_41.content_id:_42.getAttribute("content_id");return new _43(_41,_42);},resizeContent:function(){this.mxform.resize();},disposeContent:function(){this.mxform.dispose();},getTitle:function(){return this.mxform.getTitle();},getUIPlace:function(){return this.mxform.place;},getContent:function(){return this.content_id;},objectUpdate:function(obj,_45){if(this._suspended){this._updatedObject=obj;_45&&_45();}else{if(this.objectUpdateNotification.length==2){this.objectUpdateNotification(obj,_45);}else{this.objectUpdateNotification(obj);_45&&_45();}}},objectUpdateNotification:function(obj){},validationUpdate:function(){return this.refresh();},runAct:function(_46,_47,_48){_9.deprecated(this.id+".runAct is deprecated, use sequence or collect instead","","3.1");var _49=_2[_48?"collect":"sequence"];_49(this,_46,_47);},sequence:function(_4a,_4b){_2.sequence(_4a,_4b,this);},collect:function(_4c,_4d){_2.collect(_4c,_4d,this);},resume:function(){this._suspended=false;if("_updatedObject" in this){this.objectUpdateNotification(this._updatedObject);delete this._updatedObject;}this.resumed&&this.resumed();},suspend:function(){this._suspended=true;this.suspended&&this.suspended();},isSuspended:function(){return this._suspended;},addFocusBox:function(_4e){var box=mxui.wm.focus.addBox(_4e);this.addOnDestroy(function(){mxui.wm.focus.unregister(box);});return box;},getFocusBox:function(_4f){return mxui.wm.focus.byNode(_4f);},uninitialize:function(){if(!_27.prototype.isLoaded.call(this)){_3.error("Looks like "+this.id+" never loads up, check the structure of the widget");this.addOnLoad(_8.hitch(this,function(){try{this.uninitialize();}catch(e){_3.error(this.id+".uninitialize: ERROR when calling uninitialize");}}));}else{this.removeSubscriptions();var _50=this._liveConnects,_51=this._destroyCalls;while(_50.length){_1.liveDisconnect(_50.pop());}while(_51.length){(_51.shift()).call(this);}}}});return _27;});