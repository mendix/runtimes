/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/widget/_Widget",["mxui/wm/focus","mxui/dom","mendix/lang","mendix/logger","dijit/_Widget","dijit/registry","dojo/query","dojo/_base/array","dojo/_base/lang","dojo/_base/kernel","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){_5.prototype.destroy=function(_c){this._beingDestroyed=true;if(this.uninitializer){this.uninitializer();}try{this.uninitialize();}catch(e){throw new Error(this.id+".uninitialize: "+e);}function _d(w){if(w.destroyRecursive){w.destroyRecursive(_c);}else{if(w.destroy){w.destroy(_c);}}};_8.forEach(this._connects,_9.hitch(this,"disconnect"));_8.forEach(this._supportingWidgets,_d);if(this.domNode){_8.forEach(_6.findWidgets(this.domNode),_d);}this.destroyRendering(_c);_6.remove(this.id);this._destroyed=true;};var _e=_b(null,{applyContext:function(_f,_10){this.mxcontext=_f;if(this.isContainer){this.applyContextRecursive(_10);}else{if(typeof this.update=="function"){var _11=_f.getTrackObject(),_12=_f.getTrackId();if(_11){this.update(_11,_10);}else{if(_12){window.mx.data.get({guid:_12,callback:function(obj){if(!obj){_4.error(this.id+".applyContext: error while fetching object with guid "+_12);}this.update(obj,_10);},error:function(e){window.mx.onError(e);this.update(null,_10);}},this);}else{this.update(null,_10);}}}else{_10&&_10();}}},applyContextRecursive:function(_13){var _14=_6.findWidgets(this.domNode);if(_14.length==0){_13&&_13();return;}this.callFetchOnChildren(this.mxcontext,_14,_13);},patchChildImpl:function(_15){if(_15.applyContext==null){if(_15.constructor){_9.extend(_15.constructor,_e.prototype);}else{_9.mixin(_15,_e.prototype);}}},callFetchOnChildren:function(_16,_17,_18){var id=this.id,_19=[],_1a=null;if(this.createContext){_1a=this.createContext();_1a.dupFrom(_16);}else{_1a=_16;}_1a.freeze();_8.forEach(_17,function(_1b,i){this.patchChildImpl(_1b);_19.push(function(_1c){var _1d=function(){try{_1b.applyContext(_1a,_1c);}catch(e){_4.error(id+".applyContextRecursive: ERROR:"+_1b.id+": "+e.message,e);_1c();}};if((i+1)%10===0){setTimeout(_1d,0);}else{_1d();}});},this);var _1e=_9.hitch(window.mx.ui,"cleanContext",_1a.ident,this);_3.sequence(_19,function(){_1e();_18&&_18();});},isLoadedRecursive:function(_1f,_20){var _21=_7("[widgetId]",(_20!=null?_20:this.domNode)),_22=_21.map(_6.byNode),_23=[],id=this.id;_8.forEach(_22,function(kid){if(kid.addOnLoad){_23.push(function(_24){kid.addOnLoad(_24);});}else{}});_3.collect(_23,function(){_1f&&_1f();});}});var _25=_b([_e],{declaredClass:"mxui.widget._Widget",_mx_:true,_loaded:false,_loadCalls:null,_destroyCalls:null,_liveConnects:null,_subscriptions:null,mxid:"",uniqueid:"",content_id:"",app_flow_id:"",tabIndex:"",focusIndex:"",isInactive:false,attributeMap:_9.delegate(_5.prototype.attributeMap,{mxid:"",isInactive:"",focusIndex:""}),constructor:function(){this._loadCalls=[];this._destroyCalls=[];this._liveConnects=[];this._subscriptions=[];},_getDisabledAttr:function(){return this.isInactive;},_setDisabledAttr:function(_26){this.isInactive=!!_26;},loaded:function(){this._loaded=true;var _27=this._loadCalls;while(_27.length!=0){try{(_27.shift())();}catch(e){_4.error(this.id+".loaded/actLoaded: Broken onLoad function!!! "+e.message);}}this.loaded=function(){return false;};return true;},actLoaded:function(_28){this.loaded();_28&&_28();},isLoaded:function(){return this._loaded;},rendered:function(){_a.deprecated(this.id+".rendered is deprecated, use loaded instead","","3.1");this.loaded();},actRendered:function(_29){_a.deprecated(this.id+".actRendered is deprecated, use actLoaded instead","","3.1");this.actLoaded(_29);},isRendered:function(){_a.deprecated(this.id+".isRendered is deprecated, use isLoaded instead","","3.1");return this.isLoaded();},addOnLoad:function(fnc){this._loaded?fnc():this._loadCalls.push(fnc);},addOnDestroy:function(fnc){this._destroyCalls.push(fnc);},registerOnDestroy:function(f1){_a.deprecated(this.id+"registerOnDestroy is deprecated, use addOnDestroy instead","","3.1");this.addOnDestroy(f1);},subscribe:function(sub){var _2a=this._subscriptions,_2b=sub.guid,val=sub.val,_2c=sub.attr,_2d=sub.entity;if(sub.attr){if(_8.some(_2a,function(sub){return ((sub.guid==_2b)&&(sub.attr==_2c));})){return;}}else{if(sub.val){if(_8.some(_2a,function(sub){return sub.guid==_2b&&sub.val;})){return;}}else{if(sub.guid){if(_8.some(_2a,function(sub){return ((sub.guid==_2b)&&(sub.attr==null));})){return;}}else{if(sub.entity){if(_8.some(_2a,function(sub){return (sub.entity&&sub.entity==_2d);})){return;}}}}}var _2e=window.mx.data.subscribe(sub,this);_2a.push(_2e);return _2e;},unsubscribe:function(_2f){var _30=this._subscriptions;for(var i=_30.length-1,sub;sub=_30[i];i--){if(sub==_2f){window.mx.data.unsubscribe(sub);_30.splice(i,1);break;}}},subscribeToClass:function(_31){_a.deprecated(this.id+"subscribeToClass is deprecated, use subscribe instead","","3.1");this.subscribe({entity:_31,callback:_9.hitch(this,"objectUpdate")});},subscribeToGuid:function(_32){_a.deprecated(this.id+"subscribeToGuid is deprecated, use subscribe instead","","3.1");this.subscribe({guid:_32,callback:_9.hitch(this,"objectUpdate")});},subscribeToChange:function(_33,_34,_35){_a.deprecated(this.id+"subscribeToChange is deprecated, use subscribe instead","","3.1");if(!isNaN(_33)){this.subscribe({guid:_33,attr:_34,callback:_9.hitch(this,_35)});}},removeClassSubscriptions:function(_36){_a.deprecated(this.id+".removeClassSubscriptions is deprecated, use this.unsubscribe instead","","3.1");this._subscriptions=_8.filter(this._subscriptions,function(sub){if(sub.entity!=null){window.mx.data.unsubscribe(sub);return false;}return true;});_36&&_36();},removeGuidSubscriptions:function(_37){_a.deprecated(this.id+".removeGuidSubscriptions is deprecated, use this.unsubscribe instead","","3.1");this._subscriptions=_8.filter(this._subscriptions,function(sub){if((sub.guid!=null)&&(sub.attr==null)){window.mx.data.unsubscribe(sub);return false;}return false;});_37&&_37();},removeChangeSubscriptions:function(){_a.deprecated(this.id+".removeChangeSubscriptions is deprecated, use this.unsubscribe instead","","3.1");this._subscriptions=_8.filter(this._subscriptions,function(sub){if((sub.guid!=null)&&(sub.attr!=null)){window.mx.data.unsubscribe(sub);return false;}return true;});},removeSubscriptions:function(){var _38=this._subscriptions;while(_38.length!=0){window.mx.data.unsubscribe(_38.shift());}this._subscriptions=[];},liveConnect:function(_39,evt,map){this._liveConnects.push(_2.liveConnect(_39,evt,this,map));},liveDisconnect:function(_3a){var _3b=this._liveConnects;for(var i=0,_3c;_3c=_3b[i];i++){if(_3c==_3a){_2.liveDisconnect(_3a);_3b.splice(i,1);return;}}},disconnectLive:function(){_a.deprecated(this.id+".disconnectLive is deprecated, use liveDisconnect instead","","3.1");var _3d=this._liveConnects;while(_3d.length){_2.liveDisconnect(_3d.pop());}},domData:function(){this.domData=_2.getScopedData();return this.domData.apply(this,arguments);},getLocalUrl:function(_3e){_a.deprecated(this.id+".getLocalUrl is deprecated","","3.1");return require.toUrl(this.moduleName,_3e);},markupFactory:function(_3f,_40,_41){var _42=_2.getTabIndex(_40);if(_42){_3f.focusIndex=_42;}_3f.content_id=_3f.content_id?_3f.content_id:_40.getAttribute("content_id");return new _41(_3f,_40);},resizeContent:function(){this.mxform.resize();},disposeContent:function(){this.mxform.dispose();},getTitle:function(){return this.mxform.getTitle();},getUIPlace:function(){return this.mxform.place;},getContent:function(){return this.content_id;},objectUpdate:function(obj,_43){if(this.objectUpdateNotification.length==2){this.objectUpdateNotification(obj,_43);}else{this.objectUpdateNotification(obj);_43&&_43();}},objectUpdateNotification:function(obj){},validationUpdate:function(){return this.refresh();},runAct:function(_44,_45,_46){_a.deprecated(this.id+".runAct is deprecated, use sequence or collect instead","","3.1");var _47=_3[_46?"collect":"sequence"];_47(this,_44,_45);},sequence:function(_48,_49){_3.sequence(_48,_49,this);},collect:function(_4a,_4b){_3.collect(_4a,_4b,this);},addFocusBox:function(_4c){var box=_1.addBox(_4c);this.addOnDestroy(function(){_1.unregister(box);});return box;},getFocusBox:function(_4d){return _1.byNode(_4d);},resize:function(box){},uninitialize:function(){if(!_25.prototype.isLoaded.call(this)){_4.error("Looks like "+this.id+" never loads up, check the structure of the widget");this.addOnLoad(_9.hitch(this,function(){try{this.uninitialize();}catch(e){_4.error(this.id+".uninitialize: ERROR when calling uninitialize");}}));}else{this.removeSubscriptions();var _4e=this._liveConnects,_4f=this._destroyCalls;while(_4e.length){_2.liveDisconnect(_4e.pop());}while(_4f.length){(_4f.shift()).call(this);}}}});return _25;});