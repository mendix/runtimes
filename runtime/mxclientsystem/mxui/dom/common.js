
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/dom/common",["dojo","dijit","dojox"],function(_1,_2,_3){_1.provide("mxui.dom.common");(function(){var _4=0,_5=[];var _6=function(_7){_7=_7||{};var _8=function(id,_9){if(!id){id=_4++;_9.setAttribute("data-id",id);}return id;};return function(_a,_b,_c){var id=typeof _a==="string"?_a:_a.getAttribute("data-id"),_d=_7[id];switch(arguments.length){case 1:return _d;case 2:if(_b===null){delete _7[id];return;}else{if(typeof _b=="object"){if(!_d){return _7[_8(id,_a)]=_b;}else{return _1.mixin(_d,_b);}}else{return _d&&_d[_b];}}break;case 3:if(_c===null){if(_d){delete _d[_b];}for(var i in _d){return;}delete _7[id];return;}else{if(!_d){_d=_7[_8(id,_a)]={};}return _d[_b]=_c;}}};};var _e=function(_f,_10){var _11=_f.parentNode;if(_11&&(!_10.parentNode||_10.parentNode.nodeType==11)){_11.insertBefore(_10,_f);_11.removeChild(_f);return true;}return false;};mxui.dom={minContainerHeight:100,nodeTypes:{ELEMENT_NODE:1,ATTRIBUTE_NODE:2,TEXT_NODE:3,CDATA_SECTION_NODE:4,ENTITY_REFERENCE_NODE:5,ENTITY_NODE:6,PROCESSING_INSTRUCTION_NODE:7,COMMENT_NODE:8,DOCUMENT_NODE:9,DOCUMENT_TYPE_NODE:10,DOCUMENT_FRAGMENT_NODE:11,NOTATION_NODE:12},showNode:function(_12){for(var i=0,_13;_13=_5[i];i++){if(_13.node==_12){var _14=_13.span;_e(_14,_12);_5.splice(i,1);return true;}}return false;},hideNode:function(_15){var _16=mxui.dom.span();if(_e(_15,_16)){_5.push({node:_15,span:_16});return true;}return false;},copyChildren:function(src,_17){var _18=src.cloneNode(true);while(_18.firstChild){_17.appendChild(_18.removeChild(_18.firstChild));}},insertBefore:function(src,_19){if(_19.parentNode){_19.parentNode.insertBefore(src,_19);}},insertAfter:function(src,_1a){if(_1a.parentNode){if(_1a.nextSibling){_1a.nextSibling.parentNode.insertBefore(src,_1a.nextSibling);}else{_1a.parentNode.appendChild(src);}}},walkTree:function(_1b,_1c){if(_1b&&_1b.hasChildNodes){for(var i=0;i<_1b.childNodes.length;i++){mxui.dom.walkTree(_1b.childNodes[i],_1c);}}_1c(_1b);},walkNode:function(_1d,_1e,_1f){var _20=[0],_21;var _22=function(_23){try{_21=_23?_1e.call(_1f,_23,_20.slice())!==false:false;}catch(e){logger.error("mxui.dom.walkNode: Unable to execute action on node: "+e.message);_21=false;}if(_21&&_23.hasChildNodes){var i=_20.push(0)-1;var _24=null,_25=_23.firstChild;while(_25){_25=(_24=_25).nextSibling;_22(_24);_20[i]++;}_20.pop();}};_22(_1d);},nextNode:function(_26,_27){if(!_26||!_27){return true;}var cl=_27.length,sl=_26.length,_28=_27.length-1;return (sl>cl)||(cl==sl&&_27[_28]>_26[_28]);},getAncestorNode:function(_29,_2a,_2b){return _29&&((_29.nodeName==_2a)?_29:((--_2b==0)?false:arguments.callee(_29.parentNode,_2a,_2b)));},getFirstChild:function(_2c,_2d){_1.deprecated("mxui.dom.getFirstChild","Use dojo.query instead","5.0");if(typeof _2d=="string"){_2d=[_2d.toLowerCase()];}var _2e=false;var _2f=function(_30){for(var i=0;i<_2d.length;i++){if(_30.nodeName.toLowerCase()==_2d[i]){if(_2e==false){_2e=_30;return false;}}}return true;};var s=(function(_31,_32){if(_31&&_32(_31)&&_31.hasChildNodes){for(var i=0;i<_31.childNodes.length;i++){arguments.callee(_31.childNodes[i],_32);}}})(_2c,_2f);return _2e;},escapeHTMLQuotes:function(str){return str.replace(/\'/g,"&#39;").replace(/\"/g,"&#34;");},convertNlToBr:function(str){return str.replace(/\n/g,"<br />");},setSelectOptions:function(_33,_34,_35){var $=mxui.dom.create;if(!_33){return;}_34=_34||{};mxui.dom.empty(_33);_33.appendChild($("option",{value:""},""));for(var key in _34){var _36=$("option",{value:key},_34[key]);_33.appendChild(_36);if(key==_35){_36.selected=true;}}},getSelectedValue:function(_37){if(_37.nodeName.toLowerCase()=="select"){return (_37.selectedIndex!=-1)?_37.options[_37.selectedIndex].value:null;}else{return null;}},getSelectedText:function(_38){if(mendix.isIE){return _38.options[_38.selectedIndex].textValue;}else{return _38.options[_38.selectedIndex].text;}},selectOptionByValue:function(_39,_3a){var i;for(i=0;i<_39.length;++i){if(_39.options[i].value==_3a){_39.options[i].selected=true;}}},selectOptionByText:function(_3b,_3c){var i;for(i=0;i<_3b.length;++i){if(_3b.options[i].text==_3c){_3b.options[i].selected=true;}}},enableNode:function(_3d){_3d.removeAttribute("readonly");_3d.removeAttribute("disabled");},disableNode:function(_3e){_3e.setAttribute("disabled","disabled");_3e.setAttribute("readonly","readonly");},strip:function(_3f,_40){mxui.dom.walkTree(_3f,function(e){if(e&&e.getAttribute&&e.getAttribute(_40)){e.removeAttribute(_40);}});return _3f;},disableSelection:function(e){if(!_1.isIE){e.style.MozUserSelect="none";}else{e.unselectable="on";}return true;},clearSelection:function(){var w=window,s=document.selection;if(s){try{s.empty&&s.empty();}catch(e){}}else{s=w.getSelection&&w.getSelection();s&&s.removeAllRanges&&s.removeAllRanges();}},selectTextRange:function(_41,_42,_43){if(_41.createTextRange){var _44=_41.createTextRange();_44.collapse(true);_44.moveEnd("character",_43);_44.moveStart("character",_42);_44.select();}else{if(_41.setSelectionRange){_41.setSelectionRange(_42,_43);}}},getCursorPosition:function(_45){if(document.selection){var _46=Math.abs(document.selection.createRange().moveStart("character",-1000000));var end=Math.abs(document.selection.createRange().moveEnd("character",-1000000));return _46;}else{if(_45.setSelectionRange){return _45.selectionStart;}}},getSelection:function(_47){if(document.selection){var _48=Math.abs(document.selection.createRange().moveStart("character",-1000000));var end=Math.abs(document.selection.createRange().moveEnd("character",-1000000));return {start:_48,end:end};}else{if(_47.setSelectionRange){return {start:_47.selectionStart,end:_47.selectionEnd};}}},liveConnect:function(_49,evt,_4a,r,_4b){if(arguments.length==3){r=_4a;_4a=null;}var _4c={},_4d=[];for(var i in r){var _4e=i.split(".");var tag=_4e[0];var _4f=_4e[1];var _50=r[i];if((typeof _50=="string"&&_4a[_50])||typeof _50=="function"){var _51={fnc:_50};if(tag){_4c[String(tag).toUpperCase()]=_51;}else{if(_4f){_4d.push(_51);}}if(_4f){_51.clazz=_4f;}}}var _52=_1.hasClass;var _53=function(_54){for(var i=0,_50;_50=_4d[i];i++){if(_52(_54,_50.clazz)){return _50;}}return null;};var run=function(fnc,e){if(typeof (fnc)=="function"){fnc(e);}else{_4a&&_4a[fnc](e);}};return _1.connect(_49,evt,function(e){var _55=e.target;var _56=_49;var e2={target:e.target};for(var i in e){var val=e[i];if(val==null||!(val instanceof Object)){e2[i]=val;}}while(_55!=_56&&_55!=null){var _57=_4c[_55.nodeName];var _58=_53(_55);if(_57){var _59=_57.clazz;_57=((!_59)||(_52(_55,_59)))?_57:null;}e2.currentTarget=_55;_57&&run(_57.fnc,e2);_58&&run(_58.fnc,e2);if(_4b&&(_57||_58)){break;}_55=_55.parentNode;}});},liveDisconnect:function(_5a){_1.disconnect(_5a);},removeTabIndex:function(_5b){if(_1.isIE){_5b.removeAttribute("tabIndex");}_5b.removeAttribute("tabindex");},isChild:function(_5c,_5d){var _5e=_5c;while((_5e=_5e.parentNode)!=null){if(_5e==_5d){return true;}}return false;},create:function(tag,_5f,_60){var _61,_62=[].slice.call(arguments,1);_5f=_5f||{};if(_5f.nodeName||typeof _5f=="string"){_60=_62;_5f={};}else{_60=_62.slice(1);}if(tag=="#"){_61=document.createDocumentFragment();}else{_61=document.createElement(tag);for(var _63 in _5f){var _64=_5f[_63];if(_63=="style"&&typeof _64!="string"){var _65=_61.style;for(var i in _64){_65[i]=_64[i];}}else{_61.setAttribute(_63,_64);}}}_1.forEach(_60,function(_66){if(typeof _66=="string"){_1.forEach(_66.split("\r\n"),function(_67,i){if(i>0){_61.appendChild(mxui.dom.create("br"));}_61.appendChild(document.createTextNode(_67));});}else{_61.appendChild(_66);}});return _61;},synthesizeEvent:function(evt,_68){var _69=_1.mixin({},evt,_68);_69.preventDefault=function(){evt.preventDefault();};_69.stopPropagation=function(){evt.stopPropagation();};return _69;},capture:function(_6a,evt,_6b){var _6c=!_6a.addEventListener,_6d=_6a[_6c?"attachEvent":"addEventListener"],_6e=_6a[_6c?"detachEvent":"removeEventListener"],_6f=_6c?"on"+evt:evt;_6d.call(_6a,_6f,_6b,true);return {remove:function(){_6e.call(_6a,_6f,_6b,true);}};},supports:function(_70){var _71=_1.body().style;if(_70 in _71){return _70;}else{var _72=["Webkit","Moz"],_73=_70.charAt(0).toUpperCase()+_70.slice(1);for(var i=_72.length;i--;){var _74=_72[i]+_73;if(_74 in _71){return _74;}}}},supportsFixed:function(){var ua=navigator.userAgent,_75=true,_76;if(/AppleWebKit\/\d+/.test(ua)){if(/iPhone|iPad/.test(ua)){_76=/OS (\d)_/.exec(ua);_75=_76[1]&&_76[1]>=5;}else{if(/Android/.test(ua)){_76=/Android (\d\.\d)/.exec(ua);_75=_76[1]&&_76[1]>=2.2;}}}else{if(/Trident\/\d+/.test(ua)){_76=/MSIE (\d+)/.exec(ua);if(_76){_75=_76[1]&&_76[1]>=10;}else{_75=true;}}}return _75;},decodeXML:function(str){return str.replace(/&(lt|gt|apos|quot|amp);/g,function(_77,_78){return {lt:"<",gt:">",apos:"'",quot:"\"",amp:"&"}[_78];});},text:function(_79,str){if(typeof str!=="undefined"){_79.innerHTML="";_79.appendChild(document.createTextNode(str));}else{return "textContent" in _79?_79.textContent:_79.innerText;}},html:function(_7a,str){if(typeof str!=="undefined"){_7a.innerHTML=str;}else{return _7a.innerHTML;}},orphan:function(_7b){var p=_7b.parentNode;if(p){p.removeChild(_7b);}},empty:function(_7c){var _7d;while(_7d=_7c.firstChild){_7c.removeChild(_7d);}},toArray:function(_7e){return _1.map(_7e,function(_7f){return _7f;});},escapeString:function(str){var _80=mxui.dom.create("p");mxui.dom.escapeString=function(str){var _81=str.split(/\r\n|\n/),out=[];for(var i=0;i<_81.length;++i){mxui.dom.text(_80,_81[i]);out.push(_80.innerHTML);}return out.join("\n");};return mxui.dom.escapeString(str);},getCss:function(_82,doc,_83){doc=doc||document;var _84=doc.getElementsByTagName("link"),re=new RegExp(mx.appUrl+_82);for(var i=0,_85;_85=_84[i];i++){if(re.test(_85.href)){return _85;}}return null;},addCss:function(_86,doc,_87){doc=doc||document;if(mxui.dom.getCss(_86,doc,_87)){return;}var _88=doc.getElementsByTagName("head")[0],_89=mxui.dom.create("link",{rel:"stylesheet",type:"text/css",media:_87||"screen",href:mx.appUrl+_86});_88.appendChild(_89);},removeCss:function(_8a,doc,_8b){var _8c=mxui.dom.getCss(_8a,doc,_8b);if(_8c){_8c.parentNode.removeChild(_8c);return true;}return false;},ieFocusable:{"a":true,"body":true,"button":true,"frame":true,"iframe":true,"input":true,"isIndex":true,"object":true,"select":true,"textarea":true},getTabIndex:function(_8d){if(!_8d||!_8d.getAttribute){return null;}var _8e;if(_1.isIE){_8e=_8d.tabIndex;if(_8e===0){var _8f=_8d.nodeName.toLowerCase(),_90=_8d.attributes.tabIndex,_91=_90&&_90.specified===true;return _91||mxui.dom.ieFocusable[_8f]?"0":null;}else{return ""+_8e;}}else{var _92=_8d.getAttribute("tabindex");_8e=String(_8d.tabIndex);if(_92!=null||_8e>=0){if(!_1.isFF){return (_92==="")?null:_8e;}else{return _8e;}}else{return null;}}},getFocusIndex:function(_93){var _94=mxui.dom.getTabIndex(_93);return _94>=0?_94:null;},coords:function(_95){return _1.mixin(_1.position(_95),_1.marginBox(_95));},data:_6(),getScopedData:_6,moveIntoView:function(_96,_97){_97=_97||0;var pos=_1.position(_96),_98=_2.getViewport(),_99=_96.style,_9a=pos.y+pos.h+_97,_9b=pos.x+pos.w+_97;if(pos.y<_97||pos.h+_97*2>_98.h){_99.top=_97+"px";}else{if(_9a>_98.h){_99.top=pos.y-(_9a-_98.h)+"px";}}if(pos.x<_97||pos.w+_97*2>_98.w){_99.left=_97+"px";}else{if(_9b>_98.w){_99.left=pos.x-(_9b-_98.w)+"px";}}},getNodeExtents:function(_9c){var cs=_1.getComputedStyle(_9c),me=_1.getMarginExtents(_9c,cs),be=_1.getBorderExtents(_9c,cs),pe=_1.getPadExtents(_9c,cs);return {w:me.w+be.w+pe.w,h:me.h+be.h+pe.h};}};})();});