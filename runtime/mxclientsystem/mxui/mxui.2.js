/* @preserve
    Copyright (c) 2005-2016, Mendix bv. All rights reserved.
    See mxclientsystem/licenses.txt for third party licenses that apply.
*/
webpackJsonp([2],{556:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n.i(p.callbackToPromise)(t.getDirectory.bind(t),e,{create:r})}function o(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n.i(p.callbackToPromise)(t.getFile.bind(t),e,{create:r})}function u(t){return n.i(p.callbackToPromise)(t.removeRecursively.bind(t))}function a(t){return n.i(p.callbackToPromise)(t.file.bind(t)).then(s).then(function(t){return new Blob([t])})}function c(t,e){return n.i(p.callbackToPromise)(t.createWriter.bind(t)).then(function(t){return l(e,t)})}function s(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(t){return e(t.target.result)},r.onerror=function(t){return n(t.target.error)},r.readAsArrayBuffer(t)})}function l(t,e){return new Promise(function(n,r){e.onwrite=n,e.onerror=r,e.write(t)})}function f(t){return new Promise(function(e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.setRequestHeader("X-Csrf-Token",window.mx.session.getCSRFToken()),r.onreadystatechange=function(t){4===r.readyState&&(r.status>=200&&r.status<300?e(r.response):n(r.response))},r.onerror=n,r.send()})}Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"FileBackend",function(){return d});var p=n(137),m=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),y=n(38),d=function(){function t(e){r(this,t),this._config=e,this._storageDirPromise=null}return h(t,[{key:"readFile",value:function(t){return this._openFile(t).then(function(t){return a(t)})}},{key:"storeFile",value:function(t,e){return this._openFile(e,!0).then(function(e){return c(e,t)})}},{key:"downloadFile",value:function(t,e){var r=this;return this._config.downloadFileFn?n.i(p.callbackToPromise)(this._config.downloadFileFn,t,e.replace(/^files\//,"")):f(y.getStaticResourceUrlFromPath(t)).then(function(t){return r.storeFile(t,e)})}},{key:"removeDir",value:function(t){var e;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,regeneratorRuntime.awrap(this._openDir(t));case 3:return e=n.sent,n.next=6,regeneratorRuntime.awrap(u(e));case 6:n.next=12;break;case 8:if(n.prev=8,n.t0=n.catch(0),1===n.t0.code){n.next=12;break}throw n.t0;case 12:case"end":return n.stop()}},null,this,[[0,8]])}},{key:"_openFile",value:function(t){var e,n,r,i,u,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.async(function(c){for(;;)switch(c.prev=c.next){case 0:return e=t.split(/\/([^\/]+)$/),n=m(e,2),r=n[0],i=n[1],c.next=3,regeneratorRuntime.awrap(this._openDir(r,a));case 3:return u=c.sent,c.abrupt("return",o(u,i,a));case 5:case"end":return c.stop()}},null,this)}},{key:"_openDir",value:function(t){var e,n,r,o=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:return e=t.split("/").filter(function(t){return""!==t}),u.next=3,regeneratorRuntime.awrap(this._getStorageDir());case 3:n=u.sent,r=0;case 5:if(!(r<e.length)){u.next=12;break}return u.next=8,regeneratorRuntime.awrap(i(n,e[r],o));case 8:n=u.sent;case 9:++r,u.next=5;break;case 12:return u.abrupt("return",n);case 13:case"end":return u.stop()}},null,this)}},{key:"_getStorageDir",value:function(){return this._config.getStorageDirFn?n.i(p.callbackToPromise)(this._config.getStorageDirFn):(null===this._storageDirPromise&&(this._storageDirPromise=n.i(p.callbackToPromise)(window.webkitRequestFileSystem,window.TEMPORARY,1048576).then(function(t){return t.root})),this._storageDirPromise)}}]),t}()},557:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(null===t)return null;var r=window.mx.meta.getEntity(t.$objectType);return s.mapObject(t,function(t,i){return("guid"===i||!n.i(o.d)(i)&&r.isReference(i))&&null!=t?e(t):t})}Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"Synchronizer",function(){return f});var o=n(716),u=n(101),a=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(3),l=n(38),f=function(){function t(e,n,i,o){r(this,t),this._store=e,this._runtimeApi=n,this._fileBackend=i,this._objectCache=o,this._internalToExternal={}}return c(t,[{key:"upload",value:function(){var t,e,r,i,c,l,f,p,m,h,y,d,b,g,_,v,w,j=this;return regeneratorRuntime.async(function(T){for(;;)switch(T.prev=T.next){case 0:return w=function(r,i){return e.readFile(o.a+n.i(o.b)(r.guid)).then(function(e){return t.upload(i,r.Name,{},e,{},[])})},v=function(t,e){function r(e){return!n.i(o.d)(e)&&i.isSyncable(e)&&!n.i(o.e)(t,e)}var i=window.mx.meta.getEntity(t.$objectType),u=Object.keys(t).filter(r).map(function(r){var u=t[r];return[r,{value:i.isObjectReference(r)&&null!=u&&!n.i(o.c)(u)?e[u]:u}]});return[n.i(o.c)(t.guid)?t.guid:e[t.guid],s.objectFromArray(u)]},_=function(e){return t.instantiate(e.$objectType).then(function(t){var n=t.objects.find(function(e){return e.guid===t.actionResult});return{internalObj:e,remoteJson:n}})},g=function(t){var e=window.mx.meta.getEntity(t.$objectType);return s.arrayFromObject(t).filter(function(t){var r=a(t,2),i=r[0];r[1];return"guid"===i||!n.i(o.d)(i)&&e.isReference(i)})},b=function(t){var e=t.map(function(t){return t.guid}),r=s.unique(t.map(function(t){return g(t).map(function(t){var e=a(t,2);e[0];return e[1]})}).reduce(function(t,e){return t.concat(e)},[])),i=r.filter(function(t){return!n.i(o.c)(t)}).filter(function(t){return!e.includes(t)});if(i.length>0){var c=s.unique(t.map(function(t){return g(t).filter(function(t){var e=a(t,2),n=(e[0],e[1]);return i.includes(n)}).map(function(e){var n=a(e,2),r=n[0];n[1];return"object of type "+t.$objectType+" (reference "+r+")"})}).reduce(function(t,e){return t.concat(e)},[])).join(", "),l="Sync has failed due to a modeling error. Your database contains objects that reference uncommitted objects:\n"+c+".";throw new u.DanglingError(l)}},t=this._runtimeApi,e=this._fileBackend,T.next=9,regeneratorRuntime.awrap(this._store.fetchDirty());case 9:return r=T.sent,b(r),i=s.partition(function(t){return n.i(o.c)(t.guid)},r),c=a(i,2),l=c[0],f=c[1],T.next=14,regeneratorRuntime.awrap(Promise.all(f.map(_)));case 14:return p=T.sent,m=s.objectFromArray(p.map(function(t){var e=t.internalObj,n=t.remoteJson;return[e.guid,n.guid]})),h=p.map(function(t){return t.remoteJson}),y=l.map(function(t){return t.guid}).concat(p.map(function(t){return t.remoteJson.guid})),d=s.objectFromArray(r.map(function(t){return v(t,m)})),T.next=21,regeneratorRuntime.awrap(t.commit(y,null,d,h));case 21:return T.next=23,regeneratorRuntime.awrap(Promise.all(r.filter(function(t){return window.mx.meta.getEntity(t.$objectType).isA("System.FileDocument")}).filter(function(t){return t.HasContents}).map(function(t){return w(t,n.i(o.c)(t.guid)?t.guid:m[t.guid])})));case 23:return s.arrayFromObject(m).forEach(function(t){var e=a(t,2),n=e[0],r=e[1];return j._mapInternalGuid(n,r)}),T.next=26,regeneratorRuntime.awrap(this._store.cleanDatabase());case 26:return T.abrupt("return",{});case 27:case"end":return T.stop()}},null,this)}},{key:"downloadObjects",value:function(t){var e,n,r,i,u=this;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return i=function(t,n){return e.retrieveByXPath(n).then(function(e){return e.mxobjects.map(o.f).map(function(e){return Object.assign({},e,{$objectType:t})})})},e=this._runtimeApi,a.t0=s,a.next=5,regeneratorRuntime.awrap(Promise.all(t.map(function(t){return i(t.store,t.xpath)})));case 5:return a.t1=a.sent,n=a.t0.flatten.call(a.t0,a.t1),a.next=9,regeneratorRuntime.awrap(this._store.rebuildDatabase(n));case 9:return r=n.map(this.makeObjectExternal,this).filter(function(t){return u._objectCache.has(t.guid)}),this._objectCache.setMxObjects(r.map(o.g)),a.abrupt("return",{});case 12:case"end":return a.stop()}},null,this)}},{key:"downloadFiles",value:function(t){var e,r,i,u,c,f,p;return regeneratorRuntime.async(function(m){for(;;)switch(m.prev=m.next){case 0:return p=function(t,e){var i=l.getDynamicResourcePath(t.guid,t.changedDate,e),u=(e?o.h:o.a)+n.i(o.b)(t.guid);return r.downloadFile(i,u)},f=function(t){return e.getSlice(t,[{attribute:"HasContents",operator:"equals",value:"true"}]).then(function(t){var e=a(t,2),n=e[0];e[1];return n})},e=this._store,r=this._fileBackend,m.t0=s,m.next=7,regeneratorRuntime.awrap(Promise.all(t.map(function(t){return f(t)})));case 7:return m.t1=m.sent,i=m.t0.flatten.call(m.t0,m.t1),u=i.map(function(t){return p(t,!1)}),c=i.filter(function(t){return window.mx.meta.getEntity(t.$objectType).isA("System.Image")}).map(function(t){return p(t,!0)}),m.next=13,regeneratorRuntime.awrap(Promise.all(u.concat(c)));case 13:return m.abrupt("return",{});case 14:case"end":return m.stop()}},null,this)}},{key:"getExternalGuid",value:function(t){return this._internalToExternal[t]||t}},{key:"getInternalGuid",value:function(t){for(var e in this._internalToExternal)if(this._internalToExternal[e]===t)return e;return t}},{key:"makeObjectExternal",value:function(t){return i(t,this.getExternalGuid.bind(this))}},{key:"makeObjectInternal",value:function(t){return i(t,this.getInternalGuid.bind(this))}},{key:"_mapInternalGuid",value:function(t,e){this._internalToExternal[e]=t}}]),t}()},558:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function u(t){return n.i(s.f)(t.jsonData)}function a(t,e){var n={guid:t,objectType:e,attributes:{}},r=window.mx.meta.getEntity(e);return r.getAttributes().forEach(function(t){n.attributes[t]={value:y[r.getAttributeType(t)]}}),n}function c(t,e,n){var r=n?"thumbnails":"documents";return"filesystem:"+window.mx.appUrl+"temporary/files/"+r+"/"+t+"?"+ +new Date}Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"OfflineDataBackend",function(){return d});var s=n(716),l=n(80),f=(n.n(l),n(230)),p=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),m=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),h=n(3),y={String:null,Integer:"0",Long:"0",Decimal:"0",Float:"0",Currency:"0",Enum:null,HashString:null,ObjectReference:null,DateTime:null,Boolean:!1,AutoNumber:"0",Binary:null},d=function(t){function e(t,n,o,u,a){r(this,e);var s=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t=t||{},s._store=o,s._getDocumentUrl=t.getDocumentUrlFn||c,s._objectCache=n,s._fileBackend=u,s._synchronizer=a,s}return o(e,t),m(e,[{key:"getByGuid",value:function(t,e){return Promise.all(t.map(this._getByGuid,this)).then(function(t){return{mxobjects:t.filter(function(t){return null!=t}).map(s.g)}})}},{key:"getSlice",value:function(t,e,n){var r=this,i=window.mx.meta.getEntity(t),o=(e||[]).map(function(t){return i.isReference(t.attribute)?(t.value=r._synchronizer.getInternalGuid(t.value),t):t});return this._store.getSlice(t,o,n).then(function(t){var e=p(t,2),n=e[0],i=e[1];return{mxobjects:n.map(r._synchronizer.makeObjectExternal,r._synchronizer).map(s.g),count:i}})}},{key:"create",value:function(t){var e=n.i(s.i)();return this._objectCache.onCreate([e]),this._objectCache.setMxObjects([a(e,t)]),Promise.resolve({actionResult:e})}},{key:"commit",value:function(t,e){function n(t){return Object.assign({},t,h.mapObject(o[t.guid],function(t){return t.value}))}function r(t){var e={};return Object.keys(t).forEach(function(n){e[n]=Object.keys(t[n])}),e}var i=this,o=h.objectFromArray(t.map(function(t){return[t,h.clone(i._objectCache.getChanges(t))]})),a=h.partition(function(t){return i._objectCache.has(t)},t),c=p(a,2),l=c[0],f=c[1],m=l.map(function(t){return i._objectCache.getObject(t)}).map(u);return Promise.all(f.map(this._getByGuid,this)).then(function(t){var e=t.concat(m).map(n);return i._store.insertOrReplace(e.map(i._synchronizer.makeObjectInternal,i._synchronizer)).then(function(){return e})}).then(function(t){i._objectCache.onCommit(t.map(function(t){return t.guid})),i._objectCache.setMxObjects(t.map(s.g)),i._objectCache.removeChanges(r(o))}).then(function(){return{}})}},{key:"rollback",value:function(t){var e=this;this._objectCache.removeAllChanges(t);var n=t.filter(function(t){return e._objectCache.isNew(t)});return this._objectCache.removeObjects(n),Promise.resolve({})}},{key:"validate",value:function(t){return Promise.resolve({})}},{key:"saveDocument",value:function(t,e,r,i){var o=this;if(i.size/1048576>r.maxFileSize)return Promise.reject(new l.DescribedError("File too large"));var u=n.i(s.b)(this._synchronizer.getInternalGuid(t));return this._fileBackend.storeFile(i,s.a+u).then(function(){return o._objectCache.makeChange(t,"HasContents",!0),o.commit([t],null)})}},{key:"getDocumentUrl",value:function(t,e,r){return this._getDocumentUrl(n.i(s.b)(this._synchronizer.getInternalGuid(t)),e,r)}},{key:"getImageUrl",value:function(t){return Promise.resolve(t)}},{key:"upload",value:function(){return this._synchronizer.upload()}},{key:"downloadObjects",value:function(t){return this._synchronizer.downloadObjects(t)}},{key:"downloadFiles",value:function(t){return this._synchronizer.downloadFiles(t)}},{key:"cleanupDirtyObjects",value:function(){return this._store.cleanupDirtyObjects()}},{key:"isDirty",value:function(t){return this._store.isDirty(this._synchronizer.getInternalGuid(t))}},{key:"cleanup",value:function(){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(this._store.cleanDatabase());case 2:return t.next=4,regeneratorRuntime.awrap(this._fileBackend.removeDir(s.a));case 4:return t.next=6,regeneratorRuntime.awrap(this._fileBackend.removeDir(s.h));case 6:case"end":return t.stop()}},null,this)}},{key:"_getByGuid",value:function(t){var e=this;return this._store.getByGuid(this._synchronizer.getInternalGuid(t)).then(function(t){return e._synchronizer.makeObjectExternal(t)})}}]),e}(f.a)},559:function(t,e,n){function r(){return window.openDatabase("MendixDatabase","1","Mendix Database",10485760)}function i(t,e){a.call(this),e=e||r,this._tableNames=t;var n=e();this._databasePromise=this._initialize(n)}var o=n(758),u=n(757),a=n(753),c=n(696),s=n(717);i.prototype=Object.create(a.prototype),i.prototype._getDatabase=function(){return this._databasePromise},i.prototype._initialize=function(t){var e=o.createCreateTransaction(this._tableNames);return s.promiseFromTask(u.runWriteTransaction(t,e)).then(function(){return t})},i.prototype._fetch=function(t){return function(e){var n=o.createFetchByGuidTransaction(t);return s.promiseFromTask(u.runReadTransaction(e,n))}},i.prototype._fetchSlice=function(t,e,n){return function(r){var i=o.createFetchSliceTransaction(t,e,n.offset,n.limit,n.sort);return s.promiseFromTask(u.runReadTransaction(r,i))}},i.prototype._rebuildDb=function(t){return c.ask().chain(function(e){var n=o.createRebuildTransaction(this._tableNames,t);return new c(function(t){return u.runWriteTransaction(e,n)})}.bind(this))},i.prototype._insertOrReplace=function(t){return function(e){var n=o.createInsertOrReplaceTransaction(t);return s.promiseFromTask(u.runWriteTransaction(e,n))}},i.prototype._cleanDatabase=function(){var t=this;return function(e){var n=o.createCleanTransaction(t._tableNames);return s.promiseFromTask(u.runWriteTransaction(e,n))}},i.prototype._fetchDirty=function(){return c.ask().chain(function(t){var e=o.createFetchDirtyObjectsTransaction();return new c(function(n){return u.runWriteTransaction(t,e)})})},i.prototype._isDirty=function(t){return c.ask().chain(function(e){var n=o.createGetIsDirtyTransaction(t);return new c(function(t){return u.runReadTransaction(e,n)})})},i.prototype._cleanupDirtyObjects=function(){return function(t){var e=o.createDirtyCleanupTransaction();return s.promiseFromTask(u.runWriteTransaction(t,e))}},t.exports=i},689:function(t,e){function n(t){this.fork=t}n.of=function(t){return new n(function(e,n){n(t)})},n.prototype.chain=function(t){var e=this;return new n(function(n,r){e.fork(n,function(e){t(e).fork(n,r)})})},n.prototype.orElse=function(t){var e=this;return new n(function(n,r){e.fork(function(e){t(e).fork(n,r)},r)})},n.prototype.ap=function(t){var e,r,i,o=this,u=2;return new n(function(n,a){function c(){0==--u&&a(e(r))}function s(t){void 0===i&&(i=t,n(i))}o.fork(s,function(t){e=t,c()}),t.fork(s,function(t){r=t,c()})})},n.prototype.map=function(t){return this.chain(function(e){return n.of(t(e))})},n.rejected=n.prototype.rejected=function(t){return new n(function(e,n){e(t)})},n.parallel=function(t){return new n(function(e,n){function r(t){return function(e){u[t]=e,void 0===i&&0==--o&&n(u)}}var i,o=t.length,u=new Array(t.length);if(0===t.length)return void n(u);t.forEach(function(t,n){t.fork(function(t){void 0===i&&(i=t,e(t))},r(n))})})},n.sequence=function(t){return t.reduce(function(t,e){return t.chain(function(t){return e})},n.of(null))},t.exports=n},690:function(t,e){t.exports={LIKE_ESCAPE_CHAR:"~",QUOTE_CHAR:'"'}},696:function(t,e,n){var r=n(752),i=n(689),o=new r(i);o.rejected=function(t){return new o(function(e){return i.rejected(t)})},o.parallel=function(t){return new o(function(e){return new i(function(n,r){if(0===t.length)return void r([]);var i=new Array(t.length),o=t.length,u=!1;t.forEach(function(t,a){t.run(e).fork(function(t){u||(u=!0,n(t))},function(t){i[a]=t,u||0!=--o||r(i)})})})})},o.sequence=function(t){return t.reduce(function(t,e){return t.chain(function(t){return e.map(function(e){return t.concat([e])})})},o.of([]))},t.exports=o},716:function(t,e,n){"use strict";function r(t){return t.replace(/:/g,"_")}function i(){return m+l.getUniqueId()}function o(t){return!h.test(t)}function u(t){return"guid"===t||"$"===t[0]}function a(t,e){return t.$readonlyAttrs.includes(e)}function c(t){var e=Object.keys(t).filter(function(t){return!u(t)}).reduce(function(e,n){return e[n]={value:t[n]},a(t,n)&&(e[n].readonly=!0),e},{});return{guid:t.guid,objectType:t.$objectType,attributes:e}}function s(t){var e={guid:t.guid,$objectType:t.objectType,$readonlyAttrs:[]};for(var n in t.attributes)e[n]=t.attributes[n].value,t.attributes[n].readonly&&e.$readonlyAttrs.push(n);return e}n.d(e,"a",function(){return f}),n.d(e,"h",function(){return p}),e.b=r,e.i=i,e.c=o,e.d=u,e.e=a,e.g=c,e.f=s;var l=n(3),f="files/documents/",p="files/thumbnails/",m="GUID:",h=new RegExp("^"+m)},717:function(t,e,n){var r=n(689),i={};i.promiseFromTask=function(t){return new Promise(function(e,n){t.fork(n,e)})},i.callbackFromTask=function(t,e,n){t.fork(function(t){n&&n(t)},function(t){e&&e(t)})},i.taskFromPromise=function(t){return new r(function(e,n){t.then(n,e)})},t.exports=i},752:function(t,e){function n(t){function e(t){this.run=t}return e.prototype.chain=function(t){return new e(function(e){return this.run(e).chain(function(n){return t(n).run(e)})}.bind(this))},e.prototype.ap=function(t){return new e(function(e){return this.run(e).ap(t.run(e))}.bind(this))},e.prototype.map=function(t){return this.chain(function(n){return e.of(t(n))})},e.of=function(n){return new e(function(e){return t.of(n)})},e.ask=function(){return new e(t.of)},e}t.exports=n},753:function(t,e,n){function r(){}var i=n(717),o=n(696);r.prototype.getSlice=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._getDatabase().then(this._fetchSlice(t,e,n))},r.prototype.getByGuid=function(t){return this._getDatabase().then(this._fetch(t))},r.prototype.insertOrReplace=function(t){return this._getDatabase().then(this._insertOrReplace(t))},r.prototype.cleanDatabase=function(){return this._getDatabase().then(this._cleanDatabase())},r.prototype.rebuildDatabase=function(t){var e=this;return this._getDatabase().then(function(n){return i.promiseFromTask(e._rebuildDb(t).run(n))})},r.prototype.fetchDirty=function(){var t=this;return this._getDatabase().then(function(e){return i.promiseFromTask(t._fetchDirty().run(e))})},r.prototype.isDirty=function(t){var e=this;return this._getDatabase().then(function(n){return i.promiseFromTask(e._isDirty(t).run(n))})},r.prototype.cleanupDirtyObjects=function(){return this._getDatabase().then(this._cleanupDirtyObjects())},r.prototype._getDatabase=function(){return Promise.reject(new Error("not implemented"))},r.prototype._initialize=function(){return Promise.reject(new Error("not implemented"))},r.prototype._fetch=function(t){return function(t){return Promise.reject(new Error("not implemented"))}},r.prototype._fetchSlice=function(t,e,n){return function(t){return Promise.reject(new Error("not implemented"))}},r.prototype._insertOrReplace=function(t){return function(t){return Promise.reject(new Error("not implemented"))}},r.prototype._cleanDatabase=function(){return function(t){return Promise.reject(new Error("not implemented"))}},r.prototype._rebuildDb=function(t){return o.rejected(new Error("not implemented"))},r.prototype._fetchDirty=function(){return o.rejected(new Error("not implemented"))},r.prototype._isDirty=function(t){return o.rejected(new Error("not implemented"))},r.prototype._cleanupDirtyObjects=function(){return function(t){return Promise.reject(new Error("not implemented"))}},t.exports=r},754:function(t,e,n){function r(t,e){this._tableName=e&&e.tableName||t&&t._tableName||null,this._columns=e&&e.columns||t&&t._columns||[]}function i(t){var e=o.QUOTE_CHAR;return e+t+e}var o=n(690);r.prototype.table=function(t){return new r(this,{tableName:t})},r.prototype.column=function(t,e){return new r(this,{columns:this._columns.concat({columnName:t,columnType:e,isPrimary:!1})})},r.prototype.primaryKeyColumn=function(t,e){return new r(this,{columns:this._columns.concat({columnName:t,columnType:e,isPrimary:!0})})},r.prototype.createIfNotExists=function(){var t="";return t+="CREATE TABLE IF NOT EXISTS "+i(this._tableName),t+=this._buildSql()},r.prototype._buildSql=function(){var t="";return this._columns.length>0&&(t+=" (",t+=this._columns.map(function(t){return[i(t.columnName),t.columnType,"text"===t.columnType?" COLLATE NOCASE ":"",t.isPrimary?"PRIMARY KEY ":""].join(" ").slice(0,-1)},this).join(", "),t+=")"),t},t.exports=r},755:function(t,e,n){function r(t,e){if(!(this instanceof r))return new r;this._tableName=e&&e.tableName||t&&t._tableName||null,this._columnNames=e&&e.columnNames||t&&t._columnNames||[]}function i(t){var e=o.QUOTE_CHAR;return e+t+e}var o=n(690);r.prototype.into=function(t){return new r(this,{tableName:t})},r.prototype.column=function(t){return new r(this,{columnNames:this._columnNames.concat(t)})},r.prototype.insert=function(){var t="";return t+="INSERT INTO "+i(this._tableName),t+=this._buildSql()},r.prototype.insertOrReplace=function(){var t="";return t+="INSERT OR REPLACE INTO "+i(this._tableName),t+=this._buildSql()},r.prototype._buildSql=function(){var t="";return this._columnNames.length>0&&(t+=" (",t+=this._columnNames.map(i).join(", "),t+=")"),t+=" VALUES (",t+="?"+new Array(this._columnNames.length).join(", ?"),t+=")"},t.exports=r},756:function(t,e,n){function r(t,e){this._select=e&&e.select||t&&t._select||null,this._from=e&&e.from||t&&t._from||null,this._join=e&&e.join||t&&t._join||null,this._constraints=e&&e.constraints||t&&t._constraints||[],this._orderBy=e&&e.orderBy||t&&t._orderBy||[],this._limit=e&&e.limit||t&&t._limit||null,this._offset=e&&e.offset||t&&t._offset||null}function i(t,e){this._column=t,this._negate=!!e}function o(t,e,n){this._column=t,this._operator=e,this._negate=!!n}function u(t){return function(e){return e+" "+t+" ?"}}function a(t){var e="";return e+=t,e+=" LIKE '%' || ? || '%'",e+=" ESCAPE '"+c.LIKE_ESCAPE_CHAR+"'"}var c=n(690),s={equals:u("="),lessThan:u("<"),lessThanOrEquals:u("<="),greaterThan:u(">"),greaterThanOrEquals:u(">="),contains:a};r.prototype.from=function(t){return new r(this,{from:t})},r.prototype.join=function(t,e,n){return new r(this,{join:{tableName:t,joinOnColumn:e,selectedColumns:n}})},r.prototype.where=function(t,e){return this._where(t,!1,e)},r.prototype.whereNot=function(t,e){return this._where(t,!0,e)},r.prototype.whereNull=function(t,e){return this._whereNull(t,!1,e)},r.prototype.whereNotNull=function(t,e){return this._whereNull(t,!0,e)},r.prototype.order=function(t,e){return new r(this,{orderBy:this._orderBy.concat([[t,e]])})},r.prototype.limit=function(t){return new r(this,{limit:t})},r.prototype.offset=function(t){return new r(this,{offset:t})},r.prototype.selectDistinct=function(t){return Array.isArray(t)&&(t=t.join(", ")),"SELECT DISTINCT "+t+this._buildSql()},r.prototype.selectCount=function(t){return"SELECT COUNT(*) AS "+t+this._buildSql()},r.prototype.select=function(){var t=this,e="SELECT "+this._from+".*";return this._join&&this._join.selectedColumns.forEach(function(n){e+=", "+t._join.tableName+"."+n+' as "'+t._join.tableName+"."+n+'"'}),e+this._buildSql()},r.prototype._where=function(t,e,n){return new r(this,{constraints:this._constraints.concat([new o(t,n,e)])})},r.prototype._whereNull=function(t,e){return new r(this,{constraints:this._constraints.concat([new i(t,e)])})},r.prototype._buildSql=function(){var t=" FROM "+this._from+" AS "+this._from;return this._join&&(t+=" JOIN "+this._join.tableName+" AS "+this._join.tableName+" USING ("+this._join.joinOnColumn+")"),this._constraints.length>0&&(t+=" WHERE "+this._constraints.map(function(t){return t.toString()}).join(" AND ")),this._orderBy.length>0&&(t+=" ORDER BY "+this._orderBy.map(function(t){return t[0]+" "+t[1]}).join(", ")),this._limit&&(t+=" LIMIT "+this._limit),this._offset&&(t+=" OFFSET "+this._offset),t},i.prototype.toString=function(){return this._column+" IS "+(this._negate?"NOT ":"")+"NULL"},o.prototype.toString=function(){var t=s[this._operator];return(this._negate?"NOT ":"")+t(this._column)},t.exports=r},757:function(t,e,n){function r(t){return function(e,n){return new i(function(r,i){var o,u=2;e[t](function(t){n.run(t).fork(r,function(t){o=t,0==--u&&i(o)})},r,function(){0==--u&&i(o)})})}}var i=n(689);t.exports={runReadTransaction:r("readTransaction"),runWriteTransaction:r("transaction")}},758:function(t,e,n){function r(t){var e=[S].concat(t).map(_).map(function(t){return"DROP TABLE IF EXISTS '"+t+"'"}).map(function(t){return T(t,[])});return D.sequence([D.parallel(e),i(t)])}function i(t){function e(t){return T(n(t).reduce(function(t,e){return t.column(_(e.attr),e.type)},(new k).table(_(t)).primaryKeyColumn("guid","text")).createIfNotExists(),[])}function n(t){var e=window.mx.meta.getEntity(t);return e.getAttributes().map(function(t){var n=e.getAttributeType(t);return{attr:t,type:A[n]}})}var r=[a()].concat(t.map(e));return D.parallel(r).map(function(t){})}function o(t,e){var n=e.reduce(function(e,n){var r=c(),i=l(t,n);return e.concat([T(r.insert(),[n.guid,t,0,JSON.stringify(n.$readonlyAttrs)]),T(i.builder.insert(),i.values)])},[]);return D.parallel(n).map(function(t){})}function u(){return T((new x).from(S).where("dirty","equals").selectDistinct("tableName"),[1])}function a(){return T((new k).table(S).primaryKeyColumn("guid","text").column("tableName","text").column("dirty","boolean").column("readonlyAttrs","text").createIfNotExists(),[])}function c(){return(new O).into(S).column("guid").column("tableName").column("dirty").column("readonlyAttrs")}function s(t,e){return e.reduce(function(e,n){var r=t.getAttributeType(n.attribute),i=null==n.value,o=P[r],u=C[r],a=u(o(n.value));if(i&&"equals"===n.operator){return{builder:(n.negate?e.builder.whereNotNull:e.builder.whereNull).call(e.builder,_(n.attribute)),args:e.args}}if(i&&"contains"===n.operator)return e;var c=n.negate?e.builder.whereNot:e.builder.where,s="contains"===n.operator?g(a):a;return{builder:c.call(e.builder,_(n.attribute),n.operator),args:e.args.concat([s])}},{builder:new x,args:[]})}function l(t,e){var n=window.mx.meta.getEntity(t),r=n.getAttributes(),i=r.reduce(function(t,r){var i=n.getAttributeType(r),o=C[i];if(!o)return t;var u=o(e[r]);return{attrs:t.attrs.concat([r]),values:t.values.concat([u])}},{attrs:["guid"],values:[e.guid]});return{builder:i.attrs.reduce(function(t,e){return t.column(_(e))},(new O).into(_(t))),values:i.values}}function f(t){if(null==t)return null;var e=new N(t),n=20-Math.max(0,e.e)-1;return(e.s<0?"-":"")+new Array(n+1).join("0")+e.abs().toFixed()}function p(t){return null!=t?String(t):null}function m(t){return null!=t?Number(t):null}function h(t){return"false"!==t}function y(t){return t?Number(t):null}function d(t){return t}function b(t){for(var e=[],n=0;n<t.length;++n)e.push(t.item(n));return e}function g(t){var e=E.LIKE_ESCAPE_CHAR;return t.replace(new RegExp(e,"g"),e+e).replace(/%/g,e+"%").replace(/_/g,e+"_")}function _(t){return t.replace(".","$")}function v(t){return t.replace("$",".")}function w(t,e,n,r){var i={guid:r.guid,$objectType:t.getEntity(),$dirty:e,$readonlyAttrs:JSON.parse(n)};for(var o in r)if(!function(t){return"guid"===t||t.indexOf(".")>-1}(o)){var u=v(o),a=t.getAttributeType(u),c=F[a];c&&(i[u]=c(r[o]))}return i}function j(t,e){return t[S+"."+e]}function T(t,e){return e=e||[],new D(function(n){return new R(function(r,i){n.executeSql(t,e,function(t,e){return i(e)},function(t,e){return r(e)})})})}var E=n(690),x=n(756),k=n(754),O=n(755),D=n(696),R=n(689),N=n(32),S="_guidToTable",A={String:"text",Integer:"text",Long:"text",Decimal:"text",Float:"text",Currency:"text",Enum:"text",HashString:"text",ObjectReference:"text",DateTime:"integer",Boolean:"integer",AutoNumber:"integer",Binary:"blob"},C={String:p,Integer:f,Long:f,Decimal:f,Float:f,Currency:f,Enum:p,HashString:p,ObjectReference:p,DateTime:m,Boolean:Number,AutoNumber:p,Binary:p},F={String:p,Integer:p,Long:p,Decimal:p,Float:p,Currency:p,Enum:p,HashString:p,ObjectReference:p,DateTime:d,Boolean:Boolean,AutoNumber:p,Binary:p},P={String:d,Integer:d,Long:d,Decimal:d,Float:d,Currency:d,Enum:d,HashString:d,ObjectReference:d,DateTime:y,Boolean:h,AutoNumber:d,Binary:d},I={createCreateTransaction:i,createCleanTransaction:function(t){var e=[S].concat(t).map(_).map(function(t){return"DELETE FROM '"+t+"'"}).map(function(t){return T(t,[])});return D.parallel(e).map(function(t){})},createFetchByGuidTransaction:function(t){return T((new x).from(S).where("guid","equals").select(),[t]).chain(function(e){if(0===e.rows.length)return D.of(null);if(1!==e.rows.length)return D.rejected(new Error("db consistency error"));var n=e.rows.item(0),r=n.tableName,i=Boolean(n.dirty),o=n.readonlyAttrs;return T((new x).from(_(r)).where("guid","equals").select(),[t]).chain(function(t){return 0===t.rows.length?D.rejected(new Error("entity not found")):1!==t.rows.length?D.rejected(new Error("db consistency error")):D.of(w(window.mx.meta.getEntity(r),i,o,t.rows.item(0)))})})},createFetchSliceTransaction:function(t,e,n,r,i){e=e||[],i=i||[];var o=window.mx.meta.getEntity(t),u=s(o,e),a=u.builder.from(_(t)),c=u.args,l=a.offset(n).limit(r).join(S,"guid",["dirty","readonlyAttrs"]);l=i.reduce(function(t,e){return t.order(e[0],e[1])},l);var f=T(l.select(),c).map(function(t){for(var e=[],n=0;n<t.rows.length;++n){var r=t.rows.item(n),i=Boolean(r[S+".dirty"]),u=j(r,"readonlyAttrs");e.push(w(o,i,u,r))}return e}),p=T(a.selectCount("cnt"),c).map(function(t){return t.rows.item(0).cnt});return D.parallel([f,p])},createInsertOrReplaceTransaction:function(t){return D.parallel(t.map(function(t){var e=t.$objectType,n=c(),r=l(e,t);return[T(n.insertOrReplace(),[t.guid,e,1,JSON.stringify(t.$readonlyAttrs)]),T(r.builder.insertOrReplace(),r.values)]}).reduce(function(t,e){return t.concat(e)},[])).map(function(t){})},createFillBulkTransaction:o,createFetchDirtyObjectsTransaction:function(){return u().chain(function(t){var e=b(t.rows).map(function(t){var e=t.tableName,n=(new x).from(_(e)).join(S,"guid",["dirty","readonlyAttrs"]).where(S+".dirty","equals").select(),r=window.mx.meta.getEntity(e);return T(n,[1]).map(function(t){return b(t.rows).map(function(t){return w(r,!0,j(t,"readonlyAttrs"),t)})})});return D.parallel(e)}).map(function(t){return t.reduce(function(t,e){return t.concat(e)},[])})},createGetIsDirtyTransaction:function(t){return T((new x).from(S).where("guid","equals").select("dirty"),[t]).chain(function(t){return 0===t.rows.length?D.of(!1):1!==t.rows.length?D.rejected(new Error("db consistency error")):D.of(t.rows.item(0).dirty)})},createDirtyCleanupTransaction:function(){return u().chain(function(t){var e=b(t.rows).map(function(t){var e=t.tableName;return T("DELETE FROM "+_(e)+" WHERE guid IN (\n                            SELECT guid FROM "+S+" WHERE tableName = ? AND dirty = 1)",[e])});return D.sequence([D.parallel(e),T("DELETE FROM "+S+" WHERE dirty = 1")]).map(function(t){})})},createRebuildTransaction:function(t,e){var n=r(t),i=t.map(function(t){var n=e.filter(function(e){return e.$objectType===t});return o(t,n)});return D.sequence([n,D.parallel(i)]).map(function(t){})}};t.exports=I}});