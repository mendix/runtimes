/* @preserve
    Copyright (c) 2005-2016, Mendix bv. All rights reserved.
    See mxclientsystem/licenses.txt for third party licenses that apply.
*/
webpackJsonp([2],{551:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n.i(f.callbackToPromise)(t.getDirectory.bind(t),e,{create:r})}function o(t,e){var r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return n.i(f.callbackToPromise)(t.getFile.bind(t),e,{create:r})}function u(t){return n.i(f.callbackToPromise)(t.file.bind(t)).then(c).then(function(t){return new Blob([t])})}function a(t,e){return n.i(f.callbackToPromise)(t.createWriter.bind(t)).then(function(t){return s(e,t)})}function c(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(t){return e(t.target.result)},r.onerror=function(t){return n(t.target.error)},r.readAsArrayBuffer(t)})}function s(t,e){return new Promise(function(n,r){e.onwrite=n,e.onerror=r,e.write(t)})}function l(t){return new Promise(function(e,n){var r=new XMLHttpRequest;r.open("GET",t),r.responseType="blob",r.setRequestHeader("X-Csrf-Token",window.mx.session.getCSRFToken()),r.onreadystatechange=function(t){4===r.readyState&&(r.status>=200&&r.status<300?e(r.response):n(r.response))},r.onerror=n,r.send()})}Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"FileBackend",function(){return p});var f=n(139),m=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),h=n(37),p=function(){function t(e){r(this,t),this._config=e,this._storageDirPromise=null}return m(t,[{key:"readFile",value:function(t){return this._openFilePath(t).then(function(t){return u(t)})}},{key:"storeFile",value:function(t,e){return this._openFilePath(e,!0).then(function(e){return a(e,t)})}},{key:"downloadFile",value:function(t,e){var r=this;return this._config.downloadFileFn?n.i(f.callbackToPromise)(this._config.downloadFileFn,t,e.replace(/^files\//,"")):l(h.getStaticResourceUrlFromPath(t)).then(function(t){return r.storeFile(t,e)})}},{key:"_getStorageDir",value:function(){return this._config.getStorageDirFn?n.i(f.callbackToPromise)(this._config.getStorageDirFn):(null===this._storageDirPromise&&(this._storageDirPromise=n.i(f.callbackToPromise)(window.webkitRequestFileSystem,window.TEMPORARY,1048576).then(function(t){return t.root})),this._storageDirPromise)}},{key:"_openFilePath",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=t.split("/"),r=n.pop();return n.reduce(function(t,n){return t.then(function(t){return i(t,n,e)})},this._getStorageDir()).then(function(t){return o(t,r,e)})}}]),t}()},552:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(null===t)return null;var r=window.mx.meta.getEntity(t.$objectType);return s.mapObject(t,function(t,i){return("guid"===i||!n.i(o.c)(i)&&r.isReference(i))&&null!=t?e(t):t})}Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"Synchronizer",function(){return f});var o=n(710),u=n(101),a=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),c=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),s=n(3),l=n(37),f=function(){function t(e,n,i,o){r(this,t),this._store=e,this._runtimeApi=n,this._fileBackend=i,this._objectCache=o,this._internalToExternal={}}return c(t,[{key:"upload",value:function(){var t,e,r,i,c,l,f,m,h,p,y,d,b,g,_,v,w,j=this;return regeneratorRuntime.async(function(E){for(;;)switch(E.prev=E.next){case 0:return w=function(r,i){return e.readFile(o.a+n.i(o.b)(r.guid)).then(function(e){return t.upload(i,r.Name,{},e,{},[])})},v=function(t,e){var r=window.mx.meta.getEntity(t.$objectType),i=Object.keys(t).filter(function(t){return!n.i(o.c)(t)&&r.isSyncable(t)}).map(function(i){var u=t[i];return[i,{value:r.isObjectReference(i)&&null!=u&&!n.i(o.d)(u)?e[u]:u}]});return[n.i(o.d)(t.guid)?t.guid:e[t.guid],s.objectFromArray(i)]},_=function(e){return t.instantiate(e.$objectType).then(function(t){var n=t.objects.find(function(e){return e.guid===t.actionResult});return{internalObj:e,remoteJson:n}})},g=function(t){var e=window.mx.meta.getEntity(t.$objectType);return s.arrayFromObject(t).filter(function(t){var r=a(t,2),i=r[0];r[1];return"guid"===i||!n.i(o.c)(i)&&e.isReference(i)})},b=function(t){var e=t.map(function(t){return t.guid}),r=s.unique(t.map(function(t){return g(t).map(function(t){var e=a(t,2);e[0];return e[1]})}).reduce(function(t,e){return t.concat(e)},[])),i=r.filter(function(t){return!n.i(o.d)(t)}).filter(function(t){return!e.includes(t)});if(i.length>0){var c=s.unique(t.map(function(t){return g(t).filter(function(t){var e=a(t,2),n=(e[0],e[1]);return i.includes(n)}).map(function(e){var n=a(e,2),r=n[0];n[1];return"object of type "+t.$objectType+" (reference "+r+")"})}).reduce(function(t,e){return t.concat(e)},[])).join(", "),l="Sync has failed due to a modeling error. Your database contains objects that reference uncommitted objects:\n"+c+".";throw new u.DanglingError(l)}},t=this._runtimeApi,e=this._fileBackend,E.next=9,regeneratorRuntime.awrap(this._store.fetchDirty());case 9:return r=E.sent,b(r),i=s.partition(function(t){return n.i(o.d)(t.guid)},r),c=a(i,2),l=c[0],f=c[1],E.next=14,regeneratorRuntime.awrap(Promise.all(f.map(_)));case 14:return m=E.sent,h=s.objectFromArray(m.map(function(t){var e=t.internalObj,n=t.remoteJson;return[e.guid,n.guid]})),p=m.map(function(t){return t.remoteJson}),y=l.map(function(t){return t.guid}).concat(m.map(function(t){return t.remoteJson.guid})),d=s.objectFromArray(r.map(function(t){return v(t,h)})),E.next=21,regeneratorRuntime.awrap(t.commit(y,null,d,p));case 21:return E.next=23,regeneratorRuntime.awrap(Promise.all(r.filter(function(t){return window.mx.meta.getEntity(t.$objectType).isA("System.FileDocument")}).filter(function(t){return t.HasContents}).map(function(t){return w(t,n.i(o.d)(t.guid)?t.guid:h[t.guid])})));case 23:return s.arrayFromObject(h).forEach(function(t){var e=a(t,2),n=e[0],r=e[1];return j._mapInternalGuid(n,r)}),E.next=26,regeneratorRuntime.awrap(this._store.cleanDatabase());case 26:return E.abrupt("return",{});case 27:case"end":return E.stop()}},null,this)}},{key:"downloadObjects",value:function(t){var e,n,r,i,u=this;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return i=function(t,n){return e.retrieveByXPath(n).then(function(e){return e.mxobjects.map(o.e).map(function(e){return Object.assign({},e,{$objectType:t})})})},e=this._runtimeApi,a.t0=s,a.next=5,regeneratorRuntime.awrap(Promise.all(t.map(function(t){return i(t.store,t.xpath)})));case 5:return a.t1=a.sent,n=a.t0.flatten.call(a.t0,a.t1),a.next=9,regeneratorRuntime.awrap(this._store.rebuildDatabase(n));case 9:return r=n.map(this.makeObjectExternal,this).filter(function(t){return u._objectCache.has(t.guid)}),this._objectCache.setMxObjects(r.map(o.f)),a.abrupt("return",{});case 12:case"end":return a.stop()}},null,this)}},{key:"downloadFiles",value:function(t){var e,r,i,u,c,f,m;return regeneratorRuntime.async(function(h){for(;;)switch(h.prev=h.next){case 0:return m=function(t,e){var i=l.getDynamicResourcePath(t.guid,t.changedDate,e),u=(e?o.g:o.a)+n.i(o.b)(t.guid);return r.downloadFile(i,u)},f=function(t){return e.getSlice(t,[{attribute:"HasContents",operator:"equals",value:"true"}]).then(function(t){var e=a(t,2),n=e[0];e[1];return n})},e=this._store,r=this._fileBackend,h.t0=s,h.next=7,regeneratorRuntime.awrap(Promise.all(t.map(function(t){return f(t)})));case 7:return h.t1=h.sent,i=h.t0.flatten.call(h.t0,h.t1),u=i.map(function(t){return m(t,!1)}),c=i.filter(function(t){return window.mx.meta.getEntity(t.$objectType).isA("System.Image")}).map(function(t){return m(t,!0)}),h.next=13,regeneratorRuntime.awrap(Promise.all(u.concat(c)));case 13:return h.abrupt("return",{});case 14:case"end":return h.stop()}},null,this)}},{key:"getExternalGuid",value:function(t){return this._internalToExternal[t]||t}},{key:"getInternalGuid",value:function(t){for(var e in this._internalToExternal)if(this._internalToExternal[e]===t)return e;return t}},{key:"makeObjectExternal",value:function(t){return i(t,this.getExternalGuid.bind(this))}},{key:"makeObjectInternal",value:function(t){return i(t,this.getInternalGuid.bind(this))}},{key:"_mapInternalGuid",value:function(t,e){this._internalToExternal[e]=t}}]),t}()},553:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function o(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function u(t){return n.i(s.e)(t.jsonData)}function a(t,e){var n={guid:t,objectType:e,attributes:{}},r=window.mx.meta.getEntity(e);return r.getAttributes().forEach(function(t){n.attributes[t]={value:y[r.getAttributeType(t)]}}),n}function c(t,e,n){var r=n?"thumbnails":"documents";return"filesystem:"+window.mx.appUrl+"temporary/files/"+r+"/"+t+"?"+ +new Date}Object.defineProperty(e,"__esModule",{value:!0}),n.d(e,"OfflineDataBackend",function(){return d});var s=n(710),l=n(79),f=(n.n(l),n(229)),m=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),p=n(3),y={String:null,Integer:"0",Long:"0",Decimal:"0",Float:"0",Currency:"0",Enum:null,HashString:null,ObjectReference:null,DateTime:null,Boolean:!1,AutoNumber:"0",Binary:null},d=function(t){function e(t,n,o,u,a){r(this,e);var s=i(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t=t||{},s._store=o,s._getDocumentUrl=t.getDocumentUrlFn||c,s._objectCache=n,s._fileBackend=u,s._synchronizer=a,s}return o(e,t),h(e,[{key:"getByGuid",value:function(t,e){return Promise.all(t.map(this._getByGuid,this)).then(function(t){return{mxobjects:t.filter(function(t){return null!=t}).map(s.f)}})}},{key:"getSlice",value:function(t,e,n){var r=this,i=window.mx.meta.getEntity(t),o=(e||[]).map(function(t){return i.isReference(t.attribute)?(t.value=r._synchronizer.getInternalGuid(t.value),t):t});return this._store.getSlice(t,o,n).then(function(t){var e=m(t,2),n=e[0],i=e[1];return{mxobjects:n.map(r._synchronizer.makeObjectExternal,r._synchronizer).map(s.f),count:i}})}},{key:"create",value:function(t){var e=n.i(s.h)();return this._objectCache.onCreate([e]),this._objectCache.setMxObjects([a(e,t)]),Promise.resolve({actionResult:e})}},{key:"commit",value:function(t,e){function n(t){return Object.assign({},t,p.mapObject(o[t.guid],function(t){return t.value}))}function r(t){var e={};return Object.keys(t).forEach(function(n){e[n]=Object.keys(t[n])}),e}var i=this,o=p.objectFromArray(t.map(function(t){return[t,p.clone(i._objectCache.getChanges(t))]})),a=p.partition(function(t){return i._objectCache.has(t)},t),c=m(a,2),l=c[0],f=c[1],h=l.map(function(t){return i._objectCache.getObject(t)}).map(u);return Promise.all(f.map(this._getByGuid,this)).then(function(t){var e=t.concat(h).map(n);return i._store.insertOrReplace(e.map(i._synchronizer.makeObjectInternal,i._synchronizer)).then(function(){return e})}).then(function(t){i._objectCache.onCommit(t.map(function(t){return t.guid})),i._objectCache.setMxObjects(t.map(s.f)),i._objectCache.removeChanges(r(o))}).then(function(){return{}})}},{key:"rollback",value:function(t){var e=this;this._objectCache.removeAllChanges(t);var n=t.filter(function(t){return e._objectCache.isNew(t)});return this._objectCache.removeObjects(n),Promise.resolve({})}},{key:"validate",value:function(t){return Promise.resolve({})}},{key:"saveDocument",value:function(t,e,r,i){var o=this;if(i.size/1048576>r.maxFileSize)return Promise.reject(new l.DescribedError("File too large"));var u=n.i(s.b)(this._synchronizer.getInternalGuid(t));return this._fileBackend.storeFile(i,s.a+u).then(function(){return o._objectCache.makeChange(t,"HasContents",!0),o.commit([t],null)})}},{key:"getDocumentUrl",value:function(t,e,r){return this._getDocumentUrl(n.i(s.b)(this._synchronizer.getInternalGuid(t)),e,r)}},{key:"getImageUrl",value:function(t){return Promise.resolve(t)}},{key:"upload",value:function(){return this._synchronizer.upload()}},{key:"downloadObjects",value:function(t){return this._synchronizer.downloadObjects(t)}},{key:"downloadFiles",value:function(t){return this._synchronizer.downloadFiles(t)}},{key:"cleanupDirtyObjects",value:function(){return this._store.cleanupDirtyObjects()}},{key:"isDirty",value:function(t){return!n.i(s.d)(this._synchronizer.getInternalGuid(t))}},{key:"_getByGuid",value:function(t){var e=this;return this._store.getByGuid(this._synchronizer.getInternalGuid(t)).then(function(t){return e._synchronizer.makeObjectExternal(t)})}}]),e}(f.a)},554:function(t,e,n){function r(){return window.openDatabase("MendixDatabase","1","Mendix Database",10485760)}function i(t,e){a.call(this),e=e||r,this._tableNames=t,this._db=e(),this._initialize()(this._db)}var o=n(751),u=n(750),a=n(745),c=n(690),s=n(227);i.prototype=Object.create(a.prototype),i.prototype._getDatabase=function(){return this._databasePromise},i.prototype._initialize=function(){return function(t){var e=o.createCreateTransaction(this._tableNames);return this._databasePromise=s.promiseFromTask(u.runWriteTransaction(t,e)).then(function(){return t}),this._databasePromise}.bind(this)},i.prototype._fetch=function(t){return function(e){var n=o.createFetchByGuidTransaction(t);return s.promiseFromTask(u.runReadTransaction(e,n))}},i.prototype._fetchSlice=function(t,e,n){return function(r){var i=o.createFetchSliceTransaction(t,e,n.offset,n.limit,n.sort);return s.promiseFromTask(u.runReadTransaction(r,i))}},i.prototype._rebuildDb=function(t){return c.ask().chain(function(e){var n=o.createRebuildTransaction(this._tableNames,t);return new c(function(t){return u.runWriteTransaction(e,n)})}.bind(this))},i.prototype._insertOrReplace=function(t){return function(e){var n=o.createInsertOrReplaceTransaction(t);return s.promiseFromTask(u.runWriteTransaction(e,n))}},i.prototype._cleanDatabase=function(){var t=this;return function(e){var n=o.createCleanTransaction(t._tableNames);return s.promiseFromTask(u.runWriteTransaction(e,n))}},i.prototype._fetchDirty=function(){return c.ask().chain(function(t){var e=o.createFetchDirtyObjectsTransaction();return new c(function(n){return u.runWriteTransaction(t,e)})})},i.prototype._cleanupDirtyObjects=function(){return function(t){var e=o.createDirtyCleanupTransaction();return s.promiseFromTask(u.runWriteTransaction(t,e))}},t.exports=i},684:function(t,e){t.exports={LIKE_ESCAPE_CHAR:"~",QUOTE_CHAR:'"'}},690:function(t,e,n){var r=n(744),i=n(135),o=new r(i);o.rejected=function(t){return new o(function(e){return i.rejected(t)})},t.exports=o},710:function(t,e,n){"use strict";function r(t){return t.replace(/:/g,"_")}function i(){return m+s.getUniqueId()}function o(t){return!h.test(t)}function u(t){return"guid"===t||"$"===t[0]}function a(t){var e=Object.keys(t).filter(function(t){return!u(t)}).reduce(function(e,n){return e[n]={value:t[n]},t.$dirty||(e[n].readonly=!window.dojoConfig.allowEditing),e},{});return{guid:t.guid,objectType:t.$objectType,attributes:e}}function c(t){var e={guid:t.guid,$objectType:t.objectType};for(var n in t.attributes)e[n]=t.attributes[n].value;return e}n.d(e,"a",function(){return l}),n.d(e,"g",function(){return f}),e.b=r,e.h=i,e.d=o,e.c=u,e.f=a,e.e=c;var s=n(3),l="files/documents/",f="files/thumbnails/",m="GUID:",h=new RegExp("^"+m)},744:function(t,e){function n(t){function e(t){this.run=t}return e.prototype.chain=function(t){return new e(function(e){return this.run(e).chain(function(n){return t(n).run(e)})}.bind(this))},e.prototype.ap=function(t){return new e(function(e){return this.run(e).ap(t.run(e))}.bind(this))},e.prototype.map=function(t){return this.chain(function(n){return e.of(t(n))})},e.of=function(n){return new e(function(e){return t.of(n)})},e.ask=function(){return new e(t.of)},e}t.exports=n},745:function(t,e,n){function r(){}var i=n(227),o=n(690);r.prototype.getSlice=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._getDatabase().then(this._fetchSlice(t,e,n))},r.prototype.getByGuid=function(t){return this._getDatabase().then(this._fetch(t))},r.prototype.insertOrReplace=function(t){return this._getDatabase().then(this._insertOrReplace(t))},r.prototype.cleanDatabase=function(){return this._getDatabase().then(this._cleanDatabase())},r.prototype.rebuildDatabase=function(t){var e=this;return this._getDatabase().then(function(n){return i.promiseFromTask(e._rebuildDb(t).run(n))})},r.prototype.fetchDirty=function(){var t=this;return this._getDatabase().then(function(e){return i.promiseFromTask(t._fetchDirty().run(e))})},r.prototype.cleanupDirtyObjects=function(){return this._getDatabase().then(this._cleanupDirtyObjects())},r.prototype._getDatabase=function(){return Promise.reject(new Error("not implemented"))},r.prototype._initialize=function(){return Promise.reject(new Error("not implemented"))},r.prototype._fetch=function(t){return function(t){return Promise.reject(new Error("not implemented"))}},r.prototype._fetchSlice=function(t,e,n){return function(t){return Promise.reject(new Error("not implemented"))}},r.prototype._insertOrReplace=function(t){return function(t){return Promise.reject(new Error("not implemented"))}},r.prototype._cleanDatabase=function(){return function(t){return Promise.reject(new Error("not implemented"))}},r.prototype._rebuildDb=function(t){return o.rejected(new Error("not implemented"))},r.prototype._fetchDirty=function(){return o.rejected(new Error("not implemented"))},r.prototype._cleanupDirtyObjects=function(){return function(t){return Promise.reject(new Error("not implemented"))}},t.exports=r},746:function(t,e){function n(t){if(!(this instanceof n))return new n(t);this._column=t instanceof n?t._column:t}n.prototype.apply1=function(t){return new n(t+"("+this._column+")")},n.prototype.toString=function(){return this._column},t.exports=n},747:function(t,e,n){function r(t,e){this._tableName=e&&e.tableName||t&&t._tableName||null,this._columns=e&&e.columns||t&&t._columns||[]}function i(t){var e=o.QUOTE_CHAR;return e+t+e}var o=n(684);r.prototype.table=function(t){return new r(this,{tableName:t})},r.prototype.column=function(t,e){return new r(this,{columns:this._columns.concat({columnName:t,columnType:e,isPrimary:!1})})},r.prototype.primaryKeyColumn=function(t,e){return new r(this,{columns:this._columns.concat({columnName:t,columnType:e,isPrimary:!0})})},r.prototype.createIfNotExists=function(){var t="";return t+="CREATE TABLE IF NOT EXISTS "+i(this._tableName),t+=this._buildSql()},r.prototype._buildSql=function(){var t="";return this._columns.length>0&&(t+=" (",t+=this._columns.map(function(t){return[i(t.columnName),t.columnType,t.isPrimary?"PRIMARY KEY ":""].join(" ").slice(0,-1)},this).join(", "),t+=")"),t},t.exports=r},748:function(t,e,n){function r(t,e){if(!(this instanceof r))return new r;this._tableName=e&&e.tableName||t&&t._tableName||null,this._columnNames=e&&e.columnNames||t&&t._columnNames||[]}function i(t){var e=o.QUOTE_CHAR;return e+t+e}var o=n(684);r.prototype.into=function(t){return new r(this,{tableName:t})},r.prototype.column=function(t){return new r(this,{columnNames:this._columnNames.concat(t)})},r.prototype.insert=function(){var t="";return t+="INSERT INTO "+i(this._tableName),t+=this._buildSql()},r.prototype.insertOrReplace=function(){var t="";return t+="INSERT OR REPLACE INTO "+i(this._tableName),t+=this._buildSql()},r.prototype._buildSql=function(){var t="";return this._columnNames.length>0&&(t+=" (",t+=this._columnNames.map(i).join(", "),t+=")"),t+=" VALUES (",t+="?"+new Array(this._columnNames.length).join(", ?"),t+=")"},t.exports=r},749:function(t,e,n){function r(t,e){this._select=e&&e.select||t&&t._select||null,this._from=e&&e.from||t&&t._from||{},this._join=e&&e.join||t&&t._join||null,this._constraints=e&&e.constraints||t&&t._constraints||[],this._orderBy=e&&e.orderBy||t&&t._orderBy||[],this._limit=e&&e.limit||t&&t._limit||null,this._offset=e&&e.offset||t&&t._offset||null}function i(t,e){this._column=t,this._negate=!!e}function o(t,e,n){this._column=t,this._operator=e,this._negate=!!n}function u(t){return function(e){return e+" "+t+" ?"}}function a(t){var e="";return e+=t,e+=" LIKE '%' || ? || '%'",e+=" ESCAPE '"+c.LIKE_ESCAPE_CHAR+"'"}var c=n(684),s={equals:u("="),lessThan:u("<"),lessThanOrEquals:u("<="),greaterThan:u(">"),greaterThanOrEquals:u(">="),contains:a};r.prototype.from=function(t,e){return new r(this,{from:{name:t,alias:e}})},r.prototype.join=function(t,e,n){return new r(this,{join:{tableName:t,alias:e,columnName:n}})},r.prototype.where=function(t,e){return this._where(t,!1,e)},r.prototype.whereNot=function(t,e){return this._where(t,!0,e)},r.prototype.whereNull=function(t,e){return this._whereNull(t,!1,e)},r.prototype.whereNotNull=function(t,e){return this._whereNull(t,!0,e)},r.prototype.order=function(t,e){return new r(this,{orderBy:this._orderBy.concat([[t,e]])})},r.prototype.limit=function(t){return new r(this,{limit:t})},r.prototype.offset=function(t){return new r(this,{offset:t})},r.prototype.selectDistinct=function(t){return Array.isArray(t)&&(t=t.join(", ")),"SELECT DISTINCT "+t+this._buildSql()},r.prototype.select=function(t,e){Array.isArray(t)&&(t=t.join(", "));var n="SELECT "+t;return e&&(n+=" AS "+e),n+=this._buildSql()},r.prototype._where=function(t,e,n){return new r(this,{constraints:this._constraints.concat([new o(t,n,e)])})},r.prototype._whereNull=function(t,e){return new r(this,{constraints:this._constraints.concat([new i(t,e)])})},r.prototype._buildSql=function(){var t="";return t+=" FROM "+this._from.name,this._from.alias&&(t+=" AS "+this._from.alias),this._join&&(t+=" JOIN "+this._join.tableName+" AS "+this._join.alias+" USING ("+this._join.columnName+")"),this._constraints.length>0&&(t+=" WHERE "+this._constraints.map(function(t){return t.toString()}).join(" AND ")),this._orderBy.length>0&&(t+=" ORDER BY "+this._orderBy.map(function(t){return t[0]+" "+t[1]}).join(", ")),this._limit&&(t+=" LIMIT "+this._limit),this._offset&&(t+=" OFFSET "+this._offset),t},i.prototype.toString=function(){return this._column+" IS "+(this._negate?"NOT ":"")+"NULL"},o.prototype.toString=function(){var t=s[this._operator];return(this._negate?"NOT ":"")+t(this._column)},t.exports=r},750:function(t,e,n){function r(t){return function(e,n){return new i(function(r,i){var o,u=2;e[t](function(t){n.run(t).fork(r,function(t){o=t,0==--u&&i(o)})},r,function(){0==--u&&i(o)})})}}var i=n(135);t.exports={runReadTransaction:r("readTransaction"),runWriteTransaction:r("transaction")}},751:function(t,e,n){function r(t){var e=[I].concat(t).map(v).map(function(t){return"DROP TABLE IF EXISTS '"+t+"'"}).map(function(t){return E(t,[])});return S.sequence([N.sequence(e,A),i(t)],A)}function i(t){function e(t){return E(n(t).reduce(function(t,e){return t.column(v(e.attr),e.type)},(new D).table(v(t)).primaryKeyColumn("guid","text")).createIfNotExists(),[])}function n(t){var e=window.mx.meta.getEntity(t);return e.getAttributes().map(function(t){var n=e.getAttributeType(t);return{attr:t,type:B[n]}})}var r=[c()].concat(t.map(e));return N.sequence(r,A)}function o(t,e){var n=e.reduce(function(e,n){var r=s(),i=f(t,n);return e.concat([E(r.insert(),[n.guid,t,0]),E(i.builder.insert(),i.values)])},[]);return N.sequence(n,A)}function u(t){var e=t.$objectType,n=s(),r=f(e,t);return N.sequence_([E(n.insertOrReplace(),[t.guid,e,1]),E(r.builder.insertOrReplace(),r.values)],A)}function a(){return E((new O).from(I).where("dirty","equals").selectDistinct("tableName"),[1])}function c(){return E((new D).table(I).primaryKeyColumn("guid","text").column("tableName","text").column("dirty","boolean").createIfNotExists(),[])}function s(){return(new R).into(I).column("guid").column("tableName").column("dirty")}function l(t,e){return e.reduce(function(e,n){var r=t.getAttributeType(n.attribute),i=null==n.value,o=G[r],u=q[r],a=u(o(n.value));if(i&&"equals"===n.operator){return{builder:(n.negate?e.builder.whereNotNull:e.builder.whereNull).call(e.builder,v(n.attribute)),args:e.args}}if(i&&"contains"===n.operator)return e;var c=n.negate?e.builder.whereNot:e.builder.where,s="contains"===n.operator?_(a):a;return{builder:c.call(e.builder,v(n.attribute),n.operator),args:e.args.concat([s])}},{builder:new O,args:[]})}function f(t,e){var n=window.mx.meta.getEntity(t),r=n.getAttributes(),i=r.reduce(function(t,r){var i=n.getAttributeType(r),o=q[i];if(!o)return t;var u=o(e[r]);return{attrs:t.attrs.concat([r]),values:t.values.concat([u])}},{attrs:["guid"],values:[e.guid]});return{builder:i.attrs.reduce(function(t,e){return t.column(v(e))},(new R).into(v(t))),values:i.values}}function m(t){if(null==t)return null;var e=new P(t),n=20-Math.max(0,e.e)-1;return(e.s<0?"-":"")+new Array(n+1).join("0")+e.abs().toFixed()}function h(t){return null!=t?String(t):null}function p(t){return null!=t?Number(t):null}function y(t){return"false"!==t}function d(t){return t?Number(t):null}function b(t){return t}function g(t){for(var e=[],n=0;n<t.length;++n)e.push(t.item(n));return e}function _(t){var e=T.LIKE_ESCAPE_CHAR;return t.replace(new RegExp(e,"g"),e+e).replace(/%/g,e+"%").replace(/_/g,e+"_")}function v(t){return t.replace(".","$")}function w(t){return t.replace("$",".")}function j(t,e,n){var r={guid:n.guid,$objectType:t.getEntity(),$dirty:e};for(var i in n){var o=w(i);if("guid"!==o){var u=t.getAttributeType(o),a=L[u];a&&(r[o]=a(n[i]))}}return r}function E(t,e){return e=e||[],new A(function(n){return new F(function(r,i){n.executeSql(t,e,function(t,e){return i(e)},function(t,e){return r(e)})})})}var T=n(684),O=n(749),D=n(747),x=n(746),R=n(748),N=n(228),S=n(230),k=n(690),F=n(135),P=n(32),C=n(3),A=k,I="_guidToTable",B={String:"text",Integer:"text",Long:"text",Decimal:"text",Float:"text",Currency:"text",Enum:"text",HashString:"text",ObjectReference:"text",DateTime:"integer",Boolean:"integer",AutoNumber:"integer",Binary:"blob"},q={String:h,Integer:m,Long:m,Decimal:m,Float:m,Currency:m,Enum:h,HashString:h,ObjectReference:h,DateTime:p,Boolean:Number,AutoNumber:h,Binary:h},L={String:h,Integer:h,Long:h,Decimal:h,Float:h,Currency:h,Enum:h,HashString:h,ObjectReference:h,DateTime:b,Boolean:Boolean,AutoNumber:h,Binary:h},G={String:b,Integer:b,Long:b,Decimal:b,Float:b,Currency:b,Enum:b,HashString:b,ObjectReference:b,DateTime:d,Boolean:y,AutoNumber:b,Binary:b},H={String:"UPPER",Enum:"UPPER"},z={createCreateTransaction:i,createCleanTransaction:function(t){var e=[I].concat(t).map(v).map(function(t){return"DELETE FROM '"+t+"'"}).map(function(t){return E(t,[])});return N.sequence_(e,A)},createFetchByGuidTransaction:function(t){return E((new O).from(I).where("guid","equals").select("*"),[t]).chain(function(e){if(0===e.rows.length)return A.of(null);if(1!==e.rows.length)return A.rejected(new Error("db consistency error"));var n=e.rows.item(0),r=n.tableName,i=Boolean(n.dirty);return E((new O).from(v(r)).where("guid","equals").select("*"),[t]).map(function(t){return 0===t.rows.length?F.rejected(new Error("entity not found")):1!==t.rows.length?F.rejected(new Error("db consistency error")):j(window.mx.meta.getEntity(r),i,t.rows.item(0))})})},createFetchSliceTransaction:function(t,e,n,r,i){e=e||[],i=i||[];var o=window.mx.meta.getEntity(t),u=l(o,e),a=u.builder.from(v(t)),c=u.args,s=i.reduce(function(t,e){var n=o.getAttributeType(e[0]),r=new x(e[0]),i=H[n];return i&&(r=r.apply1(i)),t.order(r,e[1])},a.offset(n).limit(r).join(I,I,"guid")),f=E(s.select("*"),c).map(function(t){for(var e=[],n=0;n<t.rows.length;++n)!function(n){var r=t.rows.item(n),i={},u=Boolean(r[I+".dirty"]);Object.keys(r).filter(function(t){return!C.startsWith(t,I+".")}).forEach(function(t){i[t]=r[t]}),e.push(j(o,u,i))}(n);return e}),m=E(a.select("COUNT(*)","cnt"),c).map(function(t){return t.rows.item(0).cnt});return N.lift2(function(t,e){return[t,e]},f,m)},createInsertOrReplaceTransaction:function(t){return N.sequence_(t.map(u),A)},createFillBulkTransaction:o,createFetchDirtyObjectsTransaction:function(){return a().chain(function(t){var e=g(t.rows).map(function(t){var e=t.tableName,n=window.mx.meta.getEntity(e);return E("SELECT * FROM "+v(e)+" WHERE guid IN\n                                    (SELECT guid FROM "+I+" WHERE tableName = ? AND dirty = 1)",[e]).map(function(t){return g(t.rows).map(function(t){return j(n,!0,t)})})});return N.sequence(e,A)}).map(function(t){return t.reduce(function(t,e){return t.concat(e)},[])})},createDirtyCleanupTransaction:function(){return a().chain(function(t){var e=g(t.rows).map(function(t){var e=t.tableName;return E("DELETE FROM "+v(e)+" WHERE guid IN (\n                            SELECT guid FROM "+I+" WHERE tableName = ? AND dirty = 1)",[e])});return S.sequence_([N.sequence(e,A),E("DELETE FROM "+I+" WHERE dirty = 1")],A)})},createRebuildTransaction:function(t,e){var n=r(t),i=t.map(function(t){var n=e.filter(function(e){return e.$objectType===t});return o(t,n)});return S.sequence([n,N.sequence(i,A)],A)}};t.exports=z}});