
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/sys/Parser",["mendix/logger","big/big","dojo/i18n","dojo/date/locale","dojo/_base/lang"],function(_1,_2,_3,_4,_5){_2.RM=2;var _6="mxui.sys.Parser";var _7=function(_8,_9){_8.setFullYear(_9.getFullYear(),_9.getMonth(),_9.getDate());};var _a=function(_b,_c){_b.setHours(_c.getHours(),_c.getMinutes(),_c.getSeconds(),_c.getMilliseconds());};var _d=function(_e,_f,_10){return _10.dateLocale.format(new _10.Date(_e),_f);};var _11=function(_12,_13,_14){var _15=_14.dateLocale.parse(_12,_13);if(_15&&_15.toGregorian){_15=_15.toGregorian();}if(!_15){if(_12.indexOf("‚Äè")==-1){if(!_13.datePattern){_13.datePattern=_14.datePattern;}_13.datePattern=_13.datePattern.replace(/\u200f/g,"");_15=_4.parse(_12,_13);}}return _15;};function _16(_17,_18){return new Array(_18+1).join(_17);};function _19(str,_1a,_1b){return str.length<_1b?str+_16(_1a,_1b-str.length):str;};function _1c(_1d){var _1e=_3.getLocalization("dojo.cldr","number",_1d),_1f=_4._getGregorianBundle(_1d),_20={name:_1d,decimalSeparator:_1e.decimal,groupSeparator:_1e.group,groupSize:3,datePattern:_1f["dateFormat-short"]};var _21="\\d+"+"|"+"\\d"+_16("\\d?",_20.groupSize-1)+"(?:\\"+_20.groupSeparator+_16("\\d",_20.groupSize)+")*",_22="\\"+_20.decimalSeparator+"\\d+",_23="^"+"(-)?"+"("+_21+")"+"("+_22+")?"+"$";_20.numberPattern=new RegExp(_23);var _24=_5.getObject(window.mx.ui.getDatePackage());_20.dateLocale=_24.locale||_4;_20.Date=_24.Date||Date;return _20;};function _25(_26,_27,_28,_29){var _2a=_28>=0?_26.round(_28):_26,_2b=_2a.lt(0),_2c=_2a.toFixed().split("."),_2d=_2b?_2c[0].slice(1):_2c[0],_2e=_2c[1],_2f=_2d,_30=_2e;if(_28>=0){_30=_19(_2e||"","0",_28);}if(_27){var i=_2d.length%_29.groupSize||_29.groupSize;_2f=_2d.substr(0,i);for(;i<_2d.length;i+=_29.groupSize){_2f+=_29.groupSeparator+_2d.substr(i,_29.groupSize);}}return (_2b?"-":"")+_2f+(_30?_29.decimalSeparator+_30:"");};function _31(_32,_33,_34){var _35=_34.numberPattern.exec(_32);if(!_35){return null;}var _36=new _2(_32.split(_34.groupSeparator).join("").split(_34.decimalSeparator).join("."));return _33>=0?_36.round(_33):_36;};function _37(){var _38=this,_39;this.toString=function(){return _6;};this.startup=function(){_39=_1c(window.dojo.locale);};this.parseDate=function(_3a,_3b){if(!_3a){return null;}_3b=_3b||{};var _3c={selector:_3b.selector||"date",formatLength:_3b.format||"short",datePattern:_3b.datepattern||_3b.datePattern,timePattern:_3b.timePattern};var _3d=_11(_3a,_3c,_39);if(_3d){if(_3c.selector=="time"){var now=new Date();now.setMilliseconds(_3d.getMilliseconds());now.setSeconds(_3d.getSeconds());now.setMinutes(_3d.getMinutes());now.setHours(_3d.getHours());return +now;}}return _3d&&_3d.getTime();};this.formatDate=function(_3e,_3f){var _40=Number(_3e);if(_3e===""){return _3e;}else{if(isNaN(_40)){return null;}}_3f=_3f||{};var _41=new Date(_40),_42={locale:_39.name,selector:_3f.selector||"date",formatLength:_3f.format||"short",datePattern:_3f.datepattern||_3f.datePattern,timePattern:_3f.timePattern};if(_42.selector=="time"){var now=new Date(0);now.setMilliseconds(_41.getMilliseconds());now.setSeconds(_41.getSeconds());now.setMinutes(_41.getMinutes());now.setHours(_41.getHours());_41=now;}return _d(_41,_42,_39);};this.formatValue=function(_43,_44,_45){_45=_45||{};if(_43===""){return "";}switch(_44.toLowerCase()){case "float":return _25(new _2(_43),!!_45.groups,"places" in _45&&_45.places>=0?_45.places:-1,_39);case "currency":return _25(new _2(_43),!!_45.groups,"places" in _45&&_45.places>=0?_45.places:2,_39);case "autonumber":case "integer":case "long":return _25(new _2(_43),!!_45.groups,_45.places||0,_39);case "datetime":return _d(new Date(_43),_5.mixin({selector:"date"},_45),_39);case "boolean":return mx.ui.translate("mxui.common",_43);default:return _43;}};this.formatAttribute=function(obj,_46,_47){var _48=obj.getAttributeType(_46),_49=obj.get(_46);if(_48=="Enum"){_49=obj.getEnumCaption(_46,_49);}return _38.formatValue(_49,_48,_47);};this.parseValue=function(_4a,_4b,_4c){_4c=_4c||{};if(_4a===""){return "";}switch(_4b.toLowerCase()){case "float":case "currency":case "autonumber":case "integer":case "long":var big=_31(_4a,_4c.places,_39);return big!==null?Number(big):NaN;case "datetime":return _11(_4a,_5.mixin({selector:"date"},_4c),_39);case "enum":return _4a;case "boolean":return _4a==mx.ui.translate("mxui.common",true);default:return _4a;}};this.localizeEpoch=function(_4d){var obj=new Date(Number(_4d));return new Date(obj.getUTCFullYear(),obj.getUTCMonth(),obj.getUTCDate(),obj.getUTCHours(),obj.getUTCMinutes(),obj.getUTCSeconds(),obj.getUTCMilliseconds()).getTime();};this.delocalizeEpoch=function(_4e){var obj=new Date(Number(_4e));return Date.UTC(obj.getFullYear(),obj.getMonth(),obj.getDate(),obj.getHours(),obj.getMinutes(),obj.getSeconds(),obj.getMilliseconds());};this.mergeDates=function(_4f,_50,_51){var _52=new Date(_4f);switch(_51){case "date":_7(_52,_50);break;case "time":_a(_52,_50);break;case "datetime":_7(_52,_50);_a(_52,_50);break;default:_52=_50;}return _52;};this.replaceXPathTokens=function(_53,_54){if(_54&&_54.hasTrackId()){_53=_53.replace(/\[%CurrentObject%\]/g,_54.getTrackId());}else{if(/\[%CurrentObject%\]/.test(_53)){}}return _53;};};return _37;});