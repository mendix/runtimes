/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/sys/Router",["mxui/lib/form/ContentForm","mxui/lib/form/FormFactory","mxui/lib/pageTemplating/TemplateProvider","mxui/lib/browserBackend","mxui/sys/history","mendix/lib/Error","mendix/lib/MxContext","mendix/lib/NavigationError","mendix/lang","mendix/logger","dojo/_base/array","dojo/aspect"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c){function _d(){this._templateProvider=new _3();this._contentForm=new _1();this._formFactory=new _2(this._templateProvider);};_d.prototype.startup=function(_e){var _f=this,_10=null,_11=null,_12={};_5.init();var _13=document.getElementById("content");if(!_13){alert("You are using an outdated index page. Please update your index page. See index-example.html in the deployment directory for an example of what the index page should look like.");return;}_13.appendChild(this._contentForm.domNode);document.title=_e.profile;this._contentForm.listen("close",function(_14){_5.back();if(_14){_14();}});_c.after(this._contentForm,"onLoading",function(){_f._templateProvider.add(_f._contentForm.widgetTemplates);});_c.after(this._contentForm,"onNavigation",function(){var _15=_e.profile+" - "+_f._contentForm.title;var url=_f._contentForm.url?_e.urlPrefix+_f._contentForm.url:_4.location.pathname();_5.replace(_15,url+_4.location.search());});_c.after(_5,"onNavigation",_16,true);function _16(_17,_18){var _19=_18.formParams,_1a;if(!_10){_10=window.mx.ui.showProgress();}if(_17){_1a={};_f._contentForm.onPersistViewState(_1a);}_f._contentForm.navigateTo(_19.path,_19.title,_7.fromJSON(_19.context),_19.params,_18.id in _12?window.JSON.parse(_12[_18.id]):{},function(){_1b();window.mx.ui.hideProgress(_10);_10=null;},function(e){_1b();if(e instanceof _8){_11=_18.id;}else{window.mx.ui.hideProgress(_10);_10=null;window.mx.onError(e);}});function _1b(){if(!_17){return;}if(_17.id===_11){_11=null;}else{try{_12[_17.id]=window.JSON.stringify(_1a);}catch(e){throw new _6("One of the widgets on the previous page tried to store a complex object in its viewState");}}};};};_d.prototype.openFormInContent=function(_1c,_1d,_1e,_1f,_20){_5.push({id:_9.getUniqueId(),formParams:{path:_1c,title:_1d,context:(_1e||new _7()).toJSON(),params:_1f||{}}});if(_20){_20();}};_d.prototype.openFormInPopup=function(_21,_22,_23,_24,_25,_26){var pid=window.mx.ui.showProgress();this._formFactory.openPopupForm(_21,_22,(_23||new _7()),(_24||{}),function(_27){window.mx.ui.hideProgress(pid);_25&&_25(_27);},function(e){window.mx.ui.hideProgress(pid);_26?_26(e):window.mx.onError(e);});};_d.prototype.openFormInNode=function(_28,_29,_2a,_2b,_2c,_2d){var pid=window.mx.ui.showProgress();this._formFactory.openInlineForm(_28,_29,(_2a||new _7()),(_2b||{}),function(_2e){window.mx.ui.hideProgress(pid);_2c&&_2c(_2e);},function(e){window.mx.ui.hideProgress(pid);_2d?_2d(e):window.mx.onError(e);});};_d.prototype.getTemplate=function(id,_2f){return this._templateProvider.get(id,_2f);};_d.prototype.getContentForm=function(){return this._contentForm;};return _d;});