/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/sys/Router",["mxui/lib/form/ContentForm","mxui/lib/form/FormFactory","mxui/lib/pageTemplating/TemplateProvider","mxui/sys/history","mendix/lib/Error","mendix/lib/MxContext","mendix/lib/NavigationError","mendix/lang","mendix/logger","dojo/_base/array","dojo/aspect"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b){function _c(_d){this._templateProvider=new _3();this._contentForm=new _1();this._formFactory=new _2(this._templateProvider);var _e=this,_f=null,_10=null,_11={};_4.init();var _12=document.getElementById("content");if(!_12){alert("You are using an outdated index page. Please update your index page. See index-example.html in the deployment directory for an example of what the index page should look like.");return;}_12.appendChild(this._contentForm.domNode);document.title=_d.profile;_b.after(this._contentForm,"dispose",_4.back);_b.after(this._contentForm,"onLoading",function(){_e._templateProvider.add(_e._contentForm.widgetTemplates);});_b.after(this._contentForm,"onNavigation",function(){document.title=_d.profile+" - "+_e._contentForm.title;});_b.after(_4,"onNavigation",function(_13,_14){var _15=_14.formParams,_16;if(!_f){_f=window.mx.ui.showProgress();}if(_13){_16={};_e._contentForm.onPersistViewState(_16);}_e._contentForm.navigateTo(_15.path,_15.title,_6.fromJSON(_15.context),_15.params,_14.id in _11?window.JSON.parse(_11[_14.id]):{},function(){_17();window.mx.ui.hideProgress(_f);_f=null;},function(e){_17();if(e instanceof _7){_10=_14.id;}else{window.mx.ui.hideProgress(_f);_f=null;window.mx.onError(e);}});function _17(){if(!_13){return;}if(_13.id===_10){_10=null;}else{try{_11[_13.id]=window.JSON.stringify(_16);}catch(e){throw new _5("One of the widgets on the previous page tried to store a complex object in its viewState");}}};},true);};_c.prototype.openFormInContent=function(_18,_19,_1a,_1b){_4.push({id:_8.getUniqueId(),formParams:{path:_18,title:_19,context:(_1a||new _6()).toJSON(),params:_1b||{}}});};_c.prototype.openFormInPopup=function(_1c,_1d,_1e,_1f,_20,_21){var pid=window.mx.ui.showProgress();this._formFactory.openPopupForm(_1c,_1d,(_1e||new _6()),(_1f||{}),function(_22){window.mx.ui.hideProgress(pid);_20&&_20(_22);},function(e){window.mx.ui.hideProgress(pid);_21?_21(e):window.mx.onError(e);});};_c.prototype.openFormInNode=function(_23,_24,_25,_26,_27,_28){var pid=window.mx.ui.showProgress();this._formFactory.openInlineForm(_23,_24,(_25||new _6()),(_26||{}),function(_29){window.mx.ui.hideProgress(pid);_27&&_27(_29);},function(e){window.mx.ui.hideProgress(pid);_28?_28(e):window.mx.onError(e);});};_c.prototype.getTemplate=function(id,_2a){return this._templateProvider.get(id,_2a);};_c.prototype.getContentForm=function(){return this._contentForm;};return _c;});