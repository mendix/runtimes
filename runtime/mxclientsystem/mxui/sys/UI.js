
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("mxui/sys/UI",["mxui/lib/WindowManager","mxui/lib/form/FormFactory","mxui/lib/form/ContentForm","mxui/widget/DialogMessage","mxui/widget/Progress","mxui/widget/Underlay","mxui/widget/Login","mxui/widget/DemoUserSwitcher","mxui/widget/Confirmation","mxui/sys/history","mxui/io/iframe","mxui/dom","mendix/lib/ServerError","mendix/lib/ConnectionError","mendix/lib/DescribedServerError","mendix/lib/NavigationError","mendix/lib/ValidationError","mendix/lib/Error","mendix/lib/MxContext","mendix/lang","mendix/logger","dijit/registry","dojo/dom-class","dojo/on","dojo/aspect","dojo/cookie","dojo/has","dojo/ready","dojo/i18n","dojo/_base/array","dojo/_base/kernel","dojo/_base/lang"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20){function UI(){var _21=this,_22="mxui.sys.UI",_23=false,_24=null,_25=null,_26=null,_27=false,_28="en_US",_29=null,_2a=null,_2b="",_2c="desktop",_2d="Mendix 5",_2e=null,_2f,_30;var _31={buddhist:/th$/,hebrew:null,islamic:null};this.startup=function(_32){var _33=window.mx.session.getConfig().uiconfig;_34(_33);_35(_33);_36(_33);_37(_33);_38();_18(window,"resize",_20.hitch(_21,"resize"));_39();_3a();_3b(_33.modules);_3c();_14.collect([_3d,_1c],function(){_27=document.body.dir.toLowerCase()=="rtl";_3e();_23=true;_32();});};function _34(_3f){_2a=_3f.menubars;_14.forEach(_2a,function(_40,_41){_42(_40,_41+"-");});function _42(_43,_44){_1e.forEach(_43,function(_45,_46){_45.id=_44+_46;if(_45.items){_42(_45.items,_45.id+"-");}});};};function _35(_47){_28=_47.locale;_1f.locale=_1d.normalizeLocale(_28.replace("_","-"));_29=_47.translations;_48();_49();};function _36(_4a){_2c=_4a.profile.name.toLowerCase();_2d=_4a.profile.title;document.title=_2d;_17.add(document.body,"profile-"+_2c);};function _37(){var _4b=_1e.map(window.mx.session.getUserRoles("Name"),function(_4c){return "role-"+_4c.toLowerCase();});_17.add(document.body,_4b);};function _38(){_19.before(window.mx,"onError",function(e){var msg;if(e instanceof _f){msg=e.message;}else{if(e instanceof _e){msg=_21.translate("mxui.sys.UI","connection_error");}else{if(e instanceof _d){msg=_21.translate("mxui.sys.UI","internal_error");}else{msg=_21.translate("mxui.sys.UI","internal_error");}}}_24&&_24.hide();_24=_4d(_4e(msg,"error",true));_15.error(e);});};function _39(){_2f=new _1();_30=new _2(_2f);_2e=new _3();_19.after(_2e,"onNavigation",function(){document.title=_2d+" - "+_2e.title;});_25=new _5();_26=new _6();var _4f=mx.session.getConfig("demoUsers");if(_4f){_1e.forEach(_4f,function(_50){_50.active=(_50.name==window.mx.session.getUserName());});var _51=new _8({demoUsers:_4f});document.body.appendChild(_51.domNode);_51.startup();}};function _3e(){var _52=document.getElementById("content");if(!_52){_21.exception("You are using an outdated index template. Please update your index template.");return;}_52.appendChild(_2e.domNode);};function _3a(){_a.init();_19.after(_2e,"dispose",_a.back);var _53=null;_19.after(_a,"onNavigation",function(_54,_55){if(!_55){return;}var _56=_55.formParams;if(!_53){_53=_21.showProgress();}if(_54){_2e.onPersistViewState(_54.viewState);}if(!_55.viewState){_55.viewState={};}_2e.navigateTo(_56.path,_56.title,_56.context,_56.params,_20.clone(_55.viewState),function(){_21.hideProgress(_53);_53=null;},function(e){if(e instanceof _10){}else{_21.hideProgress(_53);_53=null;window.mx.onError(e);}});},true);};var _3d=function(_57){var _58=window.mx.server.getCacheBust(),url="widgets/widgets.js";_c.addCss("widgets/widgets.css?"+_58);dojo.registerModulePath("widgets","../../widgets");window.mx.server.get({url:url,handleAs:"text",failOk:true,load:function(_59){dojo["eval"](_59+"\r\n//# sourceURL="+url);_57();},error:function(err){window.mx.onError(new _12("Could not retrieve "+url+". Probably a custom widget has a problem. ("+err+")"));var _5a=window.mx.session.getConfig("uiconfig.widgets");for(var i=0,_5b;_5b=_5a[i];i++){var _5c=_5b.split(".");dojo.registerModulePath(_5c[0],window.mx.modulePath+_5c[0]);try{dojo["require"](_5b);}catch(e){_15.error(_22+".getWidgets: failed loading widget "+_5b+": "+e);}}_57();}});};function _3b(_5d){for(var i=0,_5e;_5e=_5d[i];i++){try{dojo["require"](_5e+"."+_5e);}catch(e){_15.error(_22+".getModules: failed loading module "+_5e);}}};var _49=function(){var _5f=_21.getCalendarSystem();if(_5f!=="gregorian"){_2b="dojox.date."+_5f;dojo["require"](_2b);dojo["require"](_2b+".locale");}};var _3c=function(){if(_1b("ie")){if(JSON.stringify(document.createElement("input").value)==="\"null\""){var _60=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value").get;Object.defineProperty(HTMLInputElement.prototype,"value",{get:function(){var _61=_60.call(this);return _61===""?"":_61;}});}_18(document,"click",function(e){var _62=e.target;if(_62.nodeName=="TEXTAREA"||_62.nodeName=="INPUT"&&(_62.type=="text"||_62.type=="password")){if(document.activeElement!=_62){var sel=_c.getSelection(_62);try{_62.focus();}catch(ex){}_c.selectTextRange(_62,sel.start,sel.end);}}if(_1b("ie")<=8){if(_62.nodeName=="INPUT"&&_62.type=="checkbox"){_c.dispatchEvent(_62,"onchange");}}});}};var _48=function(){var map={"mendix":"mxui","mendix.core.MxServer":"mendix.core.Server","mendix.widget.MxDataView":"mendix.widget.MxFormView","mendix.widget.MxNavigator":"mendix.widget.Navigator","mendix.widget.MxDataGrid":"mendix.widget.DataGrid","mendix.widget.DataGrid.true":"mxui.common.true","mendix.widget.DataGrid.false":"mxui.common.false","mendix.core.MxServer.invalid_session":"mendix.session.session_expired","mobile.widget.Dialog.ok":"mxui.widget.DialogMessage.ok","mxui.widget.Dialog.error":"mxui.widget.DialogMessage.error","mxui.widget.Dialog.information":"mxui.widget.DialogMessage.info","mxui.widget.Dialog.warning":"mxui.widget.DialogMessage.warning","mxui.widget.Dialog.confirmation":"mxui.widget.Confirmation.caption","mobile.widget":"mxui.widget","mobile.sys":"mxui.sys"};for(var _63 in map){var _64=_63.split("."),_65=map[_63].split("."),_66=_64.pop(),_67=_65.pop(),_68=_29,_69=_68,_6a;while(_68&&(_6a=_64.shift())){_68=_68[_6a];}if(_68){while(_6a=_65.shift()){_69=_69[_6a]=_69[_6a]||{};}if(_69[_67]){_20.mixin(_69[_67],_68[_66]);}else{_69[_67]=_68[_66];}}}};function _4e(msg,_6b,_6c){return new _4({type:_6b,content:""+_21.extractMessage(msg),modal:_6c});};function _4d(_6d){var _6e=_19.after(_6d,"onAfterHide",function(){_6e.remove();_6d.destroy();});_6d.show();return _6d;};this.openFormInContent=function(_6f,_70,_71,_72){_a.push({formParams:{path:_6f,title:_70,context:_71||new _13(),params:_72||{}}});};this.openFormInPopup=function(_73,_74,_75,_76,_77,_78){var _79=this,pid=this.showProgress();_30.openPopupForm(_73,_74,(_75||new _13()),(_76||{}),function(_7a){_79.hideProgress(pid);_77&&_77(_7a);},function(e){_79.hideProgress(pid);_78?_78(e):window.mx.onError(e);});};this.openFormInNode=function(_7b,_7c,_7d,_7e,_7f,_80){var _81=this,pid=this.showProgress();_30.openInlineForm(_7b,_7c,(_7d||new _13()),(_7e||{}),function(_82){_81.hideProgress(pid);_7f&&_7f(_82);},function(e){_81.hideProgress(pid);_80?_80(e):window.mx.onError(e);});};var _83=function(fmt,_84){if(!_84){return fmt;}else{if(!(_84 instanceof Array)){_84=[_84];}}return fmt.replace(/\{(\d+)\}/g,function(_85,n){var _86=_84[n-1];if(_86!=null){return _86;}else{return _85;}});};this.toString=function(){return _22;};this.getCurrentForm=function(){return _2e;};this.getProfile=function(){return _2c;};this.getMenu=function(_87){return _2a[_87]||[];};this.getDatePackage=function(){return _2b||"dojo.date";};this.getCalendarSystem=function(){for(var m in _31){var re=_31[m];if(re&&re.test(_1f.locale.toLowerCase())){return m;}}return "gregorian";};this.isRtl=function(){return _27;};this.resize=function(){_2e.resize();};this.execute=function(_88,_89,_8a){var cfg={};if(_88.microflow){_20.mixin(cfg,_88.microflow,_89);window.mx.ui.action(cfg.name,cfg,_8a);}else{if(_88.form){_20.mixin(cfg,_88.form,_89);window.mx.ui.openForm(cfg.path,cfg,_8a);}else{_15.error(_22+".execute: unknown action type");}}};this.action=function(_8b,_8c,_8d){_8c=_8c||{};_20.setObject("params.actionname",_8b,_8c);var _8e=_8c.callback,_8f=_8c.error,_90=_20.mixin({caller:_2e},_8c.store),_91;if("progress" in _8c){_91=this.getProgress(_8c.progressMsg,_8c.progress=="modal");_91.start();}window.mx.data.action({callback:function(_92){_91&&_91.stop();_8e&&_8e.call(_8d,_92);},error:function(e){_91&&_91.stop();if(_8f){_8f.call(_8d,e);}else{if(e&&!(e instanceof _11)){window.mx.onError(e);}}},context:_8c.context,async:_8c.async,params:_8c.params,store:_90});};this.back=function(){_a.back();};this.showProgress=function(msg,_93){return _25.add(msg||"",_93);};this.hideProgress=function(id){return _25.remove(id);};this.showUnderlay=function(_94){_26.show(_94);};this.hideUnderlay=function(_95){_26.hide(_95);};this.getProgress=function(msg,_96){var id,_97;return {start:function(){if(_97){return id;}else{_97=true;return id=_21.showProgress(msg,_96);}},stop:function(){if(_97){_97=false;_21.hideProgress(id);}}};};function _98(_99){if(!_23){var _9a=window.mx.session.getConfig("profile");if(_9a){_2c=_9a.name.toLowerCase();_17.add(document.body,"profile-"+_2c);document.title=_9a.title;}}if(!window.i18nMap){window.mx.server.get({url:"js/login_i18n.js",handleAs:"javascript",load:_99});}else{_99();}};this.showLogin=function(_9b){if(_9b=="402"){this.exception(window.i18nMap.http402);return;}var _9c=_1a("originURI");if(_9c){_1a("originURI",null,{expires:-1});window.mx.redirect(_9c);return;}_98(function(){new _7().show(_9b);});};this.openForm=function(_9d,_9e,_9f){if(_9e.domNode){this.openFormInNode(_9d,_9e.domNode,_9e.context,_9e.params,_9e.callback?_20.hitch(_9f,_9e.callback):null,_9e.error?_20.hitch(_9f,_9e.error):null);}else{if(/popup|modal/.test(_9e.location)){_9e.modal=_9e.location=="modal";this.openFormInPopup(_9d,_9e,_9e.context,_9e.params,_9e.callback?_20.hitch(_9f,_9e.callback):null,_9e.error?_20.hitch(_9f,_9e.error):null);}else{if(_9e.callback||_9e.error){throw new Error("Success and error callbacks are not supported for openFormInContent");}this.openFormInContent(_9d,_9e.title,_9e.context,_9e.params);}}};this.reload=function(_a0){var _a1=mxui.currentForm;if(!_a1){throw new _12("Trying to refresh the content form but no form is yet available.");}_a1.reload(_a0);};this.getTemplate=function(id,_a2){var _a3=_2e.widgetTemplates[id];return _a3&&_20.clone(_a3[_a2]);};this.applyToNode=function(_a4,_a5){var _a6=_16.byNode(_a5);switch(_a4){case "show":if(_a6&&_a6.show){_a6.show();}else{_a5.style.display="";}break;case "hide":if(_a6&&_a6.hide){_a6.hide();}else{_a5.style.display="none";}break;case "disable":if(_a6){_a6.set("disabled",true);}break;case "enable":if(_a6){_a6.set("disabled",false);}break;}};this.makeShareId=function(_a7,_a8){return "context_seed_"+_a8+"_"+_a7.hash;};this.validations=function(_a9){if(_a9.length){var _aa=[];for(var i=0,val;val=_a9[i];i++){var _ab=val.getFields();for(var x=0,_ac;_ac=_ab[x];x++){_aa.push(_ac.reason);}}this.error(_aa.join("\n"));}};this.translate=function(_ad,str,_ae,_af){var map=_20.getObject(_ad,false,_29);if(!map||!map[str]){return _af||"[No translation]";}return _83(map[str],_ae);};this.extractMessage=function(msg){if(typeof msg=="object"){if(msg.description){return msg.description;}else{if(msg.message){return msg.message;}}}return msg;};this.info=function(msg,_b0){_4d(_4e(msg,"info",_b0));};this.warning=function(msg,_b1){_4d(_4e(msg,"warning",_b1));};this.error=function(msg,_b2){_4d(_4e(msg,"error",_b2));};this.exception=function(msg){this.error(msg,true);};this.confirmation=function(_b3){var _b4=new _9({content:_b3.content,proceed:_b3.proceed||"OK",cancel:_b3.cancel||"Cancel",handler:_b3.handler});_4d(_b4);};this.encodeUrlHash=function(_b5,_b6,_b7){var _b8=_b5.substr(0,_b5.lastIndexOf(".")),_b9=_b6.toQuery();return "!/"+_b8+(_b9?"?"+_b9:"")+";"+_b7;};this.decodeUrlHash=function(_ba){if(_ba.charAt(0)=="!"){var _bb=_ba.lastIndexOf(";");_ba=_ba.slice(2,_bb!=-1?_bb:_ba.length);if(/^\w+(\/\w+(\?\w+\.\w+\=\d+(&\w+\.\w+\=\d+)*)?|\.\w+(\?\d+(&\d+)*)?)$/.test(_ba)){var _bc=_ba.split("?"),_bd=_bc[0],_be=_bc[1],_bf=new _13(),_c0,_c1;if(_bd.indexOf("/")!=-1){if(_be){_c0=_be.split("&");for(var i=_c0.length;_c1=_c0[--i];){var _c2=_c1.split("=");_bf.setContext(_c2[0],_c2[1]);}}return function(_c3){window.mx.ui.openFormInContent(_bd+".page.xml","",_bf);_c3&&_c3();};}else{if(_be){_c0=_be.split("&");for(var j=0;_c1=_c0[j++];){_bf.setContext(" ",_c1);}}return function(_c4){window.mx.data.action({context:_bf,params:{actionname:_bd},callback:_c4,error:function(e){window.mx.onError(e);_c4&&_c4();}});};}}else{return null;}}else{return null;}};this.downloadFile=function(_c5){var _c6=(window.mx.ui.getProfile()=="desktop"),_c7=_c6?_c5.target:"window",obj=_c5?_c5.mxobject:null,url;if(obj&&obj.get("HasContents")){url="file?guid="+obj.getGuid();}else{if(_c5.url){url=_c5.url;}}if(url){_b.download({url:window.mx.appUrl+url,target:_c7,error:function(err){if(_c5.error){_c5.error(err);}else{window.mx.onError(err);}}});}else{}};this.getFirstDayOfWeek=function(){return window.mx.session.getConfig("uiconfig.firstDayOfWeek");};};return UI;});