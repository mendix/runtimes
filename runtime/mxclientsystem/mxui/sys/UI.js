/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/sys/UI",["mxui/lib/form/FormFactory","mxui/lib/form/ContentForm","mxui/widget/DialogMessage","mxui/widget/Progress","mxui/widget/Underlay","mxui/widget/LoginDialog","mxui/widget/DemoUserSwitcher","mxui/widget/ConfirmationDialog","mxui/sys/history","mxui/io/iframe","mxui/dom","mendix/validator","mendix/lib/ServerError","mendix/lib/ConnectionError","mendix/lib/DescribedError","mendix/lib/DescribedServerError","mendix/lib/NavigationError","mendix/lib/ValidationError","mendix/lib/Error","mendix/lib/MxContext","mendix/lang","mendix/logger","big/big","fastclick/fastclick","dijit/registry","dojo/dom-class","dojo/on","dojo/aspect","dojo/cookie","dojo/has","dojo/ready","dojo/i18n","dojo/_base/array","dojo/_base/kernel","dojo/_base/lang","dojo/_base/config","require","dojox/date/buddhist","dojox/date/buddhist/locale"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,Big,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20,_21,_22,_23,_24){function UI(_25){_25=_25||{};var _26=this,_27="mxui.sys.UI",_28=false,_29=null,_2a=null,_2b=null,_2c=false,_2d="en_US",_2e=null,_2f=null,_30="",_31="desktop",_32="Mendix 6",_33=null,_34,_35={"HALF_UP":1,"HALF_EVEN":2};var _36={buddhist:/th$/,hebrew:null,islamic:null};var _37=_25.openUrlFn||function(url,_38,_39){window.open(url,_39);};this.startup=function(_3a){var _3b=window.mx.session.getConfig().uiconfig;_3c(_3b);_3d(_3b);_3e(_3b);_3f(_3b);_40(_3b.roundingmode);_41();_1a(window,"resize",_22.hitch(_26,"resize"));_42();_43();_44(_3b.modules);_45();_46(function(){_2c=document.body.dir.toLowerCase()=="rtl";_47();_28=true;_3a();});};function _3c(_48){_2f=_48.menubars;_15.forEach(_2f,function(_49,_4a){_4b(_49,_4a+"-");});function _4b(_4c,_4d){_20.forEach(_4c,function(_4e,_4f){_4e.id=_4d+_4f;if(_4e.items){_4b(_4e.items,_4e.id+"-");}});};};function _3d(_50){_2d=_50.locale;_21.locale=_1f.normalizeLocale(_2d.replace("_","-"));_2e=_50.translations;_51();_52();};function _3e(_53){_31=_53.profile.name.toLowerCase();_32=_53.profile.title;document.title=_32;_19.add(document.body,"profile-"+_31);};function _3f(){var _54=_20.map(window.mx.session.getUserRoles("Name"),function(_55){return "role-"+_55.toLowerCase();});_19.add(document.body,_54);};function _40(_56){Big.RM=_56?_35[_56]:_35.HALF_EVEN;};function _41(){_1b.before(window.mx,"onError",function(e){var msg;if(e instanceof _f||e instanceof _10){msg=e.message;}else{if(e instanceof _e){msg=_26.translate("mxui.sys.UI","connection_error");}else{if(e instanceof _d){msg=_26.translate("mxui.sys.UI","internal_error");}else{msg=_26.translate("mxui.sys.UI","internal_error");}}}_29&&_29.hide();_29=_57(msg,"error");_29.show(true);});};function _42(){_34=new _1();_33=new _2();_1b.after(_33,"onNavigation",function(){document.title=_32+" - "+_33.title;_19.add(document.body,"mx-no-scroll");setTimeout(function(){_19.remove(document.body,"mx-no-scroll");},0);});_2a=new _4();_2b=new _5();var _58=mx.session.getConfig("demoUsers");if(_58){_20.forEach(_58,function(_59){_59.active=(_59.name==window.mx.session.getUserName());});var _5a=new _7({demoUsers:_58});document.body.appendChild(_5a.domNode);_5a.startup();}};function _47(){var _5b=document.getElementById("content");if(!_5b){_26.exception("You are using an outdated index page. Please update your index page. See index-example.html in the deployment directory for an example of what the index page should look like.");return;}_5b.appendChild(_33.domNode);};function _43(){_9.init();_1b.after(_33,"dispose",_9.back);var _5c=null;_1b.after(_9,"onNavigation",function(_5d,_5e){if(!_5e){return;}var _5f=_5e.formParams;if(!_5c){_5c=_26.showProgress();}if(_5d){_33.onPersistViewState(_5d.viewState);}if(!_5e.viewState){_5e.viewState={};}_33.navigateTo(_5f.path,_5f.title,_5f.context,_5f.params,_22.clone(_5e.viewState),function(){_26.hideProgress(_5c);_5c=null;},function(e){if(e instanceof _11){}else{_26.hideProgress(_5c);_5c=null;window.mx.onError(e);}});},true);};function _46(_60){var _61=window.mx.session.getConfig("uiconfig.widgets");if(_61.length>0){_62();dojo.registerModulePath("widgets",window.mx.modulePath);_20.forEach(_61,function(_63){var _64=_63.split(".")[0];dojo.registerModulePath(_64,window.mx.modulePath+_64);});var _65=["widgets/widgets"];_24(_65);}_1e(_60);};function _62(){var _66=document.getElementsByTagName("head")[0],_67=_66.querySelector("link[href*='css/theme.css']"),_68=_b.createCssLink("widgets/widgets.css");if(_67){_66.insertBefore(_68,_67);}else{_66.appendChild(_68);}};function _44(_69){for(var i=0,_6a;_6a=_69[i];i++){try{dojo["require"](_6a+"."+_6a);}catch(e){_16.error(_27+".getModules: failed loading module "+_6a);}}};function _52(){var _6b=_26.getCalendarSystem();switch(_6b){case "gregorian":_30="dojo.date";return;case "buddhist":_30="dojox.date.buddhist";dojo["require"](_30);dojo["require"](_30+".locale");return;default:throw new Error("Unsupported date package: "+_6b);}};function _45(){_17.attach(document.body);if(_1d("ie")){if(JSON.stringify(document.createElement("input").value)==="\"null\""){var _6c=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value").get;Object.defineProperty(HTMLInputElement.prototype,"value",{get:function(){var _6d=_6c.call(this);return _6d===""?"":_6d;}});}_1a(document,"click",function(e){var _6e=e.target;if(_6e.nodeName=="TEXTAREA"||_6e.nodeName=="INPUT"&&(_6e.type=="text"||_6e.type=="password")){if(document.activeElement!=_6e){var sel=_b.getSelection(_6e);try{_6e.focus();}catch(ex){}_b.selectTextRange(_6e,sel.start,sel.end);}}if(_1d("ie")<=8){if(_6e.nodeName=="INPUT"&&(_6e.type==="checkbox"||_6e.type==="radio")){_b.dispatchEvent(_6e,"onchange");}}});}};function _51(){var map={"mendix":"mxui","mendix.core.MxServer":"mendix.core.Server","mendix.widget.MxDataView":"mendix.widget.MxFormView","mendix.widget.MxNavigator":"mendix.widget.Navigator","mendix.widget.MxDataGrid":"mendix.widget.DataGrid","mendix.widget.DataGrid.true":"mxui.common.true","mendix.widget.DataGrid.false":"mxui.common.false","mendix.core.MxServer.invalid_session":"mendix.session.session_expired","mobile.widget.Dialog.ok":"mxui.widget.DialogMessage.ok","mxui.widget.Dialog.error":"mxui.widget.DialogMessage.error","mxui.widget.Dialog.information":"mxui.widget.DialogMessage.info","mxui.widget.Dialog.warning":"mxui.widget.DialogMessage.warning","mxui.widget.Dialog.confirmation":"mxui.widget.ConfirmationDialog.caption","mobile.widget":"mxui.widget","mobile.sys":"mxui.sys"};for(var _6f in map){var _70=_6f.split("."),_71=map[_6f].split("."),_72=_70.pop(),_73=_71.pop(),_74=_2e,_75=_74,_76;while(_74&&(_76=_70.shift())){_74=_74[_76];}if(_74){while(_76=_71.shift()){_75=_75[_76]=_75[_76]||{};}if(_75[_73]){_22.mixin(_75[_73],_74[_72]);}else{_75[_73]=_74[_72];}}}};function _57(msg,_77){return new _3({type:_77,content:""+_26.extractMessage(msg)});};this.openFormInContent=function(_78,_79,_7a,_7b){_9.push({formParams:{path:_78,title:_79,context:_7a||new _14(),params:_7b||{}}});};this.openFormInPopup=function(_7c,_7d,_7e,_7f,_80,_81){var _82=this,pid=this.showProgress();_34.openPopupForm(_7c,_7d,(_7e||new _14()),(_7f||{}),function(_83){_82.hideProgress(pid);_80&&_80(_83);},function(e){_82.hideProgress(pid);_81?_81(e):window.mx.onError(e);});};this.openFormInNode=function(_84,_85,_86,_87,_88,_89){var _8a=this,pid=this.showProgress();_34.openInlineForm(_84,_85,(_86||new _14()),(_87||{}),function(_8b){_8a.hideProgress(pid);_88&&_88(_8b);},function(e){_8a.hideProgress(pid);_89?_89(e):window.mx.onError(e);});};function _8c(fmt,_8d){if(!_8d){return fmt;}else{if(!(_8d instanceof Array)){_8d=[_8d];}}return fmt.replace(/\{(\d+)\}/g,function(_8e,n){var _8f=_8d[n-1];if(_8f!=null){return _8f;}else{return _8e;}});};this.toString=function(){return _27;};this.getCurrentForm=function(){return _33;};this.getProfile=function(){return _31;};this.getMenu=function(_90){return _2f[_90]||[];};this.getDatePackage=function(){return _30;};this.getCalendarSystem=function(){for(var m in _36){var re=_36[m];if(re&&re.test(_21.locale.toLowerCase())){return m;}}return "gregorian";};this.isRtl=function(){return _2c;};this.resize=function(){_33.resize();};this.execute=function(_91,_92,_93){var _94=_22.mixin({},_91.microflow||_91.form,_92);if(_94.allowedRoles&&!window.mx.session.hasSomeRole(_94.allowedRoles)){if(window.mx.session.isGuest()){this.showLogin();}else{window.mx.onError(new _f("Unable to execute action because you do not have sufficient permissions."));}return;}if(_91.microflow){this.action(_94.name,_94,_93);}else{if(_91.form){this.openForm(_94.path,_94,_93);}else{_16.error(_27+".execute: unknown action type");}}};this.action=function(_95,_96,_97){_96=_96||{};_22.setObject("params.actionname",_95,_96);var _98;if("progress" in _96){_98=this.getProgress(_96.progressMsg,_96.progress=="modal");_98.start();}window.mx.data.action({callback:_99(_96.callback),error:_99(function(e){if(_96.error){_96.error.call(_97,e);}else{if(!(e instanceof _12)){window.mx.onError(e);}}}),context:_96.context,async:_96.async,params:_96.params,store:_22.mixin({caller:_33},_96.store)});function _99(_9a){return function(){try{if(_9a){_9a.apply(_97,arguments);}}finally{if(_98){_98.stop();}if(_96.complete){_96.complete.apply(_97);}}};};};this.back=function(){_9.back();};this.showProgress=function(msg,_9b){return _2a.add(msg||"",_9b);};this.hideProgress=function(id){return _2a.remove(id);};this.showUnderlay=function(_9c){_2b.show(_9c);};this.hideUnderlay=function(_9d){_2b.hide(_9d);};this.getProgress=function(msg,_9e){var id,_9f;return {start:function(){if(_9f){return id;}else{_9f=true;return id=_26.showProgress(msg,_9e);}},stop:function(){if(_9f){_9f=false;_26.hideProgress(id);}}};};function _a0(_a1){if(!_28){var _a2=window.mx.session.getConfig("profile");if(_a2){_31=_a2.name.toLowerCase();_19.add(document.body,"profile-"+_31);document.title=_a2.title;}}if(!window.i18nMap){window.mx.server.get({url:"js/login_i18n.js",handleAs:"javascript",load:_a1});}else{_a1();}};this.showLogin=function(_a3){if(_a3=="402"){this.exception(window.i18nMap.http402);return;}var _a4=_1c("originURI");if(_a4){_1c("originURI",null,{expires:-1});window.mx.redirect(_a4);return;}_a0(function(){new _6({messageCode:_a3}).show();});};this.openForm=function(_a5,_a6,_a7){if(_a6.domNode){this.openFormInNode(_a5,_a6.domNode,_a6.context,_a6.params,_a6.callback?_22.hitch(_a7,_a6.callback):null,_a6.error?_22.hitch(_a7,_a6.error):null);}else{if(/popup|modal/.test(_a6.location)){_a6.modal=_a6.location=="modal";this.openFormInPopup(_a5,_a6,_a6.context,_a6.params,_a6.callback?_22.hitch(_a7,_a6.callback):null,_a6.error?_22.hitch(_a7,_a6.error):null);}else{if(_a6.callback||_a6.error){throw new Error("Success and error callbacks are not supported for openFormInContent");}this.openFormInContent(_a5,_a6.title,_a6.context,_a6.params);}}};this.reload=function(_a8){var _a9=mxui.currentForm;if(!_a9){throw new _13("Trying to refresh the content form but no form is yet available.");}_a9.reload(_a8);};this.getTemplate=function(id,_aa){var _ab=_33.widgetTemplates[id];return _ab&&_22.clone(_ab[_aa]);};this.applyToNode=function(_ac,_ad){var _ae=_18.byNode(_ad);switch(_ac){case "show":if(_ae&&_ae.show){_ae.show();}else{_ad.style.display="";}break;case "hide":if(_ae&&_ae.hide){_ae.hide();}else{_ad.style.display="none";}break;case "disable":_af(true);break;case "enable":_af(false);break;}function _af(_b0){if(_ae){_ae.set("disabled",_b0);}else{var _b1=_18.findWidgets(_ad);_20.forEach(_b1,function(_b2){_b2.set("disabled",_b0);});}};};this.makeShareId=function(_b3,_b4){return "context_seed_"+_b4+"_"+_b3.hash;};var _b5={};_b5[_c.validation.NOT_INTEGER]="invalid_number";_b5[_c.validation.RANGE_INTEGER]="range_integer";_b5[_c.validation.RANGE_LONG]="range_long";_b5[_c.validation.RANGE_DECIMAL]="range_decimal";_b5[_c.validation.RANGE_NUMBER]="range_number";this.validate=function(_b6,_b7){var _b8=_c.validate(_b6,_b7);if(_b8===_c.validation.OK){return null;}return this.translate("mendix.lib.Validations",_b5[_b8]);};this.validations=function(_b9){if(_b9.length){var _ba=[];for(var i=0,val;val=_b9[i];i++){var _bb=val.getFields();for(var x=0,_bc;_bc=_bb[x];x++){_ba.push(_bc.reason);}}this.error(_ba.join("\n"));}};this.translate=function(_bd,str,_be,_bf){var map=_22.getObject(_bd,false,_2e);if(!map||!map[str]){return _bf||"[No translation]";}return _8c(map[str],_be);};this.extractMessage=function(msg){if(typeof msg=="object"){if(msg.description){return msg.description;}else{if(msg.message){return msg.message;}}}return msg;};this.info=function(msg,_c0){_57(msg,"info").show(_c0);};this.warning=function(msg,_c1){_57(msg,"warning").show(_c1);};this.error=function(msg,_c2){_57(msg,"error").show(_c2);};this.exception=function(msg){this.error(msg,true);};this.confirmation=function(_c3){new _8({content:_c3.content,proceed:_c3.proceed||this.translate("mxui.widget.DialogMessage","ok"),cancel:_c3.cancel||this.translate("mxui.widget.DialogMessage","cancel"),handler:_c3.handler}).show();};this.encodeUrlHash=function(_c4,_c5,_c6){var _c7=_c4.substr(0,_c4.lastIndexOf(".")),_c8=_c5.toQuery();return "!/"+_c7+(_c8?"?"+_c8:"")+";"+_c6;};this.decodeUrlHash=function(_c9){if(_c9.charAt(0)=="!"){var _ca=_c9.lastIndexOf(";");_c9=_c9.slice(2,_ca!=-1?_ca:_c9.length);if(/^\w+(\/\w+(\?\w+\.\w+\=\d+(&\w+\.\w+\=\d+)*)?|\.\w+(\?\d+(&\d+)*)?)$/.test(_c9)){var _cb=_c9.split("?"),_cc=_cb[0],_cd=_cb[1],_ce=new _14(),_cf,_d0;if(_cc.indexOf("/")!=-1){if(_cd){_cf=_cd.split("&");for(var i=_cf.length;_d0=_cf[--i];){var _d1=_d0.split("=");_ce.setContext(_d1[0],_d1[1]);}}return function(_d2){window.mx.ui.openFormInContent(_cc+".page.xml","",_ce);_d2&&_d2();};}else{if(_cd){_cf=_cd.split("&");for(var j=0;_d0=_cf[j++];){_ce.setContext(" ",_d0);}}return function(_d3){window.mx.data.action({context:_ce,params:{actionname:_cc},callback:_d3,error:function(e){window.mx.onError(e);_d3&&_d3();}});};}}else{return null;}}else{return null;}};this.canMoveBack=function(){return !_9.isAtBeginning();};this.downloadFile=function(_d4){var url;var obj=_d4&&_d4.mxobject;if(obj&&obj.get2("HasContents")){url=window.mx.appUrl+"file?guid="+obj.getGuid();}else{return;}if(_d4.target==="window"||_d5()){url+="&target=window";if(_d6()){new _8({caption:this.translate("mendix.widget.DialogMessage","file_download"),content:this.translate("mendix.widget.DialogMessage","file_download_message"),proceed:this.translate("mendix.widget.MxDataView","download"),cancel:this.translate("mendix.widget.DialogMessage","cancel"),handler:_d7}).show();}else{_d7();}}else{_a.download({url:url+"&target=internal",target:_d4.target,error:function(err){if(_d4.error){_d4.error(err);}else{window.mx.onError(err);}}});}function _d7(){_37(url,obj.get2("Name"),"mendix_file");};function _d5(){var _d8=_1d("chrome")&&typeof window.externalHost!=="undefined";var _d9=_1d("mobile");return _d8||_d9;};function _d6(){return _1d("ie")==8||((_1d("iphone")||_1d("ipad"))&&(_1d("safari")||window.navigator.standalone))||_1d("windowsphone");};};this.getFirstDayOfWeek=function(){return window.mx.session.getConfig("uiconfig.firstDayOfWeek");};};return UI;});