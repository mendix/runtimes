/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/sys/UI",["mxui/lib/actionRegistry","mxui/widget/DialogMessage","mxui/widget/Progress","mxui/widget/Underlay","mxui/widget/LoginDialog","mxui/widget/DemoUserSwitcher","mxui/widget/ConfirmationDialog","mxui/sys/history","mxui/io/iframe","mxui/dom","mendix/validator","mendix/lib/ServerError","mendix/lib/ConnectionError","mendix/lib/DescribedError","mendix/lib/DescribedServerError","mendix/lib/NavigationError","mendix/lib/ValidationError","mendix/lib/Error","mendix/lib/MxContext","mendix/lang","mendix/logger","webcore/url-helpers","big/big","fastclick/fastclick","dijit/registry","dojo/dom-class","dojo/on","dojo/aspect","dojo/cookie","dojo/has","dojo/ready","dojo/i18n","dojo/_base/array","dojo/_base/kernel","dojo/_base/lang","dojo/_base/config","require","dojox/date/buddhist","dojox/date/buddhist/locale","mxui/lib/action/doNothing","mxui/lib/action/openPage","mxui/lib/action/callMicroflow"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,Big,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20,_21,_22,_23,_24){function UI(_25){_25=_25||{};var _26=this,_27="mxui.sys.UI",_28=false,_29=null,_2a=null,_2b=null,_2c=false,_2d="en_US",_2e=null,_2f=null,_30="",_31="desktop",_32={"HALF_UP":1,"HALF_EVEN":2};var _33={buddhist:/th$/,hebrew:null,islamic:null};var _34=_25.openUrlFn||function(url,_35,_36){window.open(url,_36);};this.startup=function(_37){var _38=window.mx.session.getConfig().uiconfig;_39(_38);_3a(_38);_3b(_38);_3c(_38);_3d(_38.roundingmode);_3e();_1a(window,"resize",_22.hitch(_26,"resize"));_3f();_40(_38.modules);_41();_42(function(){_2c=document.body.dir.toLowerCase()=="rtl";_28=true;_37();});};function _39(_43){_2f=_43.menubars;_14.forEach(_2f,function(_44,_45){_46(_44,_45+"-");});function _46(_47,_48){_20.forEach(_47,function(_49,_4a){_49.id=_48+_4a;if(_49.items){_46(_49.items,_49.id+"-");}});};};function _3a(_4b){_2d=_4b.locale;_21.locale=_1f.normalizeLocale(_2d.replace("_","-"));_2e=_4b.translations;_4c();_4d();};function _3b(_4e){_31=_4e.profile.name.toLowerCase();_19.add(document.body,"profile-"+_31);};function _3c(){var _4f=_20.map(window.mx.session.getUserRoles("Name"),function(_50){return "role-"+_50.toLowerCase();});_19.add(document.body,_4f);};function _3d(_51){Big.RM=_51?_32[_51]:_32.HALF_EVEN;};function _3e(){_1b.before(window.mx,"onError",function(e){var msg;if(e instanceof _e||e instanceof _f){msg=e.message;}else{if(e instanceof _d){msg=_26.translate("mxui.sys.UI","connection_error");}else{if(e instanceof _c){msg=_26.translate("mxui.sys.UI","internal_error");}else{msg=_26.translate("mxui.sys.UI","internal_error");}}}_29&&_29.hide();_29=_52(msg,"error");_29.show(true);});};function _3f(){_2a=new _3();_2b=new _4();var _53=mx.session.getConfig("demoUsers");if(_53){_20.forEach(_53,function(_54){_54.active=(_54.name==window.mx.session.getUserName());});var _55=new _6({demoUsers:_53});document.body.appendChild(_55.domNode);_55.startup();}};function _42(_56){var _57=window.mx.session.getConfig("uiconfig.widgets");if(_57.length>0){_58();dojo.registerModulePath("widgets",window.mx.modulePath);_20.forEach(_57,function(_59){var _5a=_59.split(".")[0];dojo.registerModulePath(_5a,window.mx.modulePath+_5a);});var _5b=["widgets/widgets"];_24(_5b);}_1e(_56);};function _58(){var _5c=document.querySelector("head"),_5d=_5c.querySelector("link[href*='mxui/ui/mxui.css']"),_5e=_a.createCssLink("widgets/widgets.css");if(_5d&&_5d.nextElementSibling){_5c.insertBefore(_5e,_5d.nextElementSibling);}else{_5c.appendChild(_5e);}};function _40(_5f){for(var i=0,_60;_60=_5f[i];i++){try{dojo["require"](_60+"."+_60);}catch(e){_15.error(_27+".getModules: failed loading module "+_60);}}};function _4d(){var _61=_26.getCalendarSystem();switch(_61){case "gregorian":_30="dojo.date";return;case "buddhist":_30="dojox.date.buddhist";dojo["require"](_30);dojo["require"](_30+".locale");return;default:throw new Error("Unsupported date package: "+_61);}};function _41(){if(!_1d("windowsphone")){_17.attach(document.body);}if(_1d("ie")){if(JSON.stringify(document.createElement("input").value)==="\"null\""){var _62=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value").get;Object.defineProperty(HTMLInputElement.prototype,"value",{get:function(){var _63=_62.call(this);return _63===""?"":_63;}});}_1a(document,"click",function(e){var _64=e.target;if(_64.nodeName=="TEXTAREA"||_64.nodeName=="INPUT"&&(_64.type=="text"||_64.type=="password")){if(document.activeElement!=_64){var sel=_a.getSelection(_64);try{_64.focus();}catch(ex){}_a.selectTextRange(_64,sel.start,sel.end);}}if(_1d("ie")<=8){if(_64.nodeName=="INPUT"&&(_64.type==="checkbox"||_64.type==="radio")){_a.dispatchEvent(_64,"onchange");}}});}};function _4c(){var map={"mendix":"mxui","mendix.core.MxServer":"mendix.core.Server","mendix.widget.MxDataView":"mendix.widget.MxFormView","mendix.widget.MxNavigator":"mendix.widget.Navigator","mendix.widget.MxDataGrid":"mendix.widget.DataGrid","mendix.widget.DataGrid.true":"mxui.common.true","mendix.widget.DataGrid.false":"mxui.common.false","mendix.core.MxServer.invalid_session":"mendix.session.session_expired","mobile.widget.Dialog.ok":"mxui.widget.DialogMessage.ok","mxui.widget.Dialog.error":"mxui.widget.DialogMessage.error","mxui.widget.Dialog.information":"mxui.widget.DialogMessage.info","mxui.widget.Dialog.warning":"mxui.widget.DialogMessage.warning","mxui.widget.Dialog.confirmation":"mxui.widget.ConfirmationDialog.caption","mobile.widget":"mxui.widget","mobile.sys":"mxui.sys"};for(var _65 in map){var _66=_65.split("."),_67=map[_65].split("."),_68=_66.pop(),_69=_67.pop(),_6a=_2e,_6b=_6a,_6c;while(_6a&&(_6c=_66.shift())){_6a=_6a[_6c];}if(_6a){while(_6c=_67.shift()){_6b=_6b[_6c]=_6b[_6c]||{};}if(_6b[_69]){_22.mixin(_6b[_69],_6a[_68]);}else{_6b[_69]=_6a[_68];}}}};function _52(msg,_6d){return new _2({type:_6d,content:""+_26.extractMessage(msg)});};function _6e(fmt,_6f){if(!_6f){return fmt;}else{if(!(_6f instanceof Array)){_6f=[_6f];}}return fmt.replace(/\{(\d+)\}/g,function(_70,n){var _71=_6f[n-1];if(_71!=null){return _71;}else{return _70;}});};this.toString=function(){return _27;};this.getProfile=function(){return _31;};this.getMenu=function(_72){return _2f[_72]||[];};this.getDatePackage=function(){return _30;};this.getCalendarSystem=function(){for(var m in _33){var re=_33[m];if(re&&re.test(_21.locale.toLowerCase())){return m;}}return "gregorian";};this.isRtl=function(){return _2c;};this.resize=function(){window.mx.router.getContentForm().resize();};this.execute=function(_73,_74,_75){var _76=_22.mixin({},_73.params,_74);if(_75){for(var key in _76){if(typeof _76[key]==="function"){_76[key]=_22.hitch(_75,_76[key]);}}}return _1.execute({type:_73.type,params:_76});};this.action=function(_77,_78,_79){_78=_78||{};_22.setObject("params.actionname",_77,_78);var _7a;if("progress" in _78){_7a=this.getProgress(_78.progressMsg,_78.progress=="modal");_7a.start();}window.mx.data.action({callback:_7b(_78.callback),error:_7b(function(e){if(_78.error){_78.error.call(_79,e);}else{if(!(e instanceof _11)){window.mx.onError(e);}}}),context:_78.context,async:_78.async,params:_78.params,origin:_78.origin||window.mx.router.getContentForm()});function _7b(_7c){return function(){try{if(_7c){_7c.apply(_79,arguments);}}finally{if(_7a){_7a.stop();}if(_78.complete){_78.complete.apply(_79);}}};};};this.back=function(){_8.back();};this.showProgress=function(msg,_7d){return _2a.add(msg||"",_7d);};this.hideProgress=function(id){return _2a.remove(id);};this.showUnderlay=function(_7e){_2b.show(_7e);};this.hideUnderlay=function(_7f){_2b.hide(_7f);};this.getProgress=function(msg,_80){var id,_81;return {start:function(){if(_81){return id;}else{_81=true;return id=_26.showProgress(msg,_80);}},stop:function(){if(_81){_81=false;_26.hideProgress(id);}}};};function _82(_83){if(!_28){var _84=window.mx.session.getConfig("profile");if(_84){_31=_84.name.toLowerCase();_19.add(document.body,"profile-"+_31);document.title=_84.title;}}if(!window.i18nMap){window.mx.server.get({url:"js/login_i18n.js",handleAs:"javascript",load:_83});}else{_83();}};this.showLogin=function(_85){if(_85=="402"){this.exception(window.i18nMap.http402);return;}var _86=_1c("originURI");if(_86){_1c("originURI",null,{expires:-1});window.mx.redirect(_86);return;}_82(function(){if(_25.customLoginFn){var _87=window.mx.session.getConfig("autologin_support");_25.customLoginFn(_85,_87);}else{new _5({messageCode:_85}).show();}});};this.openForm=function(_88,_89,_8a){var _8b=_89.callback?_22.hitch(_8a,_89.callback):null;var _8c=_89.error?_22.hitch(_8a,_89.error):null;if(_89.domNode){window.mx.router.openFormInNode(_88,_89.domNode,_89.context,_89.targetParams,_8b,_8c);}else{if(/popup|modal/.test(_89.location)){_89.modal=_89.location=="modal";window.mx.router.openFormInPopup(_88,_89,_89.context,_89.targetParams,_8b,_8c);}else{window.mx.router.openFormInContent(_88,_89.title,_89.context,_89.targetParams,_8b);}}};this.reload=function(_8d){var _8e=window.mx.router.getContentForm();if(!_8e){throw new _12("Trying to refresh the content form but no form is yet available.");}_8e.reload(_8d);};this.getTemplate=function(id,_8f){return window.mx.router.getTemplate(id,_8f);};this.applyToNode=function(_90,_91){var _92=_18.byNode(_91);switch(_90){case "show":if(_92&&_92.show){_92.show();}else{_91.style.display="";}break;case "hide":if(_92&&_92.hide){_92.hide();}else{_91.style.display="none";}break;case "disable":_93(true);break;case "enable":_93(false);break;}function _93(_94){if(_92){_92.set("disabled",_94);}else{var _95=_18.findWidgets(_91);_20.forEach(_95,function(_96){_96.set("disabled",_94);});}};};this.makeShareId=function(_97,_98){return "context_seed_"+_98+"_"+_97.hash;};var _99={};_99[_b.validation.NOT_INTEGER]="invalid_number";_99[_b.validation.RANGE_INTEGER]="range_integer";_99[_b.validation.RANGE_LONG]="range_long";_99[_b.validation.RANGE_DECIMAL]="range_decimal";_99[_b.validation.RANGE_NUMBER]="range_number";this.validate=function(_9a,_9b){var _9c=_b.validate(_9a,_9b);if(_9c===_b.validation.OK){return null;}return this.translate("mendix.lib.Validations",_99[_9c]);};this.validations=function(_9d){if(_9d.length){var _9e=[];for(var i=0,val;val=_9d[i];i++){var _9f=val.getFields();for(var x=0,_a0;_a0=_9f[x];x++){_9e.push(_a0.reason);}}this.error(_9e.join("\n"));}};this.translate=function(_a1,str,_a2,_a3){var map=_22.getObject(_a1,false,_2e);if(!map||!map[str]){return _a3||"[No translation]";}return _6e(map[str],_a2);};this.extractMessage=function(msg){if(typeof msg=="object"){if(msg.description){return msg.description;}else{if(msg.message){return msg.message;}}}return msg;};this.info=function(msg,_a4){_52(msg,"info").show(_a4);};this.warning=function(msg,_a5){_52(msg,"warning").show(_a5);};this.error=function(msg,_a6){_52(msg,"error").show(_a6);};this.exception=function(msg){this.error(msg,true);};this.confirmation=function(_a7){new _7({content:_a7.content,proceed:_a7.proceed||this.translate("mxui.widget.DialogMessage","ok"),cancel:_a7.cancel||this.translate("mxui.widget.DialogMessage","cancel"),handler:_a7.handler}).show();};this.canMoveBack=function(){return !_8.isAtBeginning();};this.downloadFile=function(_a8){var url;var obj=_a8&&_a8.mxobject;if(obj&&obj.get2("HasContents")){url=_16.getDynamicResourceUrl(obj.getGuid(),obj.get2("changedDate"));}else{return;}if(_a8.target==="window"||_a9()){url+="&target=window";if(_aa()){new _7({caption:this.translate("mendix.widget.DialogMessage","file_download"),content:this.translate("mendix.widget.DialogMessage","file_download_message"),proceed:this.translate("mendix.widget.MxDataView","download"),cancel:this.translate("mendix.widget.DialogMessage","cancel"),handler:_ab}).show();}else{_ab();}}else{_9.download({url:url+"&target=internal",target:_a8.target,error:function(err){if(_a8.error){_a8.error(err);}else{window.mx.onError(err);}}});}function _ab(){_34(url,obj.get2("Name"),"mendix_file");};function _a9(){var _ac=_1d("chrome")&&typeof window.externalHost!=="undefined";var _ad=_1d("mobile");return _ac||_ad;};function _aa(){return _1d("ie")==8||((_1d("iphone")||_1d("ipad"))&&(_1d("safari")||window.navigator.standalone))||_1d("windowsphone");};};this.getFirstDayOfWeek=function(){return window.mx.session.getConfig("uiconfig.firstDayOfWeek");};};return UI;});