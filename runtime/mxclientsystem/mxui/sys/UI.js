/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/sys/UI",["mxui/lib/form/FormFactory","mxui/lib/form/ContentForm","mxui/widget/DialogMessage","mxui/widget/Progress","mxui/widget/Underlay","mxui/widget/LoginDialog","mxui/widget/DemoUserSwitcher","mxui/widget/ConfirmationDialog","mxui/sys/history","mxui/io/iframe","mxui/dom","mendix/validator","mendix/lib/ServerError","mendix/lib/ConnectionError","mendix/lib/DescribedError","mendix/lib/DescribedServerError","mendix/lib/NavigationError","mendix/lib/ValidationError","mendix/lib/Error","mendix/lib/MxContext","mendix/lang","mendix/logger","webcore/url-helpers","big/big","fastclick/fastclick","dijit/registry","dojo/dom-class","dojo/on","dojo/aspect","dojo/cookie","dojo/has","dojo/ready","dojo/i18n","dojo/_base/array","dojo/_base/kernel","dojo/_base/lang","dojo/_base/config","require","dojox/date/buddhist","dojox/date/buddhist/locale"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,Big,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20,_21,_22,_23,_24,_25){function UI(_26){_26=_26||{};var _27=this,_28="mxui.sys.UI",_29=false,_2a=null,_2b=null,_2c=null,_2d=false,_2e="en_US",_2f=null,_30=null,_31="",_32="desktop",_33="Mendix 6",_34=null,_35={},_36,_37={"HALF_UP":1,"HALF_EVEN":2};var _38={buddhist:/th$/,hebrew:null,islamic:null};var _39=_26.openUrlFn||function(url,_3a,_3b){window.open(url,_3b);};this.startup=function(_3c){var _3d=window.mx.session.getConfig().uiconfig;_3e(_3d);_3f(_3d);_40(_3d);_41(_3d);_42(_3d.roundingmode);_43();_1b(window,"resize",_23.hitch(_27,"resize"));_44();_45();_46(_3d.modules);_47();_48(function(){_2d=document.body.dir.toLowerCase()=="rtl";_49();_29=true;_3c();});};function _3e(_4a){_30=_4a.menubars;_15.forEach(_30,function(_4b,_4c){_4d(_4b,_4c+"-");});function _4d(_4e,_4f){_21.forEach(_4e,function(_50,_51){_50.id=_4f+_51;if(_50.items){_4d(_50.items,_50.id+"-");}});};};function _3f(_52){_2e=_52.locale;_22.locale=_20.normalizeLocale(_2e.replace("_","-"));_2f=_52.translations;_53();_54();};function _40(_55){_32=_55.profile.name.toLowerCase();_33=_55.profile.title;document.title=_33;_1a.add(document.body,"profile-"+_32);};function _41(){var _56=_21.map(window.mx.session.getUserRoles("Name"),function(_57){return "role-"+_57.toLowerCase();});_1a.add(document.body,_56);};function _42(_58){Big.RM=_58?_37[_58]:_37.HALF_EVEN;};function _43(){_1c.before(window.mx,"onError",function(e){var msg;if(e instanceof _f||e instanceof _10){msg=e.message;}else{if(e instanceof _e){msg=_27.translate("mxui.sys.UI","connection_error");}else{if(e instanceof _d){msg=_27.translate("mxui.sys.UI","internal_error");}else{msg=_27.translate("mxui.sys.UI","internal_error");}}}_2a&&_2a.hide();_2a=_59(msg,"error");_2a.show(true);});};function _44(){_36=new _1();_34=new _2();_1c.after(_34,"onNavigation",function(){document.title=_33+" - "+_34.title;});_2b=new _4();_2c=new _5();var _5a=mx.session.getConfig("demoUsers");if(_5a){_21.forEach(_5a,function(_5b){_5b.active=(_5b.name==window.mx.session.getUserName());});var _5c=new _7({demoUsers:_5a});document.body.appendChild(_5c.domNode);_5c.startup();}};function _49(){var _5d=document.getElementById("content");if(!_5d){_27.exception("You are using an outdated index page. Please update your index page. See index-example.html in the deployment directory for an example of what the index page should look like.");return;}_5d.appendChild(_34.domNode);};function _45(){_9.init();_1c.after(_34,"dispose",_9.back);var _5e=null;_1c.after(_9,"onNavigation",function(_5f,_60){var _61=_60.formParams;if(!_5e){_5e=_27.showProgress();}if(_5f){var _62={};_34.onPersistViewState(_62);try{_35[_5f.id]=window.JSON.stringify(_62);}catch(e){throw new _13("One of the widgets on the previous page tried to store a complex object in its viewState");}}_34.navigateTo(_61.path,_61.title,_14.fromJSON(_61.context),_61.params,_60.id in _35?window.JSON.parse(_35[_60.id]):{},function(){_27.hideProgress(_5e);_5e=null;},function(e){if(e instanceof _11){}else{_27.hideProgress(_5e);_5e=null;window.mx.onError(e);}});},true);};function _48(_63){var _64=window.mx.session.getConfig("uiconfig.widgets");if(_64.length>0){_65();dojo.registerModulePath("widgets",window.mx.modulePath);_21.forEach(_64,function(_66){var _67=_66.split(".")[0];dojo.registerModulePath(_67,window.mx.modulePath+_67);});var _68=["widgets/widgets"];_25(_68);}_1f(_63);};function _65(){var _69=document.getElementsByTagName("head")[0],_6a=_69.querySelector("link[href*='css/theme.css']"),_6b=_b.createCssLink("widgets/widgets.css");if(_6a){_69.insertBefore(_6b,_6a);}else{_69.appendChild(_6b);}};function _46(_6c){for(var i=0,_6d;_6d=_6c[i];i++){try{dojo["require"](_6d+"."+_6d);}catch(e){_16.error(_28+".getModules: failed loading module "+_6d);}}};function _54(){var _6e=_27.getCalendarSystem();switch(_6e){case "gregorian":_31="dojo.date";return;case "buddhist":_31="dojox.date.buddhist";dojo["require"](_31);dojo["require"](_31+".locale");return;default:throw new Error("Unsupported date package: "+_6e);}};function _47(){if(!_1e("windowsphone")){_18.attach(document.body);}if(_1e("ie")){if(JSON.stringify(document.createElement("input").value)==="\"null\""){var _6f=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value").get;Object.defineProperty(HTMLInputElement.prototype,"value",{get:function(){var _70=_6f.call(this);return _70===""?"":_70;}});}_1b(document,"click",function(e){var _71=e.target;if(_71.nodeName=="TEXTAREA"||_71.nodeName=="INPUT"&&(_71.type=="text"||_71.type=="password")){if(document.activeElement!=_71){var sel=_b.getSelection(_71);try{_71.focus();}catch(ex){}_b.selectTextRange(_71,sel.start,sel.end);}}if(_1e("ie")<=8){if(_71.nodeName=="INPUT"&&(_71.type==="checkbox"||_71.type==="radio")){_b.dispatchEvent(_71,"onchange");}}});}};function _53(){var map={"mendix":"mxui","mendix.core.MxServer":"mendix.core.Server","mendix.widget.MxDataView":"mendix.widget.MxFormView","mendix.widget.MxNavigator":"mendix.widget.Navigator","mendix.widget.MxDataGrid":"mendix.widget.DataGrid","mendix.widget.DataGrid.true":"mxui.common.true","mendix.widget.DataGrid.false":"mxui.common.false","mendix.core.MxServer.invalid_session":"mendix.session.session_expired","mobile.widget.Dialog.ok":"mxui.widget.DialogMessage.ok","mxui.widget.Dialog.error":"mxui.widget.DialogMessage.error","mxui.widget.Dialog.information":"mxui.widget.DialogMessage.info","mxui.widget.Dialog.warning":"mxui.widget.DialogMessage.warning","mxui.widget.Dialog.confirmation":"mxui.widget.ConfirmationDialog.caption","mobile.widget":"mxui.widget","mobile.sys":"mxui.sys"};for(var _72 in map){var _73=_72.split("."),_74=map[_72].split("."),_75=_73.pop(),_76=_74.pop(),_77=_2f,_78=_77,_79;while(_77&&(_79=_73.shift())){_77=_77[_79];}if(_77){while(_79=_74.shift()){_78=_78[_79]=_78[_79]||{};}if(_78[_76]){_23.mixin(_78[_76],_77[_75]);}else{_78[_76]=_77[_75];}}}};function _59(msg,_7a){return new _3({type:_7a,content:""+_27.extractMessage(msg)});};this.openFormInContent=function(_7b,_7c,_7d,_7e){_9.push({id:_15.getUniqueId(),formParams:{path:_7b,title:_7c,context:(_7d||new _14()).toJSON(),params:_7e||{}}});};this.openFormInPopup=function(_7f,_80,_81,_82,_83,_84){var _85=this,pid=this.showProgress();_36.openPopupForm(_7f,_80,(_81||new _14()),(_82||{}),function(_86){_85.hideProgress(pid);_83&&_83(_86);},function(e){_85.hideProgress(pid);_84?_84(e):window.mx.onError(e);});};this.openFormInNode=function(_87,_88,_89,_8a,_8b,_8c){var _8d=this,pid=this.showProgress();_36.openInlineForm(_87,_88,(_89||new _14()),(_8a||{}),function(_8e){_8d.hideProgress(pid);_8b&&_8b(_8e);},function(e){_8d.hideProgress(pid);_8c?_8c(e):window.mx.onError(e);});};function _8f(fmt,_90){if(!_90){return fmt;}else{if(!(_90 instanceof Array)){_90=[_90];}}return fmt.replace(/\{(\d+)\}/g,function(_91,n){var _92=_90[n-1];if(_92!=null){return _92;}else{return _91;}});};this.toString=function(){return _28;};this.getCurrentForm=function(){return _34;};this.getProfile=function(){return _32;};this.getMenu=function(_93){return _30[_93]||[];};this.getDatePackage=function(){return _31;};this.getCalendarSystem=function(){for(var m in _38){var re=_38[m];if(re&&re.test(_22.locale.toLowerCase())){return m;}}return "gregorian";};this.isRtl=function(){return _2d;};this.resize=function(){_34.resize();};this.execute=function(_94,_95,_96){var _97=_23.mixin({},_94.microflow||_94.form,_95);if(_97.allowedRoles&&!window.mx.session.hasSomeRole(_97.allowedRoles)){if(window.mx.session.isGuest()){this.showLogin();}else{window.mx.onError(new _f("Unable to execute action because you do not have sufficient permissions."));}return;}if(_94.microflow){this.action(_97.name,_97,_96);}else{if(_94.form){this.openForm(_97.path,_97,_96);}else{_16.error(_28+".execute: unknown action type");}}};this.action=function(_98,_99,_9a){_99=_99||{};_23.setObject("params.actionname",_98,_99);var _9b;if("progress" in _99){_9b=this.getProgress(_99.progressMsg,_99.progress=="modal");_9b.start();}window.mx.data.action({callback:_9c(_99.callback),error:_9c(function(e){if(_99.error){_99.error.call(_9a,e);}else{if(!(e instanceof _12)){window.mx.onError(e);}}}),context:_99.context,async:_99.async,params:_99.params,store:_23.mixin({caller:_34},_99.store)});function _9c(_9d){return function(){try{if(_9d){_9d.apply(_9a,arguments);}}finally{if(_9b){_9b.stop();}if(_99.complete){_99.complete.apply(_9a);}}};};};this.back=function(){_9.back();};this.showProgress=function(msg,_9e){return _2b.add(msg||"",_9e);};this.hideProgress=function(id){return _2b.remove(id);};this.showUnderlay=function(_9f){_2c.show(_9f);};this.hideUnderlay=function(_a0){_2c.hide(_a0);};this.getProgress=function(msg,_a1){var id,_a2;return {start:function(){if(_a2){return id;}else{_a2=true;return id=_27.showProgress(msg,_a1);}},stop:function(){if(_a2){_a2=false;_27.hideProgress(id);}}};};function _a3(_a4){if(!_29){var _a5=window.mx.session.getConfig("profile");if(_a5){_32=_a5.name.toLowerCase();_1a.add(document.body,"profile-"+_32);document.title=_a5.title;}}if(!window.i18nMap){window.mx.server.get({url:"js/login_i18n.js",handleAs:"javascript",load:_a4});}else{_a4();}};this.showLogin=function(_a6){if(_a6=="402"){this.exception(window.i18nMap.http402);return;}var _a7=_1d("originURI");if(_a7){_1d("originURI",null,{expires:-1});window.mx.redirect(_a7);return;}_a3(function(){new _6({messageCode:_a6}).show();});};this.openForm=function(_a8,_a9,_aa){if(_a9.domNode){this.openFormInNode(_a8,_a9.domNode,_a9.context,_a9.params,_a9.callback?_23.hitch(_aa,_a9.callback):null,_a9.error?_23.hitch(_aa,_a9.error):null);}else{if(/popup|modal/.test(_a9.location)){_a9.modal=_a9.location=="modal";this.openFormInPopup(_a8,_a9,_a9.context,_a9.params,_a9.callback?_23.hitch(_aa,_a9.callback):null,_a9.error?_23.hitch(_aa,_a9.error):null);}else{if(_a9.callback||_a9.error){throw new Error("Success and error callbacks are not supported for openFormInContent");}this.openFormInContent(_a8,_a9.title,_a9.context,_a9.params);}}};this.reload=function(_ab){var _ac=mxui.currentForm;if(!_ac){throw new _13("Trying to refresh the content form but no form is yet available.");}_ac.reload(_ab);};this.getTemplate=function(id,_ad){var _ae=_34.widgetTemplates[id];return _ae&&_23.clone(_ae[_ad]);};this.applyToNode=function(_af,_b0){var _b1=_19.byNode(_b0);switch(_af){case "show":if(_b1&&_b1.show){_b1.show();}else{_b0.style.display="";}break;case "hide":if(_b1&&_b1.hide){_b1.hide();}else{_b0.style.display="none";}break;case "disable":_b2(true);break;case "enable":_b2(false);break;}function _b2(_b3){if(_b1){_b1.set("disabled",_b3);}else{var _b4=_19.findWidgets(_b0);_21.forEach(_b4,function(_b5){_b5.set("disabled",_b3);});}};};this.makeShareId=function(_b6,_b7){return "context_seed_"+_b7+"_"+_b6.hash;};var _b8={};_b8[_c.validation.NOT_INTEGER]="invalid_number";_b8[_c.validation.RANGE_INTEGER]="range_integer";_b8[_c.validation.RANGE_LONG]="range_long";_b8[_c.validation.RANGE_DECIMAL]="range_decimal";_b8[_c.validation.RANGE_NUMBER]="range_number";this.validate=function(_b9,_ba){var _bb=_c.validate(_b9,_ba);if(_bb===_c.validation.OK){return null;}return this.translate("mendix.lib.Validations",_b8[_bb]);};this.validations=function(_bc){if(_bc.length){var _bd=[];for(var i=0,val;val=_bc[i];i++){var _be=val.getFields();for(var x=0,_bf;_bf=_be[x];x++){_bd.push(_bf.reason);}}this.error(_bd.join("\n"));}};this.translate=function(_c0,str,_c1,_c2){var map=_23.getObject(_c0,false,_2f);if(!map||!map[str]){return _c2||"[No translation]";}return _8f(map[str],_c1);};this.extractMessage=function(msg){if(typeof msg=="object"){if(msg.description){return msg.description;}else{if(msg.message){return msg.message;}}}return msg;};this.info=function(msg,_c3){_59(msg,"info").show(_c3);};this.warning=function(msg,_c4){_59(msg,"warning").show(_c4);};this.error=function(msg,_c5){_59(msg,"error").show(_c5);};this.exception=function(msg){this.error(msg,true);};this.confirmation=function(_c6){new _8({content:_c6.content,proceed:_c6.proceed||this.translate("mxui.widget.DialogMessage","ok"),cancel:_c6.cancel||this.translate("mxui.widget.DialogMessage","cancel"),handler:_c6.handler}).show();};this.canMoveBack=function(){return !_9.isAtBeginning();};this.downloadFile=function(_c7){var url;var obj=_c7&&_c7.mxobject;if(obj&&obj.get2("HasContents")){url=_17.getDynamicResourceUrl(obj.getGuid(),obj.get2("changedDate"));}else{return;}if(_c7.target==="window"||_c8()){url+="&target=window";if(_c9()){new _8({caption:this.translate("mendix.widget.DialogMessage","file_download"),content:this.translate("mendix.widget.DialogMessage","file_download_message"),proceed:this.translate("mendix.widget.MxDataView","download"),cancel:this.translate("mendix.widget.DialogMessage","cancel"),handler:_ca}).show();}else{_ca();}}else{_a.download({url:url+"&target=internal",target:_c7.target,error:function(err){if(_c7.error){_c7.error(err);}else{window.mx.onError(err);}}});}function _ca(){_39(url,obj.get2("Name"),"mendix_file");};function _c8(){var _cb=_1e("chrome")&&typeof window.externalHost!=="undefined";var _cc=_1e("mobile");return _cb||_cc;};function _c9(){return _1e("ie")==8||((_1e("iphone")||_1e("ipad"))&&(_1e("safari")||window.navigator.standalone))||_1e("windowsphone");};};this.getFirstDayOfWeek=function(){return window.mx.session.getConfig("uiconfig.firstDayOfWeek");};};return UI;});