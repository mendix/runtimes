/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/sys/UI",["mxui/lib/form/FormFactory","mxui/lib/form/ContentForm","mxui/widget/DialogMessage","mxui/widget/Progress","mxui/widget/Underlay","mxui/widget/LoginDialog","mxui/widget/DemoUserSwitcher","mxui/widget/ConfirmationDialog","mxui/sys/history","mxui/io/iframe","mxui/dom","mendix/validator","mendix/lib/ServerError","mendix/lib/ConnectionError","mendix/lib/DescribedServerError","mendix/lib/NavigationError","mendix/lib/ValidationError","mendix/lib/Error","mendix/lib/MxContext","mendix/lang","mendix/logger","big/big","dijit/registry","dojo/dom-class","dojo/on","dojo/aspect","dojo/cookie","dojo/has","dojo/ready","dojo/i18n","dojo/_base/array","dojo/_base/kernel","dojo/_base/lang","dojo/_base/config","dojox/date/buddhist","dojox/date/buddhist/locale"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,Big,_16,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20,_21){function UI(){var _22=this,_23="mxui.sys.UI",_24=false,_25=null,_26=null,_27=null,_28=false,_29="en_US",_2a=null,_2b=null,_2c="",_2d="desktop",_2e="Mendix 5",_2f=null,_30,_31={"HALF_UP":1,"HALF_EVEN":2};var _32={buddhist:/th$/,hebrew:null,islamic:null};this.startup=function(_33){var _34=window.mx.session.getConfig().uiconfig;_35(_34);_36(_34);_37(_34);_38(_34);_39(_34.roundingmode);_3a();_18(window,"resize",_20.hitch(_22,"resize"));_3b();_3c();_3d(_34.modules);_3e();_14.collect([_3f,_1c],function(){_28=document.body.dir.toLowerCase()=="rtl";_40();_24=true;_33();});};function _35(_41){_2b=_41.menubars;_14.forEach(_2b,function(_42,_43){_44(_42,_43+"-");});function _44(_45,_46){_1e.forEach(_45,function(_47,_48){_47.id=_46+_48;if(_47.items){_44(_47.items,_47.id+"-");}});};};function _36(_49){_29=_49.locale;_1f.locale=_1d.normalizeLocale(_29.replace("_","-"));_2a=_49.translations;_4a();_4b();};function _37(_4c){_2d=_4c.profile.name.toLowerCase();_2e=_4c.profile.title;document.title=_2e;_17.add(document.body,"profile-"+_2d);};function _38(){var _4d=_1e.map(window.mx.session.getUserRoles("Name"),function(_4e){return "role-"+_4e.toLowerCase();});_17.add(document.body,_4d);};function _39(_4f){Big.RM=_4f?_31[_4f]:_31.HALF_EVEN;};function _3a(){_19.before(window.mx,"onError",function(e){var msg;if(e instanceof _f){msg=e.message;}else{if(e instanceof _e){msg=_22.translate("mxui.sys.UI","connection_error");}else{if(e instanceof _d){msg=_22.translate("mxui.sys.UI","internal_error");}else{msg=_22.translate("mxui.sys.UI","internal_error");}}}_25&&_25.hide();_25=_50(msg,"error");_25.show(true);_15.error(e);});};function _3b(){_30=new _1();_2f=new _2();_19.after(_2f,"onNavigation",function(){document.title=_2e+" - "+_2f.title;_17.add(document.body,"mx-no-scroll");setTimeout(function(){_17.remove(document.body,"mx-no-scroll");},0);});_26=new _4();_27=new _5();var _51=mx.session.getConfig("demoUsers");if(_51){_1e.forEach(_51,function(_52){_52.active=(_52.name==window.mx.session.getUserName());});var _53=new _7({demoUsers:_51});document.body.appendChild(_53.domNode);_53.startup();}};function _40(){var _54=document.getElementById("content");if(!_54){_22.exception("You are using an outdated index template. Please update your index template.");return;}_54.appendChild(_2f.domNode);};function _3c(){_9.init();_19.after(_2f,"dispose",_9.back);var _55=null;_19.after(_9,"onNavigation",function(_56,_57){if(!_57){return;}var _58=_57.formParams;if(!_55){_55=_22.showProgress();}if(_56){_2f.onPersistViewState(_56.viewState);}if(!_57.viewState){_57.viewState={};}_2f.navigateTo(_58.path,_58.title,_58.context,_58.params,_20.clone(_57.viewState),function(){_22.hideProgress(_55);_55=null;},function(e){if(e instanceof _10){}else{_22.hideProgress(_55);_55=null;window.mx.onError(e);}});},true);};function _3f(_59){var _5a=document.getElementsByTagName("head")[0],_5b=window.mx.server.getCacheBust(),_5c=_5a.querySelector("link[href$='css/theme.css']"),_5d=_b.createCssLink("widgets/widgets.css?"+_5b);if(_5c){_5a.insertBefore(_5d,_5c);}else{_5a.appendChild(_5d);}var _5e=[],_5f=window.mx.session.getConfig("uiconfig.widgets");if(_5f.length>0){if(!_21.isDebug){_5e.push("widgets/widgets.js?"+_5b);}else{_1e.forEach(_5f,function(_60){var _61=_60.split(".");dojo.registerModulePath(_61[0],window.mx.modulePath+_61[0]);});_5e=_1e.map(_5f,function(_62){var _63=_62.split(".");return "widgets/"+_63.join("/")+".js?"+_5b;});}}_b.addScripts(_5e,_59);};function _3d(_64){for(var i=0,_65;_65=_64[i];i++){try{dojo["require"](_65+"."+_65);}catch(e){_15.error(_23+".getModules: failed loading module "+_65);}}};function _4b(){var _66=_22.getCalendarSystem();switch(_66){case "gregorian":_2c="dojo.date";return;case "buddhist":_2c="dojox.date.buddhist";dojo["require"](_2c);dojo["require"](_2c+".locale");return;default:throw new Error("Unsupported date package: "+_66);}};function _3e(){if(_1b("ie")){if(JSON.stringify(document.createElement("input").value)==="\"null\""){var _67=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value").get;Object.defineProperty(HTMLInputElement.prototype,"value",{get:function(){var _68=_67.call(this);return _68===""?"":_68;}});}_18(document,"click",function(e){var _69=e.target;if(_69.nodeName=="TEXTAREA"||_69.nodeName=="INPUT"&&(_69.type=="text"||_69.type=="password")){if(document.activeElement!=_69){var sel=_b.getSelection(_69);try{_69.focus();}catch(ex){}_b.selectTextRange(_69,sel.start,sel.end);}}if(_1b("ie")<=8){if(_69.nodeName=="INPUT"&&_69.type=="checkbox"){_b.dispatchEvent(_69,"onchange");}}});}};function _4a(){var map={"mendix":"mxui","mendix.core.MxServer":"mendix.core.Server","mendix.widget.MxDataView":"mendix.widget.MxFormView","mendix.widget.MxNavigator":"mendix.widget.Navigator","mendix.widget.MxDataGrid":"mendix.widget.DataGrid","mendix.widget.DataGrid.true":"mxui.common.true","mendix.widget.DataGrid.false":"mxui.common.false","mendix.core.MxServer.invalid_session":"mendix.session.session_expired","mobile.widget.Dialog.ok":"mxui.widget.DialogMessage.ok","mxui.widget.Dialog.error":"mxui.widget.DialogMessage.error","mxui.widget.Dialog.information":"mxui.widget.DialogMessage.info","mxui.widget.Dialog.warning":"mxui.widget.DialogMessage.warning","mxui.widget.Dialog.confirmation":"mxui.widget.ConfirmationDialog.caption","mobile.widget":"mxui.widget","mobile.sys":"mxui.sys"};for(var _6a in map){var _6b=_6a.split("."),_6c=map[_6a].split("."),_6d=_6b.pop(),_6e=_6c.pop(),_6f=_2a,_70=_6f,_71;while(_6f&&(_71=_6b.shift())){_6f=_6f[_71];}if(_6f){while(_71=_6c.shift()){_70=_70[_71]=_70[_71]||{};}if(_70[_6e]){_20.mixin(_70[_6e],_6f[_6d]);}else{_70[_6e]=_6f[_6d];}}}};function _50(msg,_72){return new _3({type:_72,content:""+_22.extractMessage(msg)});};this.openFormInContent=function(_73,_74,_75,_76){_9.push({formParams:{path:_73,title:_74,context:_75||new _13(),params:_76||{}}});};this.openFormInPopup=function(_77,_78,_79,_7a,_7b,_7c){var _7d=this,pid=this.showProgress();_30.openPopupForm(_77,_78,(_79||new _13()),(_7a||{}),function(_7e){_7d.hideProgress(pid);_7b&&_7b(_7e);},function(e){_7d.hideProgress(pid);_7c?_7c(e):window.mx.onError(e);});};this.openFormInNode=function(_7f,_80,_81,_82,_83,_84){var _85=this,pid=this.showProgress();_30.openInlineForm(_7f,_80,(_81||new _13()),(_82||{}),function(_86){_85.hideProgress(pid);_83&&_83(_86);},function(e){_85.hideProgress(pid);_84?_84(e):window.mx.onError(e);});};function _87(fmt,_88){if(!_88){return fmt;}else{if(!(_88 instanceof Array)){_88=[_88];}}return fmt.replace(/\{(\d+)\}/g,function(_89,n){var _8a=_88[n-1];if(_8a!=null){return _8a;}else{return _89;}});};this.toString=function(){return _23;};this.getCurrentForm=function(){return _2f;};this.getProfile=function(){return _2d;};this.getMenu=function(_8b){return _2b[_8b]||[];};this.getDatePackage=function(){return _2c;};this.getCalendarSystem=function(){for(var m in _32){var re=_32[m];if(re&&re.test(_1f.locale.toLowerCase())){return m;}}return "gregorian";};this.isRtl=function(){return _28;};this.resize=function(){_2f.resize();};this.execute=function(_8c,_8d,_8e){var cfg={};if(_8c.microflow){_20.mixin(cfg,_8c.microflow,_8d);window.mx.ui.action(cfg.name,cfg,_8e);}else{if(_8c.form){_20.mixin(cfg,_8c.form,_8d);window.mx.ui.openForm(cfg.path,cfg,_8e);}else{_15.error(_23+".execute: unknown action type");}}};this.action=function(_8f,_90,_91){_90=_90||{};_20.setObject("params.actionname",_8f,_90);var _92=_90.callback,_93=_90.error,_94=_20.mixin({caller:_2f},_90.store),_95;if("progress" in _90){_95=this.getProgress(_90.progressMsg,_90.progress=="modal");_95.start();}window.mx.data.action({callback:function(_96){_92&&_92.call(_91,_96);_95&&_95.stop();},error:function(e){_95&&_95.stop();if(_93){_93.call(_91,e);}else{if(e&&!(e instanceof _11)){window.mx.onError(e);}}},context:_90.context,async:_90.async,params:_90.params,store:_94});};this.back=function(){_9.back();};this.showProgress=function(msg,_97){return _26.add(msg||"",_97);};this.hideProgress=function(id){return _26.remove(id);};this.showUnderlay=function(_98){_27.show(_98);};this.hideUnderlay=function(_99){_27.hide(_99);};this.getProgress=function(msg,_9a){var id,_9b;return {start:function(){if(_9b){return id;}else{_9b=true;return id=_22.showProgress(msg,_9a);}},stop:function(){if(_9b){_9b=false;_22.hideProgress(id);}}};};function _9c(_9d){if(!_24){var _9e=window.mx.session.getConfig("profile");if(_9e){_2d=_9e.name.toLowerCase();_17.add(document.body,"profile-"+_2d);document.title=_9e.title;}}if(!window.i18nMap){window.mx.server.get({url:"js/login_i18n.js",handleAs:"javascript",load:_9d});}else{_9d();}};this.showLogin=function(_9f){if(_9f=="402"){this.exception(window.i18nMap.http402);return;}var _a0=_1a("originURI");if(_a0){_1a("originURI",null,{expires:-1});window.mx.redirect(_a0);return;}_9c(function(){new _6({messageCode:_9f}).show();});};this.openForm=function(_a1,_a2,_a3){if(_a2.domNode){this.openFormInNode(_a1,_a2.domNode,_a2.context,_a2.params,_a2.callback?_20.hitch(_a3,_a2.callback):null,_a2.error?_20.hitch(_a3,_a2.error):null);}else{if(/popup|modal/.test(_a2.location)){_a2.modal=_a2.location=="modal";this.openFormInPopup(_a1,_a2,_a2.context,_a2.params,_a2.callback?_20.hitch(_a3,_a2.callback):null,_a2.error?_20.hitch(_a3,_a2.error):null);}else{if(_a2.callback||_a2.error){throw new Error("Success and error callbacks are not supported for openFormInContent");}this.openFormInContent(_a1,_a2.title,_a2.context,_a2.params);}}};this.reload=function(_a4){var _a5=mxui.currentForm;if(!_a5){throw new _12("Trying to refresh the content form but no form is yet available.");}_a5.reload(_a4);};this.getTemplate=function(id,_a6){var _a7=_2f.widgetTemplates[id];return _a7&&_20.clone(_a7[_a6]);};this.applyToNode=function(_a8,_a9){var _aa=_16.byNode(_a9);switch(_a8){case "show":if(_aa&&_aa.show){_aa.show();}else{_a9.style.display="";}break;case "hide":if(_aa&&_aa.hide){_aa.hide();}else{_a9.style.display="none";}break;case "disable":if(_aa){_aa.set("disabled",true);}break;case "enable":if(_aa){_aa.set("disabled",false);}break;}};this.makeShareId=function(_ab,_ac){return "context_seed_"+_ac+"_"+_ab.hash;};var _ad={};_ad[_c.validation.NOT_INTEGER]="invalid_number";_ad[_c.validation.RANGE_INTEGER]="range_integer";_ad[_c.validation.RANGE_LONG]="range_long";_ad[_c.validation.RANGE_DECIMAL]="range_decimal";_ad[_c.validation.RANGE_NUMBER]="range_number";this.validate=function(_ae,_af){var _b0=_c.validate(_ae,_af);if(_b0===_c.validation.OK){return null;}return this.translate("mendix.lib.Validations",_ad[_b0]);};this.validations=function(_b1){if(_b1.length){var _b2=[];for(var i=0,val;val=_b1[i];i++){var _b3=val.getFields();for(var x=0,_b4;_b4=_b3[x];x++){_b2.push(_b4.reason);}}this.error(_b2.join("\n"));}};this.translate=function(_b5,str,_b6,_b7){var map=_20.getObject(_b5,false,_2a);if(!map||!map[str]){return _b7||"[No translation]";}return _87(map[str],_b6);};this.extractMessage=function(msg){if(typeof msg=="object"){if(msg.description){return msg.description;}else{if(msg.message){return msg.message;}}}return msg;};this.info=function(msg,_b8){_50(msg,"info").show(_b8);};this.warning=function(msg,_b9){_50(msg,"warning").show(_b9);};this.error=function(msg,_ba){_50(msg,"error").show(_ba);};this.exception=function(msg){this.error(msg,true);};this.confirmation=function(_bb){new _8({content:_bb.content,proceed:_bb.proceed||this.translate("mxui.widget.DialogMessage","ok"),cancel:_bb.cancel||this.translate("mxui.widget.DialogMessage","cancel"),handler:_bb.handler}).show();};this.encodeUrlHash=function(_bc,_bd,_be){var _bf=_bc.substr(0,_bc.lastIndexOf(".")),_c0=_bd.toQuery();return "!/"+_bf+(_c0?"?"+_c0:"")+";"+_be;};this.decodeUrlHash=function(_c1){if(_c1.charAt(0)=="!"){var _c2=_c1.lastIndexOf(";");_c1=_c1.slice(2,_c2!=-1?_c2:_c1.length);if(/^\w+(\/\w+(\?\w+\.\w+\=\d+(&\w+\.\w+\=\d+)*)?|\.\w+(\?\d+(&\d+)*)?)$/.test(_c1)){var _c3=_c1.split("?"),_c4=_c3[0],_c5=_c3[1],_c6=new _13(),_c7,_c8;if(_c4.indexOf("/")!=-1){if(_c5){_c7=_c5.split("&");for(var i=_c7.length;_c8=_c7[--i];){var _c9=_c8.split("=");_c6.setContext(_c9[0],_c9[1]);}}return function(_ca){window.mx.ui.openFormInContent(_c4+".page.xml","",_c6);_ca&&_ca();};}else{if(_c5){_c7=_c5.split("&");for(var j=0;_c8=_c7[j++];){_c6.setContext(" ",_c8);}}return function(_cb){window.mx.data.action({context:_c6,params:{actionname:_c4},callback:_cb,error:function(e){window.mx.onError(e);_cb&&_cb();}});};}}else{return null;}}else{return null;}};this.downloadFile=function(_cc){var obj=_cc?_cc.mxobject:null,url;if(obj&&obj.get2("HasContents")){url="file?guid="+obj.getGuid();}else{if(_cc.url){url=_cc.url;}}if(!url){return;}if(_cc.target==="window"||_cd()){if(_ce()){new _8({caption:this.translate("mendix.widget.DialogMessage","file_download"),content:this.translate("mendix.widget.DialogMessage","file_download_message"),proceed:this.translate("mendix.widget.MxDataView","download"),cancel:this.translate("mendix.widget.DialogMessage","cancel"),handler:function(){window.open(url,"mendix_file");}}).show(true);}else{window.open(url,"mendix_file");}}else{_a.download({url:window.mx.appUrl+url,target:_cc.target,error:function(err){if(_cc.error){_cc.error(err);}else{window.mx.onError(err);}}});}function _cd(){var _cf=_1b("chrome")&&typeof window.externalHost!=="undefined";var _d0=_2d!="desktop";return _cf||_d0;};function _ce(){return _1b("ie")==8||(_1b("safari")&&(_1b("iphone")||_1b("ipad")))||_1b("windowsphone");};};this.getFirstDayOfWeek=function(){return window.mx.session.getConfig("uiconfig.firstDayOfWeek");};};return UI;});