/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/sys/UI",["mxui/lib/form/FormFactory","mxui/lib/form/ContentForm","mxui/widget/DialogMessage","mxui/widget/Progress","mxui/widget/Underlay","mxui/widget/LoginDialog","mxui/widget/DemoUserSwitcher","mxui/widget/ConfirmationDialog","mxui/sys/history","mxui/io/iframe","mxui/dom","mendix/validator","mendix/lib/ServerError","mendix/lib/ConnectionError","mendix/lib/DescribedError","mendix/lib/DescribedServerError","mendix/lib/NavigationError","mendix/lib/ValidationError","mendix/lib/Error","mendix/lib/MxContext","mendix/lang","mendix/logger","webcore/url-helpers","big/big","fastclick/fastclick","dijit/registry","dojo/dom-class","dojo/on","dojo/aspect","dojo/cookie","dojo/has","dojo/ready","dojo/i18n","dojo/_base/array","dojo/_base/kernel","dojo/_base/lang","dojo/_base/config","require","dojox/date/buddhist","dojox/date/buddhist/locale"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,_16,_17,Big,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20,_21,_22,_23,_24,_25){function UI(_26){_26=_26||{};var _27=this,_28="mxui.sys.UI",_29=false,_2a=null,_2b=null,_2c=null,_2d=false,_2e="en_US",_2f=null,_30=null,_31="",_32="desktop",_33="Mendix 6",_34=null,_35,_36={"HALF_UP":1,"HALF_EVEN":2};var _37={buddhist:/th$/,hebrew:null,islamic:null};var _38=_26.openUrlFn||function(url,_39,_3a){window.open(url,_3a);};this.startup=function(_3b){var _3c=window.mx.session.getConfig().uiconfig;_3d(_3c);_3e(_3c);_3f(_3c);_40(_3c);_41(_3c.roundingmode);_42();_1b(window,"resize",_23.hitch(_27,"resize"));_43();_44();_45(_3c.modules);_46();_47(function(){_2d=document.body.dir.toLowerCase()=="rtl";_48();_29=true;_3b();});};function _3d(_49){_30=_49.menubars;_15.forEach(_30,function(_4a,_4b){_4c(_4a,_4b+"-");});function _4c(_4d,_4e){_21.forEach(_4d,function(_4f,_50){_4f.id=_4e+_50;if(_4f.items){_4c(_4f.items,_4f.id+"-");}});};};function _3e(_51){_2e=_51.locale;_22.locale=_20.normalizeLocale(_2e.replace("_","-"));_2f=_51.translations;_52();_53();};function _3f(_54){_32=_54.profile.name.toLowerCase();_33=_54.profile.title;document.title=_33;_1a.add(document.body,"profile-"+_32);};function _40(){var _55=_21.map(window.mx.session.getUserRoles("Name"),function(_56){return "role-"+_56.toLowerCase();});_1a.add(document.body,_55);};function _41(_57){Big.RM=_57?_36[_57]:_36.HALF_EVEN;};function _42(){_1c.before(window.mx,"onError",function(e){var msg;if(e instanceof _f||e instanceof _10){msg=e.message;}else{if(e instanceof _e){msg=_27.translate("mxui.sys.UI","connection_error");}else{if(e instanceof _d){msg=_27.translate("mxui.sys.UI","internal_error");}else{msg=_27.translate("mxui.sys.UI","internal_error");}}}_2a&&_2a.hide();_2a=_58(msg,"error");_2a.show(true);});};function _43(){_35=new _1();_34=new _2();_1c.after(_34,"onNavigation",function(){document.title=_33+" - "+_34.title;});_2b=new _4();_2c=new _5();var _59=mx.session.getConfig("demoUsers");if(_59){_21.forEach(_59,function(_5a){_5a.active=(_5a.name==window.mx.session.getUserName());});var _5b=new _7({demoUsers:_59});document.body.appendChild(_5b.domNode);_5b.startup();}};function _48(){var _5c=document.getElementById("content");if(!_5c){_27.exception("You are using an outdated index page. Please update your index page. See index-example.html in the deployment directory for an example of what the index page should look like.");return;}_5c.appendChild(_34.domNode);};function _44(){_9.init();_1c.after(_34,"dispose",_9.back);var _5d=null;_1c.after(_9,"onNavigation",function(_5e,_5f){if(!_5f){return;}var _60=_5f.formParams;if(!_5d){_5d=_27.showProgress();}if(_5e){_34.onPersistViewState(_5e.viewState);}if(!_5f.viewState){_5f.viewState={};}_34.navigateTo(_60.path,_60.title,_60.context,_60.params,_23.clone(_5f.viewState),function(){_27.hideProgress(_5d);_5d=null;},function(e){if(e instanceof _11){}else{_27.hideProgress(_5d);_5d=null;window.mx.onError(e);}});},true);};function _47(_61){var _62=window.mx.session.getConfig("uiconfig.widgets");if(_62.length>0){_63();dojo.registerModulePath("widgets",window.mx.modulePath);_21.forEach(_62,function(_64){var _65=_64.split(".")[0];dojo.registerModulePath(_65,window.mx.modulePath+_65);});var _66=["widgets/widgets"];_25(_66);}_1f(_61);};function _63(){var _67=document.getElementsByTagName("head")[0],_68=_67.querySelector("link[href*='css/theme.css']"),_69=_b.createCssLink("widgets/widgets.css");if(_68){_67.insertBefore(_69,_68);}else{_67.appendChild(_69);}};function _45(_6a){for(var i=0,_6b;_6b=_6a[i];i++){try{dojo["require"](_6b+"."+_6b);}catch(e){_16.error(_28+".getModules: failed loading module "+_6b);}}};function _53(){var _6c=_27.getCalendarSystem();switch(_6c){case "gregorian":_31="dojo.date";return;case "buddhist":_31="dojox.date.buddhist";dojo["require"](_31);dojo["require"](_31+".locale");return;default:throw new Error("Unsupported date package: "+_6c);}};function _46(){if(!_1e("windowsphone")){_18.attach(document.body);}if(_1e("ie")){if(JSON.stringify(document.createElement("input").value)==="\"null\""){var _6d=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value").get;Object.defineProperty(HTMLInputElement.prototype,"value",{get:function(){var _6e=_6d.call(this);return _6e===""?"":_6e;}});}_1b(document,"click",function(e){var _6f=e.target;if(_6f.nodeName=="TEXTAREA"||_6f.nodeName=="INPUT"&&(_6f.type=="text"||_6f.type=="password")){if(document.activeElement!=_6f){var sel=_b.getSelection(_6f);try{_6f.focus();}catch(ex){}_b.selectTextRange(_6f,sel.start,sel.end);}}if(_1e("ie")<=8){if(_6f.nodeName=="INPUT"&&(_6f.type==="checkbox"||_6f.type==="radio")){_b.dispatchEvent(_6f,"onchange");}}});}};function _52(){var map={"mendix":"mxui","mendix.core.MxServer":"mendix.core.Server","mendix.widget.MxDataView":"mendix.widget.MxFormView","mendix.widget.MxNavigator":"mendix.widget.Navigator","mendix.widget.MxDataGrid":"mendix.widget.DataGrid","mendix.widget.DataGrid.true":"mxui.common.true","mendix.widget.DataGrid.false":"mxui.common.false","mendix.core.MxServer.invalid_session":"mendix.session.session_expired","mobile.widget.Dialog.ok":"mxui.widget.DialogMessage.ok","mxui.widget.Dialog.error":"mxui.widget.DialogMessage.error","mxui.widget.Dialog.information":"mxui.widget.DialogMessage.info","mxui.widget.Dialog.warning":"mxui.widget.DialogMessage.warning","mxui.widget.Dialog.confirmation":"mxui.widget.ConfirmationDialog.caption","mobile.widget":"mxui.widget","mobile.sys":"mxui.sys"};for(var _70 in map){var _71=_70.split("."),_72=map[_70].split("."),_73=_71.pop(),_74=_72.pop(),_75=_2f,_76=_75,_77;while(_75&&(_77=_71.shift())){_75=_75[_77];}if(_75){while(_77=_72.shift()){_76=_76[_77]=_76[_77]||{};}if(_76[_74]){_23.mixin(_76[_74],_75[_73]);}else{_76[_74]=_75[_73];}}}};function _58(msg,_78){return new _3({type:_78,content:""+_27.extractMessage(msg)});};this.openFormInContent=function(_79,_7a,_7b,_7c){_9.push({formParams:{path:_79,title:_7a,context:_7b||new _14(),params:_7c||{}}});};this.openFormInPopup=function(_7d,_7e,_7f,_80,_81,_82){var _83=this,pid=this.showProgress();_35.openPopupForm(_7d,_7e,(_7f||new _14()),(_80||{}),function(_84){_83.hideProgress(pid);_81&&_81(_84);},function(e){_83.hideProgress(pid);_82?_82(e):window.mx.onError(e);});};this.openFormInNode=function(_85,_86,_87,_88,_89,_8a){var _8b=this,pid=this.showProgress();_35.openInlineForm(_85,_86,(_87||new _14()),(_88||{}),function(_8c){_8b.hideProgress(pid);_89&&_89(_8c);},function(e){_8b.hideProgress(pid);_8a?_8a(e):window.mx.onError(e);});};function _8d(fmt,_8e){if(!_8e){return fmt;}else{if(!(_8e instanceof Array)){_8e=[_8e];}}return fmt.replace(/\{(\d+)\}/g,function(_8f,n){var _90=_8e[n-1];if(_90!=null){return _90;}else{return _8f;}});};this.toString=function(){return _28;};this.getCurrentForm=function(){return _34;};this.getProfile=function(){return _32;};this.getMenu=function(_91){return _30[_91]||[];};this.getDatePackage=function(){return _31;};this.getCalendarSystem=function(){for(var m in _37){var re=_37[m];if(re&&re.test(_22.locale.toLowerCase())){return m;}}return "gregorian";};this.isRtl=function(){return _2d;};this.resize=function(){_34.resize();};this.execute=function(_92,_93,_94){var _95=_23.mixin({},_92.microflow||_92.form,_93);if(_95.allowedRoles&&!window.mx.session.hasSomeRole(_95.allowedRoles)){if(window.mx.session.isGuest()){this.showLogin();}else{window.mx.onError(new _f("Unable to execute action because you do not have sufficient permissions."));}return;}if(_92.microflow){this.action(_95.name,_95,_94);}else{if(_92.form){this.openForm(_95.path,_95,_94);}else{_16.error(_28+".execute: unknown action type");}}};this.action=function(_96,_97,_98){_97=_97||{};_23.setObject("params.actionname",_96,_97);var _99;if("progress" in _97){_99=this.getProgress(_97.progressMsg,_97.progress=="modal");_99.start();}window.mx.data.action({callback:_9a(_97.callback),error:_9a(function(e){if(_97.error){_97.error.call(_98,e);}else{if(!(e instanceof _12)){window.mx.onError(e);}}}),context:_97.context,async:_97.async,params:_97.params,store:_23.mixin({caller:_34},_97.store)});function _9a(_9b){return function(){try{if(_9b){_9b.apply(_98,arguments);}}finally{if(_99){_99.stop();}if(_97.complete){_97.complete.apply(_98);}}};};};this.back=function(){_9.back();};this.showProgress=function(msg,_9c){return _2b.add(msg||"",_9c);};this.hideProgress=function(id){return _2b.remove(id);};this.showUnderlay=function(_9d){_2c.show(_9d);};this.hideUnderlay=function(_9e){_2c.hide(_9e);};this.getProgress=function(msg,_9f){var id,_a0;return {start:function(){if(_a0){return id;}else{_a0=true;return id=_27.showProgress(msg,_9f);}},stop:function(){if(_a0){_a0=false;_27.hideProgress(id);}}};};function _a1(_a2){if(!_29){var _a3=window.mx.session.getConfig("profile");if(_a3){_32=_a3.name.toLowerCase();_1a.add(document.body,"profile-"+_32);document.title=_a3.title;}}if(!window.i18nMap){window.mx.server.get({url:"js/login_i18n.js",handleAs:"javascript",load:_a2});}else{_a2();}};this.showLogin=function(_a4){if(_a4=="402"){this.exception(window.i18nMap.http402);return;}var _a5=_1d("originURI");if(_a5){_1d("originURI",null,{expires:-1});window.mx.redirect(_a5);return;}_a1(function(){new _6({messageCode:_a4}).show();});};this.openForm=function(_a6,_a7,_a8){if(_a7.domNode){this.openFormInNode(_a6,_a7.domNode,_a7.context,_a7.params,_a7.callback?_23.hitch(_a8,_a7.callback):null,_a7.error?_23.hitch(_a8,_a7.error):null);}else{if(/popup|modal/.test(_a7.location)){_a7.modal=_a7.location=="modal";this.openFormInPopup(_a6,_a7,_a7.context,_a7.params,_a7.callback?_23.hitch(_a8,_a7.callback):null,_a7.error?_23.hitch(_a8,_a7.error):null);}else{if(_a7.callback||_a7.error){throw new Error("Success and error callbacks are not supported for openFormInContent");}this.openFormInContent(_a6,_a7.title,_a7.context,_a7.params);}}};this.reload=function(_a9){var _aa=mxui.currentForm;if(!_aa){throw new _13("Trying to refresh the content form but no form is yet available.");}_aa.reload(_a9);};this.getTemplate=function(id,_ab){var _ac=_34.widgetTemplates[id];return _ac&&_23.clone(_ac[_ab]);};this.applyToNode=function(_ad,_ae){var _af=_19.byNode(_ae);switch(_ad){case "show":if(_af&&_af.show){_af.show();}else{_ae.style.display="";}break;case "hide":if(_af&&_af.hide){_af.hide();}else{_ae.style.display="none";}break;case "disable":_b0(true);break;case "enable":_b0(false);break;}function _b0(_b1){if(_af){_af.set("disabled",_b1);}else{var _b2=_19.findWidgets(_ae);_21.forEach(_b2,function(_b3){_b3.set("disabled",_b1);});}};};this.makeShareId=function(_b4,_b5){return "context_seed_"+_b5+"_"+_b4.hash;};var _b6={};_b6[_c.validation.NOT_INTEGER]="invalid_number";_b6[_c.validation.RANGE_INTEGER]="range_integer";_b6[_c.validation.RANGE_LONG]="range_long";_b6[_c.validation.RANGE_DECIMAL]="range_decimal";_b6[_c.validation.RANGE_NUMBER]="range_number";this.validate=function(_b7,_b8){var _b9=_c.validate(_b7,_b8);if(_b9===_c.validation.OK){return null;}return this.translate("mendix.lib.Validations",_b6[_b9]);};this.validations=function(_ba){if(_ba.length){var _bb=[];for(var i=0,val;val=_ba[i];i++){var _bc=val.getFields();for(var x=0,_bd;_bd=_bc[x];x++){_bb.push(_bd.reason);}}this.error(_bb.join("\n"));}};this.translate=function(_be,str,_bf,_c0){var map=_23.getObject(_be,false,_2f);if(!map||!map[str]){return _c0||"[No translation]";}return _8d(map[str],_bf);};this.extractMessage=function(msg){if(typeof msg=="object"){if(msg.description){return msg.description;}else{if(msg.message){return msg.message;}}}return msg;};this.info=function(msg,_c1){_58(msg,"info").show(_c1);};this.warning=function(msg,_c2){_58(msg,"warning").show(_c2);};this.error=function(msg,_c3){_58(msg,"error").show(_c3);};this.exception=function(msg){this.error(msg,true);};this.confirmation=function(_c4){new _8({content:_c4.content,proceed:_c4.proceed||this.translate("mxui.widget.DialogMessage","ok"),cancel:_c4.cancel||this.translate("mxui.widget.DialogMessage","cancel"),handler:_c4.handler}).show();};this.encodeUrlHash=function(_c5,_c6,_c7){var _c8=_c5.substr(0,_c5.lastIndexOf(".")),_c9=_c6.toQuery();return "!/"+_c8+(_c9?"?"+_c9:"")+";"+_c7;};this.decodeUrlHash=function(_ca){if(_ca.charAt(0)=="!"){var _cb=_ca.lastIndexOf(";");_ca=_ca.slice(2,_cb!=-1?_cb:_ca.length);if(/^\w+(\/\w+(\?\w+\.\w+\=\d+(&\w+\.\w+\=\d+)*)?|\.\w+(\?\d+(&\d+)*)?)$/.test(_ca)){var _cc=_ca.split("?"),_cd=_cc[0],_ce=_cc[1],_cf=new _14(),_d0,_d1;if(_cd.indexOf("/")!=-1){if(_ce){_d0=_ce.split("&");for(var i=_d0.length;_d1=_d0[--i];){var _d2=_d1.split("=");_cf.setContext(_d2[0],_d2[1]);}}return function(_d3){window.mx.ui.openFormInContent(_cd+".page.xml","",_cf);_d3&&_d3();};}else{if(_ce){_d0=_ce.split("&");for(var j=0;_d1=_d0[j++];){_cf.setContext(" ",_d1);}}return function(_d4){window.mx.data.action({context:_cf,params:{actionname:_cd},callback:_d4,error:function(e){window.mx.onError(e);_d4&&_d4();}});};}}else{return null;}}else{return null;}};this.canMoveBack=function(){return !_9.isAtBeginning();};this.downloadFile=function(_d5){var url;var obj=_d5&&_d5.mxobject;if(obj&&obj.get2("HasContents")){url=_17.getDynamicResourceUrl(obj.getGuid(),obj.get2("changedDate"));}else{return;}if(_d5.target==="window"||_d6()){url+="&target=window";if(_d7()){new _8({caption:this.translate("mendix.widget.DialogMessage","file_download"),content:this.translate("mendix.widget.DialogMessage","file_download_message"),proceed:this.translate("mendix.widget.MxDataView","download"),cancel:this.translate("mendix.widget.DialogMessage","cancel"),handler:_d8}).show();}else{_d8();}}else{_a.download({url:url+"&target=internal",target:_d5.target,error:function(err){if(_d5.error){_d5.error(err);}else{window.mx.onError(err);}}});}function _d8(){_38(url,obj.get2("Name"),"mendix_file");};function _d6(){var _d9=_1e("chrome")&&typeof window.externalHost!=="undefined";var _da=_1e("mobile");return _d9||_da;};function _d7(){return _1e("ie")==8||((_1e("iphone")||_1e("ipad"))&&(_1e("safari")||window.navigator.standalone))||_1e("windowsphone");};};this.getFirstDayOfWeek=function(){return window.mx.session.getConfig("uiconfig.firstDayOfWeek");};};return UI;});