/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("mxui/sys/UI",["mxui/lib/form/FormFactory","mxui/lib/form/ContentForm","mxui/widget/DialogMessage","mxui/widget/Progress","mxui/widget/Underlay","mxui/widget/LoginDialog","mxui/widget/DemoUserSwitcher","mxui/widget/ConfirmationDialog","mxui/sys/history","mxui/io/iframe","mxui/dom","mendix/validator","mendix/lib/ServerError","mendix/lib/ConnectionError","mendix/lib/DescribedServerError","mendix/lib/NavigationError","mendix/lib/ValidationError","mendix/lib/Error","mendix/lib/MxContext","mendix/lang","mendix/logger","big/big","fastclick/fastclick","dijit/registry","dojo/dom-class","dojo/on","dojo/aspect","dojo/cookie","dojo/has","dojo/ready","dojo/i18n","dojo/_base/array","dojo/_base/kernel","dojo/_base/lang","dojo/_base/config","require","dojox/date/buddhist","dojox/date/buddhist/locale"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e,_f,_10,_11,_12,_13,_14,_15,Big,_16,_17,_18,_19,_1a,_1b,_1c,_1d,_1e,_1f,_20,_21,_22,_23){function UI(){var _24=this,_25="mxui.sys.UI",_26=false,_27=null,_28=null,_29=null,_2a=false,_2b="en_US",_2c=null,_2d=null,_2e="",_2f="desktop",_30="Mendix 5",_31=null,_32,_33={"HALF_UP":1,"HALF_EVEN":2};var _34={buddhist:/th$/,hebrew:null,islamic:null};this.startup=function(_35){var _36=window.mx.session.getConfig().uiconfig;_37(_36);_38(_36);_39(_36);_3a(_36);_3b(_36.roundingmode);_3c();_19(window,"resize",_21.hitch(_24,"resize"));_3d();_3e();_3f(_36.modules);_40();_41(function(){_2a=document.body.dir.toLowerCase()=="rtl";_42();_26=true;_35();});};function _37(_43){_2d=_43.menubars;_14.forEach(_2d,function(_44,_45){_46(_44,_45+"-");});function _46(_47,_48){_1f.forEach(_47,function(_49,_4a){_49.id=_48+_4a;if(_49.items){_46(_49.items,_49.id+"-");}});};};function _38(_4b){_2b=_4b.locale;_20.locale=_1e.normalizeLocale(_2b.replace("_","-"));_2c=_4b.translations;_4c();_4d();};function _39(_4e){_2f=_4e.profile.name.toLowerCase();_30=_4e.profile.title;document.title=_30;_18.add(document.body,"profile-"+_2f);};function _3a(){var _4f=_1f.map(window.mx.session.getUserRoles("Name"),function(_50){return "role-"+_50.toLowerCase();});_18.add(document.body,_4f);};function _3b(_51){Big.RM=_51?_33[_51]:_33.HALF_EVEN;};function _3c(){_1a.before(window.mx,"onError",function(e){var msg;if(e instanceof _f){msg=e.message;}else{if(e instanceof _e){msg=_24.translate("mxui.sys.UI","connection_error");}else{if(e instanceof _d){msg=_24.translate("mxui.sys.UI","internal_error");}else{msg=_24.translate("mxui.sys.UI","internal_error");}}}_27&&_27.hide();_27=_52(msg,"error");_27.show(true);_15.error(e);});};function _3d(){_32=new _1();_31=new _2();_1a.after(_31,"onNavigation",function(){document.title=_30+" - "+_31.title;_18.add(document.body,"mx-no-scroll");setTimeout(function(){_18.remove(document.body,"mx-no-scroll");},0);});_28=new _4();_29=new _5();var _53=mx.session.getConfig("demoUsers");if(_53){_1f.forEach(_53,function(_54){_54.active=(_54.name==window.mx.session.getUserName());});var _55=new _7({demoUsers:_53});document.body.appendChild(_55.domNode);_55.startup();}};function _42(){var _56=document.getElementById("content");if(!_56){_24.exception("You are using an outdated index template. Please update your index template.");return;}_56.appendChild(_31.domNode);};function _3e(){_9.init();_1a.after(_31,"dispose",_9.back);var _57=null;_1a.after(_9,"onNavigation",function(_58,_59){if(!_59){return;}var _5a=_59.formParams;if(!_57){_57=_24.showProgress();}if(_58){_31.onPersistViewState(_58.viewState);}if(!_59.viewState){_59.viewState={};}_31.navigateTo(_5a.path,_5a.title,_5a.context,_5a.params,_21.clone(_59.viewState),function(){_24.hideProgress(_57);_57=null;},function(e){if(e instanceof _10){}else{_24.hideProgress(_57);_57=null;window.mx.onError(e);}});},true);};function _41(_5b){var _5c=window.mx.session.getConfig("uiconfig.widgets");if(_5c.length>0){_5d();dojo.registerModulePath("widgets",window.mx.modulePath);_1f.forEach(_5c,function(_5e){var _5f=_5e.split(".")[0];dojo.registerModulePath(_5f,window.mx.modulePath+_5f);});var _60=["widgets/widgets"];_23(_60);}_1d(_5b);};function _5d(){var _61=document.getElementsByTagName("head")[0],_62=_61.querySelector("link[href*='css/theme.css']"),_63=_b.createCssLink("widgets/widgets.css");if(_62){_61.insertBefore(_63,_62);}else{_61.appendChild(_63);}};function _3f(_64){for(var i=0,_65;_65=_64[i];i++){try{dojo["require"](_65+"."+_65);}catch(e){_15.error(_25+".getModules: failed loading module "+_65);}}};function _4d(){var _66=_24.getCalendarSystem();switch(_66){case "gregorian":_2e="dojo.date";return;case "buddhist":_2e="dojox.date.buddhist";dojo["require"](_2e);dojo["require"](_2e+".locale");return;default:throw new Error("Unsupported date package: "+_66);}};function _40(){_16.attach(document.body);if(_1c("ie")){if(JSON.stringify(document.createElement("input").value)==="\"null\""){var _67=Object.getOwnPropertyDescriptor(HTMLInputElement.prototype,"value").get;Object.defineProperty(HTMLInputElement.prototype,"value",{get:function(){var _68=_67.call(this);return _68===""?"":_68;}});}_19(document,"click",function(e){var _69=e.target;if(_69.nodeName=="TEXTAREA"||_69.nodeName=="INPUT"&&(_69.type=="text"||_69.type=="password")){if(document.activeElement!=_69){var sel=_b.getSelection(_69);try{_69.focus();}catch(ex){}_b.selectTextRange(_69,sel.start,sel.end);}}if(_1c("ie")<=8){if(_69.nodeName=="INPUT"&&_69.type=="checkbox"){_b.dispatchEvent(_69,"onchange");}}});}};function _4c(){var map={"mendix":"mxui","mendix.core.MxServer":"mendix.core.Server","mendix.widget.MxDataView":"mendix.widget.MxFormView","mendix.widget.MxNavigator":"mendix.widget.Navigator","mendix.widget.MxDataGrid":"mendix.widget.DataGrid","mendix.widget.DataGrid.true":"mxui.common.true","mendix.widget.DataGrid.false":"mxui.common.false","mendix.core.MxServer.invalid_session":"mendix.session.session_expired","mobile.widget.Dialog.ok":"mxui.widget.DialogMessage.ok","mxui.widget.Dialog.error":"mxui.widget.DialogMessage.error","mxui.widget.Dialog.information":"mxui.widget.DialogMessage.info","mxui.widget.Dialog.warning":"mxui.widget.DialogMessage.warning","mxui.widget.Dialog.confirmation":"mxui.widget.ConfirmationDialog.caption","mobile.widget":"mxui.widget","mobile.sys":"mxui.sys"};for(var _6a in map){var _6b=_6a.split("."),_6c=map[_6a].split("."),_6d=_6b.pop(),_6e=_6c.pop(),_6f=_2c,_70=_6f,_71;while(_6f&&(_71=_6b.shift())){_6f=_6f[_71];}if(_6f){while(_71=_6c.shift()){_70=_70[_71]=_70[_71]||{};}if(_70[_6e]){_21.mixin(_70[_6e],_6f[_6d]);}else{_70[_6e]=_6f[_6d];}}}};function _52(msg,_72){return new _3({type:_72,content:""+_24.extractMessage(msg)});};this.openFormInContent=function(_73,_74,_75,_76){_9.push({formParams:{path:_73,title:_74,context:_75||new _13(),params:_76||{}}});};this.openFormInPopup=function(_77,_78,_79,_7a,_7b,_7c){var _7d=this,pid=this.showProgress();_32.openPopupForm(_77,_78,(_79||new _13()),(_7a||{}),function(_7e){_7d.hideProgress(pid);_7b&&_7b(_7e);},function(e){_7d.hideProgress(pid);_7c?_7c(e):window.mx.onError(e);});};this.openFormInNode=function(_7f,_80,_81,_82,_83,_84){var _85=this,pid=this.showProgress();_32.openInlineForm(_7f,_80,(_81||new _13()),(_82||{}),function(_86){_85.hideProgress(pid);_83&&_83(_86);},function(e){_85.hideProgress(pid);_84?_84(e):window.mx.onError(e);});};function _87(fmt,_88){if(!_88){return fmt;}else{if(!(_88 instanceof Array)){_88=[_88];}}return fmt.replace(/\{(\d+)\}/g,function(_89,n){var _8a=_88[n-1];if(_8a!=null){return _8a;}else{return _89;}});};this.toString=function(){return _25;};this.getCurrentForm=function(){return _31;};this.getProfile=function(){return _2f;};this.getMenu=function(_8b){return _2d[_8b]||[];};this.getDatePackage=function(){return _2e;};this.getCalendarSystem=function(){for(var m in _34){var re=_34[m];if(re&&re.test(_20.locale.toLowerCase())){return m;}}return "gregorian";};this.isRtl=function(){return _2a;};this.resize=function(){_31.resize();};this.execute=function(_8c,_8d,_8e){var cfg={};if(_8c.microflow){_21.mixin(cfg,_8c.microflow,_8d);window.mx.ui.action(cfg.name,cfg,_8e);}else{if(_8c.form){_21.mixin(cfg,_8c.form,_8d);window.mx.ui.openForm(cfg.path,cfg,_8e);}else{_15.error(_25+".execute: unknown action type");}}};this.action=function(_8f,_90,_91){_90=_90||{};_21.setObject("params.actionname",_8f,_90);var _92=_90.callback,_93=_90.error,_94=_21.mixin({caller:_31},_90.store),_95;if("progress" in _90){_95=this.getProgress(_90.progressMsg,_90.progress=="modal");_95.start();}window.mx.data.action({callback:function(_96){_92&&_92.call(_91,_96);_95&&_95.stop();},error:function(e){_95&&_95.stop();if(_93){_93.call(_91,e);}else{if(e&&!(e instanceof _11)){window.mx.onError(e);}}},context:_90.context,async:_90.async,params:_90.params,store:_94});};this.back=function(){_9.back();};this.showProgress=function(msg,_97){return _28.add(msg||"",_97);};this.hideProgress=function(id){return _28.remove(id);};this.showUnderlay=function(_98){_29.show(_98);};this.hideUnderlay=function(_99){_29.hide(_99);};this.getProgress=function(msg,_9a){var id,_9b;return {start:function(){if(_9b){return id;}else{_9b=true;return id=_24.showProgress(msg,_9a);}},stop:function(){if(_9b){_9b=false;_24.hideProgress(id);}}};};function _9c(_9d){if(!_26){var _9e=window.mx.session.getConfig("profile");if(_9e){_2f=_9e.name.toLowerCase();_18.add(document.body,"profile-"+_2f);document.title=_9e.title;}}if(!window.i18nMap){window.mx.server.get({url:"js/login_i18n.js",handleAs:"javascript",load:_9d});}else{_9d();}};this.showLogin=function(_9f){if(_9f=="402"){this.exception(window.i18nMap.http402);return;}var _a0=_1b("originURI");if(_a0){_1b("originURI",null,{expires:-1});window.mx.redirect(_a0);return;}_9c(function(){new _6({messageCode:_9f}).show();});};this.openForm=function(_a1,_a2,_a3){if(_a2.domNode){this.openFormInNode(_a1,_a2.domNode,_a2.context,_a2.params,_a2.callback?_21.hitch(_a3,_a2.callback):null,_a2.error?_21.hitch(_a3,_a2.error):null);}else{if(/popup|modal/.test(_a2.location)){_a2.modal=_a2.location=="modal";this.openFormInPopup(_a1,_a2,_a2.context,_a2.params,_a2.callback?_21.hitch(_a3,_a2.callback):null,_a2.error?_21.hitch(_a3,_a2.error):null);}else{if(_a2.callback||_a2.error){throw new Error("Success and error callbacks are not supported for openFormInContent");}this.openFormInContent(_a1,_a2.title,_a2.context,_a2.params);}}};this.reload=function(_a4){var _a5=mxui.currentForm;if(!_a5){throw new _12("Trying to refresh the content form but no form is yet available.");}_a5.reload(_a4);};this.getTemplate=function(id,_a6){var _a7=_31.widgetTemplates[id];return _a7&&_21.clone(_a7[_a6]);};this.applyToNode=function(_a8,_a9){var _aa=_17.byNode(_a9);switch(_a8){case "show":if(_aa&&_aa.show){_aa.show();}else{_a9.style.display="";}break;case "hide":if(_aa&&_aa.hide){_aa.hide();}else{_a9.style.display="none";}break;case "disable":if(_aa){_aa.set("disabled",true);}break;case "enable":if(_aa){_aa.set("disabled",false);}break;}};this.makeShareId=function(_ab,_ac){return "context_seed_"+_ac+"_"+_ab.hash;};var _ad={};_ad[_c.validation.NOT_INTEGER]="invalid_number";_ad[_c.validation.RANGE_INTEGER]="range_integer";_ad[_c.validation.RANGE_LONG]="range_long";_ad[_c.validation.RANGE_DECIMAL]="range_decimal";_ad[_c.validation.RANGE_NUMBER]="range_number";this.validate=function(_ae,_af){var _b0=_c.validate(_ae,_af);if(_b0===_c.validation.OK){return null;}return this.translate("mendix.lib.Validations",_ad[_b0]);};this.validations=function(_b1){if(_b1.length){var _b2=[];for(var i=0,val;val=_b1[i];i++){var _b3=val.getFields();for(var x=0,_b4;_b4=_b3[x];x++){_b2.push(_b4.reason);}}this.error(_b2.join("\n"));}};this.translate=function(_b5,str,_b6,_b7){var map=_21.getObject(_b5,false,_2c);if(!map||!map[str]){return _b7||"[No translation]";}return _87(map[str],_b6);};this.extractMessage=function(msg){if(typeof msg=="object"){if(msg.description){return msg.description;}else{if(msg.message){return msg.message;}}}return msg;};this.info=function(msg,_b8){_52(msg,"info").show(_b8);};this.warning=function(msg,_b9){_52(msg,"warning").show(_b9);};this.error=function(msg,_ba){_52(msg,"error").show(_ba);};this.exception=function(msg){this.error(msg,true);};this.confirmation=function(_bb){new _8({content:_bb.content,proceed:_bb.proceed||this.translate("mxui.widget.DialogMessage","ok"),cancel:_bb.cancel||this.translate("mxui.widget.DialogMessage","cancel"),handler:_bb.handler}).show();};this.encodeUrlHash=function(_bc,_bd,_be){var _bf=_bc.substr(0,_bc.lastIndexOf(".")),_c0=_bd.toQuery();return "!/"+_bf+(_c0?"?"+_c0:"")+";"+_be;};this.decodeUrlHash=function(_c1){if(_c1.charAt(0)=="!"){var _c2=_c1.lastIndexOf(";");_c1=_c1.slice(2,_c2!=-1?_c2:_c1.length);if(/^\w+(\/\w+(\?\w+\.\w+\=\d+(&\w+\.\w+\=\d+)*)?|\.\w+(\?\d+(&\d+)*)?)$/.test(_c1)){var _c3=_c1.split("?"),_c4=_c3[0],_c5=_c3[1],_c6=new _13(),_c7,_c8;if(_c4.indexOf("/")!=-1){if(_c5){_c7=_c5.split("&");for(var i=_c7.length;_c8=_c7[--i];){var _c9=_c8.split("=");_c6.setContext(_c9[0],_c9[1]);}}return function(_ca){window.mx.ui.openFormInContent(_c4+".page.xml","",_c6);_ca&&_ca();};}else{if(_c5){_c7=_c5.split("&");for(var j=0;_c8=_c7[j++];){_c6.setContext(" ",_c8);}}return function(_cb){window.mx.data.action({context:_c6,params:{actionname:_c4},callback:_cb,error:function(e){window.mx.onError(e);_cb&&_cb();}});};}}else{return null;}}else{return null;}};this.downloadFile=function(_cc){var obj=_cc?_cc.mxobject:null,url;if(obj&&obj.get2("HasContents")){url="file?guid="+obj.getGuid();}else{if(_cc.url){url=_cc.url;}}if(!url){return;}if(_cc.target==="window"||_cd()){if(_ce()){new _8({caption:this.translate("mendix.widget.DialogMessage","file_download"),content:this.translate("mendix.widget.DialogMessage","file_download_message"),proceed:this.translate("mendix.widget.MxDataView","download"),cancel:this.translate("mendix.widget.DialogMessage","cancel"),handler:function(){window.open(url,"mendix_file");}}).show(true);}else{window.open(url,"mendix_file");}}else{_a.download({url:window.mx.appUrl+url,target:_cc.target,error:function(err){if(_cc.error){_cc.error(err);}else{window.mx.onError(err);}}});}function _cd(){var _cf=_1c("chrome")&&typeof window.externalHost!=="undefined";var _d0=_1c("mobile");return _cf||_d0;};function _ce(){return _1c("ie")==8||((_1c("iphone")||_1c("ipad"))&&(_1c("safari")||window.navigator.standalone))||_1c("windowsphone");};};this.getFirstDayOfWeek=function(){return window.mx.session.getConfig("uiconfig.firstDayOfWeek");};};return UI;});