/* @preserve
    Copyright (c) 2005-2016, Mendix bv. All rights reserved.
    See mxclientsystem/licenses.txt for third party licenses that apply.
*/
webpackJsonp([1],{679:function(e,t,n){"use strict";function r(e,t){var n,r,s,l,f=t.createStoreFn,m=t.getStorageDirFn,h=t.downloadFileFn,p=t.getDocumentUrlFn;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return n=new i(window.mx.session.getConfig("sync_config.schema"),f),r=new o.a({downloadFileFn:h,getStorageDirFn:m}),s=new c.a(n,u,r,e),l=new a.a({getDocumentUrlFn:p},e,n,r,s),t.next=6,regeneratorRuntime.awrap(l.initialize());case 6:return t.abrupt("return",l);case 7:case"end":return t.stop()}},null,this)}Object.defineProperty(t,"__esModule",{value:!0}),t.buildOfflineDataBackend=r;var i=n(703),u=(n.n(i),n(135)),o=n(711),a=n(712),c=n(713)},680:function(e,t){e.exports={LIKE_ESCAPE_CHAR:"~",QUOTE_CHAR:'"'}},681:function(e,t){function n(e){this.fork=e}n.of=function(e){return new n(function(t,n){n(e)})},n.prototype.chain=function(e){var t=this;return new n(function(n,r){t.fork(n,function(t){e(t).fork(n,r)})})},n.prototype.orElse=function(e){var t=this;return new n(function(n,r){t.fork(function(t){e(t).fork(n,r)},r)})},n.prototype.ap=function(e){var t,r,i,u=this,o=2;return new n(function(n,a){function c(){0==--o&&a(t(r))}function s(e){void 0===i&&(i=e,n(i))}u.fork(s,function(e){t=e,c()}),e.fork(s,function(e){r=e,c()})})},n.prototype.map=function(e){return this.chain(function(t){return n.of(e(t))})},n.rejected=n.prototype.rejected=function(e){return new n(function(t,n){t(e)})},n.parallel=function(e){return new n(function(t,n){function r(e){return function(t){o[e]=t,void 0===i&&0==--u&&n(o)}}var i,u=e.length,o=new Array(e.length);if(0===e.length)return void n(o);e.forEach(function(e,n){e.fork(function(e){void 0===i&&(i=e,t(e))},r(n))})})},n.sequence=function(e){return e.reduce(function(e,t){return e.chain(function(e){return t})},n.of(null))},e.exports=n},682:function(e,t,n){var r=n(708),i=n(681),u=new r(i);u.rejected=function(e){return new u(function(t){return i.rejected(e)})},u.parallel=function(e){return new u(function(t){return new i(function(n,r){if(0===e.length)return void r([]);var i=new Array(e.length),u=e.length,o=!1;e.forEach(function(e,a){e.run(t).fork(function(e){o||(o=!0,n(e))},function(e){i[a]=e,o||0!=--u||r(i)})})})})},u.sequence=function(e){return e.reduce(function(e,t){return e.chain(function(e){return t.map(function(t){return e.concat([t])})})},u.of([]))},e.exports=u},685:function(e,t,n){var r=n(681),i={};i.promiseFromTask=function(e){return new Promise(function(t,n){e.fork(n,t)})},i.callbackFromTask=function(e,t,n){e.fork(function(e){n&&n(e)},function(e){t&&t(e)})},i.taskFromPromise=function(e){return new r(function(t,n){e.then(n,t)})},e.exports=i},686:function(e,t,n){"use strict";function r(e){return e.replace(/:/g,"_")}function i(){return h+l.getUniqueId()}function u(e){return!p.test(e)}function o(e){return"guid"===e||"$"===e[0]}function a(e,t){return e.$readonlyAttrs.includes(t)}function c(e){var t=Object.keys(e).filter(function(e){return!o(e)}).reduce(function(t,n){return t[n]={value:e[n]},a(e,n)&&(t[n].readonly=!0),t},{});return{guid:e.guid,objectType:e.$objectType,attributes:t}}function s(e){var t={guid:e.guid,$objectType:e.objectType,$readonlyAttrs:[]};for(var n in e.attributes)t[n]=e.attributes[n].value,e.attributes[n].readonly&&t.$readonlyAttrs.push(n);return t}n.d(t,"a",function(){return f}),n.d(t,"b",function(){return m}),t.g=r,t.c=i,t.i=u,t.e=o,t.d=a,t.h=c,t.f=s;var l=n(4),f="files/documents/",m="files/thumbnails/",h="GUID:",p=new RegExp("^"+h)},703:function(e,t,n){function r(){return window.openDatabase("MendixDatabase","1","Mendix Database",10485760)}function i(e,t){a.call(this),t=t||r,this._tableNames=e;var n=t();this._databasePromise=this._initialize(n)}var u=n(704),o=n(709),a=n(710),c=n(682),s=n(685);i.prototype=Object.create(a.prototype),i.prototype._getDatabase=function(){return this._databasePromise},i.prototype._initialize=function(e){var t=u.createCreateTransaction(this._tableNames);return s.promiseFromTask(o.runWriteTransaction(e,t)).then(function(){return e})},i.prototype._fetch=function(e){return function(t){var n=u.createFetchByGuidTransaction(e);return s.promiseFromTask(o.runReadTransaction(t,n))}},i.prototype._fetchSlice=function(e,t,n){return function(r){var i=u.createFetchSliceTransaction(e,t,n.offset,n.limit,n.sort);return s.promiseFromTask(o.runReadTransaction(r,i))}},i.prototype._rebuildDb=function(e){return c.ask().chain(function(t){var n=u.createRebuildTransaction(this._tableNames,e);return new c(function(e){return o.runWriteTransaction(t,n)})}.bind(this))},i.prototype._insertOrReplace=function(e){return function(t){var n=u.createInsertOrReplaceTransaction(e);return s.promiseFromTask(o.runWriteTransaction(t,n))}},i.prototype._cleanDatabase=function(){var e=this;return function(t){var n=u.createCleanTransaction(e._tableNames);return s.promiseFromTask(o.runWriteTransaction(t,n))}},i.prototype._fetchDirty=function(){return c.ask().chain(function(e){var t=u.createFetchDirtyObjectsTransaction();return new c(function(n){return o.runWriteTransaction(e,t)})})},i.prototype._makeClean=function(e){return c.ask().chain(function(t){var n=u.createMakeCleanTransaction(e);return new c(function(e){return o.runWriteTransaction(t,n)})})},i.prototype._cleanupDirtyObjects=function(){return function(e){var t=u.createDirtyCleanupTransaction();return s.promiseFromTask(o.runWriteTransaction(e,t))}},e.exports=i},704:function(e,t,n){function r(e){var t=[F].concat(e).map(v).map(function(e){return"DROP TABLE IF EXISTS '"+e+"'"}).map(function(e){return T(e,[])});return S.sequence([S.parallel(t),i(e)])}function i(e){function t(e){return T(n(e).reduce(function(e,t){return e.column(v(t.attr),t.type)},(new R).table(v(e)).primaryKeyColumn("guid","text")).createIfNotExists(),[])}function n(e){var t=window.mx.meta.getEntity(e);return t.getAttributes().map(function(e){var n=t.getAttributeType(e);return{attr:e,type:N[n]}})}var r=[a()].concat(e.map(t));return S.parallel(r).map(function(e){})}function u(e,t){var n=t.reduce(function(t,n){var r=c(),i=l(e,n);return t.concat([T(r.insert(),[n.guid,e,0,JSON.stringify(n.$readonlyAttrs)]),T(i.builder.insert(),i.values)])},[]);return S.parallel(n).map(function(e){})}function o(){return T((new x).from(F).where(k.equals("dirty")).selectDistinct("tableName"),[1])}function a(){return T((new R).table(F).primaryKeyColumn("guid","text").column("tableName","text").column("dirty","boolean").column("readonlyAttrs","text").createIfNotExists(),[])}function c(){return(new D).into(F).column("guid").column("tableName").column("dirty").column("readonlyAttrs")}function s(e,t){function n(t){if(t.constraints)return k[t.operator](t.constraints.map(n).filter(function(e){return null!==e}));if(null==t.value)switch(t.operator){case"contains":return null;case"equals":return k.isNull(v(t.attribute),t.negate)}var i=e.getAttributeType(t.attribute),u=B[i],o=P[i],a=o(u(t.value));return r.push("contains"===t.operator?g(a):a),k[t.operator](v(t.attribute),t.negate)}var r=[];return{builder:(new x).where(t.map(n).filter(function(e){return null!==e})),args:r}}function l(e,t){var n=window.mx.meta.getEntity(e),r=n.getAttributes(),i=r.reduce(function(e,r){var i=n.getAttributeType(r),u=P[i];if(!u)return e;var o=u(t[r]);return{attrs:e.attrs.concat([r]),values:e.values.concat([o])}},{attrs:["guid"],values:[t.guid]});return{builder:i.attrs.reduce(function(e,t){return e.column(v(t))},(new D).into(v(e))),values:i.values}}function f(e){if(null==e)return null;var t=new C(e),n=20-Math.max(0,t.e)-1;return(t.s<0?"-":"")+new Array(n+1).join("0")+t.abs().toFixed()}function m(e){return null!=e?String(e):null}function h(e){return null!=e?Number(e):null}function p(e){return"false"!==e}function y(e){return e?Number(e):null}function d(e){return e}function b(e){for(var t=[],n=0;n<e.length;++n)t.push(e.item(n));return t}function g(e){var t=O.LIKE_ESCAPE_CHAR;return e.replace(new RegExp(t,"g"),t+t).replace(/%/g,t+"%").replace(/_/g,t+"_")}function v(e){return e.replace(".","$")}function _(e){return e.replace("$",".")}function w(e,t,n,r){var i={guid:r.guid,$objectType:e.getEntity(),$dirty:t,$readonlyAttrs:JSON.parse(n)};for(var u in r)if(!function(e){return"guid"===e||e.indexOf(".")>-1}(u)){var o=_(u),a=e.getAttributeType(o),c=I[a];c&&(i[o]=c(r[u]))}return i}function j(e,t){return e[F+"."+t]}function T(e,t){return t=t||[],new S(function(n){return new A(function(r,i){n.executeSql(e,t,function(e,t){return i(t)},function(e,t){return r(t)})})})}var O=n(680),E=n(705),x=E.SqlSelectBuilder,k=E.constraintBuilder,R=n(706),D=n(707),S=n(682),A=n(681),C=n(37),F="_guidToTable",N={String:"text",Integer:"text",Long:"text",Decimal:"text",Float:"text",Currency:"text",Enum:"text",HashString:"text",ObjectReference:"text",DateTime:"integer",Boolean:"integer",AutoNumber:"integer",Binary:"blob"},P={String:m,Integer:f,Long:f,Decimal:f,Float:f,Currency:f,Enum:m,HashString:m,ObjectReference:m,DateTime:h,Boolean:Number,AutoNumber:m,Binary:m},I={String:m,Integer:m,Long:m,Decimal:m,Float:m,Currency:m,Enum:m,HashString:m,ObjectReference:m,DateTime:d,Boolean:Boolean,AutoNumber:m,Binary:m},B={String:d,Integer:d,Long:d,Decimal:d,Float:d,Currency:d,Enum:d,HashString:d,ObjectReference:d,DateTime:y,Boolean:p,AutoNumber:d,Binary:d},q={createCreateTransaction:i,createCleanTransaction:function(e){var t=[F].concat(e).map(v).map(function(e){return"DELETE FROM '"+e+"'"}).map(function(e){return T(e,[])});return S.parallel(t).map(function(e){})},createFetchByGuidTransaction:function(e){return T((new x).from(F).where(k.equals("guid")).select(),[e]).chain(function(t){if(0===t.rows.length)return S.of(null);if(1!==t.rows.length)return S.rejected(new Error("db consistency error"));var n=t.rows.item(0),r=n.tableName,i=Boolean(n.dirty),u=n.readonlyAttrs;return T((new x).from(v(r)).where(k.equals("guid")).select(),[e]).chain(function(e){return 0===e.rows.length?S.rejected(new Error("entity not found")):1!==e.rows.length?S.rejected(new Error("db consistency error")):S.of(w(window.mx.meta.getEntity(r),i,u,e.rows.item(0)))})})},createFetchSliceTransaction:function(e,t,n,r,i){t=t||[],i=i||[];var u=window.mx.meta.getEntity(e),o=s(u,t),a=o.builder.from(v(e)),c=o.args,l=a.offset(n).limit(r).join(F,"guid",["dirty","readonlyAttrs"]);l=i.reduce(function(e,t){return e.order(t[0],t[1])},l);var f=T(l.select(),c).map(function(e){for(var t=[],n=0;n<e.rows.length;++n){var r=e.rows.item(n),i=Boolean(r[F+".dirty"]),o=j(r,"readonlyAttrs");t.push(w(u,i,o,r))}return t}),m=T(a.selectCount("cnt"),c).map(function(e){return e.rows.item(0).cnt});return S.parallel([f,m])},createInsertOrReplaceTransaction:function(e){return S.parallel(e.map(function(e){var t=e.$objectType,n=c(),r=l(t,e);return[T(n.insertOrReplace(),[e.guid,t,1,JSON.stringify(e.$readonlyAttrs)]),T(r.builder.insertOrReplace(),r.values)]}).reduce(function(e,t){return e.concat(t)},[])).map(function(e){})},createFetchDirtyObjectsTransaction:function(){return o().chain(function(e){var t=b(e.rows).map(function(e){var t=e.tableName,n=(new x).from(v(t)).join(F,"guid",["dirty","readonlyAttrs"]).where(k.equals(F+".dirty")).select(),r=window.mx.meta.getEntity(t);return T(n,[1]).map(function(e){return b(e.rows).map(function(e){return w(r,!0,j(e,"readonlyAttrs"),e)})})});return S.parallel(t)}).map(function(e){return e.reduce(function(e,t){return e.concat(t)},[])})},createMakeCleanTransaction:function(e){var t=e.map(function(e){return T("UPDATE "+F+" set dirty = 0 where guid = ?",[e.guid])});return S.parallel(t).map(function(e){})},createDirtyCleanupTransaction:function(){return o().chain(function(e){var t=b(e.rows).map(function(e){var t=e.tableName;return T("DELETE FROM "+v(t)+" WHERE guid IN (\n                            SELECT guid FROM "+F+" WHERE tableName = ? AND dirty = 1)",[t])});return S.sequence([S.parallel(t),T("DELETE FROM "+F+" WHERE dirty = 1")]).map(function(e){})})},createRebuildTransaction:function(e,t){var n=r(e),i=e.map(function(e){var n=t.filter(function(t){return t.$objectType===e});return u(e,n)});return S.sequence([n,S.parallel(i)]).map(function(e){})}};e.exports=q},705:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return function(t){return t+" "+e+" ?"}}function u(e){var t="";return t+=e,t+=" LIKE '%' || ? || '%'",t+=" ESCAPE '"+a.LIKE_ESCAPE_CHAR+"'"}Object.defineProperty(t,"__esModule",{value:!0}),n.d(t,"SqlSelectBuilder",function(){return c}),n.d(t,"constraintBuilder",function(){return h});var o=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),a=n(680),c=function(){function e(t,n){r(this,e),this._select=n&&n.select||t&&t._select||null,this._from=n&&n.from||t&&t._from||null,this._join=n&&n.join||t&&t._join||null,this._constraints=n&&n.constraints||t&&t._constraints||[],this._orderBy=n&&n.orderBy||t&&t._orderBy||[],this._limit=n&&n.limit||t&&t._limit||null,this._offset=n&&n.offset||t&&t._offset||null}return o(e,[{key:"from",value:function(t){return new e(this,{from:t})}},{key:"join",value:function(t,n,r){return new e(this,{join:{tableName:t,joinOnColumn:n,selectedColumns:r}})}},{key:"where",value:function(t){return new e(this,{constraints:this._constraints.concat(t)})}},{key:"order",value:function(t,n){return new e(this,{orderBy:this._orderBy.concat([[t,n]])})}},{key:"limit",value:function(t){return new e(this,{limit:t})}},{key:"offset",value:function(t){return new e(this,{offset:t})}},{key:"selectDistinct",value:function(e){return Array.isArray(e)&&(e=e.join(", ")),"SELECT DISTINCT "+e+" "+this._buildSql()}},{key:"selectCount",value:function(e){return"SELECT COUNT(*) AS "+e+this._buildSql()}},{key:"select",value:function(){var e=this,t="SELECT "+this._from+".*";return this._join&&this._join.selectedColumns.forEach(function(n){t+=", "+e._join.tableName+".["+n+'] as "'+e._join.tableName+"."+n+'"'}),t+this._buildSql()}},{key:"_buildSql",value:function(){var e=this,t=" FROM "+this._from+" AS "+this._from;return this._join&&(t+=" JOIN "+this._join.tableName+" AS "+this._join.tableName+" USING ("+this._join.joinOnColumn+")"),this._constraints.length>0&&(t+=" WHERE "+this._constraints.map(function(t){return t.build(e._from)}).join(" AND ")),this._orderBy.length>0&&(t+=" ORDER BY "+this._orderBy.map(function(t){return e._from+".["+t[0]+"] "+t[1]}).join(", ")),this._limit&&(t+=" LIMIT "+this._limit),this._offset&&(t+=" OFFSET "+this._offset),t}}]),e}(),s={equals:i("="),lessThan:i("<"),lessThanOrEquals:i("<="),greaterThan:i(">"),greaterThanOrEquals:i(">="),contains:u},l=function(){function e(t,n,i){r(this,e),this._column=t,this._operator=n,this._negate=!!i}return o(e,[{key:"build",value:function(e){var t=s[this._operator],n=this._column.indexOf(".")>-1?this._column:e+".["+this._column+"]";return(this._negate?"NOT ":"")+t(n)}}]),e}(),f=function(){function e(t,n){r(this,e),this._column=t,this._negate=!!n}return o(e,[{key:"build",value:function(e){return(this._column.indexOf(".")>-1?this._column:e+".["+this._column+"]")+" IS "+(this._negate?"NOT ":"")+"NULL"}}]),e}(),m=function(){function e(t,n){r(this,e),this.group=t,this.constraints=n||[]}return o(e,[{key:"add",value:function(e){this.constraints.push(e)}},{key:"build",value:function(e){return"("+this.constraints.map(function(t){return t.build(e)}).join(" "+this.group+" ")+")"}}]),e}(),h={and:function(e){return new m("and",e)},or:function(e){return new m("or",e)},equals:function(e,t){return new l(e,"equals",t)},isNull:function(e,t){return new f(e,t)},lessThan:function(e,t){return new l(e,"lessThan",t)},lessThanOrEquals:function(e,t){return new l(e,"lessThanOrEquals",t)},greaterThan:function(e,t){return new l(e,"greaterThan",t)},greaterThanOrEquals:function(e,t){return new l(e,"greaterThanOrEquals",t)},contains:function(e,t){return new l(e,"contains",t)}}},706:function(e,t,n){function r(e,t){this._tableName=t&&t.tableName||e&&e._tableName||null,this._columns=t&&t.columns||e&&e._columns||[]}function i(e){var t=u.QUOTE_CHAR;return t+e+t}var u=n(680);r.prototype.table=function(e){return new r(this,{tableName:e})},r.prototype.column=function(e,t){return new r(this,{columns:this._columns.concat({columnName:e,columnType:t,isPrimary:!1})})},r.prototype.primaryKeyColumn=function(e,t){return new r(this,{columns:this._columns.concat({columnName:e,columnType:t,isPrimary:!0})})},r.prototype.createIfNotExists=function(){var e="";return e+="CREATE TABLE IF NOT EXISTS "+i(this._tableName),e+=this._buildSql()},r.prototype._buildSql=function(){var e="";return this._columns.length>0&&(e+=" (",e+=this._columns.map(function(e){return[i(e.columnName),e.columnType,"text"===e.columnType?" COLLATE NOCASE ":"",e.isPrimary?"PRIMARY KEY ":""].join(" ").slice(0,-1)},this).join(", "),e+=")"),e},e.exports=r},707:function(e,t,n){function r(e,t){if(!(this instanceof r))return new r;this._tableName=t&&t.tableName||e&&e._tableName||null,this._columnNames=t&&t.columnNames||e&&e._columnNames||[]}function i(e){var t=u.QUOTE_CHAR;return t+e+t}var u=n(680);r.prototype.into=function(e){return new r(this,{tableName:e})},r.prototype.column=function(e){return new r(this,{columnNames:this._columnNames.concat(e)})},r.prototype.insert=function(){var e="";return e+="INSERT INTO "+i(this._tableName),e+=this._buildSql()},r.prototype.insertOrReplace=function(){var e="";return e+="INSERT OR REPLACE INTO "+i(this._tableName),e+=this._buildSql()},r.prototype._buildSql=function(){var e="";return this._columnNames.length>0&&(e+=" (",e+=this._columnNames.map(i).join(", "),e+=")"),e+=" VALUES (",e+="?"+new Array(this._columnNames.length).join(", ?"),e+=")"},e.exports=r},708:function(e,t){function n(e){function t(e){this.run=e}return t.prototype.chain=function(e){return new t(function(t){return this.run(t).chain(function(n){return e(n).run(t)})}.bind(this))},t.prototype.ap=function(e){return new t(function(t){return this.run(t).ap(e.run(t))}.bind(this))},t.prototype.map=function(e){return this.chain(function(n){return t.of(e(n))})},t.of=function(n){return new t(function(t){return e.of(n)})},t.ask=function(){return new t(e.of)},t}e.exports=n},709:function(e,t,n){function r(e){return function(t,n){return new i(function(r,i){var u,o=2;t[e](function(e){n.run(e).fork(r,function(e){u=e,0==--o&&i(u)})},r,function(){0==--o&&i(u)})})}}var i=n(681);e.exports={runReadTransaction:r("readTransaction"),runWriteTransaction:r("transaction")}},710:function(e,t,n){function r(){}var i=n(685),u=n(682);r.prototype.getSlice=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._getDatabase().then(this._fetchSlice(e,t,n))},r.prototype.getByGuid=function(e){return this._getDatabase().then(this._fetch(e))},r.prototype.insertOrReplace=function(e){return this._getDatabase().then(this._insertOrReplace(e))},r.prototype.cleanDatabase=function(){return this._getDatabase().then(this._cleanDatabase())},r.prototype.rebuildDatabase=function(e){var t=this;return this._getDatabase().then(function(n){return i.promiseFromTask(t._rebuildDb(e).run(n))})},r.prototype.fetchDirty=function(){var e=this;return this._getDatabase().then(function(t){return i.promiseFromTask(e._fetchDirty().run(t))})},r.prototype.makeClean=function(e){var t=this;return this._getDatabase().then(function(n){return i.promiseFromTask(t._makeClean(e).run(n))})},r.prototype.cleanupDirtyObjects=function(){return this._getDatabase().then(this._cleanupDirtyObjects())},r.prototype._getDatabase=function(){return Promise.reject(new Error("not implemented"))},r.prototype._initialize=function(){return Promise.reject(new Error("not implemented"))},r.prototype._fetch=function(e){return function(e){return Promise.reject(new Error("not implemented"))}},r.prototype._fetchSlice=function(e,t,n){return function(e){return Promise.reject(new Error("not implemented"))}},r.prototype._insertOrReplace=function(e){return function(e){return Promise.reject(new Error("not implemented"))}},r.prototype._cleanDatabase=function(){return function(e){return Promise.reject(new Error("not implemented"))}},r.prototype._rebuildDb=function(e){return u.rejected(new Error("not implemented"))},r.prototype._fetchDirty=function(){return u.rejected(new Error("not implemented"))},r.prototype._makeClean=function(){return u.rejected(new Error("not implemented"))},r.prototype._cleanupDirtyObjects=function(){return function(e){return Promise.reject(new Error("not implemented"))}},e.exports=r},711:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e){return e.split(/\/([^\/]+)$/)}function u(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(h.callbackToPromise)(e.getDirectory.bind(e),t,{create:n})}function o(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(h.callbackToPromise)(e.getFile.bind(e),t,{create:n})}function a(e){return Object(h.callbackToPromise)(e.removeRecursively.bind(e))}function c(e){return Object(h.callbackToPromise)(e.file.bind(e)).then(l).then(function(e){return new Blob([e])})}function s(e,t){return Object(h.callbackToPromise)(e.createWriter.bind(e)).then(function(e){return f(t,e)})}function l(e){return new Promise(function(t,n){var r=new FileReader;r.onload=function(e){return t(e.target.result)},r.onerror=function(e){return n(e.target.error)},r.readAsArrayBuffer(e)})}function f(e,t){return new Promise(function(n,r){t.onwrite=n,t.onerror=r,t.write(e)})}function m(e,t,n){return new Promise(function(r,i){e.moveTo(t,n,r,i)})}n.d(t,"a",function(){return b});var h=n(176),p=n(64),y=function(){function e(e,t){var n=[],r=!0,i=!1,u=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,u=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw u}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),b=function(){function e(t){r(this,e),this._config=t,this._storageDirPromise=null}return d(e,[{key:"readFile",value:function(e){return this._openFile(e).then(function(e){return c(e)})}},{key:"storeFile",value:function(e,t){return this._openFile(t,!0).then(function(t){return s(t,e)})}},{key:"moveFile",value:function(e,t){var n,r,u,o,a,c;return regeneratorRuntime.async(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,regeneratorRuntime.awrap(this._openFile(e));case 2:return n=s.sent,r=i(t),u=y(r,2),o=u[0],a=u[1],s.next=6,regeneratorRuntime.awrap(this._openDir(o));case 6:return c=s.sent,s.next=9,regeneratorRuntime.awrap(m(n,c,a));case 9:case"end":return s.stop()}},null,this)}},{key:"downloadFile",value:function(e,t){var n=this;return this._config.downloadFileFn?Object(h.callbackToPromise)(this._config.downloadFileFn,e,t):Object(p.get)(e,"blob").then(function(e){return n.storeFile(e,t)})}},{key:"removeDir",value:function(e){var t;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,regeneratorRuntime.awrap(this._openDir(e));case 3:return t=n.sent,n.next=6,regeneratorRuntime.awrap(a(t));case 6:n.next=12;break;case 8:if(n.prev=8,n.t0=n.catch(0),1===n.t0.code){n.next=12;break}throw n.t0;case 12:case"end":return n.stop()}},null,this,[[0,8]])}},{key:"_openFile",value:function(e){var t,n,r,u,a,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.async(function(s){for(;;)switch(s.prev=s.next){case 0:return t=i(e),n=y(t,2),r=n[0],u=n[1],s.next=3,regeneratorRuntime.awrap(this._openDir(r,c));case 3:return a=s.sent,s.abrupt("return",o(a,u,c));case 5:case"end":return s.stop()}},null,this)}},{key:"_openDir",value:function(e){var t,n,r,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.async(function(o){for(;;)switch(o.prev=o.next){case 0:return t=e.split("/").filter(function(e){return""!==e}),o.next=3,regeneratorRuntime.awrap(this._getStorageDir());case 3:n=o.sent,r=0;case 5:if(!(r<t.length)){o.next=12;break}return o.next=8,regeneratorRuntime.awrap(u(n,t[r],i));case 8:n=o.sent;case 9:++r,o.next=5;break;case 12:return o.abrupt("return",n);case 13:case"end":return o.stop()}},null,this)}},{key:"_getStorageDir",value:function(){return this._config.getStorageDirFn?Object(h.callbackToPromise)(this._config.getStorageDirFn):(null===this._storageDirPromise&&(this._storageDirPromise=Object(h.callbackToPromise)(window.webkitRequestFileSystem,window.TEMPORARY,1048576).then(function(e){return e.root})),this._storageDirPromise)}}]),e}()},712:function(e,t,n){"use strict";function r(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}function i(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function u(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}function o(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function a(e){return Object(l.f)(e.jsonData)}function c(e,t){var n={guid:e,objectType:t,attributes:{}},r=window.mx.meta.getEntity(t);return r.getAttributes().forEach(function(e){n.attributes[e]={value:d[r.getAttributeType(e)]}}),n}function s(e,t,n){var r=n?"thumbnails":"documents";return"filesystem:"+window.mx.appUrl+"temporary/files/"+r+"/"+e+"?"+ +new Date}n.d(t,"a",function(){return b});var l=n(686),f=n(81),m=n(292),h=function(){function e(e,t){var n=[],r=!0,i=!1,u=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,u=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw u}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),p=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),y=n(4),d={String:null,Integer:"0",Long:"0",Decimal:"0",Float:"0",Currency:"0",Enum:null,HashString:null,ObjectReference:null,DateTime:null,Boolean:!1,AutoNumber:"0",Binary:null},b=function(e){function t(e,n,r,o,a){i(this,t);var c=u(this,(t.__proto__||Object.getPrototypeOf(t)).call(this));return e=e||{},c._store=r,c._getDocumentUrl=e.getDocumentUrlFn||s,c._objectCache=n,c._fileBackend=o,c._synchronizer=a,c._dirtyGuids=[],c}return o(t,e),p(t,[{key:"initialize",value:function(){var e;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(this._store.fetchDirty());case 2:e=t.sent,this._dirtyGuids=e.map(function(e){return e.guid});case 4:case"end":return t.stop()}},null,this)}},{key:"getByGuid",value:function(e,t){return Promise.all(e.map(this._getByGuid,this)).then(function(e){return{mxobjects:e.filter(function(e){return null!=e}).map(l.h)}})}},{key:"getSlice",value:function(e,t,n){var r=this,i=window.mx.meta.getEntity(e),u=(t||[]).map(function(e){return e.attribute&&i.isReference(e.attribute)&&(e.value=r._synchronizer.getInternalGuid(e.value)),e});return this._store.getSlice(e,u,n).then(function(e){var t=h(e,2),n=t[0],i=t[1];return{mxobjects:n.map(r._synchronizer.makeObjectExternal,r._synchronizer).map(l.h),count:i}})}},{key:"create",value:function(e){var t=Object(l.c)();return this._objectCache.onCreate([t]),this._objectCache.setMxObjects([c(t,e)]),Promise.resolve({actionResult:t})}},{key:"commit",value:function(e,t){var n,i,u,o,c,s,f,m,p,d,b,g=this;return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return b=function(e){var t={};return Object.keys(e).forEach(function(n){t[n]=Object.keys(e[n])}),t},d=function(e){return Object.assign({},e,y.mapObject(i[e.guid],function(e){return e.value}))},i=y.objectFromArray(e.map(function(e){return[e,y.clone(g._objectCache.getChanges(e))]})),u=y.partition(function(e){return g._objectCache.has(e)},e),o=h(u,2),c=o[0],s=o[1],f=c.map(function(e){return g._objectCache.getObject(e)}).map(a),t.next=7,regeneratorRuntime.awrap(Promise.all(s.map(this._getByGuid,this)));case 7:return m=t.sent,p=m.concat(f).map(d),t.next=11,regeneratorRuntime.awrap(this._store.insertOrReplace(p.map(this._synchronizer.makeObjectInternal,this._synchronizer)));case 11:return(n=this._dirtyGuids).push.apply(n,r(e)),this._objectCache.onCommit(e),this._objectCache.setMxObjects(p.map(function(e){return Object(l.h)(Object.assign(e,{$dirty:!0}))})),this._objectCache.removeChanges(b(i)),t.abrupt("return",{});case 16:case"end":return t.stop()}},null,this)}},{key:"rollback",value:function(e){var t=this;this._objectCache.removeAllChanges(e);var n=e.filter(function(e){return t._objectCache.isNew(e)});return this._objectCache.removeObjects(n),Promise.resolve({})}},{key:"validate",value:function(e){return Promise.resolve({})}},{key:"saveDocument",value:function(e,t,n,r){var i=this;if(r.size/1048576>n.maxFileSize)return Promise.reject(new f.DescribedError("File too large"));var u=Object(l.g)(this._synchronizer.getInternalGuid(e));return this._fileBackend.storeFile(r,l.a+u).then(function(){return i._objectCache.makeChange(e,"HasContents",!0),i.commit([e],null)})}},{key:"getDocumentUrl",value:function(e,t,n){return this._getDocumentUrl(Object(l.g)(this._synchronizer.getInternalGuid(e)),t,n)}},{key:"getImageUrl",value:function(e){return Promise.resolve(e)}},{key:"upload",value:function(){return this._synchronizer.upload()}},{key:"downloadObjects",value:function(e){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(this._synchronizer.downloadObjects(e));case 2:this._dirtyGuids=[];case 3:case"end":return t.stop()}},null,this)}},{key:"downloadFiles",value:function(e){return this._synchronizer.downloadFiles(e)}},{key:"cleanupDirtyObjects",value:function(){return this._store.cleanupDirtyObjects()}},{key:"isDirty",value:function(e){return this._dirtyGuids.includes(e)}},{key:"cleanup",value:function(){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this._store.cleanDatabase());case 2:return e.next=4,regeneratorRuntime.awrap(this._fileBackend.removeDir(l.a));case 4:return e.next=6,regeneratorRuntime.awrap(this._fileBackend.removeDir(l.b));case 6:this._dirtyGuids=[];case 7:case"end":return e.stop()}},null,this)}},{key:"_getByGuid",value:function(e){var t=this;return this._store.getByGuid(this._synchronizer.getInternalGuid(e)).then(function(e){return t._synchronizer.makeObjectExternal(e)})}}]),t}(m.a)},713:function(e,t,n){"use strict";function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function i(e,t){if(null===e)return null;var n=window.mx.meta.getEntity(e.$objectType);return f.mapObject(e,function(e,r){return("guid"===r||!Object(u.e)(r)&&n.isReference(r))&&null!=e?t(e):e})}n.d(t,"a",function(){return m});var u=n(686),o=n(134),a=n(24),c=n(34),s=function(){function e(e,t){var n=[],r=!0,i=!1,u=void 0;try{for(var o,a=e[Symbol.iterator]();!(r=(o=a.next()).done)&&(n.push(o.value),!t||n.length!==t);r=!0);}catch(e){i=!0,u=e}finally{try{!r&&a.return&&a.return()}finally{if(i)throw u}}return n}return function(t,n){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function e(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}return function(t,n,r){return n&&e(t.prototype,n),r&&e(t,r),t}}(),f=n(4),m=function(){function e(t,n,i,u){r(this,e),this._store=t,this._runtimeApi=n,this._fileBackend=i,this._objectCache=u,this._internalToExternal={}}return l(e,[{key:"upload",value:function(){var e,t,n,r,i,c,l,m,h,p,y,d,b,g,v,_,w,j=this;return regeneratorRuntime.async(function(T){for(;;)switch(T.prev=T.next){case 0:return w=function(n,r){var i,o,a;return regeneratorRuntime.async(function(c){for(;;)switch(c.prev=c.next){case 0:if(i=u.a+Object(u.g)(n.guid),o=u.a+Object(u.g)(r),i===o){c.next=5;break}return c.next=5,regeneratorRuntime.awrap(t.moveFile(i,o));case 5:return c.next=7,regeneratorRuntime.awrap(t.readFile(o));case 7:return a=c.sent,c.next=10,regeneratorRuntime.awrap(e.upload(r,n.Name,{},a,{},[]));case 10:case"end":return c.stop()}},null,this)},_=function(e,t){function n(t){return!Object(u.e)(t)&&r.isSyncable(t)&&!Object(u.d)(e,t)}var r=window.mx.meta.getEntity(e.$objectType),i=Object.keys(e).filter(n).map(function(n){var i=e[n];return[n,{value:r.isObjectReference(n)&&null!=i&&!Object(u.i)(i)?t[i]:i}]});return[Object(u.i)(e.guid)?e.guid:t[e.guid],f.objectFromArray(i)]},v=function(t){return e.instantiate(t.$objectType).then(function(e){var n=e.objects.find(function(t){return t.guid===e.actionResult});return{internalObj:t,remoteJson:n}})},g=function(e){var t=window.mx.meta.getEntity(e.$objectType);return f.arrayFromObject(e).filter(function(e){var n=s(e,2),r=n[0];n[1];return"guid"===r||!Object(u.e)(r)&&t.isReference(r)})},b=function(e){var t=e.map(function(e){return e.guid}),n=f.unique(e.map(function(e){return g(e).map(function(e){var t=s(e,2);t[0];return t[1]})}).reduce(function(e,t){return e.concat(t)},[])),r=n.filter(function(e){return!Object(u.i)(e)}).filter(function(e){return!t.includes(e)});if(r.length>0){var i=f.unique(e.map(function(e){return g(e).filter(function(e){var t=s(e,2),n=(t[0],t[1]);return r.includes(n)}).map(function(t){var n=s(t,2),r=n[0];n[1];return"object of type "+e.$objectType+" (reference "+r+")"})}).reduce(function(e,t){return e.concat(t)},[])).join(", "),a="Sync has failed due to a modeling error. Your database contains objects that reference uncommitted objects:\n"+i+".";throw new o.DanglingError(a)}},e=this._runtimeApi,t=this._fileBackend,T.next=9,regeneratorRuntime.awrap(this._store.fetchDirty());case 9:return n=T.sent,b(n),r=f.partition(function(e){return Object(u.i)(e.guid)},n),i=s(r,2),c=i[0],l=i[1],T.next=14,regeneratorRuntime.awrap(Promise.all(l.map(v)));case 14:return m=T.sent,h=f.objectFromArray(m.map(function(e){var t=e.internalObj,n=e.remoteJson;return[t.guid,n.guid]})),p=m.map(function(e){return e.remoteJson}),y=c.map(function(e){return e.guid}).concat(m.map(function(e){return e.remoteJson.guid})),d=f.objectFromArray(n.map(function(e){return _(e,h)})),T.next=21,regeneratorRuntime.awrap(e.commit(y,new a.MxContext,d,p));case 21:return T.next=23,regeneratorRuntime.awrap(this._store.makeClean(n));case 23:return T.next=25,regeneratorRuntime.awrap(Promise.all(n.filter(function(e){return window.mx.meta.getEntity(e.$objectType).isA("System.FileDocument")}).filter(function(e){return e.HasContents}).map(function(e){return w(e,Object(u.i)(e.guid)?e.guid:h[e.guid])})));case 25:return f.arrayFromObject(h).forEach(function(e){var t=s(e,2),n=t[0],r=t[1];return j._mapInternalGuid(n,r)}),T.abrupt("return",{});case 27:case"end":return T.stop()}},null,this)}},{key:"downloadObjects",value:function(e){var t,n,r,i,o=this;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return i=function(e,n){return t.retrieveByXPath(n).then(function(t){return t.mxobjects.map(u.f).map(function(t){return Object.assign({},t,{$objectType:e})})})},t=this._runtimeApi,a.t0=f,a.next=5,regeneratorRuntime.awrap(Promise.all(e.map(function(e){return i(e.store,e.xpath)})));case 5:return a.t1=a.sent,n=a.t0.flatten.call(a.t0,a.t1),a.next=9,regeneratorRuntime.awrap(this._store.rebuildDatabase(n));case 9:return r=n.map(this.makeObjectExternal,this).filter(function(e){return o._objectCache.has(e.guid)}),this._objectCache.setMxObjects(r.map(u.h)),a.abrupt("return",{});case 12:case"end":return a.stop()}},null,this)}},{key:"downloadFiles",value:function(e){var t,n,r,i,o,a,l;return regeneratorRuntime.async(function(m){for(;;)switch(m.prev=m.next){case 0:return l=function(e,t){var r=Object(c.getRemoteDynamicResourceUrl)(e.guid,e.changedDate,t),i=(t?u.b:u.a)+Object(u.g)(e.guid);return n.downloadFile(r,i)},a=function(e){return t.getSlice(e,[{attribute:"HasContents",operator:"equals",value:"true"}]).then(function(e){var t=s(e,2),n=t[0];t[1];return n})},t=this._store,n=this._fileBackend,m.t0=f,m.next=7,regeneratorRuntime.awrap(Promise.all(e.map(function(e){return a(e)})));case 7:return m.t1=m.sent,r=m.t0.flatten.call(m.t0,m.t1),i=r.map(function(e){return l(e,!1)}),o=r.filter(function(e){return window.mx.meta.getEntity(e.$objectType).isA("System.Image")}).map(function(e){return l(e,!0)}),m.next=13,regeneratorRuntime.awrap(Promise.all(i.concat(o)));case 13:return m.abrupt("return",{});case 14:case"end":return m.stop()}},null,this)}},{key:"getExternalGuid",value:function(e){return this._internalToExternal[e]||e}},{key:"getInternalGuid",value:function(e){for(var t in this._internalToExternal)if(this._internalToExternal[t]===e)return t;return e}},{key:"makeObjectExternal",value:function(e){return i(e,this.getExternalGuid.bind(this))}},{key:"makeObjectInternal",value:function(e){return i(e,this.getInternalGuid.bind(this))}},{key:"_mapInternalGuid",value:function(e,t){this._internalToExternal[t]=e}}]),e}()}});