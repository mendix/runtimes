/* @preserve
    Copyright (c) 2005-2016, Mendix bv. All rights reserved.
    See mxclientsystem/licenses.txt for third party licenses that apply.
*/
webpackJsonp([1],{632:function(t,e,n){"use strict";function r(t,e){var n,r,s,l,f=e.createStoreFn,m=e.getStorageDirFn,p=e.downloadFileFn,h=e.getDocumentUrlFn;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return n=new i(window.mx.session.getConfig("sync_config.schema"),f),r=new u.a({downloadFileFn:p,getStorageDirFn:m}),s=new c.a(n,o,r,t),l=new a.a({getDocumentUrlFn:h},t,n,r,s),e.next=6,regeneratorRuntime.awrap(l.initialize());case 6:return e.abrupt("return",l);case 7:case"end":return e.stop()}},null,this)}Object.defineProperty(e,"__esModule",{value:!0}),e.buildOfflineDataBackend=r;var i=n(656),o=(n.n(i),n(123)),u=n(664),a=n(665),c=n(666)},633:function(t,e){t.exports={LIKE_ESCAPE_CHAR:"~",QUOTE_CHAR:'"'}},634:function(t,e){function n(t){this.fork=t}n.of=function(t){return new n(function(e,n){n(t)})},n.prototype.chain=function(t){var e=this;return new n(function(n,r){e.fork(n,function(e){t(e).fork(n,r)})})},n.prototype.orElse=function(t){var e=this;return new n(function(n,r){e.fork(function(e){t(e).fork(n,r)},r)})},n.prototype.ap=function(t){var e,r,i,o=this,u=2;return new n(function(n,a){function c(){0==--u&&a(e(r))}function s(t){void 0===i&&(i=t,n(i))}o.fork(s,function(t){e=t,c()}),t.fork(s,function(t){r=t,c()})})},n.prototype.map=function(t){return this.chain(function(e){return n.of(t(e))})},n.rejected=n.prototype.rejected=function(t){return new n(function(e,n){e(t)})},n.parallel=function(t){return new n(function(e,n){function r(t){return function(e){u[t]=e,void 0===i&&0==--o&&n(u)}}var i,o=t.length,u=new Array(t.length);if(0===t.length)return void n(u);t.forEach(function(t,n){t.fork(function(t){void 0===i&&(i=t,e(t))},r(n))})})},n.sequence=function(t){return t.reduce(function(t,e){return t.chain(function(t){return e})},n.of(null))},t.exports=n},635:function(t,e,n){var r=n(661),i=n(634),o=new r(i);o.rejected=function(t){return new o(function(e){return i.rejected(t)})},o.parallel=function(t){return new o(function(e){return new i(function(n,r){if(0===t.length)return void r([]);var i=new Array(t.length),o=t.length,u=!1;t.forEach(function(t,a){t.run(e).fork(function(t){u||(u=!0,n(t))},function(t){i[a]=t,u||0!=--o||r(i)})})})})},o.sequence=function(t){return t.reduce(function(t,e){return t.chain(function(t){return e.map(function(e){return t.concat([e])})})},o.of([]))},t.exports=o},638:function(t,e,n){var r=n(634),i={};i.promiseFromTask=function(t){return new Promise(function(e,n){t.fork(n,e)})},i.callbackFromTask=function(t,e,n){t.fork(function(t){n&&n(t)},function(t){e&&e(t)})},i.taskFromPromise=function(t){return new r(function(e,n){t.then(n,e)})},t.exports=i},639:function(t,e,n){"use strict";function r(t){return t.replace(/:/g,"_")}function i(){return p+l.getUniqueId()}function o(t){return!h.test(t)}function u(t){return"guid"===t||"$"===t[0]}function a(t,e){return t.$readonlyAttrs.includes(e)}function c(t){var e=Object.keys(t).filter(function(t){return!u(t)}).reduce(function(e,n){return e[n]={value:t[n]},a(t,n)&&(e[n].readonly=!0),e},{});return{guid:t.guid,objectType:t.$objectType,attributes:e}}function s(t){var e={guid:t.guid,$objectType:t.objectType,$readonlyAttrs:[]};for(var n in t.attributes)e[n]=t.attributes[n].value,t.attributes[n].readonly&&e.$readonlyAttrs.push(n);return e}n.d(e,"a",function(){return f}),n.d(e,"b",function(){return m}),e.g=r,e.c=i,e.i=o,e.e=u,e.d=a,e.h=c,e.f=s;var l=n(4),f="files/documents/",m="files/thumbnails/",p="GUID:",h=new RegExp("^"+p)},656:function(t,e,n){function r(){return window.openDatabase("MendixDatabase","1","Mendix Database",10485760)}function i(t,e){a.call(this),e=e||r,this._tableNames=t;var n=e();this._databasePromise=this._initialize(n)}var o=n(657),u=n(662),a=n(663),c=n(635),s=n(638);i.prototype=Object.create(a.prototype),i.prototype._getDatabase=function(){return this._databasePromise},i.prototype._initialize=function(t){var e=o.createCreateTransaction(this._tableNames);return s.promiseFromTask(u.runWriteTransaction(t,e)).then(function(){return t})},i.prototype._fetch=function(t){return function(e){var n=o.createFetchByGuidTransaction(t);return s.promiseFromTask(u.runReadTransaction(e,n))}},i.prototype._fetchSlice=function(t,e,n){return function(r){var i=o.createFetchSliceTransaction(t,e,n.offset,n.limit,n.sort);return s.promiseFromTask(u.runReadTransaction(r,i))}},i.prototype._rebuildDb=function(t){return c.ask().chain(function(e){var n=o.createRebuildTransaction(this._tableNames,t);return new c(function(t){return u.runWriteTransaction(e,n)})}.bind(this))},i.prototype._insertOrReplace=function(t){return function(e){var n=o.createInsertOrReplaceTransaction(t);return s.promiseFromTask(u.runWriteTransaction(e,n))}},i.prototype._cleanDatabase=function(){var t=this;return function(e){var n=o.createCleanTransaction(t._tableNames);return s.promiseFromTask(u.runWriteTransaction(e,n))}},i.prototype._fetchDirty=function(){return c.ask().chain(function(t){var e=o.createFetchDirtyObjectsTransaction();return new c(function(n){return u.runWriteTransaction(t,e)})})},i.prototype._makeClean=function(t){return c.ask().chain(function(e){var n=o.createMakeCleanTransaction(t);return new c(function(t){return u.runWriteTransaction(e,n)})})},i.prototype._cleanupDirtyObjects=function(){return function(t){var e=o.createDirtyCleanupTransaction();return s.promiseFromTask(u.runWriteTransaction(t,e))}},t.exports=i},657:function(t,e,n){function r(t){var e=[A].concat(t).map(v).map(function(t){return"DROP TABLE IF EXISTS '"+t+"'"}).map(function(t){return T(t,[])});return R.sequence([R.parallel(e),i(t)])}function i(t){function e(t){return T(n(t).reduce(function(t,e){return t.column(v(e.attr),e.type)},(new E).table(v(t)).primaryKeyColumn("guid","text")).createIfNotExists(),[])}function n(t){var e=window.mx.meta.getEntity(t);return e.getAttributes().map(function(t){var n=e.getAttributeType(t);return{attr:t,type:C[n]}})}var r=[a()].concat(t.map(e));return R.parallel(r).map(function(t){})}function o(t,e){var n=e.reduce(function(e,n){var r=c(),i=l(t,n);return e.concat([T(r.insert(),[n.guid,t,0,JSON.stringify(n.$readonlyAttrs)]),T(i.builder.insert(),i.values)])},[]);return R.parallel(n).map(function(t){})}function u(){return T((new x).from(A).where("dirty","equals").selectDistinct("tableName"),[1])}function a(){return T((new E).table(A).primaryKeyColumn("guid","text").column("tableName","text").column("dirty","boolean").column("readonlyAttrs","text").createIfNotExists(),[])}function c(){return(new k).into(A).column("guid").column("tableName").column("dirty").column("readonlyAttrs")}function s(t,e){return e.reduce(function(e,n){var r=t.getAttributeType(n.attribute),i=null==n.value,o=P[r],u=F[r],a=u(o(n.value));if(i&&"equals"===n.operator){return{builder:(n.negate?e.builder.whereNotNull:e.builder.whereNull).call(e.builder,v(n.attribute)),args:e.args}}if(i&&"contains"===n.operator)return e;var c=n.negate?e.builder.whereNot:e.builder.where,s="contains"===n.operator?g(a):a;return{builder:c.call(e.builder,v(n.attribute),n.operator),args:e.args.concat([s])}},{builder:new x,args:[]})}function l(t,e){var n=window.mx.meta.getEntity(t),r=n.getAttributes(),i=r.reduce(function(t,r){var i=n.getAttributeType(r),o=F[i];if(!o)return t;var u=o(e[r]);return{attrs:t.attrs.concat([r]),values:t.values.concat([u])}},{attrs:["guid"],values:[e.guid]});return{builder:i.attrs.reduce(function(t,e){return t.column(v(e))},(new k).into(v(t))),values:i.values}}function f(t){if(null==t)return null;var e=new N(t),n=20-Math.max(0,e.e)-1;return(e.s<0?"-":"")+new Array(n+1).join("0")+e.abs().toFixed()}function m(t){return null!=t?String(t):null}function p(t){return null!=t?Number(t):null}function h(t){return"false"!==t}function y(t){return t?Number(t):null}function d(t){return t}function b(t){for(var e=[],n=0;n<t.length;++n)e.push(t.item(n));return e}function g(t){var e=O.LIKE_ESCAPE_CHAR;return t.replace(new RegExp(e,"g"),e+e).replace(/%/g,e+"%").replace(/_/g,e+"_")}function v(t){return t.replace(".","$")}function _(t){return t.replace("$",".")}function w(t,e,n,r){var i={guid:r.guid,$objectType:t.getEntity(),$dirty:e,$readonlyAttrs:JSON.parse(n)};for(var o in r)if(!function(t){return"guid"===t||t.indexOf(".")>-1}(o)){var u=_(o),a=t.getAttributeType(u),c=S[a];c&&(i[u]=c(r[o]))}return i}function j(t,e){return t[A+"."+e]}function T(t,e){return e=e||[],new R(function(n){return new D(function(r,i){n.executeSql(t,e,function(t,e){return i(e)},function(t,e){return r(e)})})})}var O=n(633),x=n(658),E=n(659),k=n(660),R=n(635),D=n(634),N=n(34),A="_guidToTable",C={String:"text",Integer:"text",Long:"text",Decimal:"text",Float:"text",Currency:"text",Enum:"text",HashString:"text",ObjectReference:"text",DateTime:"integer",Boolean:"integer",AutoNumber:"integer",Binary:"blob"},F={String:m,Integer:f,Long:f,Decimal:f,Float:f,Currency:f,Enum:m,HashString:m,ObjectReference:m,DateTime:p,Boolean:Number,AutoNumber:m,Binary:m},S={String:m,Integer:m,Long:m,Decimal:m,Float:m,Currency:m,Enum:m,HashString:m,ObjectReference:m,DateTime:d,Boolean:Boolean,AutoNumber:m,Binary:m},P={String:d,Integer:d,Long:d,Decimal:d,Float:d,Currency:d,Enum:d,HashString:d,ObjectReference:d,DateTime:y,Boolean:h,AutoNumber:d,Binary:d},I={createCreateTransaction:i,createCleanTransaction:function(t){var e=[A].concat(t).map(v).map(function(t){return"DELETE FROM '"+t+"'"}).map(function(t){return T(t,[])});return R.parallel(e).map(function(t){})},createFetchByGuidTransaction:function(t){return T((new x).from(A).where("guid","equals").select(),[t]).chain(function(e){if(0===e.rows.length)return R.of(null);if(1!==e.rows.length)return R.rejected(new Error("db consistency error"));var n=e.rows.item(0),r=n.tableName,i=Boolean(n.dirty),o=n.readonlyAttrs;return T((new x).from(v(r)).where("guid","equals").select(),[t]).chain(function(t){return 0===t.rows.length?R.rejected(new Error("entity not found")):1!==t.rows.length?R.rejected(new Error("db consistency error")):R.of(w(window.mx.meta.getEntity(r),i,o,t.rows.item(0)))})})},createFetchSliceTransaction:function(t,e,n,r,i){e=e||[],i=i||[];var o=window.mx.meta.getEntity(t),u=s(o,e),a=u.builder.from(v(t)),c=u.args,l=a.offset(n).limit(r).join(A,"guid",["dirty","readonlyAttrs"]);l=i.reduce(function(t,e){return t.order(e[0],e[1])},l);var f=T(l.select(),c).map(function(t){for(var e=[],n=0;n<t.rows.length;++n){var r=t.rows.item(n),i=Boolean(r[A+".dirty"]),u=j(r,"readonlyAttrs");e.push(w(o,i,u,r))}return e}),m=T(a.selectCount("cnt"),c).map(function(t){return t.rows.item(0).cnt});return R.parallel([f,m])},createInsertOrReplaceTransaction:function(t){return R.parallel(t.map(function(t){var e=t.$objectType,n=c(),r=l(e,t);return[T(n.insertOrReplace(),[t.guid,e,1,JSON.stringify(t.$readonlyAttrs)]),T(r.builder.insertOrReplace(),r.values)]}).reduce(function(t,e){return t.concat(e)},[])).map(function(t){})},createFetchDirtyObjectsTransaction:function(){return u().chain(function(t){var e=b(t.rows).map(function(t){var e=t.tableName,n=(new x).from(v(e)).join(A,"guid",["dirty","readonlyAttrs"]).where(A+".dirty","equals").select(),r=window.mx.meta.getEntity(e);return T(n,[1]).map(function(t){return b(t.rows).map(function(t){return w(r,!0,j(t,"readonlyAttrs"),t)})})});return R.parallel(e)}).map(function(t){return t.reduce(function(t,e){return t.concat(e)},[])})},createMakeCleanTransaction:function(t){var e=t.map(function(t){return T("UPDATE "+A+" set dirty = 0 where guid = ?",[t.guid])});return R.parallel(e).map(function(t){})},createDirtyCleanupTransaction:function(){return u().chain(function(t){var e=b(t.rows).map(function(t){var e=t.tableName;return T("DELETE FROM "+v(e)+" WHERE guid IN (\n                            SELECT guid FROM "+A+" WHERE tableName = ? AND dirty = 1)",[e])});return R.sequence([R.parallel(e),T("DELETE FROM "+A+" WHERE dirty = 1")]).map(function(t){})})},createRebuildTransaction:function(t,e){var n=r(t),i=t.map(function(t){var n=e.filter(function(e){return e.$objectType===t});return o(t,n)});return R.sequence([n,R.parallel(i)]).map(function(t){})}};t.exports=I},658:function(t,e,n){function r(t,e){this._select=e&&e.select||t&&t._select||null,this._from=e&&e.from||t&&t._from||null,this._join=e&&e.join||t&&t._join||null,this._constraints=e&&e.constraints||t&&t._constraints||[],this._orderBy=e&&e.orderBy||t&&t._orderBy||[],this._limit=e&&e.limit||t&&t._limit||null,this._offset=e&&e.offset||t&&t._offset||null}function i(t,e){this._column=t,this._negate=!!e}function o(t,e,n){this._column=t,this._operator=e,this._negate=!!n}function u(t){return function(e){return e+" "+t+" ?"}}function a(t){var e="";return e+=t,e+=" LIKE '%' || ? || '%'",e+=" ESCAPE '"+c.LIKE_ESCAPE_CHAR+"'"}var c=n(633),s={equals:u("="),lessThan:u("<"),lessThanOrEquals:u("<="),greaterThan:u(">"),greaterThanOrEquals:u(">="),contains:a};r.prototype.from=function(t){return new r(this,{from:t})},r.prototype.join=function(t,e,n){return new r(this,{join:{tableName:t,joinOnColumn:e,selectedColumns:n}})},r.prototype.where=function(t,e){return this._where(t,!1,e)},r.prototype.whereNot=function(t,e){return this._where(t,!0,e)},r.prototype.whereNull=function(t,e){return this._whereNull(t,!1,e)},r.prototype.whereNotNull=function(t,e){return this._whereNull(t,!0,e)},r.prototype.order=function(t,e){return new r(this,{orderBy:this._orderBy.concat([[t,e]])})},r.prototype.limit=function(t){return new r(this,{limit:t})},r.prototype.offset=function(t){return new r(this,{offset:t})},r.prototype.selectDistinct=function(t){return Array.isArray(t)&&(t=t.join(", ")),"SELECT DISTINCT "+t+this._buildSql()},r.prototype.selectCount=function(t){return"SELECT COUNT(*) AS "+t+this._buildSql()},r.prototype.select=function(){var t=this,e="SELECT "+this._from+".*";return this._join&&this._join.selectedColumns.forEach(function(n){e+=", "+t._join.tableName+".["+n+'] as "'+t._join.tableName+"."+n+'"'}),e+this._buildSql()},r.prototype._where=function(t,e,n){return new r(this,{constraints:this._constraints.concat([new o(t,n,e)])})},r.prototype._whereNull=function(t,e){return new r(this,{constraints:this._constraints.concat([new i(t,e)])})},r.prototype._buildSql=function(){var t=this,e=" FROM "+this._from+" AS "+this._from;return this._join&&(e+=" JOIN "+this._join.tableName+" AS "+this._join.tableName+" USING ("+this._join.joinOnColumn+")"),this._constraints.length>0&&(e+=" WHERE "+this._constraints.map(function(e){return e.build(t._from)}).join(" AND ")),this._orderBy.length>0&&(e+=" ORDER BY "+this._orderBy.map(function(e){return t._from+".["+e[0]+"] "+e[1]}).join(", ")),this._limit&&(e+=" LIMIT "+this._limit),this._offset&&(e+=" OFFSET "+this._offset),e},i.prototype.build=function(t){return(this._column.indexOf(".")>-1?this._column:t+".["+this._column+"]")+" IS "+(this._negate?"NOT ":"")+"NULL"},o.prototype.build=function(t){var e=s[this._operator],n=this._column.indexOf(".")>-1?this._column:t+".["+this._column+"]";return(this._negate?"NOT ":"")+e(n)},t.exports=r},659:function(t,e,n){function r(t,e){this._tableName=e&&e.tableName||t&&t._tableName||null,this._columns=e&&e.columns||t&&t._columns||[]}function i(t){var e=o.QUOTE_CHAR;return e+t+e}var o=n(633);r.prototype.table=function(t){return new r(this,{tableName:t})},r.prototype.column=function(t,e){return new r(this,{columns:this._columns.concat({columnName:t,columnType:e,isPrimary:!1})})},r.prototype.primaryKeyColumn=function(t,e){return new r(this,{columns:this._columns.concat({columnName:t,columnType:e,isPrimary:!0})})},r.prototype.createIfNotExists=function(){var t="";return t+="CREATE TABLE IF NOT EXISTS "+i(this._tableName),t+=this._buildSql()},r.prototype._buildSql=function(){var t="";return this._columns.length>0&&(t+=" (",t+=this._columns.map(function(t){return[i(t.columnName),t.columnType,"text"===t.columnType?" COLLATE NOCASE ":"",t.isPrimary?"PRIMARY KEY ":""].join(" ").slice(0,-1)},this).join(", "),t+=")"),t},t.exports=r},660:function(t,e,n){function r(t,e){if(!(this instanceof r))return new r;this._tableName=e&&e.tableName||t&&t._tableName||null,this._columnNames=e&&e.columnNames||t&&t._columnNames||[]}function i(t){var e=o.QUOTE_CHAR;return e+t+e}var o=n(633);r.prototype.into=function(t){return new r(this,{tableName:t})},r.prototype.column=function(t){return new r(this,{columnNames:this._columnNames.concat(t)})},r.prototype.insert=function(){var t="";return t+="INSERT INTO "+i(this._tableName),t+=this._buildSql()},r.prototype.insertOrReplace=function(){var t="";return t+="INSERT OR REPLACE INTO "+i(this._tableName),t+=this._buildSql()},r.prototype._buildSql=function(){var t="";return this._columnNames.length>0&&(t+=" (",t+=this._columnNames.map(i).join(", "),t+=")"),t+=" VALUES (",t+="?"+new Array(this._columnNames.length).join(", ?"),t+=")"},t.exports=r},661:function(t,e){function n(t){function e(t){this.run=t}return e.prototype.chain=function(t){return new e(function(e){return this.run(e).chain(function(n){return t(n).run(e)})}.bind(this))},e.prototype.ap=function(t){return new e(function(e){return this.run(e).ap(t.run(e))}.bind(this))},e.prototype.map=function(t){return this.chain(function(n){return e.of(t(n))})},e.of=function(n){return new e(function(e){return t.of(n)})},e.ask=function(){return new e(t.of)},e}t.exports=n},662:function(t,e,n){function r(t){return function(e,n){return new i(function(r,i){var o,u=2;e[t](function(t){n.run(t).fork(r,function(t){o=t,0==--u&&i(o)})},r,function(){0==--u&&i(o)})})}}var i=n(634);t.exports={runReadTransaction:r("readTransaction"),runWriteTransaction:r("transaction")}},663:function(t,e,n){function r(){}var i=n(638),o=n(635);r.prototype.getSlice=function(t,e){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._getDatabase().then(this._fetchSlice(t,e,n))},r.prototype.getByGuid=function(t){return this._getDatabase().then(this._fetch(t))},r.prototype.insertOrReplace=function(t){return this._getDatabase().then(this._insertOrReplace(t))},r.prototype.cleanDatabase=function(){return this._getDatabase().then(this._cleanDatabase())},r.prototype.rebuildDatabase=function(t){var e=this;return this._getDatabase().then(function(n){return i.promiseFromTask(e._rebuildDb(t).run(n))})},r.prototype.fetchDirty=function(){var t=this;return this._getDatabase().then(function(e){return i.promiseFromTask(t._fetchDirty().run(e))})},r.prototype.makeClean=function(t){var e=this;return this._getDatabase().then(function(n){return i.promiseFromTask(e._makeClean(t).run(n))})},r.prototype.cleanupDirtyObjects=function(){return this._getDatabase().then(this._cleanupDirtyObjects())},r.prototype._getDatabase=function(){return Promise.reject(new Error("not implemented"))},r.prototype._initialize=function(){return Promise.reject(new Error("not implemented"))},r.prototype._fetch=function(t){return function(t){return Promise.reject(new Error("not implemented"))}},r.prototype._fetchSlice=function(t,e,n){return function(t){return Promise.reject(new Error("not implemented"))}},r.prototype._insertOrReplace=function(t){return function(t){return Promise.reject(new Error("not implemented"))}},r.prototype._cleanDatabase=function(){return function(t){return Promise.reject(new Error("not implemented"))}},r.prototype._rebuildDb=function(t){return o.rejected(new Error("not implemented"))},r.prototype._fetchDirty=function(){return o.rejected(new Error("not implemented"))},r.prototype._makeClean=function(){return o.rejected(new Error("not implemented"))},r.prototype._cleanupDirtyObjects=function(){return function(t){return Promise.reject(new Error("not implemented"))}},t.exports=r},664:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t){return t.split(/\/([^\/]+)$/)}function o(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(p.callbackToPromise)(t.getDirectory.bind(t),e,{create:n})}function u(t,e){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return Object(p.callbackToPromise)(t.getFile.bind(t),e,{create:n})}function a(t){return Object(p.callbackToPromise)(t.removeRecursively.bind(t))}function c(t){return Object(p.callbackToPromise)(t.file.bind(t)).then(l).then(function(t){return new Blob([t])})}function s(t,e){return Object(p.callbackToPromise)(t.createWriter.bind(t)).then(function(t){return f(e,t)})}function l(t){return new Promise(function(e,n){var r=new FileReader;r.onload=function(t){return e(t.target.result)},r.onerror=function(t){return n(t.target.error)},r.readAsArrayBuffer(t)})}function f(t,e){return new Promise(function(n,r){e.onwrite=n,e.onerror=r,e.write(t)})}function m(t,e,n){return new Promise(function(r,i){t.moveTo(e,n,r,i)})}n.d(e,"a",function(){return b});var p=n(162),h=n(58),y=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),d=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),b=function(){function t(e){r(this,t),this._config=e,this._storageDirPromise=null}return d(t,[{key:"readFile",value:function(t){return this._openFile(t).then(function(t){return c(t)})}},{key:"storeFile",value:function(t,e){return this._openFile(e,!0).then(function(e){return s(e,t)})}},{key:"moveFile",value:function(t,e){var n,r,o,u,a,c;return regeneratorRuntime.async(function(s){for(;;)switch(s.prev=s.next){case 0:return s.next=2,regeneratorRuntime.awrap(this._openFile(t));case 2:return n=s.sent,r=i(e),o=y(r,2),u=o[0],a=o[1],s.next=6,regeneratorRuntime.awrap(this._openDir(u));case 6:return c=s.sent,s.next=9,regeneratorRuntime.awrap(m(n,c,a));case 9:case"end":return s.stop()}},null,this)}},{key:"downloadFile",value:function(t,e){var n=this;return this._config.downloadFileFn?Object(p.callbackToPromise)(this._config.downloadFileFn,t,e):Object(h.get)(t,"blob").then(function(t){return n.storeFile(t,e)})}},{key:"removeDir",value:function(t){var e;return regeneratorRuntime.async(function(n){for(;;)switch(n.prev=n.next){case 0:return n.prev=0,n.next=3,regeneratorRuntime.awrap(this._openDir(t));case 3:return e=n.sent,n.next=6,regeneratorRuntime.awrap(a(e));case 6:n.next=12;break;case 8:if(n.prev=8,n.t0=n.catch(0),1===n.t0.code){n.next=12;break}throw n.t0;case 12:case"end":return n.stop()}},null,this,[[0,8]])}},{key:"_openFile",value:function(t){var e,n,r,o,a,c=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.async(function(s){for(;;)switch(s.prev=s.next){case 0:return e=i(t),n=y(e,2),r=n[0],o=n[1],s.next=3,regeneratorRuntime.awrap(this._openDir(r,c));case 3:return a=s.sent,s.abrupt("return",u(a,o,c));case 5:case"end":return s.stop()}},null,this)}},{key:"_openDir",value:function(t){var e,n,r,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];return regeneratorRuntime.async(function(u){for(;;)switch(u.prev=u.next){case 0:return e=t.split("/").filter(function(t){return""!==t}),u.next=3,regeneratorRuntime.awrap(this._getStorageDir());case 3:n=u.sent,r=0;case 5:if(!(r<e.length)){u.next=12;break}return u.next=8,regeneratorRuntime.awrap(o(n,e[r],i));case 8:n=u.sent;case 9:++r,u.next=5;break;case 12:return u.abrupt("return",n);case 13:case"end":return u.stop()}},null,this)}},{key:"_getStorageDir",value:function(){return this._config.getStorageDirFn?Object(p.callbackToPromise)(this._config.getStorageDirFn):(null===this._storageDirPromise&&(this._storageDirPromise=Object(p.callbackToPromise)(window.webkitRequestFileSystem,window.TEMPORARY,1048576).then(function(t){return t.root})),this._storageDirPromise)}}]),t}()},665:function(t,e,n){"use strict";function r(t){if(Array.isArray(t)){for(var e=0,n=Array(t.length);e<t.length;e++)n[e]=t[e];return n}return Array.from(t)}function i(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function o(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function u(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function a(t){return Object(l.f)(t.jsonData)}function c(t,e){var n={guid:t,objectType:e,attributes:{}},r=window.mx.meta.getEntity(e);return r.getAttributes().forEach(function(t){n.attributes[t]={value:d[r.getAttributeType(t)]}}),n}function s(t,e,n){var r=n?"thumbnails":"documents";return"filesystem:"+window.mx.appUrl+"temporary/files/"+r+"/"+t+"?"+ +new Date}n.d(e,"a",function(){return b});var l=n(639),f=n(72),m=n(273),p=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),h=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),y=n(4),d={String:null,Integer:"0",Long:"0",Decimal:"0",Float:"0",Currency:"0",Enum:null,HashString:null,ObjectReference:null,DateTime:null,Boolean:!1,AutoNumber:"0",Binary:null},b=function(t){function e(t,n,r,u,a){i(this,e);var c=o(this,(e.__proto__||Object.getPrototypeOf(e)).call(this));return t=t||{},c._store=r,c._getDocumentUrl=t.getDocumentUrlFn||s,c._objectCache=n,c._fileBackend=u,c._synchronizer=a,c._dirtyGuids=[],c}return u(e,t),h(e,[{key:"initialize",value:function(){var t;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this._store.fetchDirty());case 2:t=e.sent,this._dirtyGuids=t.map(function(t){return t.guid});case 4:case"end":return e.stop()}},null,this)}},{key:"getByGuid",value:function(t,e){return Promise.all(t.map(this._getByGuid,this)).then(function(t){return{mxobjects:t.filter(function(t){return null!=t}).map(l.h)}})}},{key:"getSlice",value:function(t,e,n){var r=this,i=window.mx.meta.getEntity(t),o=(e||[]).map(function(t){return i.isReference(t.attribute)?(t.value=r._synchronizer.getInternalGuid(t.value),t):t});return this._store.getSlice(t,o,n).then(function(t){var e=p(t,2),n=e[0],i=e[1];return{mxobjects:n.map(r._synchronizer.makeObjectExternal,r._synchronizer).map(l.h),count:i}})}},{key:"create",value:function(t){var e=Object(l.c)();return this._objectCache.onCreate([e]),this._objectCache.setMxObjects([c(e,t)]),Promise.resolve({actionResult:e})}},{key:"commit",value:function(t,e){var n,i,o,u,c,s,f,m,h,d,b,g=this;return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return b=function(t){var e={};return Object.keys(t).forEach(function(n){e[n]=Object.keys(t[n])}),e},d=function(t){return Object.assign({},t,y.mapObject(i[t.guid],function(t){return t.value}))},i=y.objectFromArray(t.map(function(t){return[t,y.clone(g._objectCache.getChanges(t))]})),o=y.partition(function(t){return g._objectCache.has(t)},t),u=p(o,2),c=u[0],s=u[1],f=c.map(function(t){return g._objectCache.getObject(t)}).map(a),e.next=7,regeneratorRuntime.awrap(Promise.all(s.map(this._getByGuid,this)));case 7:return m=e.sent,h=m.concat(f).map(d),e.next=11,regeneratorRuntime.awrap(this._store.insertOrReplace(h.map(this._synchronizer.makeObjectInternal,this._synchronizer)));case 11:return(n=this._dirtyGuids).push.apply(n,r(t)),this._objectCache.onCommit(t),this._objectCache.setMxObjects(h.map(function(t){return Object(l.h)(Object.assign(t,{$dirty:!0}))})),this._objectCache.removeChanges(b(i)),e.abrupt("return",{});case 16:case"end":return e.stop()}},null,this)}},{key:"rollback",value:function(t){var e=this;this._objectCache.removeAllChanges(t);var n=t.filter(function(t){return e._objectCache.isNew(t)});return this._objectCache.removeObjects(n),Promise.resolve({})}},{key:"validate",value:function(t){return Promise.resolve({})}},{key:"saveDocument",value:function(t,e,n,r){var i=this;if(r.size/1048576>n.maxFileSize)return Promise.reject(new f.DescribedError("File too large"));var o=Object(l.g)(this._synchronizer.getInternalGuid(t));return this._fileBackend.storeFile(r,l.a+o).then(function(){return i._objectCache.makeChange(t,"HasContents",!0),i.commit([t],null)})}},{key:"getDocumentUrl",value:function(t,e,n){return this._getDocumentUrl(Object(l.g)(this._synchronizer.getInternalGuid(t)),e,n)}},{key:"getImageUrl",value:function(t){return Promise.resolve(t)}},{key:"upload",value:function(){return this._synchronizer.upload()}},{key:"downloadObjects",value:function(t){return regeneratorRuntime.async(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,regeneratorRuntime.awrap(this._synchronizer.downloadObjects(t));case 2:this._dirtyGuids=[];case 3:case"end":return e.stop()}},null,this)}},{key:"downloadFiles",value:function(t){return this._synchronizer.downloadFiles(t)}},{key:"cleanupDirtyObjects",value:function(){return this._store.cleanupDirtyObjects()}},{key:"isDirty",value:function(t){return this._dirtyGuids.includes(t)}},{key:"cleanup",value:function(){return regeneratorRuntime.async(function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,regeneratorRuntime.awrap(this._store.cleanDatabase());case 2:return t.next=4,regeneratorRuntime.awrap(this._fileBackend.removeDir(l.a));case 4:return t.next=6,regeneratorRuntime.awrap(this._fileBackend.removeDir(l.b));case 6:this._dirtyGuids=[];case 7:case"end":return t.stop()}},null,this)}},{key:"_getByGuid",value:function(t){var e=this;return this._store.getByGuid(this._synchronizer.getInternalGuid(t)).then(function(t){return e._synchronizer.makeObjectExternal(t)})}}]),e}(m.a)},666:function(t,e,n){"use strict";function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function i(t,e){if(null===t)return null;var n=window.mx.meta.getEntity(t.$objectType);return f.mapObject(t,function(t,r){return("guid"===r||!Object(o.e)(r)&&n.isReference(r))&&null!=t?e(t):t})}n.d(e,"a",function(){return m});var o=n(639),u=n(122),a=n(22),c=n(30),s=function(){function t(t,e){var n=[],r=!0,i=!1,o=void 0;try{for(var u,a=t[Symbol.iterator]();!(r=(u=a.next()).done)&&(n.push(u.value),!e||n.length!==e);r=!0);}catch(t){i=!0,o=t}finally{try{!r&&a.return&&a.return()}finally{if(i)throw o}}return n}return function(e,n){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,n);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),l=function(){function t(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}return function(e,n,r){return n&&t(e.prototype,n),r&&t(e,r),e}}(),f=n(4),m=function(){function t(e,n,i,o){r(this,t),this._store=e,this._runtimeApi=n,this._fileBackend=i,this._objectCache=o,this._internalToExternal={}}return l(t,[{key:"upload",value:function(){var t,e,n,r,i,c,l,m,p,h,y,d,b,g,v,_,w,j=this;return regeneratorRuntime.async(function(T){for(;;)switch(T.prev=T.next){case 0:return w=function(n,r){var i,u,a;return regeneratorRuntime.async(function(c){for(;;)switch(c.prev=c.next){case 0:if(i=o.a+Object(o.g)(n.guid),u=o.a+Object(o.g)(r),i===u){c.next=5;break}return c.next=5,regeneratorRuntime.awrap(e.moveFile(i,u));case 5:return c.next=7,regeneratorRuntime.awrap(e.readFile(u));case 7:return a=c.sent,c.next=10,regeneratorRuntime.awrap(t.upload(r,n.Name,{},a,{},[]));case 10:case"end":return c.stop()}},null,this)},_=function(t,e){function n(e){return!Object(o.e)(e)&&r.isSyncable(e)&&!Object(o.d)(t,e)}var r=window.mx.meta.getEntity(t.$objectType),i=Object.keys(t).filter(n).map(function(n){var i=t[n];return[n,{value:r.isObjectReference(n)&&null!=i&&!Object(o.i)(i)?e[i]:i}]});return[Object(o.i)(t.guid)?t.guid:e[t.guid],f.objectFromArray(i)]},v=function(e){return t.instantiate(e.$objectType).then(function(t){var n=t.objects.find(function(e){return e.guid===t.actionResult});return{internalObj:e,remoteJson:n}})},g=function(t){var e=window.mx.meta.getEntity(t.$objectType);return f.arrayFromObject(t).filter(function(t){var n=s(t,2),r=n[0];n[1];return"guid"===r||!Object(o.e)(r)&&e.isReference(r)})},b=function(t){var e=t.map(function(t){return t.guid}),n=f.unique(t.map(function(t){return g(t).map(function(t){var e=s(t,2);e[0];return e[1]})}).reduce(function(t,e){return t.concat(e)},[])),r=n.filter(function(t){return!Object(o.i)(t)}).filter(function(t){return!e.includes(t)});if(r.length>0){var i=f.unique(t.map(function(t){return g(t).filter(function(t){var e=s(t,2),n=(e[0],e[1]);return r.includes(n)}).map(function(e){var n=s(e,2),r=n[0];n[1];return"object of type "+t.$objectType+" (reference "+r+")"})}).reduce(function(t,e){return t.concat(e)},[])).join(", "),a="Sync has failed due to a modeling error. Your database contains objects that reference uncommitted objects:\n"+i+".";throw new u.DanglingError(a)}},t=this._runtimeApi,e=this._fileBackend,T.next=9,regeneratorRuntime.awrap(this._store.fetchDirty());case 9:return n=T.sent,b(n),r=f.partition(function(t){return Object(o.i)(t.guid)},n),i=s(r,2),c=i[0],l=i[1],T.next=14,regeneratorRuntime.awrap(Promise.all(l.map(v)));case 14:return m=T.sent,p=f.objectFromArray(m.map(function(t){var e=t.internalObj,n=t.remoteJson;return[e.guid,n.guid]})),h=m.map(function(t){return t.remoteJson}),y=c.map(function(t){return t.guid}).concat(m.map(function(t){return t.remoteJson.guid})),d=f.objectFromArray(n.map(function(t){return _(t,p)})),T.next=21,regeneratorRuntime.awrap(t.commit(y,new a.MxContext,d,h));case 21:return T.next=23,regeneratorRuntime.awrap(this._store.makeClean(n));case 23:return T.next=25,regeneratorRuntime.awrap(Promise.all(n.filter(function(t){return window.mx.meta.getEntity(t.$objectType).isA("System.FileDocument")}).filter(function(t){return t.HasContents}).map(function(t){return w(t,Object(o.i)(t.guid)?t.guid:p[t.guid])})));case 25:return f.arrayFromObject(p).forEach(function(t){var e=s(t,2),n=e[0],r=e[1];return j._mapInternalGuid(n,r)}),T.abrupt("return",{});case 27:case"end":return T.stop()}},null,this)}},{key:"downloadObjects",value:function(t){var e,n,r,i,u=this;return regeneratorRuntime.async(function(a){for(;;)switch(a.prev=a.next){case 0:return i=function(t,n){return e.retrieveByXPath(n).then(function(e){return e.mxobjects.map(o.f).map(function(e){return Object.assign({},e,{$objectType:t})})})},e=this._runtimeApi,a.t0=f,a.next=5,regeneratorRuntime.awrap(Promise.all(t.map(function(t){return i(t.store,t.xpath)})));case 5:return a.t1=a.sent,n=a.t0.flatten.call(a.t0,a.t1),a.next=9,regeneratorRuntime.awrap(this._store.rebuildDatabase(n));case 9:return r=n.map(this.makeObjectExternal,this).filter(function(t){return u._objectCache.has(t.guid)}),this._objectCache.setMxObjects(r.map(o.h)),a.abrupt("return",{});case 12:case"end":return a.stop()}},null,this)}},{key:"downloadFiles",value:function(t){var e,n,r,i,u,a,l;return regeneratorRuntime.async(function(m){for(;;)switch(m.prev=m.next){case 0:return l=function(t,e){var r=Object(c.getRemoteDynamicResourceUrl)(t.guid,t.changedDate,e),i=(e?o.b:o.a)+Object(o.g)(t.guid);return n.downloadFile(r,i)},a=function(t){return e.getSlice(t,[{attribute:"HasContents",operator:"equals",value:"true"}]).then(function(t){var e=s(t,2),n=e[0];e[1];return n})},e=this._store,n=this._fileBackend,m.t0=f,m.next=7,regeneratorRuntime.awrap(Promise.all(t.map(function(t){return a(t)})));case 7:return m.t1=m.sent,r=m.t0.flatten.call(m.t0,m.t1),i=r.map(function(t){return l(t,!1)}),u=r.filter(function(t){return window.mx.meta.getEntity(t.$objectType).isA("System.Image")}).map(function(t){return l(t,!0)}),m.next=13,regeneratorRuntime.awrap(Promise.all(i.concat(u)));case 13:return m.abrupt("return",{});case 14:case"end":return m.stop()}},null,this)}},{key:"getExternalGuid",value:function(t){return this._internalToExternal[t]||t}},{key:"getInternalGuid",value:function(t){for(var e in this._internalToExternal)if(this._internalToExternal[e]===t)return e;return t}},{key:"makeObjectExternal",value:function(t){return i(t,this.getExternalGuid.bind(this))}},{key:"makeObjectInternal",value:function(t){return i(t,this.getInternalGuid.bind(this))}},{key:"_mapInternalGuid",value:function(t,e){this._internalToExternal[e]=t}}]),t}()}});