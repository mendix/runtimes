
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("reporting/lib/OQLSource",["dojo","dijit","dojox","dojo/require!reporting/store/ParameterStore"],function(_1,_2,_3){_1.provide("reporting.lib.OQLSource");_1.require("reporting.store.ParameterStore");reporting.lib.OQLSource=function(_4){var _5="reporting.lib.OQLSource";var _6=this;var _7=(_4.reportid||null);var _8=(_4.context||null);var _9=(_4.startdormant||true);var _a=(_4.load||null);var _b=_4.page;var _c=function(_d){_a&&mendix.lang.thread(_a);_d&&_d();};var _e="uninitialized";var _f={information:{title:"Empty report",xaxis:"X",yaxis:"Y"},interval_descriptives:[],series_descriptives:[],series_data:[]};var _10={};var _11={};var _12=0;var _13=0;var _14=_1.hitch;var _15=function(_16){_16&&_16();};var _17=function(){return _11;};var _18=function(_19){mx.server.request({request:{action:"report_retrieve_params",params:{actiontype:"retrieve_params",reportid:_7}},options:{callback:function(_1a,res){if(!res||!res.report||!res.report.params){logger.error(_5+"["+_7+"].actGetQueryParams.callback : No valid report parameters received!");}else{_10=res.report.params;}_19();},error:function(e){mx.onError(e);_19();}}});};var _1b=function(_1c){reporting.store.ParameterStore.registerParams(_7,_10);_1c&&_1c();};var _1d=function(_1e){mx.server.request({request:{action:"report",params:{reportid:_7,offset:_12,limit:_b||null,params:_17()}},options:{callback:function(_1f,res){if(!res||!res.report){logger.error(_5+"["+_7+"].actExecQuery.callback : No valid report structure received!");}else{_f=res.report;if(res.report.information&&res.report.information.count){_13=res.report.information.count;}}_1e();},error:function(e){mx.onError(e);_1e();}}});};this.execQuery=function(_20){mendix.lang.sequence([_14(this,_1d),_20||_15]);};var _21=_1.hitch(this,"execQuery");this.getQueryParameters=function(){return _17();};this.setParameters=function(_22){return this.setParams(_22);};this.getInformation=function(){return _f.information;};this.getSeriesDescriptives=function(){return _f.series_descriptives;};this.getAggregateRows=function(){return _f.aggregate_rows||[];};this.getSeriesTypes=function(){return _f.series_info||[];};this.getIntervalType=function(){return _f.interval_info||{};};this.getIntervalDescriptives=function(){if((_f.interval_descriptives)&&(_f.interval_descriptives.length)&&(_f.interval_descriptives.length!=0)){return _f.interval_descriptives;}else{if(_f.series_data.length>0){var res=[];for(var i=0;i<_f.series_data[0].length;i++){res.push(" ");}return res;}else{return [];}}};this.getSeriesData=function(row){if(row){return (_f.series_data[row]);}else{return (_f.series_data);}};this.setParams=function(_23){_11={};for(var i in _23){if(!i.match(/_config_hash/)){if(_23[i]!=""){_11[i]=_23[i];}}else{if(!i.match(/_config_hash/)){}}}};this.size=function(){return _13;};this.getSize=function(){return this.size();};this.getPageSize=function(){return (_b);};this.setPageSize=function(n,_24){_b=n;_24&&_21(_24);};this.getOffset=function(){return (_12);};this.setOffset=function(n,_25){_12=n;_25&&_21(_25);};this.setPageSize=function(n,_26){_b=n;_26&&_21(_26);};this.getOffset=function(){return (_12);};this.first=function(_27){_12=0;_27&&_21(_27);};this.last=function(_28){if(_b>=_13){_12=0;}else{_12=_13-_b;}_28&&_21(_28);};this.next=function(_29){if(_12>=(_13-_b)){_12=_13-_b;}else{_12+=_b;}_29&&_21(_29);};this.previous=function(_2a){if((_13<_b)||((_12-_b)<=0)){_12=0;}else{_12-=_b;}_2a&&_21(_2a);};this._getstats=function(){var _2b=_f;if(_2b){var _2c=_2b.information.count;if(_2c==null){_2c=_13;}var _2d=_2b.series_data;var agl=_2b.aggregate_rows?_2b.aggregate_rows.length:0;var _2e=_2d.length?_2d[0].length-agl:0;var st=_2e!=0?_12+1:_12;var en=_12+_2e;return [st,en,_2c];}return [0,0,0];};this.getStatusMessage=function(){return (mx.ui.translate("mxui.lib.MxDataSource","status",this._getstats()));};this.atBeginning=function(){return (_12==0);};this.atEnd=function(){var _2f=this._getstats();return _2f[1]>=_2f[2];};mendix.lang.sequence([_14(this,_18),_14(this,_1b),!_9?_14(this,_1d):_15,_c]);this.uninitialize=function(){delete _6;};};});