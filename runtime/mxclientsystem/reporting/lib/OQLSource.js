/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("reporting/lib/OQLSource",["mxui/store/asyncValueStore","mendix/lang","mendix/logger","dojo/_base/lang"],function(_1,_2,_3,_4){var _5=function(_6){var _7="reporting.lib.OQLSource";var _8=(_6.reportid||null);var _9=(_6.startdormant||true);var _a=_6.page;var _b={information:{title:"Empty report",xaxis:"X",yaxis:"Y"},interval_descriptives:[],series_descriptives:[],series_data:[]};var _c={};var _d={};var _e=0;var _f=0;var _10=function(_11){window.mx.server.request({request:{action:"report_retrieve_params",params:{actiontype:"retrieve_params",reportid:_8}},options:{callback:function(_12,res){if(!res||!res.report||!res.report.params){_3.error(_7+"["+_8+"].actGetQueryParams.callback: "+"No valid report parameters received!");}else{_c=res.report.params;}_11();}}});};var _13=function(_14){_1.register(_8,_c);_14&&_14();};var _15=function(_16){window.mx.server.request({request:{action:"report",params:{reportid:_8,offset:_e,limit:_a||null,params:_d}},options:{callback:function(_17,res){if(!res||!res.report){_3.error(_7+"["+_8+"].actExecQuery.callback: "+"No valid report structure received!");}else{_b=res.report;if(res.report.information&&res.report.information.count){_f=res.report.information.count;}}_16();},error:function(e){window.mx.onError(e);_16();}}});};this.execQuery=function(_18){_15(_18||function(){});};var _19=_4.hitch(this,"execQuery");this.getQueryParameters=function(){return _d;};this.getInformation=function(){return _b.information;};this.getSeriesDescriptives=function(){return _b.series_descriptives;};this.getAggregateRows=function(){return _b.aggregate_rows||[];};this.getSeriesTypes=function(){return _b.series_info||[];};this.getIntervalType=function(){return _b.interval_info||{};};this.getIntervalDescriptives=function(){if(_b.interval_descriptives&&_b.interval_descriptives.length&&_b.interval_descriptives.length!==0){return _b.interval_descriptives;}else{if(_b.series_data.length>0){var res=[];for(var i=0;i<_b.series_data[0].length;i++){res.push(" ");}return res;}else{return [];}}};this.getSeriesData=function(row){return row?_b.series_data[row]:_b.series_data;};this.setParams=function(_1a){_d={};for(var i in _1a){if(!i.match(/_config_hash/)){if(_1a[i]!==""){_d[i]=_1a[i];}}else{if(!i.match(/_config_hash/)){}}}};this.size=function(){return _f;};this.getSize=function(){return this.size();};this.getPageSize=function(){return (_a);};this.setPageSize=function(n,_1b){_a=n;_1b&&_19(_1b);};this.getOffset=function(){return (_e);};this.setOffset=function(n,_1c){_e=n;_1c&&_19(_1c);};this.setPageSize=function(n,_1d){_a=n;_1d&&_19(_1d);};this.getOffset=function(){return (_e);};this.first=function(_1e){_e=0;_1e&&_19(_1e);};this.last=function(_1f){if(_a>=_f){_e=0;}else{_e=_f-_a;}_1f&&_19(_1f);};this.next=function(_20){if(_e>=(_f-_a)){_e=_f-_a;}else{_e+=_a;}_20&&_19(_20);};this.previous=function(_21){if((_f<_a)||((_e-_a)<=0)){_e=0;}else{_e-=_a;}_21&&_19(_21);};this._getstats=function(){var _22=_b;if(_22){var _23=_22.information.count;if(_23==null){_23=_f;}var _24=_22.series_data;var agl=_22.aggregate_rows?_22.aggregate_rows.length:0;var _25=_24.length?_24[0].length-agl:0;var st=_25!==0?_e+1:_e;var en=_e+_25;return [st,en,_23];}return [0,0,0];};this.getStatusMessage=function(){return window.mx.ui.translate("mxui.lib.MxDataSource","status",this._getstats());};this.atBeginning=function(){return _e===0;};this.atEnd=function(){var _26=this._getstats();return _26[1]>=_26[2];};_2.sequence([_4.hitch(this,_10),_4.hitch(this,_13),!_9?_4.hitch(this,_15):_2.nullExec],function(){_6.load&&_2.thread(_6.load,null);});};return _5;});