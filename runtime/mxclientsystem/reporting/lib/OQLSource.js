
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("reporting/lib/OQLSource",["dojo","dijit","dojox","dojo/require!reporting/store/ParameterStore"],function(_1,_2,_3){_1.provide("reporting.lib.OQLSource");_1.require("reporting.store.ParameterStore");reporting.lib.OQLSource=function(_4){var _5="reporting.lib.OQLSource";var _6=(_4.reportid||null);var _7=(_4.startdormant||true);var _8=(_4.load||null);var _9=_4.page;var _a={information:{title:"Empty report",xaxis:"X",yaxis:"Y"},interval_descriptives:[],series_descriptives:[],series_data:[]};var _b={};var _c={};var _d=0;var _e=0;var _f=function(_10){_10&&_10();};var _11=function(_12){mx.server.request({request:{action:"report_retrieve_params",params:{actiontype:"retrieve_params",reportid:_6}},options:{callback:function(_13,res){if(!res||!res.report||!res.report.params){logger.error(_5+"["+_6+"].actGetQueryParams.callback : No valid report parameters received!");}else{_b=res.report.params;}_12();}}});};var _14=function(_15){reporting.store.ParameterStore.registerParams(_6,_b);_15&&_15();};var _16=function(_17){mx.server.request({request:{action:"report",params:{reportid:_6,offset:_d,limit:_9||null,params:_c}},options:{callback:function(_18,res){if(!res||!res.report){logger.error(_5+"["+_6+"].actExecQuery.callback : No valid report structure received!");}else{_a=res.report;if(res.report.information&&res.report.information.count){_e=res.report.information.count;}}_17();},error:function(e){mx.onError(e);_17();}}});};this.execQuery=function(_19){mendix.lang.sequence([_1.hitch(this,_16),_19||_f]);};var _1a=_1.hitch(this,"execQuery");this.getQueryParameters=function(){return _c;};this.getInformation=function(){return _a.information;};this.getSeriesDescriptives=function(){return _a.series_descriptives;};this.getAggregateRows=function(){return _a.aggregate_rows||[];};this.getSeriesTypes=function(){return _a.series_info||[];};this.getIntervalType=function(){return _a.interval_info||{};};this.getIntervalDescriptives=function(){if((_a.interval_descriptives)&&(_a.interval_descriptives.length)&&(_a.interval_descriptives.length!==0)){return _a.interval_descriptives;}else{if(_a.series_data.length>0){var res=[];for(var i=0;i<_a.series_data[0].length;i++){res.push(" ");}return res;}else{return [];}}};this.getSeriesData=function(row){if(row){return (_a.series_data[row]);}else{return (_a.series_data);}};this.setParams=function(_1b){_c={};for(var i in _1b){if(!i.match(/_config_hash/)){if(_1b[i]!==""){_c[i]=_1b[i];}}else{if(!i.match(/_config_hash/)){}}}};this.size=function(){return _e;};this.getSize=function(){return this.size();};this.getPageSize=function(){return (_9);};this.setPageSize=function(n,_1c){_9=n;_1c&&_1a(_1c);};this.getOffset=function(){return (_d);};this.setOffset=function(n,_1d){_d=n;_1d&&_1a(_1d);};this.setPageSize=function(n,_1e){_9=n;_1e&&_1a(_1e);};this.getOffset=function(){return (_d);};this.first=function(_1f){_d=0;_1f&&_1a(_1f);};this.last=function(_20){if(_9>=_e){_d=0;}else{_d=_e-_9;}_20&&_1a(_20);};this.next=function(_21){if(_d>=(_e-_9)){_d=_e-_9;}else{_d+=_9;}_21&&_1a(_21);};this.previous=function(_22){if((_e<_9)||((_d-_9)<=0)){_d=0;}else{_d-=_9;}_22&&_1a(_22);};this._getstats=function(){var _23=_a;if(_23){var _24=_23.information.count;if(_24==null){_24=_e;}var _25=_23.series_data;var agl=_23.aggregate_rows?_23.aggregate_rows.length:0;var _26=_25.length?_25[0].length-agl:0;var st=_26!=0?_d+1:_d;var en=_d+_26;return [st,en,_24];}return [0,0,0];};this.getStatusMessage=function(){return (mx.ui.translate("mxui.lib.MxDataSource","status",this._getstats()));};this.atBeginning=function(){return (_d==0);};this.atEnd=function(){var _27=this._getstats();return _27[1]>=_27[2];};this.uninitialize=function(){};mendix.lang.sequence([_1.hitch(this,_11),_1.hitch(this,_14),!_7?_1.hitch(this,_16):_f,function(_28){_8&&mendix.lang.thread(_8);_28&&_28();}]);};});