
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("reporting/widget/ReportChart",["dojo","dijit","dojox","dojo/require!reporting/lib/OQLSource,reporting/lib/ChartBuilder,reporting/mixin/_Reportable,reporting/FusionChartsFree/FusionChartsFree"],function(_1,_2,_3){_1.provide("reporting.widget.ReportChart");_1.require("reporting.lib.OQLSource");_1.require("reporting.lib.ChartBuilder");_1.require("reporting.mixin._Reportable");_1.require("reporting.FusionChartsFree.FusionChartsFree");mxui.widget.declare("reporting.widget.ReportChart",{mixins:[_2._TemplatedMixin,_2._Container,_2._Contained,mxui.mixin._Contextable,reporting.mixin._Reportable],inputargs:{aspect:"",reportid:"",yaxisminimum:"",yaxismaximum:"",yaxisprecision:0,yaxiscaption:"",xaxiscaption:"",charttype:"",nested:false,startdormant:false,width:550,height:350},constructor:function(){this.templateString=_1.cache("reporting.widget","templates/ReportChart.html","<div class=\"ReportCharts\" style=\"z-index:-1;display:none;\">\r\n\t<div style=\"clear:both\"/>\r\n\t<div style=\"text-align:center; padding:10px 0px 10px;\">\r\n\t\t<div dojoAttachPoint=\"chartNode\">\r\n\t\t</div>\r\n\t</div>\r\n</div>\r\n");this.reportid="XXX";this.startdormant=false;this.charttype="";this.domNode=null;this.chartNode=null;this.width=550;this.height=350;this.aspect="";this.xaxiscaption="";this.yaxiscaption="";this.yaxisminimum=null;this.yaxismaximum=null;this.yaxisprecision=0;var _4=null;var _5="MSColumn3D";var _6="";var _7={};var _8=[];var _9="mxclientsystem/reporting/FusionChartsFree/charts/";this.returnValue=null;var _a=_1.hitch;var _b=mxui.dom.hide;var _c=mxui.dom.show;var _d=_1.addClass;var _e=_1.removeClass;var _f=_1.addClass;var _10=mxui.dom.setClass;var _11=mxui.dom.getClass;var _12=mxui.dom.setOpacity;var _13=mxui.dom;var _14=null;var _15={};var _16=function(_17){_17&&_17();};var _18={MSBar2D:"",MSLine:"",MSArea2D:"",MSColumn2D:"",MSColumn3D:"",StackedArea2D:"",StackedBar2D:"",StackedColumn2D:"",StackedColumn3D:""};this.postCreate=function(){this.initContext();this.registerContent();if(this.charttype==""){}else{if(this.charttype in _18){_5=this.charttype;}else{}}if(this.yaxisminimum!=""){this.yaxisminimum=parseFloat(this.yaxisminimum);}if(this.yaxismaximum!=""){this.yaxismaximum=parseFloat(this.yaxismaximum);}var _19=["actSetupOQLSource","actSetupChart","actRegisterUIEvents"];if(!this.startdormant){_19.push("actRunReport","actFillChart");}this.sequence(_19);};this.applyContext=function(_1a,_1b){if(!this.startdormant){this.contextNotification(_1a);mendix.lang.runBindActions(this,["refresh"],_1b);}else{this.startdormant=false;_1b&&_1b();}};this.actSetupOQLSource=function(_1c){_14=new reporting.lib.OQLSource({reportid:this.reportid,startdormant:this.startdormant,load:_1c});};this.actSetupChart=function(_1d){var swf="FCF_"+_5+".swf";var _1e=this.id+"_flashNode";var w=null;var h=null;var asp=null;if(this.aspect){try{var _1f=this.aspect.split(/:/);asp=(parseInt(_1f[1])/parseInt(_1f[0]));}catch(e){asp=0.5;}}else{asp=0.5;}var _20=_1._getContentBox(this.domNode.parentNode);if(_20.w!=null){w=_20.w;h=(w*asp)*0.7;w=w.toString();h=h.toString();}else{w=this.width;h=this.height;}_7={rendered:false,node:this.chartNode,flash:new FusionChartsFree(_9+swf,_1e,w,h,"0","1"),_id:_1e};_7.node.id=this.id+"_parentNode";this.loaded();_1d();};this.actRunReport=function(_21){_14.execQuery(_21);};this.actFillChart=function(_22){mxui.dom.show(this.domNode);_6=reporting.lib.ChartBuilder({oqlsource:_14,ymin:this.yaxisminimum,ymax:this.yaxismaximum,precision:this.yaxisprecision,xcaption:this.xaxiscaption,xcaption:this.xaxiscaption,ycaption:this.yaxiscaption});try{if(_7.rendered){window.infosoftglobal.FusionChartsFreeUtil.updateChartXML(_7._id,_6);}else{_7.flash.setDataXML(_6);_7.rendered=true;_7.flash.render(_7.node.id);}}catch(e){logger.error(this.id+".actFillChart : Problem rendering chart : "+e.message);}_22&&_22();};this.actReloadChart=function(_23){this.sequence([_a(_14,"refresh"),"actRefreshChart",_23?_23:_16]);};this.actRegisterUIEvents=function(_24){_8.push(_1.subscribe("report_"+this.mxform.hash,this,"topicUpdate"));_24();};this.refresh=function(_25){this.sequence(["actRunReport","actFillChart",_25||_16]);};this.contextUpdate=function(){};this.topicUpdate=function(){this.refresh();};this.contextNotification=function(_26){var _27=_26.getParams();for(var p in _27){_15[p]=_27[p];}_14.setParams(_15);};this.uninitialize=function(_28){try{_14.uninitialize();for(var i=0;i<_8.length;i++){_1.unsubscribe(_8[i]);}}catch(e){}delete _14;};}});});