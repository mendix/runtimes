/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
require({cache:{"url:reporting/widget/templates/ReportChart.html":"<div class=\"ReportCharts\" style=\"z-index:-1;display:none;\">\n\t<div style=\"clear:both\"/>\n\t<div style=\"text-align:center; padding:10px 0px 10px;\">\n\t\t<div dojoAttachPoint=\"chartNode\">\n\t\t</div>\n\t</div>\n</div>\n"}});define("reporting/widget/ReportChart",["reporting/FusionChartsFree/FusionChartsFree","reporting/lib/OQLSource","reporting/lib/ChartBuilder","mxui/widget","mxui/mixin/_Templated","mxui/mixin/_Contextable","mxui/mixin/_Stateful","dojo/dom-geometry","dojo/_base/connect","dojo/_base/declare","dijit/_Container","dijit/_Contained","dojo/text!reporting/widget/templates/ReportChart.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d){return _4.declare("reporting.widget.ReportChart",{mixins:[_5,_b,_c,_6,_7],aspect:"",reportid:"",yaxisminimum:"",yaxismaximum:"",yaxisprecision:0,yaxiscaption:"",xaxiscaption:"",charttype:"",nested:false,startdormant:false,width:550,height:350,chartTypes:{MSBar2D:"",MSLine:"",MSArea2D:"",MSColumn2D:"",MSColumn3D:"",StackedArea2D:"",StackedBar2D:"",StackedColumn2D:"",StackedColumn3D:""},constructor:function(){this.templateString=_d;this.domNode=null;this.chartNode=null;this._chartTarget="MSColumn3D";var _e="";var _f={};var _10=[];var _11="mxclientsystem/reporting/FusionChartsFree/charts/";var _12=null,_13={},_14=false;this.applyContext=function(_15,_16){this.startdormant=this.getState("dormant",this.startdormant);if(!this.startdormant){this.contextNotification(_15);this.refresh(_16);}else{this.startdormant=false;_16&&_16();}};this.actSetupOQLSource=function(_17){_12=new _2({reportid:this.reportid,startdormant:this.startdormant,load:_17});};this.actSetupChart=function(_18){var swf="FCF_"+this._chartTarget+".swf",_19=this.id+"_flashNode",_1a=this.getChartSize();_f={rendered:false,node:this.chartNode,flash:new _1.Chart(_11+swf,_19,_1a.width,_1a.height,"0","1"),_id:_19};_f.node.id=this.id+"_parentNode";this.loaded();_18();};this.actRunReport=function(_1b){_14=true;_12.execQuery(_1b);};this.getChartSize=function(){var asp=null;if(this.aspect){try{var _1c=this.aspect.split(/:/);asp=parseInt(_1c[1],10)/parseInt(_1c[0],10);}catch(e){}}if(!asp){asp=0.5;}var _1d=_8.getContentBox(this.domNode.parentNode);return {width:_1d.w||this.width,height:(this.width*asp)*0.7};};this.actFillChart=function(_1e){this.domNode.style.display="";_e=_3({oqlsource:_12,ymin:this.yaxisminimum,ymax:this.yaxismaximum,precision:this.yaxisprecision,xcaption:this.xaxiscaption,ycaption:this.yaxiscaption});try{if(_f.rendered){_1.updateChartXML(_f._id,_e);}else{_f.flash.setDataXML(_e);_f.rendered=true;_f.flash.render(_f.node.id);}}catch(e){logger.error(this.id+".actFillChart : Problem rendering chart : "+e.message);}_1e&&_1e();};this.actRegisterUIEvents=function(_1f){_10.push(_9.subscribe("report_"+this.mxform.hash,this,"topicUpdate"));_1f();};this.refresh=function(_20){this.sequence(["actRunReport","actFillChart"],_20);};this.topicUpdate=function(){this.refresh();};this.contextNotification=function(_21){var _22=_21.getParams();for(var p in _22){_13[p]=_22[p];}_12.setParams(_13);};this.uninitialize=function(){for(var i=0;i<_10.length;i++){_10[i].remove();}};this.storeState=function(_23){_23("dormant",!_14);};},postCreate:function(){this.initContext();if(this.charttype===""){}else{if(this.charttype in this.chartTypes){this._chartTarget=this.charttype;}else{}}if(this.yaxisminimum!=""){this.yaxisminimum=parseFloat(this.yaxisminimum);}if(this.yaxismaximum!=""){this.yaxismaximum=parseFloat(this.yaxismaximum);}var _24=["actSetupOQLSource","actSetupChart","actRegisterUIEvents"];if(!this.startdormant){_24.push("actRunReport","actFillChart");}this.sequence(_24);}});});