/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
require({cache:{"url:reporting/widget/templates/ReportMatrix.html":"<div class=\"mx-grid mx-reportmatrix\" style=\"display:none;\">\n\t<div class=\"mx-grid-controlbar clearfix\" focusIndex=\"0\">\n        <div class=\"mx-grid-pagingbar\" dojoAttachPoint=\"pagingNode\"></div>\n        <div class=\"mx-grid-toolbar\" dojoAttachPoint=\"toolBarNode\"></div>\n\t</div>\n\t<div class=\"mx-grid-content\" focusIndex=\"1\">\n        <table class=\"table table-bordered table-striped mx-reportmatrix-table\">\n            <thead dojoAttachPoint=\"theadNode\"></thead>\n            <tbody dojoAttachPoint=\"tbodyNode\"></tbody>\n            <tfoot dojoAttachPoint=\"tfootNode\"></tfoot>\n        </table>\n    </div>\n</div>\n"}});define("reporting/widget/ReportMatrix",["reporting/lib/MetaResult","reporting/lib/OQLSource","mxui/widget/Button","mxui/mixin/_Templated","mxui/mixin/_Contextable","mxui/mixin/_Stateful","mxui/widget","mxui/dom","dojo/_base/connect","dojo/_base/lang","dojo/_base/declare","dijit/_Container","dijit/_Contained","dojo/text!reporting/widget/templates/ReportMatrix.html"],function(_1,_2,_3,_4,_5,_6,_7,_8,_9,_a,_b,_c,_d,_e){return _7.declare("reporting.widget.ReportMatrix",{mixins:[_4,_c,_d,_5,_6],startdormant:false,showexportbutton:false,reportid:"",intervalvalues:"",target:"",pagesize:10,usepaging:false,columns:null,constructor:function(){this.templateString=_e;this.domNode=null;this.theadNode=null;this.tfootNode=null;this.tbodyNode=null;this.toolBarNode=null;this.btFirst=null;this.btPrevious=null;this.btNext=null;this.btLast=null;this.pagingNode=null;var _f=null,_10=false,_11={},_12=[],_13={},_14=[],_15=[],_16=[],_17=null,_18=this;var _19=" ";this.applyContext=function(_1a,_1b){this.startdormant=this.getState("dormant",this.startdormant);if(!this.startdormant){this.contextNotification(_1a);this.actRefreshMatrix(function(){_18._updatePagingStatus();_1b&&_1b();});}else{this.startdormant=false;_1b&&_1b();}};function _1c(arr){var obj={};for(var i=0;i<arr.length;i++){obj[arr[i]]=arr[i];}return obj;};var _1d=function(){this.domNode.style.display="";_14=_f.getSeriesData();_15=_f.getSeriesDescriptives();_16=_f.getIntervalDescriptives();_13=_1c(_f.getAggregateRows());var _1e=_f.getSeriesTypes();_17=new _1(_1e);var _1f=99/(_15.length+1);_1f=_1f.toString()+"%";var i,tr;var _20="";var _21=_8.create("th");_21.innerHTML="&nbsp;";_21.setAttribute("width","1%");tr=_8.create("tr",{},_21);this.theadNode.appendChild(tr);var _22={};var _23;for(i=0;i<_15.length;i++){_23=this.columns[i];_20=_15[i].toString();_20=(_20==="")?" ":_20;_21=_8.create("th",{"class":this._getAlignmentClass(_23.alignment)},_20);_21.setAttribute("width",_23.weight+"%");if(!_23.weight){_22[i]=true;}else{tr.appendChild(_21);}}for(i=0;i<_16.length;i++){_20=_16[i].toString();_20=(/^\s*$/.test(_20))?"&nbsp;":_20;var _24=_8.create("th");_24.innerHTML=_20;tr=_8.create("tr",{},_24);tr.setAttribute("offset",i);if(_13[i]!=null){tr.className="mx-reportmatrix-aggregate-row";}for(var j=0;j<_15.length;j++){if(!_22[j]){_20=_14[j][i]!=null?_14[j][i]:_19;if((typeof _20!="boolean")&&(typeof _20!="number")){_20=(_20==="")?" ":_17.getRenderValue(j,_20);}else{_20=_17.getRenderValue(j,_20);}_20=(_20==="")?" ":_20;_21=_8.create("td",{"class":this._getAlignmentClass(this.columns[j].alignment)},_20);tr.appendChild(_21);}}this.tbodyNode.appendChild(tr);}};this.actInitialize=function(_25){if(this.reportid===""){logger.error(this.id+".actInitialize : No report parameter passed. Aborting!");throw ("No report parameter passed to Report Matrix : aborting!");}if(!this.usepaging){this.pagingNode.style.display="none";}try{_8.empty(this.theadNode);_8.empty(this.tbodyNode);_8.empty(this.tfootNode);}catch(e){}this._fillMatrix=_a.hitch(this,_1d);_25();};this.actSetupOQLSource=function(_26){_f=new _2({reportid:this.reportid,page:(this.usepaging)?this.pagesize:null,startdormant:true,load:_26});};this.actRunReport=function(_27){_10=true;_f.execQuery(_27);};this._fillMatrix=function(){};this.actRefreshMatrix=function(_28){this.actRunReport(function(){_18._refreshView();_28&&_28();});};this._refreshView=function(){this._resetMatrix();this._updatePagingStatus();this._fillMatrix();};this.actSetupEvents=function(_29){_12.push(_9.subscribe("report_"+this.mxform.hash,this,"topicUpdate"));this.connect(this.tbodyNode,"ondblclick","eventMatrixClicked");if(this.showexportbutton){var _2a=new _3({"caption":window.mx.ui.translate(this.declaredClass,"excel_btn_caption"),"onClick":_a.hitch(this,"eventExcelExportClicked"),"cssClasses":["reportingReportMatrix_exportButton"],"iconUrl":"mxclientsystem/reporting/ui/widget/images/ReportMatrix/icnExcel.gif"});this.toolBarNode.appendChild(_2a.domNode);}else{this.toolBarNode.style.display="none";}if(this.usepaging){var ltr=this.isLeftToRight(),_2b=document.createDocumentFragment(),$=_8.create;this.btFirst=new _3({iconClass:"glyphicon "+(ltr?"glyphicon-step-backward":"glyphicon-step-forward"),"onClick":_a.hitch(this,"eventPagingButtonClicked","first")});_2b.appendChild($("#",this.btFirst.domNode," "));this.btPrevious=new _3({iconClass:"glyphicon "+(ltr?"glyphicon-backward":"glyphicon-forward"),"onClick":_a.hitch(this,"eventPagingButtonClicked","previous")});_2b.appendChild($("#",this.btPrevious.domNode," "));this._pagingStatusNode=$("div",{"class":"dijitInline mx-grid-paging-status"});_2b.appendChild($("#",this._pagingStatusNode," "));this.btNext=new _3({iconClass:"glyphicon "+(ltr?"glyphicon-forward":"glyphicon-backward"),"onClick":_a.hitch(this,"eventPagingButtonClicked","next")});_2b.appendChild($("#",this.btNext.domNode," "));this.btLast=new _3({iconClass:"glyphicon "+(ltr?"glyphicon-step-forward":"glyphicon-step-backward"),"onClick":_a.hitch(this,"eventPagingButtonClicked","last")});_2b.appendChild($("#",this.btLast.domNode," "));this.pagingNode.appendChild(_2b);_8.disableSelection(this.pagingNode);}_29&&_29();};this._resetMatrix=function(){try{_8.empty(this.theadNode);_8.empty(this.tbodyNode);_8.empty(this.tfootNode);}catch(e){}};this._updatePagingStatus=function(){if(!this.usepaging){return;}_8.text(this._pagingStatusNode,_f.getStatusMessage());if(_f.atBeginning()){this.btFirst.set("disabled",true);this.btPrevious.set("disabled",true);}else{this.btFirst.set("disabled",false);this.btPrevious.set("disabled",false);}if(_f.atEnd()){this.btNext.set("disabled",true);this.btLast.set("disabled",true);}else{this.btNext.set("disabled",false);this.btLast.set("disabled",false);}};this.topicUpdate=function(){_f.first();this.actRefreshMatrix();};this.contextNotification=function(_2c){var _2d=_2c.getParams();for(var p in _2d){_11[p]=_2d[p];}_f.first();_f.setParams(_11);};this.contextUpdate=function(){};this.eventMatrixClicked=function(e){var _2e=e.target,tr=_2e.parentNode,_2f=parseInt(tr.getAttribute("offset")),_30=this.createContext();_30.dupFrom(this.mxcontext);var _31=this.intervalvalues;if(_31!==""){try{for(var i=0;i<_31.length;i++){var key=_31[i];if(key!==""&&!_30.hasParam(key)){var _32=_14[i][_2f];_30.setParam(key,_32);}}}catch(err){}}if(this.target!==""){window.mx.ui.openFormInContent(this.target,"",_30);}else{}};this.eventExcelExportClicked=function(){window.mx.server.request({request:{action:"report_export_excel",params:{reportid:this.reportid,params:_f.getQueryParameters()}},options:{callback:window.mx.data.mxObjectsCallback(function(_33){window.mx.ui.downloadFile({mxobject:_33[0]});}),useCache:false}});};this.eventPagingButtonClicked=function(_34){switch(_34.toLowerCase()){case "first":if(!_f.atBeginning()){_f.first(_a.hitch(this,"_refreshView"));}break;case "last":if(!_f.atEnd()){_f.last(_a.hitch(this,"_refreshView"));}break;case "next":if(!_f.atEnd()){_f.next(_a.hitch(this,"_refreshView"));}break;case "previous":if(!_f.atBeginning()){_f.previous(_a.hitch(this,"_refreshView"));}break;default:break;}};this.uninitialize=function(){try{for(var i=0;i<_12.length;i++){_12[i].remove();}_7.destroyChildren(this.toolBarNode);}catch(e){}};this.storeState=function(_35){_35("dormant",!_10);};this._getAlignmentClass=function(_36){if(window.mx.ui.isRtl()){_36=_36=="right"?"left":"right";}return {left:"mx-left-aligned",right:"mx-right-aligned",center:"mx-center-aligned"}[_36];};},postCreate:function(){this.initContext();var _37="context_seed_"+this.mxform.hash,_38=_9.subscribe(_37,_a.hitch(this,"contextNotification"));this.addOnDestroy(function(){_38.remove();});this.sequence(["actInitialize","actSetupOQLSource","actSetupEvents","actLoaded"]);}});});