
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("reporting/widget/ReportParameter",["dojo","dijit","dojox","dojo/require!reporting/lib/OQLSource,reporting/lib/ChartBuilder,reporting/mixin/_Reportable"],function(_1,_2,_3){_1.provide("reporting.widget.ReportParameter");_1.require("reporting.lib.OQLSource");_1.require("reporting.lib.ChartBuilder");_1.require("reporting.mixin._Reportable");mxui.widget.declare("reporting.widget.ReportParameter",{mixins:[_2._TemplatedMixin,_2._Contained,mxui.mixin._Contextable,reporting.mixin._Reportable],inputargs:{reportid:"",nested:false,parameter:"",paramtype:"",query:"",config:""},constructor:function(){this.templatePath=null;this.templateString="<div class='reportingReportParameter'></div>";this.parameter="";this.config="";this.query="";this.paramtype="";this.domNode=null;this.returnValue=null;var _4=_1.hitch;var _5=mxui.dom.hide;var _6=mxui.dom.show;var _7=_1.addClass;var _8=_1.removeClass;var _9=_1.addClass;var _a=mxui.dom.setClass;var _b=mxui.dom.getClass;var _c=mxui.dom.setOpacity;var _d=mxui.dom;var _e=null;var _f={};var _10=null;var _11=function(_12){_12&&_12();};var _13=function(){var _14=mxui.dom.getSelectedValue(_e);if(_10.isRange&&_10.isRange=="true"){if(_14==""){return _14;}else{return (_10.values[parseInt(_14)]);}}else{return _14;}};this.postCreate=function(){this.initContext();this.sequence(["actSetup","actContentHook","actRetrieveParameters","actBuildUI","actRegisterUIEvents","actLoaded"]);};this.applyContext=function(_15,_16){this.cloneContext(_15);var _17=this.paramtype;var has=this.mxcontext.hasParam(this.parameter);try{if(has){var _18=this.mxcontext.getParam(this.parameter);if(_17=="integer"||_17=="float"){var val=(_18.length)?_19(_18):_18;mxui.dom.selectOptionByText(_e,val);var _1a=_e.selectedIndex;if(_1a==0&&_e.getAttribute("isRange")&&(typeof (_18.length=="undefined"))){var _1b=_e.options;for(var i=0;i<_1b.length;i++){var opt=_1b[i];var _1c=Number(opt.getAttribute("range-start"));var end=Number(opt.getAttribute("range-end"));if(val>_1c&&val<end){_e.selectedIndex=i;break;}}}}else{mxui.dom.selectOption(_e,String(_18));}}}catch(e){}_16&&_16();};this.actSetup=function(_1d){if(this.parameter==""){logger.error(this.id+".actSetup : no parameter attribute passed.");}else{}_1d();};this.actRetrieveParameters=function(_1e){var _1f=reporting.store.ParameterStore.retrieveLead(this.mxform.hash);if(_1f.length==0){_1e&&_1e();}else{for(var i=0;i<_1f.length;i++){_f[_1f[i]]={callbacked:false,params:{}};}for(var i=0;i<_1f.length;i++){(function(_20){reporting.store.ParameterStore.retrieveParams(_20,function(p){_f[_20]={callbacked:true,params:p};var _21=true;for(var x in _f){if(!_f[x].callbacked){_21=false;}}if(_21){_1e&&_1e();}});})(_1f[i]);}}};var _22=this.declaredClass;var _19=function(arr){if((arr[0]==-Infinity)&&(arr[1]==Infinity)){return mx.ui.translate(_22,"all");}else{if(arr[0]==-Infinity){return mx.ui.translate(_22,"less_than",arr[1].toString());}else{if(arr[1]==Infinity){return mx.ui.translate(_22,"greater_than",arr[0].toString());}else{return mx.ui.translate(_22,"from_to",[arr[0].toString(),arr[1].toString()]);}}}};var _23=function(_24){var _25=String(_24);return (_25.match(/true|false/))?mx.ui.translate("mxui.widget.DataGrid",_25):_24;};var _26=function(_27,_28){var ret=[];if(_28=="enum"){for(var key in _27){ret.push([key,_27[key]]);}}else{if(_27.length){if(typeof (_27[0])=="string"){for(var i=0;i<_27.length;i++){ret.push([_27[i],_27[i]]);}}else{ret=_27;}}else{if(_27.isRange){if(_27.isRange=="true"){for(var i=0,val;val=_27.values[i];i++){ret.push([i,_19(val)]);}}else{ret={};for(var i=0,val;val=_27.values[i];i++){for(var j=parseInt(val[0]);j<parseInt(val[1]);j++){ret[j.toString()]=j.toString();}}}}else{if(_27.values){ret=_27.values;}else{ret=_27;}}}}if(ret.length!=null){var old=ret;ret={};var _29=null;for(var i=0,val;val=old[i];i++){ret[val[0]]=_23(val[1]||val[0]);}}return ret;};this.actBuildUI=function(_2a){_e=mxui.dom.select({"class":"form-control"});try{this.domNode.appendChild(_e);}catch(e){}try{for(var i in _f){var _2b=_f[i];var _2c=_2b.params[this.parameter];if(_2c!=null){_10=_2c;_2c=_26(_2c,this.paramtype);if(_2c!=null){mxui.dom.setSelectOptions(_e,_2c,"");if(/true/.test(_10.isRange)){_e.setAttribute("isRange","true");var _2d=_e.options;var lol=_10.values;for(var i=0;i<lol.length;i++){var opt=_2d[i+1];if(opt){var _2e=lol[i];opt.setAttribute("range-start",String(_2e[0]));opt.setAttribute("range-end",String(_2e[1]));}}}}}else{var _2f=[];for(var j in _2b.params){_2f.push(j);}}}}catch(e){logger.error(this.id+".actBuildUI : Unable to find parameter in params list : "+e.message);mxui.dom.setSelectOptions(_e,{},"");}_2a&&_2a();};this.updateTrigger=function(){};this.actRegisterUIEvents=function(_30){this.connect(_e,"onchange","eventControlChanged");_30();};this.eventControlChanged=function(e){if(e){e.preventDefault();e.stopPropagation();}this.syncFormControlWithContext();};this.eventOnKeyUp=function(e){if(e.keyCode==13){this.eventControlChanged(e);_1.publish("report_"+this.mxform.hash,["runreport"]);}else{}};this.syncFormControlWithContext=function(){var _31=this.createContext();_31.setParam(this.parameter,_13());_1.publish("context_seed_"+this.mxform.hash,[_31]);};this.refresh=function(_32){this.sequence(["actFillChart",_32||_11]);};this.objectUpdate=function(){};this.contextUpdate=function(){};this.parentUpdate=function(_33){};this.uninitialize=function(_34){};}});});