
/* Copyright (c) 2005-2012, Mendix bv. All rights reserved. */

//>>built
define("reporting/widget/ReportParameter",["reporting/store/ParameterStore","mxui/mixin/_Stateful","mxui/widget/_WidgetBase","mxui/dom","mendix/lang","dojo/topic","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7){var $=_4.create;function _8(_9){var _a=String(_9);return (_a.match(/true|false/))?mx.ui.translate("mxui.widget.DataGrid",_a):_9;};function _b(_c){var _d="reporting.widget.ReportParameter";if((_c[0]==-Infinity)&&(_c[1]==Infinity)){return window.mx.ui.translate(_d,"all");}else{if(_c[0]==-Infinity){return window.mx.ui.translate(_d,"less_than",_c[1].toString());}else{if(_c[1]==Infinity){return window.mx.ui.translate(_d,"greater_than",_c[0].toString());}else{return window.mx.ui.translate(_d,"from_to",[_c[0].toString(),_c[1].toString()]);}}}};function _e(_f,_10){var ret=[];if(_10=="enum"){for(var key in _f){ret.push([key,_f[key]]);}}else{if(_f.length){if(typeof (_f[0])=="string"){for(var i=0;i<_f.length;i++){ret.push([_f[i],_f[i]]);}}else{ret=_f;}}else{if(_f.isRange){if(_f.isRange=="true"){for(var i=0,val;val=_f.values[i];i++){ret.push([i,_b(val)]);}}else{ret={};for(var i=0,val;val=_f.values[i];i++){for(var j=parseInt(val[0],10);j<parseInt(val[1],10);j++){ret[j.toString()]=j.toString();}}}}else{if(_f.values){ret=_f.values;}else{ret=_f;}}}}if(ret.length!=null){var old=ret;ret={};for(var i=0,val;val=old[i];i++){ret[val[0]]=_8(val[1]||val[0]);}}return ret;};var _11=_7([_3,_2],{parameter:"",paramtype:"",reportid:"",autoLoad:false,_selectNode:null,_parameterInfo:null,buildRendering:function(){this.domNode=$("div",{"class":"reportingReportParameter"},this._selectNode=$("select",{"class":"form-control"}));this.connect(this._selectNode,"change",function(e){e.stopPropagation();this._onChange();});},postCreate:function(){var _12=this;_1.retrieveParams(this.reportid,function(_13){_12._parameterInfo=_13[_12.parameter];if(!_12._parameterInfo){_12.set("loaded",true);return;}var _14=_e(_12._parameterInfo,this.paramtype);_4.setSelectOptions(_12._selectNode,_14,"");_12.set("loaded",true);});},update:function(_15,_16){var _17=this.getState("value",this.mxcontext.hasParam(this.parameter)?this.mxcontext.getParam(this.parameter):undefined);if(_17!==undefined){if(this.paramtype=="long"||this.paramtype=="float"){if(this._parameterInfo.isRange=="true"&&!(_17 instanceof Array)){_17=_5.find(this._parameterInfo.values,function(_18){return _17>=Number(_18[0])&&_17<=Number(_18[1]);});}var _19=(_17 instanceof Array)?_b(_17):_17;_4.selectOptionByText(this._selectNode,_19);}else{_4.selectOptionByValue(this._selectNode,String(_17));}}else{_4.selectOptionByValue(this._selectNode,"");}this._onChange();_16&&_16();},_getValue:function(){var _1a=_4.getSelectedValue(this._selectNode);if(this._parameterInfo.isRange&&this._parameterInfo.isRange=="true"&&_1a!=""){_1a=this._parameterInfo.values[parseInt(_1a,10)];}return _1a;},_onChange:function(){this.mxcontext.setParam(this.parameter,this._getValue());_6.publish("context_seed_"+this.mxform.hash,this.mxcontext);},storeState:function(_1b){_1b("value",this._getValue());}});return _11;});