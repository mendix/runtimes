/*
    Copyright (c) 2005-2015, Mendix bv. All rights reserved.
    See licenses.txt for third party licenses that apply.
*/

//>>built
define("reporting/widget/ReportParameter",["mxui/store/asyncValueStore","big/big","mxui/mixin/_Stateful","mxui/widget/_WidgetBase","mxui/dom","mendix/lang","dojo/topic","dojo/_base/declare"],function(_1,_2,_3,_4,_5,_6,_7,_8){var $=_5.create;function _9(_a){var _b=String(_a);return (_b.match(/true|false/))?mx.ui.translate("mxui.widget.DataGrid",_b):_a;};function _c(_d){var _e="reporting.widget.ReportParameter";if(_d[0]===""&&_d[1]===""){return window.mx.ui.translate(_e,"all");}else{if(_d[0]===""){return window.mx.ui.translate(_e,"less_than",_d[1].toString());}else{if(_d[1]===""){return window.mx.ui.translate(_e,"greater_than",_d[0].toString());}else{return window.mx.ui.translate(_e,"from_to",[_d[0].toString(),_d[1].toString()]);}}}};function _f(_10,_11){var ret=[];if(_11=="enum"){ret=_10;}else{if(_11=="boolean"||_11=="datetime"){if(typeof _10[0]=="string"){for(var i=0;i<_10.length;i++){ret.push([_10[i],_10[i]]);}}else{ret=_10;}}else{if(_11=="decimal"){if(_10.isRange){for(var i=0,val;val=_10.values[i];i++){ret.push([i,_c(val)]);}}else{ret={};for(var i=0,val;val=_10.values[i];i++){if(val[0]===""||val[1]===""){continue;}var _12=new _2(val[0]),to=new _2(val[1]);for(var j=_12;j.lt(to);j=j.plus(1)){ret[j.toString()]=j.toString();}}}}else{if(_10.values){ret=_10.values;}else{ret=_10;}}}}if(ret.length!=null){var old=ret;ret={};for(var i=0,val;val=old[i];i++){ret[val[0]]=_9(val[1]||val[0]);}}return ret;};var _13=_8([_4,_3],{parameter:"",paramtype:"",reportid:"",autoLoad:false,_selectNode:null,_parameterInfo:null,buildRendering:function(){this.domNode=$("div",{"class":"reportingReportParameter"},this._selectNode=$("select",{"class":"form-control"}));this.connect(this._selectNode,"change",function(e){e.stopPropagation();this._onChange();});},postCreate:function(){var _14=this;_1.retrieve(this.reportid,function(_15){_14._parameterInfo=_15[_14.parameter];if(!_14._parameterInfo){_14.set("loaded",true);return;}var _16=_f(_14._parameterInfo,_14.paramtype);_5.setSelectOptions(_14._selectNode,_16,"");_14.set("loaded",true);});},update:function(_17,_18){var _19=this.getState("value",this.mxcontext.hasParam(this.parameter)?this.mxcontext.getParam(this.parameter):undefined);if(_19!==undefined){if(this.paramtype=="decimal"){if(this._parameterInfo.isRange&&!(_19 instanceof Array)){var _1a=new _2(_19);_19=_6.find(this._parameterInfo.values,function(_1b){return (_1b[0]===""||_1a.gte(_1b[0]))&&(_1b[1]===""||_1a.lt(_1b[1]));});}var _1c=(_19 instanceof Array)?_c(_19):_19;_5.selectOptionByText(this._selectNode,_1c);}else{_5.selectOptionByValue(this._selectNode,_19.toString());}}else{_5.selectOptionByValue(this._selectNode,"");}this._onChange();_18&&_18();},_getValue:function(){var _1d=_5.getSelectedValue(this._selectNode);if(this._parameterInfo.isRange&&_1d!=""){_1d=this._parameterInfo.values[parseInt(_1d,10)];}return _1d;},_onChange:function(){this.mxcontext.setParam(this.parameter,this._getValue());_7.publish("context_seed_"+this.mxform.hash,this.mxcontext);},storeState:function(_1e){_1e("value",this._getValue());}});return _13;});